"use strict";(self.webpackChunkportfolio_all_in_one=self.webpackChunkportfolio_all_in_one||[]).push([[2743],{2743:(L,D,l)=>{l.d(D,{A:()=>M});var p=l(467),$=l(4438),y=l(4668),P=l(7673),S=l(4572),C=l(8810),R=l(9437),k=l(8141),g=l(6354);function v(s){return new Date(s).toISOString().split("T")[0]}var w=l(9972);let A=(()=>{class s{constructor(){this.methodCallCount={}}trackMethodCall(e){this.methodCallCount[e]||(this.methodCallCount[e]=0),this.methodCallCount[e]++,console.log(`${e} called ${this.methodCallCount[e]} times`)}getMethodCallCount(e){return this.methodCallCount[e]||0}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=$.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var b=function(s){return s.CATEGORY="categories_wise",s.STATUS="status_wise",s.DATE="date_wise",s}(b||{});let M=(()=>{class s{constructor(e,t){this.firebaseRealtimeDatabaseService=e,this.trackingService=t,this.basePath="topics-db",this.postEndpoint="posts",this.categoryEndpoint="categories",this.sprintEndpoint="sprints",this.checklistEndpoint="checklist",this.legacySpacesPath="spaces-db",this.newBasePath="topics-db",this.totalPosts=(0,$.vPA)(0),this.posts$=this.fetchPosts().pipe((0,y.t)(1)),this.categories$=this.fetchCategories().pipe((0,y.t)(1)),this.safePosts$=this.posts$.pipe((0,R.W)(a=>(this.handleError(a),(0,P.of)([])))),this.postsWithCategory$=(0,S.z)([this.posts$,this.categories$]).pipe((0,k.M)(([a])=>this.totalPosts.set(a.length)),(0,g.T)(([a,r])=>this.attachCategoryNames(a,r))),this.groupedCategories$=(0,S.z)([this.categories$,this.posts$]).pipe((0,g.T)(([a,r])=>a.reduce((n,o)=>{const c=r.filter(d=>d.categoryId===o.key);return(c.length?n.withPosts:n.withoutPosts).push({...o,posts:c}),n},{withPosts:[],withoutPosts:[]})))}fetchPosts(){return this.firebaseRealtimeDatabaseService.readRealtime$(`${this.basePath}/${this.postEndpoint}`)}fetchCategories(){return this.firebaseRealtimeDatabaseService.readRealtime$(`${this.basePath}/${this.categoryEndpoint}`)}attachCategoryNames(e,t){return e.map(a=>({...a,categoryName:t.find(r=>r.key===a.categoryId)?.title||"Uncategorized"}))}createPost(e){return this.firebaseRealtimeDatabaseService.create(`${this.basePath}/${this.postEndpoint}`,e)}updatePost(e,t){return this.firebaseRealtimeDatabaseService.update(`${this.basePath}/${this.postEndpoint}/${e}`,t)}removePost(e){return this.firebaseRealtimeDatabaseService.remove(`${this.basePath}/${this.postEndpoint}/${e}`)}removeMultiplePosts(e){var t=this;return(0,p.A)(function*(){const a=e.map(r=>t.removePost(r));yield Promise.all(a)})()}getPost(e){return this.firebaseRealtimeDatabaseService.readRealtimeOriginal$(`${this.basePath}/${this.postEndpoint}/${e}`)}getCategoriesWisePosts(){return this.postsWithCategory$.pipe((0,g.T)(e=>this.manageData(b.CATEGORY,e)))}createCategory(e){return this.firebaseRealtimeDatabaseService.create(`${this.basePath}/${this.categoryEndpoint}`,e)}removeCategory(e){return this.firebaseRealtimeDatabaseService.remove(`${this.basePath}/${this.categoryEndpoint}/${e}`)}getCategories(){return this.categories$}getCategory(e){return this.firebaseRealtimeDatabaseService.readRealtimeOriginal$(`${this.basePath}/${this.categoryEndpoint}/${e}`)}getCategoryById(e){return this.firebaseRealtimeDatabaseService.readRealtimeOriginal$(`${this.basePath}/${this.categoryEndpoint}/${e}`)}getPostsByCategoryId(e){return this.postsWithCategory$.pipe((0,g.T)(t=>t.filter(a=>a.categoryId===e)))}getPostsBySprintId(e){return this.postsWithCategory$.pipe((0,g.T)(t=>t.filter(a=>a.sprintId===e)))}filterPosts(e,t,a="All",r="createdAt",n="desc",o="",c=null){return this.postsWithCategory$.pipe((0,g.T)(h=>function B(s,i,e,t,a,r,n,o){const c=e.toLowerCase().trim();return function I(s,i,e="asc"){return[...s].sort((t,a)=>{const r=t[i],n=a[i],o=r<n?-1:r>n?1:0;return"asc"===e?o:-o})}(s,a,r).filter(h=>{const d=!i||h.categoryId===i,u=h.title?.toLowerCase().includes(c)||h.body?.toLowerCase().includes(c);return d&&u&&("All"===t||h.status===t)&&(!n||h.sprintId===n)&&(null===o||h.bookmark===o)})}(h,e,t,a,r,n,o,c)))}matchesSearch(e,t){const a=e.title?.toLowerCase().includes(t),r=e.body?.toLowerCase().includes(t);return!(!a&&!r)}handleError(e){return console.error("Error occurred:",e),(0,C.$)(()=>new Error("Unknown error occurred. Please try again later."))}manageData(e,t){let a,r;switch(e){case b.CATEGORY:a=n=>n.categoryId,r=n=>n.categoryName;break;case b.STATUS:a=n=>n.status,r=n=>n.status;break;case b.DATE:a=n=>v(n.updatedAt),r=n=>v(n.updatedAt);break;default:return[]}return function E(s,i,e){const t={};for(const a of s){const r=i(a),n=e(a);t[r]||(t[r]={key:r,title:n,data:[]}),t[r].data.push(a)}return Object.values(t)}(t,a,r)}createSprint(e){return this.firebaseRealtimeDatabaseService.create(`${this.basePath}/${this.sprintEndpoint}`,e)}getSprints(){return this.firebaseRealtimeDatabaseService.readRealtime$(`${this.basePath}/${this.sprintEndpoint}`)}getSprint(e){return this.firebaseRealtimeDatabaseService.readRealtimeOriginal$(`${this.basePath}/${this.sprintEndpoint}/${e}`)}updateSprint(e,t){return this.firebaseRealtimeDatabaseService.update(`${this.basePath}/${this.sprintEndpoint}/${e}`,t)}moveLists(e,t,a=!1){return(0,p.A)(function*(){})()}createChecklist(e){return this.firebaseRealtimeDatabaseService.create(`${this.basePath}/${this.checklistEndpoint}`,e)}updateChecklist(e,t){return this.firebaseRealtimeDatabaseService.update(`${this.basePath}/${this.checklistEndpoint}/${e}`,t)}getChecklist(){return this.firebaseRealtimeDatabaseService.readRealtime$(`${this.basePath}/${this.checklistEndpoint}`)}getChecklistByCategoryId(e){return this.firebaseRealtimeDatabaseService.readRealtimeWhere$(`${this.basePath}/${this.checklistEndpoint}`,{categoryId:e})}getChecklistByCategoryOrSpace(e,t){if(!e&&!t)throw new Error("categoryId or spaceId is required");return this.firebaseRealtimeDatabaseService.readRealtimeWhere$(`${this.basePath}/${this.checklistEndpoint}`,e?{categoryId:e}:{spaceId:t})}getChecklistById(e){return this.firebaseRealtimeDatabaseService.readRealtimeOriginal$(`${this.basePath}/${this.checklistEndpoint}/${e}`)}getChecklistItemsById(e){return this.firebaseRealtimeDatabaseService.readRealtime$(`${this.basePath}/${this.checklistEndpoint}/${e}/items`)}updateTitle(e,t){return this.firebaseRealtimeDatabaseService.update(`${this.basePath}/${this.checklistEndpoint}/${e}`,{title:t})}addItem(e,t,a=!1){return this.firebaseRealtimeDatabaseService.create(`${this.basePath}/${this.checklistEndpoint}/${e}/items`,{name:t,completed:a})}toggleItem(e,t,a){return this.firebaseRealtimeDatabaseService.update(`${this.basePath}/${this.checklistEndpoint}/${e}/items/${t}`,{completed:a})}renameItem(e,t,a){return this.firebaseRealtimeDatabaseService.update(`${this.basePath}/${this.checklistEndpoint}/${e}/items/${t}`,{name:a})}removeItem(e,t){return this.firebaseRealtimeDatabaseService.remove(`${this.basePath}/${this.checklistEndpoint}/${e}/items/${t}`)}createCheckListWithOrginalKey(e,t){var a=this;return(0,p.A)(function*(){yield a.firebaseRealtimeDatabaseService.set(`${a.basePath}/${a.checklistEndpoint}/${e}`,t)})()}addItemWithKey(e,t,a){return this.firebaseRealtimeDatabaseService.set(`${this.basePath}/${this.checklistEndpoint}/${e}/items/${t}`,{name:a.name,completed:a.completed})}checkIfExists(e){return this.firebaseRealtimeDatabaseService.readOnceOriginal(`${this.basePath}/${this.checklistEndpoint}/${e}`)}migrateLegacyData(){var e=this;return(0,p.A)(function*(){const t=yield e.firebaseRealtimeDatabaseService.readOnceOriginal(e.legacySpacesPath);if(t){for(const[a,r]of Object.entries(t))if(r?.lists)for(const[n,o]of Object.entries(r.lists)){const c=`${e.newBasePath}/${e.checklistEndpoint}/${n}`;(yield e.firebaseRealtimeDatabaseService.readOnceOriginal(c))||(yield e.firebaseRealtimeDatabaseService.set(c,{title:o.name??"Untitled Checklist",spaceId:a,listId:n,createdAt:Date.now()}));for(const[d,u]of Object.entries(o.checkslist||{}))yield e.firebaseRealtimeDatabaseService.set(`${c}/items/${d}`,{name:u.name,completed:u.completed??!1,createdAt:Date.now()})}console.log("\u2705 Legacy checklist migration completed")}})()}migrateSpacesToCategories(e){var t=this;return(0,p.A)(function*(){const a=yield t.firebaseRealtimeDatabaseService.readOnceOriginal("spaces-db");if(!a)return;const r=Object.entries(a),n=r.length;let o=0;for(const[c,h]of r){const d=`${t.basePath}/${t.categoryEndpoint}/${c}`;(yield t.firebaseRealtimeDatabaseService.readOnceOriginal(d))||(yield t.firebaseRealtimeDatabaseService.set(d,{title:h.name??"Untitled Space",spaceId:c,createdAt:Date.now()})),o++,e?.(o,n)}})()}backfillSpaceIdForChecklists(e){var t=this;return(0,p.A)(function*(){console.log("\u{1f504} Backfilling spaceId for forgotten checklists...");const[a,r]=yield Promise.all([t.firebaseRealtimeDatabaseService.readOnceOriginal("spaces-db"),t.firebaseRealtimeDatabaseService.readOnceOriginal(`${t.basePath}/${t.checklistEndpoint}`)]);if(!a||!r)return void e?.(0,0);const n=new Map;for(const[u,m]of Object.entries(a))for(const[f]of Object.entries(m.lists||{}))n.set(f,u);const o=Object.entries(r),c=o.length;e?.(0,c);let h=0,d=0;for(const[u,m]of o){if(!m.spaceId){const f=n.get(u);f&&(yield t.firebaseRealtimeDatabaseService.update(`${t.basePath}/${t.checklistEndpoint}/${u}`,{spaceId:f,categoryId:f}),h++)}d++,e?.(d,c)}console.log(`\u2705 Backfill completed (${h} checklists updated)`)})()}static{this.\u0275fac=function(t){return new(t||s)($.KVO(w.h),$.KVO(A))}}static{this.\u0275prov=$.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})()}}]);