"use strict";(self.webpackChunkportfolio_all_in_one=self.webpackChunkportfolio_all_in_one||[]).push([[2713],{2713:(rp,ec,fe)=>{fe.d(ec,{ek:()=>_u,gm:()=>vu,f8:()=>rr,C5:()=>Iu,Qi:()=>vn});var y=fe(5e3),Se=fe(655),z=fe(6197),mt=fe(9751),pe=fe(4004),kt=fe(9808),L=(fe(4202),fe(520)),N=(fe(259),fe(9996)),x=fe(531),V=fe(2090),Fe=fe(6881),ra=fe(1877),ti=fe(3475);const ia=function gt(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ni=new V.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ke=new ra.Yd("@firebase/auth");function ri(c,...s){ke.logLevel<=ra.in.ERROR&&ke.error(`Auth (${Fe.Jn}): ${c}`,...s)}function Ne(c,...s){throw He(c,...s)}function tt(c,...s){return He(c,...s)}function ii(c,s,a){const l=Object.assign(Object.assign({},ia()),{[s]:a});return new V.LL("auth","Firebase",l).create(s,{appName:c.name})}function He(c,...s){if("string"!=typeof c){const a=s[0],l=[...s.slice(1)];return l[0]&&(l[0].appName=c.name),c._errorFactory.create(a,...l)}return ni.create(c,...s)}function D(c,s,...a){if(!c)throw He(s,...a)}function ut(c){const s="INTERNAL ASSERTION FAILED: "+c;throw ri(s),new Error(s)}function Nt(c,s){c||ut(s)}const $t=new Map;function ct(c){Nt(c instanceof Function,"Expected a class definition");let s=$t.get(c);return s?(Nt(s instanceof c,"Instance stored in cache mismatched with class"),s):(s=new c,$t.set(c,s),s)}function dr(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function fr(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class zt{constructor(s,a){this.shortDelay=s,this.longDelay=a,Nt(a>s,"Short delay should be less than long delay!"),this.isMobile=(0,V.uI)()||(0,V.b$)()}get(){return function Cs(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(function si(){return"http:"===fr()||"https:"===fr()}()||(0,V.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ps(c,s){Nt(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return s?`${a}${s.startsWith("/")?s.slice(1):s}`:a}class oa{static initialize(s,a,l){this.fetchImpl=s,a&&(this.headersImpl=a),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void ut("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void ut("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void ut("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Os={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},aa=new zt(3e4,6e4);function ve(c,s){return c.tenantId&&!s.tenantId?Object.assign(Object.assign({},s),{tenantId:c.tenantId}):s}function le(c,s,a,l){return Ms.apply(this,arguments)}function Ms(){return(Ms=(0,x.Z)(function*(c,s,a,l,f={}){return wn(c,f,(0,x.Z)(function*(){let m={},v={};l&&("GET"===s?v=l:m={body:JSON.stringify(l)});const E=(0,V.xO)(Object.assign({key:c.config.apiKey},v)).slice(1),P=yield c._getAdditionalHeaders();return P["Content-Type"]="application/json",c.languageCode&&(P["X-Firebase-Locale"]=c.languageCode),oa.fetch()(oi(c,c.config.apiHost,a,E),Object.assign({method:s,headers:P,referrerPolicy:"no-referrer"},m))}))})).apply(this,arguments)}function wn(c,s,a){return Ls.apply(this,arguments)}function Ls(){return(Ls=(0,x.Z)(function*(c,s,a){c._canInitEmulator=!1;const l=Object.assign(Object.assign({},Os),s);try{const f=new ua(c),m=yield Promise.race([a(),f.promise]);f.clearNetworkTimeout();const v=yield m.json();if("needConfirmation"in v)throw bn(c,"account-exists-with-different-credential",v);if(m.ok&&!("errorMessage"in v))return v;{const E=m.ok?v.errorMessage:v.error.message,[P,G]=E.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===P)throw bn(c,"credential-already-in-use",v);if("EMAIL_EXISTS"===P)throw bn(c,"email-already-in-use",v);if("USER_DISABLED"===P)throw bn(c,"user-disabled",v);const U=l[P]||P.toLowerCase().replace(/[_\s]+/g,"-");if(G)throw ii(c,U,G);Ne(c,U)}}catch(f){if(f instanceof V.ZR)throw f;Ne(c,"network-request-failed")}})).apply(this,arguments)}function _t(c,s,a,l){return En.apply(this,arguments)}function En(){return(En=(0,x.Z)(function*(c,s,a,l,f={}){const m=yield le(c,s,a,l,f);return"mfaPendingCredential"in m&&Ne(c,"multi-factor-auth-required",{_serverResponse:m}),m})).apply(this,arguments)}function oi(c,s,a,l){const f=`${s}${a}?${l}`;return c.config.emulator?Ps(c.config,f):`${c.config.apiScheme}://${f}`}class ua{constructor(s){this.auth=s,this.timer=null,this.promise=new Promise((a,l)=>{this.timer=setTimeout(()=>l(tt(this.auth,"network-request-failed")),aa.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function bn(c,s,a){const l={appName:c.name};a.email&&(l.email=a.email),a.phoneNumber&&(l.phoneNumber=a.phoneNumber);const f=tt(c,s,l);return f.customData._tokenResponse=a,f}function xn(){return(xn=(0,x.Z)(function*(c,s){return le(c,"POST","/v1/accounts:delete",s)})).apply(this,arguments)}function Us(c,s){return mr.apply(this,arguments)}function mr(){return(mr=(0,x.Z)(function*(c,s){return le(c,"POST","/v1/accounts:lookup",s)})).apply(this,arguments)}function An(c){if(c)try{const s=new Date(Number(c));if(!isNaN(s.getTime()))return s.toUTCString()}catch(s){}}function ai(){return(ai=(0,x.Z)(function*(c,s=!1){const a=(0,V.m9)(c),l=yield a.getIdToken(s),f=Sn(l);D(f&&f.exp&&f.auth_time&&f.iat,a.auth,"internal-error");const m="object"==typeof f.firebase?f.firebase:void 0,v=null==m?void 0:m.sign_in_provider;return{claims:f,token:l,authTime:An(ui(f.auth_time)),issuedAtTime:An(ui(f.iat)),expirationTime:An(ui(f.exp)),signInProvider:v||null,signInSecondFactor:(null==m?void 0:m.sign_in_second_factor)||null}})).apply(this,arguments)}function ui(c){return 1e3*Number(c)}function Sn(c){const[s,a,l]=c.split(".");if(void 0===s||void 0===a||void 0===l)return ri("JWT malformed, contained fewer than 3 sections"),null;try{const f=(0,V.tV)(a);return f?JSON.parse(f):(ri("Failed to decode base64 JWT payload"),null)}catch(f){return ri("Caught error parsing JWT payload as JSON",null==f?void 0:f.toString()),null}}function vt(c,s){return gr.apply(this,arguments)}function gr(){return(gr=(0,x.Z)(function*(c,s,a=!1){if(a)return s;try{return yield s}catch(l){throw l instanceof V.ZR&&Vs(l)&&c.auth.currentUser===c&&(yield c.auth.signOut()),l}})).apply(this,arguments)}function Vs({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}class qs{constructor(s){this.user=s,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(s){var a;if(s){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const f=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,f)}}schedule(s=!1){var a=this;if(!this.isRunning)return;const l=this.getInterval(s);this.timerId=setTimeout((0,x.Z)(function*(){yield a.iteration()}),l)}iteration(){var s=this;return(0,x.Z)(function*(){try{yield s.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===(null==a?void 0:a.code)&&s.schedule(!0))}s.schedule()})()}}class Ie{constructor(s,a){this.createdAt=s,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=An(this.lastLoginAt),this.creationTime=An(this.createdAt)}_copy(s){this.createdAt=s.createdAt,this.lastLoginAt=s.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function me(c){return kn.apply(this,arguments)}function kn(){return(kn=(0,x.Z)(function*(c){var s;const a=c.auth,l=yield c.getIdToken(),f=yield vt(c,Us(a,{idToken:l}));D(null==f?void 0:f.users.length,a,"internal-error");const m=f.users[0];c._notifyReloadListener(m);const v=null!==(s=m.providerUserInfo)&&void 0!==s&&s.length?ha(m.providerUserInfo):[],E=ic(c.providerData,v),U=!!c.isAnonymous&&!(c.email&&m.passwordHash||null!=E&&E.length),te={uid:m.localId,displayName:m.displayName||null,photoURL:m.photoUrl||null,email:m.email||null,emailVerified:m.emailVerified||!1,phoneNumber:m.phoneNumber||null,tenantId:m.tenantId||null,providerData:E,metadata:new Ie(m.createdAt,m.lastLoginAt),isAnonymous:U};Object.assign(c,te)})).apply(this,arguments)}function Bs(){return(Bs=(0,x.Z)(function*(c){const s=(0,V.m9)(c);yield me(s),yield s.auth._persistUserIfCurrent(s),s.auth._notifyListenersIfCurrent(s)})).apply(this,arguments)}function ic(c,s){return[...c.filter(l=>!s.some(f=>f.providerId===l.providerId)),...s]}function ha(c){return c.map(s=>{var{providerId:a}=s,l=(0,Se._T)(s,["providerId"]);return{providerId:a,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}function js(){return(js=(0,x.Z)(function*(c,s){const a=yield wn(c,{},(0,x.Z)(function*(){const l=(0,V.xO)({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:f,apiKey:m}=c.config,v=oi(c,f,"/v1/token",`key=${m}`),E=yield c._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",oa.fetch()(v,{method:"POST",headers:E,body:l})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class Nn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(s){D(s.idToken,"internal-error"),D(void 0!==s.idToken,"internal-error"),D(void 0!==s.refreshToken,"internal-error");const a="expiresIn"in s&&void 0!==s.expiresIn?Number(s.expiresIn):function la(c){const s=Sn(c);return D(s,"internal-error"),D(void 0!==s.exp,"internal-error"),D(void 0!==s.iat,"internal-error"),Number(s.exp)-Number(s.iat)}(s.idToken);this.updateTokensAndExpiration(s.idToken,s.refreshToken,a)}getToken(s,a=!1){var l=this;return(0,x.Z)(function*(){return D(!l.accessToken||l.refreshToken,s,"user-token-expired"),a||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(s,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(s,a){var l=this;return(0,x.Z)(function*(){const{accessToken:f,refreshToken:m,expiresIn:v}=yield function sc(c,s){return js.apply(this,arguments)}(s,a);l.updateTokensAndExpiration(f,m,Number(v))})()}updateTokensAndExpiration(s,a,l){this.refreshToken=a||null,this.accessToken=s||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(s,a){const{refreshToken:l,accessToken:f,expirationTime:m}=a,v=new Nn;return l&&(D("string"==typeof l,"internal-error",{appName:s}),v.refreshToken=l),f&&(D("string"==typeof f,"internal-error",{appName:s}),v.accessToken=f),m&&(D("number"==typeof m,"internal-error",{appName:s}),v.expirationTime=m),v}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(s){this.accessToken=s.accessToken,this.refreshToken=s.refreshToken,this.expirationTime=s.expirationTime}_clone(){return Object.assign(new Nn,this.toJSON())}_performRefresh(){return ut("not implemented")}}function lt(c,s){D("string"==typeof c||void 0===c,"internal-error",{appName:s})}class Wt{constructor(s){var{uid:a,auth:l,stsTokenManager:f}=s,m=(0,Se._T)(s,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new qs(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=l,this.stsTokenManager=f,this.accessToken=f.accessToken,this.displayName=m.displayName||null,this.email=m.email||null,this.emailVerified=m.emailVerified||!1,this.phoneNumber=m.phoneNumber||null,this.photoURL=m.photoURL||null,this.isAnonymous=m.isAnonymous||!1,this.tenantId=m.tenantId||null,this.providerData=m.providerData?[...m.providerData]:[],this.metadata=new Ie(m.createdAt||void 0,m.lastLoginAt||void 0)}getIdToken(s){var a=this;return(0,x.Z)(function*(){const l=yield vt(a,a.stsTokenManager.getToken(a.auth,s));return D(l,a.auth,"internal-error"),a.accessToken!==l&&(a.accessToken=l,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),l})()}getIdTokenResult(s){return function rc(c){return ai.apply(this,arguments)}(this,s)}reload(){return function Gs(c){return Bs.apply(this,arguments)}(this)}_assign(s){this!==s&&(D(this.uid===s.uid,this.auth,"internal-error"),this.displayName=s.displayName,this.photoURL=s.photoURL,this.email=s.email,this.emailVerified=s.emailVerified,this.phoneNumber=s.phoneNumber,this.isAnonymous=s.isAnonymous,this.tenantId=s.tenantId,this.providerData=s.providerData.map(a=>Object.assign({},a)),this.metadata._copy(s.metadata),this.stsTokenManager._assign(s.stsTokenManager))}_clone(s){return new Wt(Object.assign(Object.assign({},this),{auth:s,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(s){D(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=s,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(s){this.reloadListener?this.reloadListener(s):this.reloadUserInfo=s}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(s,a=!1){var l=this;return(0,x.Z)(function*(){let f=!1;s.idToken&&s.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(s),f=!0),a&&(yield me(l)),yield l.auth._persistUserIfCurrent(l),f&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var s=this;return(0,x.Z)(function*(){const a=yield s.getIdToken();return yield vt(s,function ca(c,s){return xn.apply(this,arguments)}(s.auth,{idToken:a})),s.stsTokenManager.clearRefreshToken(),s.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(s=>Object.assign({},s)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(s,a){var l,f,m,v,E,P,G,U;const te=null!==(l=a.displayName)&&void 0!==l?l:void 0,at=null!==(f=a.email)&&void 0!==f?f:void 0,Xe=null!==(m=a.phoneNumber)&&void 0!==m?m:void 0,We=null!==(v=a.photoURL)&&void 0!==v?v:void 0,as=null!==(E=a.tenantId)&&void 0!==E?E:void 0,us=null!==(P=a._redirectEventId)&&void 0!==P?P:void 0,ir=null!==(G=a.createdAt)&&void 0!==G?G:void 0,Oo=null!==(U=a.lastLoginAt)&&void 0!==U?U:void 0,{uid:cs,emailVerified:Mo,isAnonymous:Tu,providerData:Lo,stsTokenManager:sr}=a;D(cs&&sr,s,"internal-error");const Fo=Nn.fromJSON(this.name,sr);D("string"==typeof cs,s,"internal-error"),lt(te,s.name),lt(at,s.name),D("boolean"==typeof Mo,s,"internal-error"),D("boolean"==typeof Tu,s,"internal-error"),lt(Xe,s.name),lt(We,s.name),lt(as,s.name),lt(us,s.name),lt(ir,s.name),lt(Oo,s.name);const Uo=new Wt({uid:cs,auth:s,email:at,emailVerified:Mo,displayName:te,isAnonymous:Tu,photoURL:We,phoneNumber:Xe,tenantId:as,stsTokenManager:Fo,createdAt:ir,lastLoginAt:Oo});return Lo&&Array.isArray(Lo)&&(Uo.providerData=Lo.map(wu=>Object.assign({},wu))),us&&(Uo._redirectEventId=us),Uo}static _fromIdTokenResponse(s,a,l=!1){return(0,x.Z)(function*(){const f=new Nn;f.updateFromServerResponse(a);const m=new Wt({uid:a.localId,auth:s,stsTokenManager:f,isAnonymous:l});return yield me(m),m})()}}const Ks=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,x.Z)(function*(){return!0})()}_set(a,l){var f=this;return(0,x.Z)(function*(){f.storage[a]=l})()}_get(a){var l=this;return(0,x.Z)(function*(){const f=l.storage[a];return void 0===f?null:f})()}_remove(a){var l=this;return(0,x.Z)(function*(){delete l.storage[a]})()}_addListener(a,l){}_removeListener(a,l){}}return c.type="NONE",c})();function ci(c,s,a){return`firebase:${c}:${s}:${a}`}class It{constructor(s,a,l){this.persistence=s,this.auth=a,this.userKey=l;const{config:f,name:m}=this.auth;this.fullUserKey=ci(this.userKey,f.apiKey,m),this.fullPersistenceKey=ci("persistence",f.apiKey,m),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(s){return this.persistence._set(this.fullUserKey,s.toJSON())}getCurrentUser(){var s=this;return(0,x.Z)(function*(){const a=yield s.persistence._get(s.fullUserKey);return a?Wt._fromJSON(s.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(s){var a=this;return(0,x.Z)(function*(){if(a.persistence===s)return;const l=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=s,l?a.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(s,a,l="authUser"){return(0,x.Z)(function*(){if(!a.length)return new It(ct(Ks),s,l);const f=(yield Promise.all(a.map(function(){var G=(0,x.Z)(function*(U){if(yield U._isAvailable())return U});return function(U){return G.apply(this,arguments)}}()))).filter(G=>G);let m=f[0]||ct(Ks);const v=ci(l,s.config.apiKey,s.name);let E=null;for(const G of a)try{const U=yield G._get(v);if(U){const te=Wt._fromJSON(s,U);G!==m&&(E=te),m=G;break}}catch(U){}const P=f.filter(G=>G._shouldAllowMigration);return m._shouldAllowMigration&&P.length?(m=P[0],E&&(yield m._set(v,E.toJSON())),yield Promise.all(a.map(function(){var G=(0,x.Z)(function*(U){if(U!==m)try{yield U._remove(v)}catch(te){}});return function(U){return G.apply(this,arguments)}}())),new It(m,s,l)):new It(m,s,l)})()}}function li(c){const s=c.toLowerCase();if(s.includes("opera/")||s.includes("opr/")||s.includes("opios/"))return"Opera";if(Dn(s))return"IEMobile";if(s.includes("msie")||s.includes("trident/"))return"IE";if(s.includes("edge/"))return"Edge";if(hi(s))return"Firefox";if(s.includes("silk/"))return"Silk";if(zs(s))return"Blackberry";if(Ws(s))return"Webos";if(di(s))return"Safari";if((s.includes("chrome/")||fa(s))&&!s.includes("edge/"))return"Chrome";if($s(s))return"Android";{const l=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==l?void 0:l.length))return l[1]}return"Other"}function hi(c=(0,V.z$)()){return/firefox\//i.test(c)}function di(c=(0,V.z$)()){const s=c.toLowerCase();return s.includes("safari/")&&!s.includes("chrome/")&&!s.includes("crios/")&&!s.includes("android")}function fa(c=(0,V.z$)()){return/crios\//i.test(c)}function Dn(c=(0,V.z$)()){return/iemobile/i.test(c)}function $s(c=(0,V.z$)()){return/android/i.test(c)}function zs(c=(0,V.z$)()){return/blackberry/i.test(c)}function Ws(c=(0,V.z$)()){return/webos/i.test(c)}function Zt(c=(0,V.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function pa(c=(0,V.z$)()){return Zt(c)||$s(c)||Ws(c)||zs(c)||/windows phone/i.test(c)||Dn(c)}function Dt(c,s=[]){let a;switch(c){case"Browser":a=li((0,V.z$)());break;case"Worker":a=`${li((0,V.z$)())}-${c}`;break;default:a=c}const l=s.length?s.join(","):"FirebaseCore-web";return`${a}/JsCore/${Fe.Jn}/${l}`}class ma{constructor(s){this.auth=s,this.queue=[]}pushCallback(s,a){const l=m=>new Promise((v,E)=>{try{v(s(m))}catch(P){E(P)}});l.onAbort=a,this.queue.push(l);const f=this.queue.length-1;return()=>{this.queue[f]=()=>Promise.resolve()}}runMiddleware(s){var a=this;return(0,x.Z)(function*(){if(a.auth.currentUser===s)return;const l=[];try{for(const f of a.queue)yield f(s),f.onAbort&&l.push(f.onAbort)}catch(f){l.reverse();for(const m of l)try{m()}catch(v){}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null==f?void 0:f.message})}})()}}class fi{constructor(s,a,l){this.app=s,this.heartbeatServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Rn(this),this.idTokenSubscription=new Rn(this),this.beforeStateQueue=new ma(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ni,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=s.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(s,a){var l=this;return a&&(this._popupRedirectResolver=ct(a)),this._initializationPromise=this.queue((0,x.Z)(function*(){var f,m;if(!l._deleted&&(l.persistenceManager=yield It.create(l,s),!l._deleted)){if(null!==(f=l._popupRedirectResolver)&&void 0!==f&&f._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch(v){}yield l.initializeCurrentUser(a),l.lastNotifiedUid=(null===(m=l.currentUser)||void 0===m?void 0:m.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var s=this;return(0,x.Z)(function*(){if(s._deleted)return;const a=yield s.assertedPersistence.getCurrentUser();if(s.currentUser||a){if(s.currentUser&&a&&s.currentUser.uid===a.uid)return s._currentUser._assign(a),void(yield s.currentUser.getIdToken());yield s._updateCurrentUser(a,!0)}})()}initializeCurrentUser(s){var a=this;return(0,x.Z)(function*(){var l;const f=yield a.assertedPersistence.getCurrentUser();let m=f,v=!1;if(s&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const E=null===(l=a.redirectUser)||void 0===l?void 0:l._redirectEventId,P=null==m?void 0:m._redirectEventId,G=yield a.tryRedirectSignIn(s);(!E||E===P)&&(null==G?void 0:G.user)&&(m=G.user,v=!0)}if(!m)return a.directlySetCurrentUser(null);if(!m._redirectEventId){if(v)try{yield a.beforeStateQueue.runMiddleware(m)}catch(E){m=f,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(E))}return m?a.reloadAndSetCurrentUserOrClear(m):a.directlySetCurrentUser(null)}return D(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===m._redirectEventId?a.directlySetCurrentUser(m):a.reloadAndSetCurrentUserOrClear(m)})()}tryRedirectSignIn(s){var a=this;return(0,x.Z)(function*(){let l=null;try{l=yield a._popupRedirectResolver._completeRedirectFn(a,s,!0)}catch(f){yield a._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(s){var a=this;return(0,x.Z)(function*(){try{yield me(s)}catch(l){if("auth/network-request-failed"!==(null==l?void 0:l.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(s)})()}useDeviceLanguage(){this.languageCode=function Rs(){if("undefined"==typeof navigator)return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var s=this;return(0,x.Z)(function*(){s._deleted=!0})()}updateCurrentUser(s){var a=this;return(0,x.Z)(function*(){const l=s?(0,V.m9)(s):null;return l&&D(l.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(l&&l._clone(a))})()}_updateCurrentUser(s,a=!1){var l=this;return(0,x.Z)(function*(){if(!l._deleted)return s&&D(l.tenantId===s.tenantId,l,"tenant-id-mismatch"),a||(yield l.beforeStateQueue.runMiddleware(s)),l.queue((0,x.Z)(function*(){yield l.directlySetCurrentUser(s),l.notifyAuthListeners()}))})()}signOut(){var s=this;return(0,x.Z)(function*(){return yield s.beforeStateQueue.runMiddleware(null),(s.redirectPersistenceManager||s._popupRedirectResolver)&&(yield s._setRedirectUser(null)),s._updateCurrentUser(null,!0)})()}setPersistence(s){var a=this;return this.queue((0,x.Z)(function*(){yield a.assertedPersistence.setPersistence(ct(s))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(s){this._errorFactory=new V.LL("auth","Firebase",s())}onAuthStateChanged(s,a,l){return this.registerStateListener(this.authStateSubscription,s,a,l)}beforeAuthStateChanged(s,a){return this.beforeStateQueue.pushCallback(s,a)}onIdTokenChanged(s,a,l){return this.registerStateListener(this.idTokenSubscription,s,a,l)}toJSON(){var s;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(s=this._currentUser)||void 0===s?void 0:s.toJSON()}}_setRedirectUser(s,a){var l=this;return(0,x.Z)(function*(){const f=yield l.getOrInitRedirectPersistenceManager(a);return null===s?f.removeCurrentUser():f.setCurrentUser(s)})()}getOrInitRedirectPersistenceManager(s){var a=this;return(0,x.Z)(function*(){if(!a.redirectPersistenceManager){const l=s&&ct(s)||a._popupRedirectResolver;D(l,a,"argument-error"),a.redirectPersistenceManager=yield It.create(a,[ct(l._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(s){var a=this;return(0,x.Z)(function*(){var l,f;return a._isInitialized&&(yield a.queue((0,x.Z)(function*(){}))),(null===(l=a._currentUser)||void 0===l?void 0:l._redirectEventId)===s?a._currentUser:(null===(f=a.redirectUser)||void 0===f?void 0:f._redirectEventId)===s?a.redirectUser:null})()}_persistUserIfCurrent(s){var a=this;return(0,x.Z)(function*(){if(s===a.currentUser)return a.queue((0,x.Z)(function*(){return a.directlySetCurrentUser(s)}))})()}_notifyListenersIfCurrent(s){s===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(a=null===(s=this.currentUser)||void 0===s?void 0:s.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(s,a,l,f){if(this._deleted)return()=>{};const m="function"==typeof a?a:a.next.bind(a),v=this._isInitialized?Promise.resolve():this._initializationPromise;return D(v,this,"internal-error"),v.then(()=>m(this.currentUser)),"function"==typeof a?s.addObserver(a,l,f):s.addObserver(a)}directlySetCurrentUser(s){var a=this;return(0,x.Z)(function*(){a.currentUser&&a.currentUser!==s&&a._currentUser._stopProactiveRefresh(),s&&a.isProactiveRefreshEnabled&&s._startProactiveRefresh(),a.currentUser=s,s?yield a.assertedPersistence.setCurrentUser(s):yield a.assertedPersistence.removeCurrentUser()})()}queue(s){return this.operations=this.operations.then(s,s),this.operations}get assertedPersistence(){return D(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(s){!s||this.frameworks.includes(s)||(this.frameworks.push(s),this.frameworks.sort(),this.clientVersion=Dt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var s=this;return(0,x.Z)(function*(){var a;const l={"X-Client-Version":s.clientVersion};s.app.options.appId&&(l["X-Firebase-gmpid"]=s.app.options.appId);const f=yield null===(a=s.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return f&&(l["X-Firebase-Client"]=f),l})()}}function Ve(c){return(0,V.m9)(c)}class Rn{constructor(s){this.auth=s,this.observer=null,this.addObserver=(0,V.ne)(a=>this.observer=a)}get next(){return D(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Re(c){const s=c.indexOf(":");return s<0?"":c.substr(0,s+1)}function Pn(c){if(!c)return null;const s=Number(c);return isNaN(s)?null:s}class Zs{constructor(s,a){this.providerId=s,this.signInMethod=a}toJSON(){return ut("not implemented")}_getIdTokenResponse(s){return ut("not implemented")}_linkToIdToken(s,a){return ut("not implemented")}_getReauthenticationResolver(s){return ut("not implemented")}}function Ht(){return(Ht=(0,x.Z)(function*(c,s){return le(c,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function On(){return(On=(0,x.Z)(function*(c,s){return _t(c,"POST","/v1/accounts:signInWithPassword",ve(c,s))})).apply(this,arguments)}function Ii(){return(Ii=(0,x.Z)(function*(c,s){return _t(c,"POST","/v1/accounts:signInWithEmailLink",ve(c,s))})).apply(this,arguments)}function Qt(){return(Qt=(0,x.Z)(function*(c,s){return _t(c,"POST","/v1/accounts:signInWithEmailLink",ve(c,s))})).apply(this,arguments)}class nt extends Zs{constructor(s,a,l,f=null){super("password",l),this._email=s,this._password=a,this._tenantId=f}static _fromEmailAndPassword(s,a){return new nt(s,a,"password")}static _fromEmailAndCode(s,a,l=null){return new nt(s,a,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(s){var a=this;return(0,x.Z)(function*(){switch(a.signInMethod){case"password":return function Ys(c,s){return On.apply(this,arguments)}(s,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function Ir(c,s){return Ii.apply(this,arguments)}(s,{email:a._email,oobCode:a._password});default:Ne(s,"internal-error")}})()}_linkToIdToken(s,a){var l=this;return(0,x.Z)(function*(){switch(l.signInMethod){case"password":return function Hs(c,s){return Ht.apply(this,arguments)}(s,{idToken:a,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function Ti(c,s){return Qt.apply(this,arguments)}(s,{idToken:a,email:l._email,oobCode:l._password});default:Ne(s,"internal-error")}})()}_getReauthenticationResolver(s){return this._getIdTokenResponse(s)}}function rt(c,s){return Js.apply(this,arguments)}function Js(){return(Js=(0,x.Z)(function*(c,s){return _t(c,"POST","/v1/accounts:signInWithIdp",ve(c,s))})).apply(this,arguments)}class Un{constructor(s){var a,l,f,m,v,E;const P=(0,V.zd)((0,V.pd)(s)),G=null!==(a=P.apiKey)&&void 0!==a?a:null,U=null!==(l=P.oobCode)&&void 0!==l?l:null,te=function Tr(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(f=P.mode)&&void 0!==f?f:null);D(G&&U&&te,"argument-error"),this.apiKey=G,this.operation=te,this.code=U,this.continueUrl=null!==(m=P.continueUrl)&&void 0!==m?m:null,this.languageCode=null!==(v=P.languageCode)&&void 0!==v?v:null,this.tenantId=null!==(E=P.tenantId)&&void 0!==E?E:null}static parseLink(s){const a=function lc(c){const s=(0,V.zd)((0,V.pd)(c)).link,a=s?(0,V.zd)((0,V.pd)(s)).deep_link_id:null,l=(0,V.zd)((0,V.pd)(c)).deep_link_id;return(l?(0,V.zd)((0,V.pd)(l)).link:null)||l||a||s||c}(s);try{return new Un(a)}catch(l){return null}}}let wa=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(a,l){return nt._fromEmailAndPassword(a,l)}static credentialWithLink(a,l){const f=Un.parseLink(l);return D(f,"argument-error"),nt._fromEmailAndCode(a,f.code,f.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class Rt{constructor(s){this.providerId=s,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(s){this.defaultLanguageCode=s}setCustomParameters(s){return this.customParameters=s,this}getCustomParameters(){return this.customParameters}}class hc extends Rt{constructor(){super(...arguments),this.scopes=[]}addScope(s){return this.scopes.includes(s)||this.scopes.push(s),this}getScopes(){return[...this.scopes]}}function ba(c,s){return Ei.apply(this,arguments)}function Ei(){return(Ei=(0,x.Z)(function*(c,s){return _t(c,"POST","/v1/accounts:signUp",ve(c,s))})).apply(this,arguments)}class ze{constructor(s){this.user=s.user,this.providerId=s.providerId,this._tokenResponse=s._tokenResponse,this.operationType=s.operationType}static _fromIdTokenResponse(s,a,l,f=!1){return(0,x.Z)(function*(){const m=yield Wt._fromIdTokenResponse(s,l,f),v=bi(l);return new ze({user:m,providerId:v,_tokenResponse:l,operationType:a})})()}static _forOperation(s,a,l){return(0,x.Z)(function*(){yield s._updateTokensIfNecessary(l,!0);const f=bi(l);return new ze({user:s,providerId:f,_tokenResponse:l,operationType:a})})()}}function bi(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}class wr extends V.ZR{constructor(s,a,l,f){var m;super(a.code,a.message),this.operationType=l,this.user=f,Object.setPrototypeOf(this,wr.prototype),this.customData={appName:s.name,tenantId:null!==(m=s.tenantId)&&void 0!==m?m:void 0,_serverResponse:a.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(s,a,l,f){return new wr(s,a,l,f)}}function Ai(c,s,a,l){return("reauthenticate"===s?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(m=>{throw"auth/multi-factor-auth-required"===m.code?wr._fromErrorAndOperation(c,m,s,l):m})}function Vn(c,s){return Jt.apply(this,arguments)}function Jt(){return(Jt=(0,x.Z)(function*(c,s,a=!1){const l=yield vt(c,s._linkToIdToken(c.auth,yield c.getIdToken()),a);return ze._forOperation(c,"link",l)})).apply(this,arguments)}function tn(){return(tn=(0,x.Z)(function*(c,s,a=!1){const{auth:l}=c,f="reauthenticate";try{const m=yield vt(c,Ai(l,f,s,c),a);D(m.idToken,l,"internal-error");const v=Sn(m.idToken);D(v,l,"internal-error");const{sub:E}=v;return D(c.uid===E,l,"user-mismatch"),ze._forOperation(c,f,m)}catch(m){throw"auth/user-not-found"===(null==m?void 0:m.code)&&Ne(l,"user-mismatch"),m}})).apply(this,arguments)}function qn(c,s){return io.apply(this,arguments)}function io(){return(io=(0,x.Z)(function*(c,s,a=!1){const l="signIn",f=yield Ai(c,l,s),m=yield ze._fromIdTokenResponse(c,l,f);return a||(yield c._updateCurrentUser(m.user)),m})).apply(this,arguments)}function Si(){return(Si=(0,x.Z)(function*(c,s){return qn(Ve(c),s)})).apply(this,arguments)}function Oi(){return(Oi=(0,x.Z)(function*(c,s,a){const l=Ve(c),f=yield ba(l,{returnSecureToken:!0,email:s,password:a}),m=yield ze._fromIdTokenResponse(l,"signIn",f);return yield l._updateCurrentUser(m.user),m})).apply(this,arguments)}const Ar="__sak";class Ua{constructor(s,a){this.storageRetriever=s,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Ar,"1"),this.storage.removeItem(Ar),Promise.resolve(!0)):Promise.resolve(!1)}catch(s){return Promise.resolve(!1)}}_set(s,a){return this.storage.setItem(s,JSON.stringify(a)),Promise.resolve()}_get(s){const a=this.storage.getItem(s);return Promise.resolve(a?JSON.parse(a):null)}_remove(s){return this.storage.removeItem(s),Promise.resolve()}get storage(){return this.storageRetriever()}}const $n=(()=>{class c extends Ua{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,l)=>this.onStorageEvent(a,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Jh(){const c=(0,V.z$)();return di(c)||Zt(c)}()&&function ac(){try{return!(!window||window===window.top)}catch(c){return!1}}(),this.fallbackToPolling=pa(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const l of Object.keys(this.listeners)){const f=this.storage.getItem(l),m=this.localCache[l];f!==m&&a(l,m,f)}}onStorageEvent(a,l=!1){if(!a.key)return void this.forAllChangedKeys((E,P,G)=>{this.notifyListeners(E,G)});const f=a.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const E=this.storage.getItem(f);if(a.newValue!==E)null!==a.newValue?this.storage.setItem(f,a.newValue):this.storage.removeItem(f);else if(this.localCache[f]===a.newValue&&!l)return}const m=()=>{const E=this.storage.getItem(f);!l&&this.localCache[f]===E||this.notifyListeners(f,E)},v=this.storage.getItem(f);!function Cn(){return(0,V.w1)()&&10===document.documentMode}()||v===a.newValue||a.newValue===a.oldValue?m():setTimeout(m,10)}notifyListeners(a,l){this.localCache[a]=l;const f=this.listeners[a];if(f)for(const m of Array.from(f))m(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,l,f)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:l,newValue:f}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,l){var f=()=>super._set,m=this;return(0,x.Z)(function*(){yield f().call(m,a,l),m.localCache[a]=JSON.stringify(l)})()}_get(a){var l=()=>super._get,f=this;return(0,x.Z)(function*(){const m=yield l().call(f,a);return f.localCache[a]=JSON.stringify(m),m})()}_remove(a){var l=()=>super._remove,f=this;return(0,x.Z)(function*(){yield l().call(f,a),delete f.localCache[a]})()}}return c.type="LOCAL",c})(),oe=(()=>{class c extends Ua{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,l){}_removeListener(a,l){}}return c.type="SESSION",c})();let Sr=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const l=this.receivers.find(m=>m.isListeningto(a));if(l)return l;const f=new c(a);return this.receivers.push(f),f}isListeningto(a){return this.eventTarget===a}handleEvent(a){var l=this;return(0,x.Z)(function*(){const f=a,{eventId:m,eventType:v,data:E}=f.data,P=l.handlersMap[v];if(null==P||!P.size)return;f.ports[0].postMessage({status:"ack",eventId:m,eventType:v});const G=Array.from(P).map(function(){var te=(0,x.Z)(function*(at){return at(f.origin,E)});return function(at){return te.apply(this,arguments)}}()),U=yield function q(c){return Promise.all(c.map(function(){var s=(0,x.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(l){return{fulfilled:!1,reason:l}}});return function(a){return s.apply(this,arguments)}}()))}(G);f.ports[0].postMessage({status:"done",eventId:m,eventType:v,response:U})})()}_subscribe(a,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(l)}_unsubscribe(a,l){this.handlersMap[a]&&l&&this.handlersMap[a].delete(l),(!l||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function Z(c="",s=10){let a="";for(let l=0;l<s;l++)a+=Math.floor(10*Math.random());return c+a}class kc{constructor(s){this.target=s,this.handlers=new Set}removeMessageHandler(s){s.messageChannel&&(s.messageChannel.port1.removeEventListener("message",s.onMessage),s.messageChannel.port1.close()),this.handlers.delete(s)}_send(s,a,l=50){var f=this;return(0,x.Z)(function*(){const m="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!m)throw new Error("connection_unavailable");let v,E;return new Promise((P,G)=>{const U=Z("",20);m.port1.start();const te=setTimeout(()=>{G(new Error("unsupported_event"))},l);E={messageChannel:m,onMessage(at){const Xe=at;if(Xe.data.eventId===U)switch(Xe.data.status){case"ack":clearTimeout(te),v=setTimeout(()=>{G(new Error("timeout"))},3e3);break;case"done":clearTimeout(v),P(Xe.data.response);break;default:clearTimeout(te),clearTimeout(v),G(new Error("invalid_response"))}}},f.handlers.add(E),m.port1.addEventListener("message",E.onMessage),f.target.postMessage({eventType:s,eventId:U,data:a},[m.port2])}).finally(()=>{E&&f.removeMessageHandler(E)})})()}}function $(){return window}function zn(){return void 0!==$().WorkerGlobalScope&&"function"==typeof $().importScripts}function wt(){return(wt=(0,x.Z)(function*(){if(null==navigator||!navigator.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch(c){return null}})).apply(this,arguments)}const qa="firebaseLocalStorageDb",Nr="firebaseLocalStorage",go="fbase_key";class De{constructor(s){this.request=s}toPromise(){return new Promise((s,a)=>{this.request.addEventListener("success",()=>{s(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Wn(c,s){return c.transaction([Nr],s?"readwrite":"readonly").objectStore(Nr)}function Bi(){const c=indexedDB.open(qa,1);return new Promise((s,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const l=c.result;try{l.createObjectStore(Nr,{keyPath:go})}catch(f){a(f)}}),c.addEventListener("success",(0,x.Z)(function*(){const l=c.result;l.objectStoreNames.contains(Nr)?s(l):(l.close(),yield function Ga(){const c=indexedDB.deleteDatabase(qa);return new De(c).toPromise()}(),s(yield Bi()))}))})}function Et(c,s,a){return Dr.apply(this,arguments)}function Dr(){return(Dr=(0,x.Z)(function*(c,s,a){const l=Wn(c,!0).put({[go]:s,value:a});return new De(l).toPromise()})).apply(this,arguments)}function Zn(){return(Zn=(0,x.Z)(function*(c,s){const a=Wn(c,!1).get(s),l=yield new De(a).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function Ye(c,s){const a=Wn(c,!0).delete(s);return new De(a).toPromise()}const Cc=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,x.Z)(function*(){return a.db||(a.db=yield Bi()),a.db})()}_withRetries(a){var l=this;return(0,x.Z)(function*(){let f=0;for(;;)try{const m=yield l._openDb();return yield a(m)}catch(m){if(f++>3)throw m;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,x.Z)(function*(){return zn()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,x.Z)(function*(){a.receiver=Sr._getInstance(function Gi(){return zn()?self:null}()),a.receiver._subscribe("keyChanged",function(){var l=(0,x.Z)(function*(f,m){return{keyProcessed:(yield a._poll()).includes(m.key)}});return function(f,m){return l.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var l=(0,x.Z)(function*(f,m){return["keyChanged"]});return function(f,m){return l.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,x.Z)(function*(){var l,f;if(a.activeServiceWorker=yield function mo(){return wt.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new kc(a.activeServiceWorker);const m=yield a.sender._send("ping",{},800);!m||(null===(l=m[0])||void 0===l?void 0:l.fulfilled)&&(null===(f=m[0])||void 0===f?void 0:f.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var l=this;return(0,x.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function Nc(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:a},l.serviceWorkerReceiverAvailable?800:50)}catch(f){}})()}_isAvailable(){return(0,x.Z)(function*(){try{if(!indexedDB)return!1;const a=yield Bi();return yield Et(a,Ar,"1"),yield Ye(a,Ar),!0}catch(a){}return!1})()}_withPendingWrite(a){var l=this;return(0,x.Z)(function*(){l.pendingWrites++;try{yield a()}finally{l.pendingWrites--}})()}_set(a,l){var f=this;return(0,x.Z)(function*(){return f._withPendingWrite((0,x.Z)(function*(){return yield f._withRetries(m=>Et(m,a,l)),f.localCache[a]=l,f.notifyServiceWorker(a)}))})()}_get(a){var l=this;return(0,x.Z)(function*(){const f=yield l._withRetries(m=>function T(c,s){return Zn.apply(this,arguments)}(m,a));return l.localCache[a]=f,f})()}_remove(a){var l=this;return(0,x.Z)(function*(){return l._withPendingWrite((0,x.Z)(function*(){return yield l._withRetries(f=>Ye(f,a)),delete l.localCache[a],l.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,x.Z)(function*(){const l=yield a._withRetries(v=>{const E=Wn(v,!1).getAll();return new De(E).toPromise()});if(!l)return[];if(0!==a.pendingWrites)return[];const f=[],m=new Set;for(const{fbase_key:v,value:E}of l)m.add(v),JSON.stringify(a.localCache[v])!==JSON.stringify(E)&&(a.notifyListeners(v,E),f.push(v));for(const v of Object.keys(a.localCache))a.localCache[v]&&!m.has(v)&&(a.notifyListeners(v,null),f.push(v));return f})()}notifyListeners(a,l){this.localCache[a]=l;const f=this.listeners[a];if(f)for(const m of Array.from(f))m(l)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,x.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})();function ja(c){return`__${c}${Math.floor(1e6*Math.random())}`}function Vt(c,s){return s?ct(s):(D(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}ja("rcb"),new zt(3e4,6e4);class zi extends Zs{constructor(s){super("custom","custom"),this.params=s}_getIdTokenResponse(s){return rt(s,this._buildIdpRequest())}_linkToIdToken(s,a){return rt(s,this._buildIdpRequest(a))}_getReauthenticationResolver(s){return rt(s,this._buildIdpRequest())}_buildIdpRequest(s){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return s&&(a.idToken=s),a}}function Wi(c){return qn(c.auth,new zi(c),c.bypassAuthState)}function Fr(c){const{auth:s,user:a}=c;return D(a,s,"internal-error"),function ro(c,s){return tn.apply(this,arguments)}(a,new zi(c),c.bypassAuthState)}function za(c){return To.apply(this,arguments)}function To(){return(To=(0,x.Z)(function*(c){const{auth:s,user:a}=c;return D(a,s,"internal-error"),Vn(a,new zi(c),c.bypassAuthState)})).apply(this,arguments)}new zt(2e3,1e4);const hn=new Map;class wo extends class Mc{constructor(s,a,l,f,m=!1){this.auth=s,this.resolver=l,this.user=f,this.bypassAuthState=m,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var s=this;return new Promise(function(){var a=(0,x.Z)(function*(l,f){s.pendingPromise={resolve:l,reject:f};try{s.eventManager=yield s.resolver._initialize(s.auth),yield s.onExecution(),s.eventManager.registerConsumer(s)}catch(m){s.reject(m)}});return function(l,f){return a.apply(this,arguments)}}())}onAuthEvent(s){var a=this;return(0,x.Z)(function*(){const{urlResponse:l,sessionId:f,postBody:m,tenantId:v,error:E,type:P}=s;if(E)return void a.reject(E);const G={auth:a.auth,requestUri:l,sessionId:f,tenantId:v||void 0,postBody:m||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(P)(G))}catch(U){a.reject(U)}})()}onError(s){this.reject(s)}getIdpTask(s){switch(s){case"signInViaPopup":case"signInViaRedirect":return Wi;case"linkViaPopup":case"linkViaRedirect":return za;case"reauthViaPopup":case"reauthViaRedirect":return Fr;default:Ne(this.auth,"internal-error")}}resolve(s){Nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(s),this.unregisterAndCleanUp()}reject(s){Nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(s),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}{constructor(s,a,l=!1){super(s,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,l),this.eventId=null}execute(){var s=()=>super.execute,a=this;return(0,x.Z)(function*(){let l=hn.get(a.auth._key());if(!l){try{const m=(yield function Wa(c,s){return Ur.apply(this,arguments)}(a.resolver,a.auth))?yield s().call(a):null;l=()=>Promise.resolve(m)}catch(f){l=()=>Promise.reject(f)}hn.set(a.auth._key(),l)}return a.bypassAuthState||hn.set(a.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(s){var a=()=>super.onAuthEvent,l=this;return(0,x.Z)(function*(){if("signInViaRedirect"===s.type)return a().call(l,s);if("unknown"!==s.type){if(s.eventId){const f=yield l.auth._redirectUserForId(s.eventId);if(f)return l.user=f,a().call(l,s);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,x.Z)(function*(){})()}cleanUp(){}}function Ur(){return(Ur=(0,x.Z)(function*(c,s){const a=Ha(s),l=Za(c);if(!(yield l._isAvailable()))return!1;const f="true"===(yield l._get(a));return yield l._remove(a),f})).apply(this,arguments)}function Gc(c,s){hn.set(c._key(),s)}function Za(c){return ct(c._redirectPersistence)}function Ha(c){return ci("pendingRedirect",c.config.apiKey,c.name)}function Eo(c,s){return Gt.apply(this,arguments)}function Gt(){return(Gt=(0,x.Z)(function*(c,s,a=!1){const l=Ve(c),f=Vt(l,s),v=yield new wo(l,f,a).execute();return v&&!a&&(delete v.user._redirectEventId,yield l._persistUserIfCurrent(v.user),yield l._setRedirectUser(null,s)),v})).apply(this,arguments)}class ne{constructor(s){this.auth=s,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(s){this.consumers.add(s),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,s)&&(this.sendToConsumer(this.queuedRedirectEvent,s),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(s){this.consumers.delete(s)}onEvent(s){if(this.hasEventBeenHandled(s))return!1;let a=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(s,l)&&(a=!0,this.sendToConsumer(s,l),this.saveEventToCache(s))}),this.hasHandledPotentialRedirect||!function dn(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Xi(c);default:return!1}}(s)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=s,a=!0)),a}sendToConsumer(s,a){var l;if(s.error&&!Xi(s)){const f=(null===(l=s.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";a.onError(tt(this.auth,f))}else a.onAuthEvent(s)}isEventForConsumer(s,a){const l=null===a.eventId||!!s.eventId&&s.eventId===a.eventId;return a.filter.includes(s.type)&&l}hasEventBeenHandled(s){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ya(s))}saveEventToCache(s){this.cachedEventUids.add(Ya(s)),this.lastProcessedEventTime=Date.now()}}function Ya(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(s=>s).join("-")}function Xi({type:c,error:s}){return"unknown"===c&&"auth/no-auth-event"===(null==s?void 0:s.code)}function Vr(c){return Xn.apply(this,arguments)}function Xn(){return(Xn=(0,x.Z)(function*(c,s={}){return le(c,"GET","/v1/projects",s)})).apply(this,arguments)}const Ji=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xa=/^https?/;function ot(){return(ot=(0,x.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:s}=yield Vr(c);for(const a of s)try{if(eu(a))return}catch(l){}Ne(c,"unauthorized-domain")})).apply(this,arguments)}function eu(c){const s=dr(),{protocol:a,hostname:l}=new URL(s);if(c.startsWith("chrome-extension://")){const v=new URL(c);return""===v.hostname&&""===l?"chrome-extension:"===a&&c.replace("chrome-extension://","")===s.replace("chrome-extension://",""):"chrome-extension:"===a&&v.hostname===l}if(!Xa.test(a))return!1;if(Ji.test(c))return l===c;const f=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+f+"|"+f+")$","i").test(l)}const Jn=new zt(3e4,6e4);function bo(){const c=$().___jsl;if(null!=c&&c.H)for(const s of Object.keys(c.H))if(c.H[s].r=c.H[s].r||[],c.H[s].L=c.H[s].L||[],c.H[s].r=[...c.H[s].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let fn=null;function Ao(c){return fn=fn||function xo(c){return new Promise((s,a)=>{var l,f,m;function v(){bo(),gapi.load("gapi.iframes",{callback:()=>{s(gapi.iframes.getContext())},ontimeout:()=>{bo(),a(tt(c,"network-request-failed"))},timeout:Jn.get()})}if(null!==(f=null===(l=$().gapi)||void 0===l?void 0:l.iframes)&&void 0!==f&&f.Iframe)s(gapi.iframes.getContext());else{if(null===(m=$().gapi)||void 0===m||!m.load){const E=ja("iframefcb");return $()[E]=()=>{gapi.load?v():a(tt(c,"network-request-failed"))},function Ke(c){return new Promise((s,a)=>{const l=document.createElement("script");l.setAttribute("src",c),l.onload=s,l.onerror=f=>{const m=tt("internal-error");m.customData=f,a(m)},l.type="text/javascript",l.charset="UTF-8",function Rc(){var c,s;return null!==(s=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==s?s:document}().appendChild(l)})}(`https://apis.google.com/js/api.js?onload=${E}`).catch(P=>a(P))}v()}}).catch(s=>{throw fn=null,s})}(c),fn}const pn=new zt(5e3,15e3),es={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},qr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function tu(c){const s=c.config;D(s.authDomain,c,"auth-domain-config-required");const a=s.emulator?Ps(s,"emulator/auth/iframe"):`https://${c.config.authDomain}/__/auth/iframe`,l={apiKey:s.apiKey,appName:c.name,v:Fe.Jn},f=qr.get(c.config.apiHost);f&&(l.eid=f);const m=c._getFrameworks();return m.length&&(l.fw=m.join(",")),`${a}?${(0,V.xO)(l).slice(1)}`}function mn(){return mn=(0,x.Z)(function*(c){const s=yield Ao(c),a=$().gapi;return D(a,c,"internal-error"),s.open({where:document.body,url:tu(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:es,dontclear:!0},l=>new Promise(function(){var f=(0,x.Z)(function*(m,v){yield l.restyle({setHideOnLeave:!1});const E=tt(c,"network-request-failed"),P=$().setTimeout(()=>{v(E)},pn.get());function G(){$().clearTimeout(P),m(l)}l.ping(G).then(G,()=>{v(E)})});return function(m,v){return f.apply(this,arguments)}}()))}),mn.apply(this,arguments)}const nu={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class No{constructor(s){this.window=s,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(s){}}}function gn(c,s,a,l,f,m){D(c.config.authDomain,c,"auth-domain-config-required"),D(c.config.apiKey,c,"invalid-api-key");const v={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:l,v:Fe.Jn,eventId:f};if(s instanceof Rt){s.setDefaultLanguage(c.languageCode),v.providerId=s.providerId||"",(0,V.xb)(s.getCustomParameters())||(v.customParameters=JSON.stringify(s.getCustomParameters()));for(const[P,G]of Object.entries(m||{}))v[P]=G}if(s instanceof hc){const P=s.getScopes().filter(G=>""!==G);P.length>0&&(v.scopes=P.join(","))}c.tenantId&&(v.tid=c.tenantId);const E=v;for(const P of Object.keys(E))void 0===E[P]&&delete E[P];return`${function yn({config:c}){return c.emulator?Ps(c,"emulator/auth/handler"):`https://${c.authDomain}/__/auth/handler`}(c)}?${(0,V.xO)(E).slice(1)}`}const ns="webStorageSupport",au=class _n{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=oe,this._completeRedirectFn=Eo,this._overrideRedirectResult=Gc}_openPopup(s,a,l,f){var m=this;return(0,x.Z)(function*(){var v;Nt(null===(v=m.eventManagers[s._key()])||void 0===v?void 0:v.manager,"_initialize() not called before _openPopup()");const E=gn(s,a,l,dr(),f);return function ts(c,s,a,l=500,f=600){const m=Math.max((window.screen.availHeight-f)/2,0).toString(),v=Math.max((window.screen.availWidth-l)/2,0).toString();let E="";const P=Object.assign(Object.assign({},nu),{width:l.toString(),height:f.toString(),top:m,left:v}),G=(0,V.z$)().toLowerCase();a&&(E=fa(G)?"_blank":a),hi(G)&&(s=s||"http://localhost",P.scrollbars="yes");const U=Object.entries(P).reduce((at,[Xe,We])=>`${at}${Xe}=${We},`,"");if(function oc(c=(0,V.z$)()){var s;return Zt(c)&&!(null===(s=window.navigator)||void 0===s||!s.standalone)}(G)&&"_self"!==E)return function zc(c,s){const a=document.createElement("a");a.href=c,a.target=s;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(l)}(s||"",E),new No(null);const te=window.open(s||"",E,U);D(te,c,"popup-blocked");try{te.focus()}catch(at){}return new No(te)}(s,E,Z())})()}_openRedirect(s,a,l,f){var m=this;return(0,x.Z)(function*(){return yield m._originValidation(s),function R(c){$().location.href=c}(gn(s,a,l,dr(),f)),new Promise(()=>{})})()}_initialize(s){const a=s._key();if(this.eventManagers[a]){const{manager:f,promise:m}=this.eventManagers[a];return f?Promise.resolve(f):(Nt(m,"If manager is not set, promise should be"),m)}const l=this.initAndGetManager(s);return this.eventManagers[a]={promise:l},l.catch(()=>{delete this.eventManagers[a]}),l}initAndGetManager(s){var a=this;return(0,x.Z)(function*(){const l=yield function ko(c){return mn.apply(this,arguments)}(s),f=new ne(s);return l.register("authEvent",m=>(D(null==m?void 0:m.authEvent,s,"invalid-auth-event"),{status:f.onEvent(m.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[s._key()]={manager:f},a.iframes[s._key()]=l,f})()}_isIframeWebStorageSupported(s,a){this.iframes[s._key()].send(ns,{type:ns},f=>{var m;const v=null===(m=null==f?void 0:f[0])||void 0===m?void 0:m[ns];void 0!==v&&a(!!v),Ne(s,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(s){const a=s._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Ja(c){return ot.apply(this,arguments)}(s)),this.originValidationPromises[a]}get _shouldInitProactively(){return pa()||di()||Zt()}};var er="@firebase/auth";class Hc{constructor(s){this.auth=s,this.internalListeners=new Map}getUid(){var s;return this.assertAuthConfigured(),(null===(s=this.auth.currentUser)||void 0===s?void 0:s.uid)||null}getToken(s){var a=this;return(0,x.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(s)}:null})()}addAuthTokenListener(s){if(this.assertAuthConfigured(),this.internalListeners.has(s))return;const a=this.auth.onIdTokenChanged(l=>{s((null==l?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(s,a),this.updateProactiveRefresh()}removeAuthTokenListener(s){this.assertAuthConfigured();const a=this.internalListeners.get(s);!a||(this.internalListeners.delete(s),a(),this.updateProactiveRefresh())}assertAuthConfigured(){D(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const cu=(0,V.Pz)("authIdTokenMaxAge")||300;let lu=null;const Br=c=>function(){var s=(0,x.Z)(function*(a){const l=a&&(yield a.getIdTokenResult()),f=l&&((new Date).getTime()-Date.parse(l.issuedAtTime))/1e3;if(f&&f>cu)return;const m=null==l?void 0:l.token;lu!==m&&(lu=m,yield fetch(c,{method:m?"POST":"DELETE",headers:m?{Authorization:`Bearer ${m}`}:{}}))});return function(a){return s.apply(this,arguments)}}();function Qc(c=(0,Fe.Mq)()){const s=(0,Fe.qX)(c,"auth");if(s.isInitialized())return s.getImmediate();const a=function Ds(c,s){const a=(0,Fe.qX)(c,"auth");if(a.isInitialized()){const f=a.getImmediate(),m=a.getOptions();if((0,V.vZ)(m,null!=s?s:{}))return f;Ne(f,"already-initialized")}return a.initialize({options:s})}(c,{popupRedirectResolver:au,persistence:[Cc,$n,oe]}),l=(0,V.Pz)("authTokenSyncURL");if(l){const m=Br(l);(function ge(c,s,a){(0,V.m9)(c).beforeAuthStateChanged(s,a)})(a,m,()=>m(a.currentUser)),function k(c,s,a,l){(0,V.m9)(c).onIdTokenChanged(s,a,l)}(a,v=>m(v))}const f=(0,V.q4)("auth");return f&&function ga(c,s,a){const l=Ve(c);D(l._canInitEmulator,l,"emulator-config-failed"),D(/^https?:\/\//.test(s),l,"invalid-emulator-scheme");const f=!(null==a||!a.disableWarnings),m=Re(s),{host:v,port:E}=function ya(c){const s=Re(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(s.length));if(!a)return{host:"",port:null};const l=a[2].split("@").pop()||"",f=/^(\[[^\]]+\])(:|$)/.exec(l);if(f){const m=f[1];return{host:m,port:Pn(l.substr(m.length+1))}}{const[m,v]=l.split(":");return{host:m,port:Pn(v)}}}(s);l.config.emulator={url:`${m}//${v}${null===E?"":`:${E}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:v,port:E,protocol:m.replace(":",""),options:Object.freeze({disableWarnings:f})}),f||function pi(){function c(){const s=document.createElement("p"),a=s.style;s.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",s.classList.add("firebase-emulator-warning"),document.body.appendChild(s)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(a,`http://${f}`),a}function hu(c,s){if(1&c&&(y.TgZ(0,"section")(1,"h2")(2,"span"),y._uU(3,"Total"),y.qZA(),y._uU(4,"Users"),y.qZA(),y.TgZ(5,"h2")(6,"h1"),y._uU(7),y.qZA()()()),2&c){const a=s.ngIf;y.xp6(7),y.hij(" ",a.length," ")}}function tr(c,s){1&c&&(y.TgZ(0,"b",10),y._uU(1,"Last Active At"),y.qZA())}!function rs(c){(0,Fe.Xd)(new ti.wA("auth",(s,{options:a})=>{const l=s.getProvider("app").getImmediate(),f=s.getProvider("heartbeat"),{apiKey:m,authDomain:v}=l.options;return((E,P)=>{D(m&&!m.includes(":"),"invalid-api-key",{appName:E.name}),D(!(null!=v&&v.includes(":")),"argument-error",{appName:E.name});const G={apiKey:m,authDomain:v,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Dt(c)},U=new fi(E,P,G);return function sa(c,s){const a=(null==s?void 0:s.persistence)||[],l=(Array.isArray(a)?a:[a]).map(ct);null!=s&&s.errorMap&&c._updateErrorMap(s.errorMap),c._initializeWithPersistence(l,null==s?void 0:s.popupRedirectResolver)}(U,a),U})(l,f)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((s,a,l)=>{s.getProvider("auth-internal").initialize()})),(0,Fe.Xd)(new ti.wA("auth-internal",s=>{const a=Ve(s.getProvider("auth").getImmediate());return new Hc(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,Fe.KN)(er,"0.21.3",function ae(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,Fe.KN)(er,"0.21.3","esm2017")}("Browser");const At=function(c,s,a){return{"text-success":c,"text-danger":s,"text-warning":a}};function du(c,s){if(1&c&&(y.TgZ(0,"tr")(1,"td",6),y._uU(2),y.qZA(),y.TgZ(3,"td",7)(4,"b"),y._uU(5),y.qZA()(),y.TgZ(6,"td",8),y.YNc(7,tr,2,0,"b",9),y._uU(8),y.ALo(9,"date"),y.qZA()()),2&c){const a=s.$implicit;y.xp6(2),y.Oqu(a.key),y.xp6(1),y.Q6J("ngClass",y.kEZ(7,At,"online"===a.status,"offline"===a.status,"away"===a.status)),y.xp6(2),y.Oqu(a.status),y.xp6(2),y.Q6J("ngIf","offline"===a.status),y.xp6(1),y.Oqu(y.lcZ(9,5,a.timestamp))}}function fu(c,s){if(1&c&&(y.TgZ(0,"table")(1,"caption"),y._uU(2,"Users Summary"),y.qZA(),y.TgZ(3,"thead",2)(4,"tr")(5,"th"),y._uU(6,"User Id"),y.qZA(),y.TgZ(7,"th"),y._uU(8,"Status"),y.qZA(),y.TgZ(9,"th"),y._uU(10,"Date"),y.qZA()()(),y.TgZ(11,"tbody"),y.YNc(12,du,10,11,"tr",3),y.qZA()()),2&c){const a=s.ngIf;y.xp6(12),y.Q6J("ngForOf",a)}}function pu(c,s){1&c&&y.GkF(0)}const nr=function(c){return{$implicit:c}};function Co(c,s){if(1&c&&(y.ynx(0),y.TgZ(1,"tr")(2,"td",11)(3,"strong"),y._uU(4),y.ALo(5,"uppercase"),y.qZA()()(),y.YNc(6,pu,1,0,"ng-container",12),y.BQk()),2&c){const a=s.$implicit;y.oxw();const l=y.MAs(35);y.xp6(4),y.Oqu(y.lcZ(5,3,a.key)),y.xp6(2),y.Q6J("ngTemplateOutlet",l)("ngTemplateOutletContext",y.VKq(5,nr,a))}}function Yc(c,s){if(1&c&&(y.TgZ(0,"tr")(1,"td"),y._uU(2),y.qZA(),y.TgZ(3,"td",13)(4,"b"),y._uU(5),y.qZA()()()),2&c){const a=y.oxw(2),l=a.parent,f=a.$implicit;y.xp6(2),y.lnq(" ",l," ",l?"/":""," ",f.key," "),y.xp6(3),y.Oqu(f.value.counter)}}function _e(c,s){1&c&&y.GkF(0)}const H=function(c,s){return{$implicit:c,parent:s}};function mu(c,s){if(1&c&&(y.ynx(0),y.YNc(1,Yc,6,4,"tr",1),y.YNc(2,_e,1,0,"ng-container",12),y.BQk()),2&c){const a=y.oxw(),l=a.$implicit,f=a.parent;y.oxw();const m=y.MAs(37);y.xp6(1),y.Q6J("ngIf",l.value.counter),y.xp6(1),y.Q6J("ngTemplateOutlet",m)("ngTemplateOutletContext",y.WLB(3,H,l,f?f+" / "+l.key:l.key))}}function gu(c,s){1&c&&y.YNc(0,mu,3,6,"ng-container",1),2&c&&y.Q6J("ngIf","counter"!==s.$implicit.key)}function Bt(c,s){1&c&&y.GkF(0)}function Xc(c,s){if(1&c&&(y.ynx(0),y.YNc(1,Bt,1,0,"ng-container",12),y.BQk()),2&c){const a=s.$implicit,l=y.oxw().parent;y.oxw();const f=y.MAs(35);y.xp6(1),y.Q6J("ngTemplateOutlet",f)("ngTemplateOutletContext",y.WLB(2,H,a,l))}}function $e(c,s){1&c&&(y.YNc(0,Xc,2,5,"ng-container",3),y.ALo(1,"keyvalue")),2&c&&y.Q6J("ngForOf",y.lcZ(1,1,s.$implicit.value))}class rr{constructor(){this.db=(0,z.N8)()}create(s,a={}){let l=(0,z.VF)((0,z.iH)(this.db,s));return(0,z.t8)(l,Object.assign({key:l.key},a)).then(),Promise.resolve({key:l.key})}set(s,a={}){return(0,Se.mG)(this,void 0,void 0,function*(){const l=(0,z.iH)(this.db,s);yield(0,z.t8)(l,a)})}update(s,a={}){return(0,Se.mG)(this,void 0,void 0,function*(){const l=(0,z.iH)(this.db,s);yield(0,z.Vx)(l,a)})}remove(s){return(0,Se.mG)(this,void 0,void 0,function*(){const a=(0,z.iH)(this.db,s);yield(0,z.Od)(a)})}readRealTime(s){return new mt.y(a=>{(0,z.jM)((0,z.iH)(this.db,s),l=>{let f=[];l.exists()?(l.forEach(m=>{f.push(Object.assign({key:m.key},m.val()))}),a.next(f)):a.next([])})})}readOnceWithObserver(s){return(0,z.jM)((0,z.iH)(this.db,s),a=>a.val(),{onlyOnce:!0})}readOnce(s){return new Promise((a,l)=>{(0,z.U2)((0,z.iH)(this.db,s)).then(f=>{f.exists()?a(Object.assign({key:f.key},f.val())):a([])}).catch(f=>{l(f)})})}readReal(s){return new mt.y(a=>{(0,z.jM)((0,z.iH)(this.db,s),l=>{l.exists()?a.next(l.val()):a.next(null)})})}updateCounter(s,a=!0){return new Promise((l,f)=>{const m=(0,z.iH)(this.db);(0,z.U2)((0,z.iU)(m,"counter")).then(v=>{(0,z.Vx)((0,z.iH)(this.db,s),{counter:(0,z.nP)(a?1:-1)}).then(E=>{l(E)})})})}others(){}checkPresence(s){const a=(0,z.iH)(this.db,`${s}/connections`),l=(0,z.iH)(this.db,`${s}/lastOnline`),f=(0,z.iH)(this.db,".info/connected");(0,z.jM)(f,m=>{if(!0===m.val()){const v=(0,z.VF)(a);(0,z.ae)(v).remove().then(),(0,z.t8)(v,!0).then(),(0,z.ae)(l).set((0,z.Bt)()).then()}})}onDisconnect(s){const a=(0,z.iH)(this.db,s);return(0,z.ae)(a)}detectingConnectionState(){return new mt.y(s=>{const a=(0,z.iH)(this.db,".info/connected");(0,z.jM)(a,l=>{s.next(l.val())})})}}let vn=(()=>{class c extends rr{constructor(){super()}get timestamp(){return(new Date).getTime()}getPresence(a){return this.readReal(`status/${a}`)}getUserOnlineCounts(){return this.readRealTime("status").pipe((0,pe.U)(a=>a.reduce((l,f)=>"online"===f.status?++l:l,0)))}getTotalUserCounts(){return this.readRealTime("status").pipe((0,pe.U)(a=>a))}setPresence(a,l){return this.set(`status/${a}`,{status:l,timestamp:this.timestamp})}updateOnAway(a){document.onvisibilitychange=l=>{"hidden"===document.visibilityState?this.setPresence(a,"away"):this.setPresence(a,"online")}}updateOnUser(a){this.detectingConnectionState().pipe((0,pe.U)(f=>f?"online":"offline")).subscribe(f=>this.setPresence(a,f))}updateOnDisconnect(a){this.onDisconnect(`status/${a}`).update({status:"offline",timestamp:this.timestamp})}configure(a){this.updateOnAway(a),this.updateOnUser(a),this.updateOnDisconnect(a)}configureUserPresenceByLocal(){let a=localStorage.getItem("uid");this.checkingUser(a)}configureUserPresenceByLogin(a,l={}){this.checkingUser(a,l)}checkingUser(a,l={}){a?this.configure(a):this.create("status",Object.assign({uid:a},l)).then(f=>{localStorage.setItem("uid",f.key),this.configure(f.key)})}}return c.\u0275fac=function(a){return new(a||c)},c.\u0275prov=y.Yz7({token:c,factory:c.\u0275fac}),c})(),_u=(()=>{class c extends rr{constructor(a){super(),this.presenceService=a,this.flattenObject1=l=>{const f={};return Object.keys(l).forEach(m=>{const v=l[m];"object"!=typeof v||null===v||Array.isArray(v)?f[m]=v:Object.assign(f,this.flattenObject1(v))}),f},this.flattenObject=l=>{let f={};for(const m in l)if(l.hasOwnProperty(m))if("object"!=typeof l[m]||Array.isArray(l[m]))f[m]=l[m];else{const v=this.flattenObject(l[m]);for(const E in v)f[m+"_"+E]=v[E]}return f}}ngOnInit(){this.readReal("server-activities").subscribe(a=>{this.serverActivities=a}),this.readReal("router-activities").subscribe(a=>(0,Se.mG)(this,void 0,void 0,function*(){this.routerActivities=a})),this.counts$=this.presenceService.getUserOnlineCounts(),this.totalUsers$=this.presenceService.getTotalUserCounts()}d(a){let l={};for(let f in a)if(a.hasOwnProperty(f)){const m=typeof a[f];"string"===m?l[f]=a[f]:"object"===m&&this.d(a[f])}}}return c.\u0275fac=function(a){return new(a||c)(y.Y36(vn))},c.\u0275cmp=y.Xpm({type:c,selectors:[["fb-activities"]],features:[y.qOj],decls:38,vars:13,consts:[[1,"grid-even-columns"],[4,"ngIf"],[1,"sticky-top"],[4,"ngFor","ngForOf"],["rows",""],["inner",""],["data-label","id"],["data-label","status",3,"ngClass"],["data-label","date"],["class","mr-2",4,"ngIf"],[1,"mr-2"],["colspan","2"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[2,"color","tomato"]],template:function(a,l){1&a&&(y.TgZ(0,"div",0)(1,"section")(2,"h2")(3,"span"),y._uU(4,"Online"),y.qZA(),y._uU(5,"Users"),y.qZA(),y.TgZ(6,"h2")(7,"h1"),y._uU(8),y.ALo(9,"async"),y.qZA()()(),y.YNc(10,hu,8,1,"section",1),y.ALo(11,"async"),y.TgZ(12,"section")(13,"h2")(14,"span"),y._uU(15,"Server"),y.qZA(),y._uU(16,"Requests"),y.qZA(),y.TgZ(17,"h2")(18,"h1"),y._uU(19),y.qZA()()()(),y.YNc(20,fu,13,1,"table",1),y.ALo(21,"async"),y.TgZ(22,"table")(23,"caption"),y._uU(24,"Modules Summary"),y.qZA(),y.TgZ(25,"thead",2)(26,"tr")(27,"th"),y._uU(28,"Modules"),y.qZA(),y.TgZ(29,"th"),y._uU(30,"Views"),y.qZA()()(),y.TgZ(31,"tbody"),y.YNc(32,Co,7,7,"ng-container",3),y.ALo(33,"keyvalue"),y.qZA()(),y.YNc(34,gu,1,1,"ng-template",null,4,y.W1O),y.YNc(36,$e,2,3,"ng-template",null,5,y.W1O)),2&a&&(y.xp6(8),y.hij(" ",y.lcZ(9,5,l.counts$)," "),y.xp6(2),y.Q6J("ngIf",y.lcZ(11,7,l.totalUsers$)),y.xp6(9),y.Oqu(null==l.serverActivities?null:l.serverActivities.counter),y.xp6(1),y.Q6J("ngIf",y.lcZ(21,9,l.totalUsers$)),y.xp6(12),y.Q6J("ngForOf",y.lcZ(33,11,l.routerActivities)))},dependencies:[kt.mk,kt.sg,kt.O5,kt.tP,kt.Ov,kt.gd,kt.uU,kt.Nd],styles:['*,*:before,*:after{box-sizing:border-box;margin-top:0}:host{display:block;background:#f5f5f5;color:#18314f;font-family:Crimson Text,serif;font-size:1.5rem;padding:1rem}section{background:white;box-shadow:0 0 20px #00000040;width:80%;margin:50px auto;padding:50px}h2{font-weight:400;text-transform:uppercase;font-size:1rem;margin-bottom:3em;letter-spacing:8px;text-align:center;color:tomato}h2:after{content:"";display:block;border-bottom:1px solid rgba(24,49,79,.25);width:20%;margin:3em auto 0}h2 span{font-size:2em;font-weight:700;display:block;color:#18314f}[class*=grid-]{display:grid;gap:1rem}.grid-even-columns{grid-template-columns:repeat(auto-fit,minmax(min(300px,100%),1fr))}@media (min-width: 50em){.grid-auto-flows{grid-auto-flow:column;grid-auto-columns:1fr}}.grid-stack{display:grid;place-items:center}.grid-stack>*{grid-column:1/2;grid-row:1/2}.grid-stack>img{aspect-ratio:16/9;object-fit:cover;z-index:-1}.overflow-y{height:300px;overflow-y:auto;overflow-x:hidden}table{border:1px solid #ccc;border-collapse:collapse;margin:0;padding:0;width:100%;table-layout:fixed;box-shadow:1px 2px 1px 2px #e6e5e5;position:relative}table caption{font-size:1.5em;margin:.5em 0 .75em}table tr{background-color:#f8f8f8;border:1px solid #ddd;padding:.35em}table th,table td{padding:.625em;text-align:center}table th{font-size:.85em;letter-spacing:.1em;text-transform:uppercase}.text-success{color:#006400}.text-danger{color:#8b0000}.text-warning{color:#ff0}.sticky-top{position:sticky;top:0}@media screen and (max-width: 600px){table{border:0}table caption{font-size:1.3em}table thead{border:none;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute!important;width:1px}table tr{border-bottom:3px solid #ddd;display:block;margin-bottom:.625em}table td{border-bottom:1px solid #ddd;display:block;font-size:.8em;text-align:right}table td:last-child{border-bottom:0}table td:before{content:attr(data-label);float:left;font-weight:700;text-transform:uppercase}}\n'],encapsulation:3}),c})();new y.OlP(null);const Kr="https://rktect-rest-default-rtdb.firebaseio.com/users.json",Po="kpPiWBeAJJ3KlXNQ1tULjJcYLWZoLMwdEpDRzKSc";let vu=(()=>{class c{constructor(a){this.http=a}getUsers(){return this.http.get(Kr,{params:{auth:Po}})}createUser(a){return this.http.post(Kr,a,{params:{auth:Po}})}}return c.\u0275fac=function(a){return new(a||c)(y.LFG(L.eN))},c.\u0275prov=y.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})();class Iu{constructor(){this.db=(0,N.ad)(),this.auth=Qc(),(0,N.ST)(this.db).catch(s=>{"failed-precondition"==s.code?console.log("persistance failed"):"unimplemented"==s.code&&console.log("persistance not available")})}get colRef(){return(0,N.hJ)(this.db,this.collectionPath)}getCollectionData(){return new Promise((s,a)=>{(0,N.PL)(this.colRef).then(l=>{let f=this.setData2(l);s(f)}).catch(l=>{a(l.message)})})}getSingleDoc(s){const a=(0,N.JU)(this.db,this.collectionPath,s);return new Promise((l,f)=>(0,N.QT)(a).then(m=>{let v=this.transformSingleDoc(m);l(v)}).catch(m=>{f(m.message)}))}getSingleDocFromCache(s){return(0,Se.mG)(this,void 0,void 0,function*(){const a=(0,N.JU)(this.db,this.collectionPath,s);try{const l=yield(0,N.kl)(a);console.log("Cached document data:",l.data())}catch(l){console.log("Error getting cached document:",l)}})}getCollectionRealTime(s){return this.unsubscribe=(0,N.cf)(this.colRef,a=>{s(this.setData2(a))})}getDocRealTime(s,a){const l=(0,N.JU)(this.db,this.collectionPath,s);return(0,N.cf)(l,f=>{a(this.transformSingleDoc(f))})}g(){(0,N.cf)(void 0,a=>{a.docChanges().forEach(l=>{"added"===l.type&&console.log("New city: ",l.doc.data()),"modified"===l.type&&console.log("Modified city: ",l.doc.data()),"removed"===l.type&&console.log("Removed city: ",l.doc.data())})})}addingDoc(s={}){return(0,N.ET)(this.colRef,Object.assign({createdAt:(0,N.Bt)(),updatedAt:(0,N.Bt)()},s))}deletingDoc(s){const a=(0,N.JU)(this.db,this.collectionPath,s);return(0,N.oe)(a)}updatingDoc(s,a){const l=(0,N.JU)(this.db,this.collectionPath,s);return(0,N.r7)(l,Object.assign({updatedAt:(0,N.Bt)()},a))}signUpWithEmailPass({email:s,password:a}){return function Na(c,s,a){return Oi.apply(this,arguments)}(this.auth,s,a).then(l=>Promise.resolve(l.user)).catch(l=>Promise.reject(l.message))}signInWithEmailPass({email:s,password:a}){return function co(c,s,a){return function se(c,s){return Si.apply(this,arguments)}((0,V.m9)(c),wa.credential(s,a))}(this.auth,s,a).then(l=>Promise.resolve(l.user)).catch(l=>Promise.reject(l.message))}onSignOut(){return function F(c){return(0,V.m9)(c).signOut()}(this.auth).then(s=>Promise.resolve(s)).catch(s=>Promise.reject(s.message))}subscribingAuthChangedRealTime(s){return function Kn(c,s,a,l){return(0,V.m9)(c).onAuthStateChanged(s,a,l)}(this.auth,a=>{s(a)})}getPaginationData1(s={latestDoc:null,empty:!1,data:[]},a=5){return new Promise((l,f)=>{const m=(0,N.IO)(this.colRef,(0,N.Xo)("createdAt"),(0,N.TQ)(s.latestDoc||0),(0,N.b9)(a));(0,N.PL)(m).then(v=>{let E=this.setData2(v);s.latestDoc=v.docs[v.docs.length-1],s.data=[...s.data,...E],s.empty=v.empty,l(s)}).catch(v=>{f(v.message)})})}getPaginationData(s={latestDoc:null,empty:!1,data:[],size:0},a=5){return(0,Se.mG)(this,void 0,void 0,function*(){if(!s.empty)try{const l=(0,N.IO)(this.colRef,(0,N.Xo)("createdAt"),(0,N.TQ)(s.latestDoc||0),(0,N.b9)(a)),f=yield(0,N.PL)(l);let m=this.setData2(f);return s.latestDoc=f.docs[f.docs.length-1],s.data=[...s.data,...m],s.empty=f.empty,s.size=f.size,s}catch(l){return l}})}unsubscribeRealTime(){this.unsubscribe()}nextPage(s={latestDoc:null,empty:!1,data:[],size:0},a=5){return(0,Se.mG)(this,void 0,void 0,function*(){const l=(0,N.IO)(this.colRef,(0,N.Xo)("createdAt"),(0,N.TQ)(s.latestDoc||0),(0,N.b9)(a));return yield this.handlePagination(l)})}prePage(s={latestDoc:null,empty:!1,data:[],size:0},a=5){return(0,Se.mG)(this,void 0,void 0,function*(){const l=(0,N.IO)(this.colRef,(0,N.Xo)("createdAt"),(0,N.Lx)(s.latestDoc||0),(0,N.b9)(a));return yield this.handlePagination(l,!1)})}setData(s){return s.docs.map(a=>Object.assign({id:a.id},a.data()))}setData2(s){let a=[];return s.docs.forEach(l=>{a.push(Object.assign(Object.assign({},l.data()),{id:l.id}))}),a}transformSingleDoc(s){return Object.assign(Object.assign({},s.data()),{id:s.id})}handlePagination(s,a=!0){return(0,Se.mG)(this,void 0,void 0,function*(){try{const l=yield(0,N.PL)(s);let f=this.setData2(l);return{latestDoc:a?l.docs[l.docs.length-1]:l.docs[0],data:f,empty:l.empty,size:l.size}}catch(l){return l}})}}},9996:(rp,ec,fe)=>{fe.d(ec,{ET:()=>Gg,hJ:()=>rg,oe:()=>qg,JU:()=>kf,ST:()=>Ig,Lx:()=>Pg,QT:()=>Lg,kl:()=>Fg,PL:()=>Ug,ad:()=>vg,b9:()=>Cg,cf:()=>Bg,Xo:()=>Dg,IO:()=>Ng,Bt:()=>zg,TQ:()=>Rg,r7:()=>Vg});var L,y=fe(531),Se=fe(6881),z=fe(3475),mt=fe(1877),pe=fe(2090),kt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},et={},na=na||{},N=kt||self;function x(){}function V(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Fe(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var ti="closure_uid_"+(1e9*Math.random()>>>0),Bh=0;function jh(n,e,t){return n.call.apply(n.bind,arguments)}function Kh(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Ue(n,e,t){return(Ue=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?jh:Kh).apply(null,arguments)}function Ns(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Ce(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(r,i,o){for(var u=Array(arguments.length-2),h=2;h<arguments.length;h++)u[h-2]=arguments[h];return e.prototype[i].apply(r,u)}}function gt(){this.s=this.s,this.o=this.o}gt.prototype.s=!1,gt.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function ra(n){Object.prototype.hasOwnProperty.call(n,ti)&&n[ti]||(n[ti]=++Bh)}(this)},gt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ia=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function ni(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function tc(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(V(r)){const i=n.length||0,o=r.length||0;n.length=i+o;for(let u=0;u<o;u++)n[i+u]=r[u]}else n.push(r)}}function ke(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ke.prototype.h=function(){this.defaultPrevented=!0};var ri=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{N.addEventListener("test",x,e),N.removeEventListener("test",x,e)}catch(t){}return n}();function Ne(n){return/^[\s\xa0]*$/.test(n)}var tt=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function ii(n,e){return n<e?-1:n>e?1:0}function yt(){var n=N.navigator;return n&&(n=n.userAgent)?n:""}function He(n){return-1!=yt().indexOf(n)}function D(n){return D[" "](n),n}D[" "]=x;var fr,n,Nt=He("Opera"),$t=He("Trident")||He("MSIE"),ct=He("Edge"),Ds=ct||$t,sa=He("Gecko")&&!(-1!=yt().toLowerCase().indexOf("webkit")&&!He("Edge"))&&!(He("Trident")||He("MSIE"))&&!He("Edge"),dr=-1!=yt().toLowerCase().indexOf("webkit")&&!He("Edge");function si(){var n=N.document;return n?n.documentMode:void 0}e:{var Cs="",Rs=(n=yt(),sa?/rv:([^\);]+)(\)|;)/.exec(n):ct?/Edge\/([\d\.]+)/.exec(n):$t?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):dr?/WebKit\/(\S+)/.exec(n):Nt?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Rs&&(Cs=Rs?Rs[1]:""),$t){var zt=si();if(null!=zt&&zt>parseFloat(Cs)){fr=String(zt);break e}}fr=Cs}var Ps={};var ve=N.document&&$t&&(si()||parseInt(fr,10))||void 0;function le(n,e){if(ke.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(sa){e:{try{D(e.nodeName);var i=!0;break e}catch(o){}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Ms[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&le.X.h.call(this)}}Ce(le,ke);var Ms={2:"touch",3:"pen",4:"mouse"};le.prototype.h=function(){le.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var wn="closure_listenable_"+(1e6*Math.random()|0),Ls=0;function _t(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ha=i,this.key=++Ls,this.ba=this.ea=!1}function En(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function oi(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function ua(n){const e={};for(const t in n)e[t]=n[t];return e}const bn="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ca(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let o=0;o<bn.length;o++)t=bn[o],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function xn(n){this.src=n,this.g={},this.h=0}function Fs(n,e){var t=e.type;if(t in n.g){var o,r=n.g[t],i=ia(r,e);(o=0<=i)&&Array.prototype.splice.call(r,i,1),o&&(En(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function pr(n,e,t,r){for(var i=0;i<n.length;++i){var o=n[i];if(!o.ba&&o.listener==e&&o.capture==!!t&&o.ha==r)return i}return-1}xn.prototype.add=function(n,e,t,r,i){var o=n.toString();(n=this.g[o])||(n=this.g[o]=[],this.h++);var u=pr(n,e,r,i);return-1<u?(e=n[u],t||(e.ea=!1)):((e=new _t(e,this.src,o,!!r,i)).ea=t,n.push(e)),e};var Us="closure_lm_"+(1e6*Math.random()|0),mr={};function An(n,e,t,r,i){if(r&&r.once)return ai(n,e,t,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)An(n,e[o],t,r,i);return null}return t=qs(t),n&&n[wn]?n.N(e,t,Fe(r)?!!r.capture:!!r,i):nc(n,e,t,!1,r,i)}function nc(n,e,t,r,i,o){if(!e)throw Error("Invalid event type");var u=Fe(i)?!!i.capture:!!i,h=gr(n);if(h||(n[Us]=h=new xn(n)),(t=h.add(e,t,r,u,o)).proxy)return t;if(r=function rc(){const e=vt;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)ri||(i=u),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(la(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function ai(n,e,t,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)ai(n,e[o],t,r,i);return null}return t=qs(t),n&&n[wn]?n.O(e,t,Fe(r)?!!r.capture:!!r,i):nc(n,e,t,!0,r,i)}function ui(n,e,t,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)ui(n,e[o],t,r,i);else r=Fe(r)?!!r.capture:!!r,t=qs(t),n&&n[wn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=pr(o=n.g[e],t,r,i))&&(En(o[t]),Array.prototype.splice.call(o,t,1),0==o.length&&(delete n.g[e],n.h--))):n&&(n=gr(n))&&(e=n.g[e.toString()],n=-1,e&&(n=pr(e,t,r,i)),(t=-1<n?e[n]:null)&&Sn(t))}function Sn(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[wn])Fs(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(la(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=gr(e))?(Fs(t,n),0==t.h&&(t.src=null,e[Us]=null)):En(n)}}}function la(n){return n in mr?mr[n]:mr[n]="on"+n}function vt(n,e){if(n.ba)n=!0;else{e=new le(e,this);var t=n.listener,r=n.ha||n.src;n.ea&&Sn(n),n=t.call(r,e)}return n}function gr(n){return(n=n[Us])instanceof xn?n:null}var Vs="__closure_events_fn_"+(1e9*Math.random()>>>0);function qs(n){return"function"==typeof n?n:(n[Vs]||(n[Vs]=function(e){return n.handleEvent(e)}),n[Vs])}function Ie(){gt.call(this),this.i=new xn(this),this.P=this,this.I=null}function me(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new ke(e,n);else if(e instanceof ke)e.target=e.target||n;else{var i=e;ca(e=new ke(r,n),i)}if(i=!0,t)for(var o=t.length-1;0<=o;o--){var u=e.g=t[o];i=kn(u,r,!0,e)&&i}if(i=kn(u=e.g=n,r,!0,e)&&i,i=kn(u,r,!1,e)&&i,t)for(o=0;o<t.length;o++)i=kn(u=e.g=t[o],r,!1,e)&&i}function kn(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var u=e[o];if(u&&!u.ba&&u.capture==t){var h=u.listener,d=u.ha||u.src;u.ea&&Fs(n.i,u),i=!1!==h.call(d,r)&&i}}return i&&!r.defaultPrevented}Ce(Ie,gt),Ie.prototype[wn]=!0,Ie.prototype.removeEventListener=function(n,e,t,r){ui(this,n,e,t,r)},Ie.prototype.M=function(){if(Ie.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)En(t[r]);delete n.g[e],n.h--}}this.I=null},Ie.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},Ie.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Gs=N.JSON.stringify;function Bs(){var n=Ks;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var lt,ha=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new sc,n=>n.reset());class sc{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function js(n){N.setTimeout(()=>{throw n},0)}function Nn(n,e){lt||function Wt(){var n=N.Promise.resolve(void 0);lt=function(){n.then(ci)}}(),da||(lt(),da=!0),Ks.add(n,e)}var da=!1,Ks=new class ic{constructor(){this.h=this.g=null}add(e,t){const r=ha.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function ci(){for(var n;n=Bs();){try{n.h.call(n.g)}catch(t){js(t)}var e=ha;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}da=!1}function It(n,e){Ie.call(this),this.h=n||1,this.g=e||N,this.j=Ue(this.lb,this),this.l=Date.now()}function li(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function hi(n,e,t){if("function"==typeof n)t&&(n=Ue(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Ue(n.handleEvent,n)}return 2147483647<Number(e)?-1:N.setTimeout(n,e||0)}function di(n){n.g=hi(()=>{n.g=null,n.i&&(n.i=!1,di(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Ce(It,Ie),(L=It.prototype).ca=!1,L.R=null,L.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),me(this,"tick"),this.ca&&(li(this),this.start()))}},L.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},L.M=function(){It.X.M.call(this),li(this),delete this.g};class fa extends gt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:di(this)}M(){super.M(),this.g&&(N.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Dn(n){gt.call(this),this.h=n,this.g={}}Ce(Dn,gt);var $s=[];function zs(n,e,t,r){Array.isArray(t)||(t&&($s[0]=t.toString()),t=$s);for(var i=0;i<t.length;i++){var o=An(e,t[i],r||n.handleEvent,!1,n.h||n);if(!o)break;n.g[o.key]=o}}function Ws(n){oi(n.g,function(e,t){this.g.hasOwnProperty(t)&&Sn(e)},n),n.g={}}function Zt(){this.g=!0}function Cn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function ac(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var u=1;u<i.length;u++)i[u]=""}}}return Gs(t)}catch(h){return e}}(n,t)+(r?" "+r:"")})}Dn.prototype.M=function(){Dn.X.M.call(this),Ws(this)},Dn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Zt.prototype.Aa=function(){this.g=!1},Zt.prototype.info=function(){};var Dt={},ma=null;function fi(){return ma=ma||new Ie}function Ve(n){ke.call(this,Dt.Pa,n)}function Rn(n){const e=fi();me(e,new Ve(e))}function ga(n,e){ke.call(this,Dt.STAT_EVENT,n),this.stat=e}function Re(n){const e=fi();me(e,new ga(e,n))}function ya(n,e){ke.call(this,Dt.Qa,n),this.size=e}function Pn(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){n()},e)}Dt.Pa="serverreachability",Ce(Ve,ke),Dt.STAT_EVENT="statevent",Ce(ga,ke),Dt.Qa="timingevent",Ce(ya,ke);var pi={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Zs={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function mi(){}function Hs(){}mi.prototype.h=null;var Ys,Ht={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Qs(){ke.call(this,"d")}function yr(){ke.call(this,"c")}function On(){}function Ct(n,e,t,r){this.l=n,this.j=e,this.m=t,this.U=r||1,this.S=new Dn(this),this.O=uc,this.T=new It(n=Ds?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new yi}function yi(){this.i=null,this.g="",this.h=!1}Ce(Qs,ke),Ce(yr,ke),Ce(On,mi),On.prototype.g=function(){return new XMLHttpRequest},On.prototype.i=function(){return{}},Ys=new On;var uc=45e3,_r={},_i={};function vr(n,e,t){n.K=1,n.v=Fn(it(e)),n.s=t,n.P=!0,_a(n,null)}function _a(n,e){n.F=Date.now(),Ir(n),n.A=it(n.v);var t=n.A,r=n.U;Array.isArray(r)||(r=[String(r)]),Ea(t.i,"t",r),n.C=0,t=n.l.H,n.h=new yi,n.g=Ui(n.l,t?e:null,!n.s),0<n.N&&(n.L=new fa(Ue(n.La,n,n.g),n.N)),zs(n.S,n.g,"readystatechange",n.ib),e=n.H?ua(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Rn(),function zh(n,e,t,r,i,o){n.info(function(){if(n.g)if(o)for(var u="",h=o.split("&"),d=0;d<h.length;d++){var p=h[d].split("=");if(1<p.length){var g=p[0];p=p[1];var _=g.split("_");u=2<=_.length&&"type"==_[1]?u+(g+"=")+p+"&":u+(g+"=redacted&")}}else u=null;else u=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.U,n.s)}function vi(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function va(n,e,t){let i,r=!0;for(;!n.I&&n.C<t.length;){if(i=Xs(n,t),i==_i){4==e&&(n.o=4,Re(14),r=!1),Cn(n.j,n.m,null,"[Incomplete Response]");break}if(i==_r){n.o=4,Re(15),Cn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Cn(n.j,n.m,i,null),rt(n,i)}vi(n)&&i!=_i&&i!=_r&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Re(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Da(e),e.K=!0,Re(11))):(Cn(n.j,n.m,t,"[Invalid Chunked Response]"),nt(n),Qt(n))}function Xs(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?_i:(t=Number(e.substring(t,r)),isNaN(t)?_r:(r+=1)+t>e.length?_i:(e=e.substr(r,t),n.C=r+t,e))}function Ir(n){n.V=Date.now()+n.O,Ii(n,n.O)}function Ii(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Pn(Ue(n.gb,n),e)}function Ti(n){n.B&&(N.clearTimeout(n.B),n.B=null)}function Qt(n){0==n.l.G||n.I||Ic(n.l,n)}function nt(n){Ti(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,li(n.T),Ws(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function rt(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||bi(t.h,n)))if(!n.J&&bi(t.h,n)&&3==t.G){try{var r=t.Fa.g.parse(e)}catch(p){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.F+3e3<n.F))break e;lo(t),ao(t)}co(t),Re(18)}}else t.Ba=i[1],0<t.Ba-t.T&&37500>i[2]&&t.L&&0==t.A&&!t.v&&(t.v=Pn(Ue(t.cb,t),6e3));if(1>=ze(t.h)&&t.ja){try{t.ja()}catch(p){}t.ja=void 0}}else sn(t,11)}else if((n.J||t.g==n)&&lo(t),!Ne(e))for(i=t.Fa.g.parse(e),e=0;e<i.length;e++){let p=i[e];if(t.T=p[0],p=p[1],2==t.G)if("c"==p[0]){t.I=p[1],t.ka=p[2];const g=p[3];null!=g&&(t.ma=g,t.j.info("VER="+t.ma));const _=p[4];null!=_&&(t.Ca=_,t.j.info("SVER="+t.Ca));const I=p[5];null!=I&&"number"==typeof I&&0<I&&(t.J=r=1.5*I,t.j.info("backChannelRequestTimeoutMs_="+r)),r=t;const b=n.g;if(b){const S=b.g?b.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(S){var o=r.h;o.g||-1==S.indexOf("spdy")&&-1==S.indexOf("quic")&&-1==S.indexOf("h2")||(o.j=o.l,o.g=new Set,o.h&&(xa(o,o.h),o.h=null))}if(r.D){const O=b.g?b.g.getResponseHeader("X-HTTP-Session-Id"):null;O&&(r.za=O,ie(r.F,r.D,O))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var u=n;if((r=t).sa=Tc(r,r.H?r.ka:null,r.V),u.J){xi(r.h,u);var h=u,d=r.J;d&&h.setTimeout(d),h.B&&(Ti(h),Ir(h)),r.g=u}else Oi(r);0<t.i.length&&Pi(t)}else"stop"!=p[0]&&"close"!=p[0]||sn(t,7);else 3==t.G&&("stop"==p[0]||"close"==p[0]?"stop"==p[0]?sn(t,7):xr(t):"noop"!=p[0]&&t.l&&t.l.wa(p),t.A=0)}Rn()}catch(p){}}function Mn(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(V(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function cc(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if("undefined"!=typeof Map&&n instanceof Map)return Array.from(n.keys());if(!("undefined"!=typeof Set&&n instanceof Set)){if(V(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Js(n){if(n.W&&"function"==typeof n.W)return n.W();if("undefined"!=typeof Map&&n instanceof Map||"undefined"!=typeof Set&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(V(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],t&&t[o],n)}(L=Ct.prototype).setTimeout=function(n){this.O=n},L.ib=function(n){n=n.target;const e=this.L;e&&3==st(n)?e.l():this.La(n)},L.La=function(n){try{if(n==this.g)e:{const g=st(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>g)&&(3!=g||Ds||this.g&&(this.h.h||this.g.fa()||Ci(this.g)))){this.I||4!=g||7==e||Rn(),Ti(this);var t=this.g.aa();this.Y=t;t:if(vi(this)){var r=Ci(this.g);n="";var i=r.length,o=4==st(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){nt(this),Qt(this);var u="";break t}this.h.i=new N.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:o&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.fa();if(this.i=200==t,function oc(n,e,t,r,i,o,u){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+o+" "+u})}(this.j,this.u,this.A,this.m,this.U,g,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var h,d=this.g;if((h=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ne(h)){var p=h;break t}}p=null}if(!(t=p)){this.i=!1,this.o=3,Re(12),nt(this),Qt(this);break e}Cn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,rt(this,t)}this.P?(va(this,g,u),Ds&&this.i&&3==g&&(zs(this.S,this.T,"tick",this.hb),this.T.start())):(Cn(this.j,this.m,u,null),rt(this,u)),4==g&&nt(this),this.i&&!this.I&&(4==g?Ic(this.l,this):(this.i=!1,Ir(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,Re(12)):(this.o=0,Re(13)),nt(this),Qt(this)}}}catch(g){}},L.hb=function(){if(this.g){var n=st(this.g),e=this.g.fa();this.C<e.length&&(Ti(this),va(this,n,e),this.i&&4!=n&&Ir(this))}},L.cancel=function(){this.I=!0,nt(this)},L.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function pa(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Rn(),Re(17)),nt(this),this.o=2,Qt(this)):Ii(this,this.V-n)};var Ia=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Yt(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Yt){this.h=void 0!==e?e:n.h,wi(this,n.j),this.s=n.s,this.g=n.g,Ln(this,n.m),this.l=n.l,e=n.i;var t=new Pt;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Ta(this,t),this.o=n.o}else n&&(t=String(n).match(Ia))?(this.h=!!e,wi(this,t[1]||"",!0),this.s=Tt(t[2]||""),this.g=Tt(t[3]||"",!0),Ln(this,t[4]),this.l=Tt(t[5]||"",!0),Ta(this,t[6]||"",!0),this.o=Tt(t[7]||"")):(this.h=!!e,this.i=new Pt(null,this.h))}function it(n){return new Yt(n)}function wi(n,e,t){n.j=t?Tt(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ln(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Ta(n,e,t){e instanceof Pt?(n.i=e,function pc(n,e){e&&!n.j&&(Xt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(dc(this,r),Ea(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Tr(e,Rt)),n.i=new Pt(e,n.h))}function ie(n,e,t){n.i.set(e,t)}function Fn(n){return ie(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Tt(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Tr(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,lc),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function lc(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Yt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Tr(e,Un,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Tr(e,Un,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Tr(t,"/"==t.charAt(0)?wa:Wh,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Tr(t,hc)),n.join("")};var Un=/[#\/\?@]/g,Wh=/[#\?:]/g,wa=/[#\?]/g,Rt=/[#\?@]/g,hc=/#/g;function Pt(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Xt(n){n.g||(n.g=new Map,n.h=0,n.i&&function eo(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var o=n[t].substring(0,r);i=n[t].substring(r+1)}else o=n[t];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function dc(n,e){Xt(n),e=ht(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function fc(n,e){return Xt(n),e=ht(n,e),n.g.has(e)}function Ea(n,e,t){dc(n,e),0<t.length&&(n.i=null,n.g.set(ht(n,e),ni(t)),n.h+=t.length)}function ht(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function mc(n){this.l=n||ba,n=N.PerformanceNavigationTiming?0<(n=N.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(N.g&&N.g.Ga&&N.g.Ga()&&N.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(L=Pt.prototype).add=function(n,e){Xt(this),this.i=null,n=ht(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},L.forEach=function(n,e){Xt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},L.oa=function(){Xt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let o=0;o<i.length;o++)t.push(e[r])}return t},L.W=function(n){Xt(this);let e=[];if("string"==typeof n)fc(this,n)&&(e=e.concat(this.g.get(ht(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},L.set=function(n,e){return Xt(this),this.i=null,fc(this,n=ht(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},L.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},L.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const o=encodeURIComponent(String(r)),u=this.W(r);for(r=0;r<u.length;r++){var i=o;""!==u[r]&&(i+="="+encodeURIComponent(String(u[r]))),n.push(i)}}return this.i=n.join("&")};var ba=10;function Ei(n){return!!n.h||!!n.g&&n.g.size>=n.j}function ze(n){return n.h?1:n.g?n.g.size:0}function bi(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function xa(n,e){n.g?n.g.add(e):n.h=e}function xi(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function wr(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return ni(n.i)}function Ai(){}function Aa(){this.g=new Ai}function Zh(n,e,t){const r=t||"";try{Mn(n,function(i,o){let u=i;Fe(i)&&(u=Gs(i)),e.push(r+o+"="+encodeURIComponent(u))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Vn(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function Jt(n){this.l=n.ac||null,this.j=n.jb||!1}function en(n,e){Ie.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Er,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}mc.prototype.cancel=function(){if(this.i=wr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},Ai.prototype.stringify=function(n){return N.JSON.stringify(n,void 0)},Ai.prototype.parse=function(n){return N.JSON.parse(n,void 0)},Ce(Jt,mi),Jt.prototype.g=function(){return new en(this.l,this.j)},Jt.prototype.i=function(n){return function(){return n}}({}),Ce(en,Ie);var Er=0;function ro(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function tn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,qn(n)}function qn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(L=en.prototype).open=function(n,e){if(this.readyState!=Er)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,qn(this)},L.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||N).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},L.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tn(this)),this.readyState=Er},L.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,qn(this)),this.g&&(this.readyState=3,qn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==N.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ro(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},L.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?tn(this):qn(this),3==this.readyState&&ro(this)}},L.Va=function(n){this.g&&(this.response=this.responseText=n,tn(this))},L.Ua=function(n){this.g&&(this.response=n,tn(this))},L.ga=function(){this.g&&tn(this)},L.setRequestHeader=function(n,e){this.v.append(n,e)},L.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},L.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(en.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var io=N.JSON.parse;function se(n){Ie.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Si,this.K=this.L=!1}Ce(se,Ie);var Si="",gc=/^https?$/i,so=["POST","PUT"];function ki(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Sa(n),oo(n)}function Sa(n){n.D||(n.D=!0,me(n,"complete"),me(n,"error"))}function Ni(n){if(n.h&&void 0!==na&&(!n.C[1]||4!=st(n)||2!=n.aa()))if(n.v&&4==st(n))hi(n.Ha,0,n);else if(me(n,"readystatechange"),4==st(n)){n.h=!1;try{const h=n.aa();e:switch(h){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===h){var i=String(n.H).match(Ia)[1]||null;if(!i&&N.self&&N.self.location){var o=N.self.location.protocol;i=o.substr(0,o.length-1)}r=!gc.test(i?i.toLowerCase():"")}t=r}if(t)me(n,"complete"),me(n,"success");else{n.m=6;try{var u=2<st(n)?n.g.statusText:""}catch(d){u=""}n.j=u+" ["+n.aa()+"]",Sa(n)}}finally{oo(n)}}}function oo(n,e){if(n.g){Di(n);const t=n.g,r=n.C[0]?x:null;n.g=null,n.C=null,e||me(n,"ready");try{t.onreadystatechange=r}catch(i){}}}function Di(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(N.clearTimeout(n.A),n.A=null)}function st(n){return n.g?n.g.readyState:0}function Ci(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Si:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function br(n){let e="";return oi(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function ka(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=br(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):ie(n,e,t))}function nn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function _c(n){this.Ca=0,this.i=[],this.j=new Zt,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=nn("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=nn("baseRetryDelayMs",5e3,n),this.bb=nn("retryDelaySeedMs",1e4,n),this.$a=nn("forwardChannelMaxRetries",2,n),this.ta=nn("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new mc(n&&n.concurrentRequestLimit),this.Fa=new Aa,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function xr(n){if(Ri(n),3==n.G){var e=n.U++,t=it(n.F);ie(t,"SID",n.I),ie(t,"RID",e),ie(t,"TYPE","terminate"),rn(n,t),(e=new Ct(n,n.j,e,void 0)).K=2,e.v=Fn(it(t)),t=!1,N.navigator&&N.navigator.sendBeacon&&(t=N.navigator.sendBeacon(e.v.toString(),"")),!t&&N.Image&&((new Image).src=e.v,t=!0),t||(e.g=Ui(e.l,null),e.g.da(e.v)),e.F=Date.now(),Ir(e)}Fi(n)}function ao(n){n.g&&(Da(n),n.g.cancel(),n.g=null)}function Ri(n){ao(n),n.u&&(N.clearTimeout(n.u),n.u=null),lo(n),n.h.cancel(),n.m&&("number"==typeof n.m&&N.clearTimeout(n.m),n.m=null)}function Pi(n){Ei(n.h)||n.m||(n.m=!0,Nn(n.Ja,n),n.C=0)}function vc(n,e){var t;t=e?e.m:n.U++;const r=it(n.F);ie(r,"SID",n.I),ie(r,"RID",t),ie(r,"AID",n.T),rn(n,r),n.o&&n.s&&ka(r,n.o,n.s),t=new Ct(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=Na(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),xa(n.h,t),vr(t,r,e)}function rn(n,e){n.ia&&oi(n.ia,function(t,r){ie(e,r,t)}),n.l&&Mn({},function(t,r){ie(e,r,t)})}function Na(n,e,t){t=Math.min(n.i.length,t);var r=n.l?Ue(n.l.Ra,n.l,n):null;e:{var i=n.i;let o=-1;for(;;){const u=["count="+t];-1==o?0<t?(o=i[0].h,u.push("ofs="+o)):o=0:u.push("ofs="+o);let h=!0;for(let d=0;d<t;d++){let p=i[d].h;const g=i[d].g;if(p-=o,0>p)o=Math.max(0,i[d].h-100),h=!1;else try{Zh(g,u,"req"+p+"_")}catch(_){r&&r(g)}}if(h){r=u.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,r}function Oi(n){n.g||n.u||(n.Z=1,Nn(n.Ia,n),n.A=0)}function co(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=Pn(Ue(n.Ia,n),Li(n,n.A)),n.A++,0))}function Da(n){null!=n.B&&(N.clearTimeout(n.B),n.B=null)}function Mi(n){n.g=new Ct(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=it(n.sa);ie(e,"RID","rpc"),ie(e,"SID",n.I),ie(e,"CI",n.L?"0":"1"),ie(e,"AID",n.T),ie(e,"TYPE","xmlhttp"),rn(n,e),n.o&&n.s&&ka(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Fn(it(e)),t.s=null,t.P=!0,_a(t,n)}function lo(n){null!=n.v&&(N.clearTimeout(n.v),n.v=null)}function Ic(n,e){var t=null;if(n.g==e){lo(n),Da(n),n.g=null;var r=2}else{if(!bi(n.h,e))return;t=e.D,xi(n.h,e),r=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var i=n.C;me(r=fi(),new ya(r,t)),Pi(n)}else Oi(n);else if(3==(i=e.o)||0==i&&0<n.pa||!(1==r&&function uo(n,e){return!(ze(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=Pn(Ue(n.Ja,n,e),Li(n,n.C)),n.C++,0)))}(n,e)||2==r&&co(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),i){case 1:sn(n,5);break;case 4:sn(n,10);break;case 3:sn(n,6);break;default:sn(n,2)}}function Li(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function sn(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var r=Ue(n.kb,n);t||(t=new Yt("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||wi(t,"https"),Fn(t)),function no(n,e){const t=new Zt;if(N.Image){const r=new Image;r.onload=Ns(Vn,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ns(Vn,t,r,"TestLoadImage: error",!1,e),r.onabort=Ns(Vn,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ns(Vn,t,r,"TestLoadImage: timeout",!1,e),N.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Re(2);n.G=0,n.l&&n.l.va(e),Fi(n),Ri(n)}function Fi(n){if(n.G=0,n.la=[],n.l){const e=wr(n.h);(0!=e.length||0!=n.i.length)&&(tc(n.la,e),tc(n.la,n.i),n.h.i.length=0,ni(n.i),n.i.length=0),n.l.ua()}}function Tc(n,e,t){var r=t instanceof Yt?it(t):new Yt(t,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),Ln(r,r.m);else{var i=N.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var o=new Yt(null,void 0);r&&wi(o,r),e&&(o.g=e),i&&Ln(o,i),t&&(o.l=t),r=o}return e=n.za,(t=n.D)&&e&&ie(r,t,e),ie(r,"VER",n.ma),rn(n,r),r}function Ui(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new se(t&&n.Da&&!n.ra?new Jt({jb:!0}):n.ra)).Ka(n.H),e}function wc(){}function Gn(){if($t&&!(10<=Number(ve)))throw Error("Environmental error: no available transport.")}function Qe(n,e){Ie.call(this),this.g=new _c(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!Ne(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ne(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Ot(this)}function Vi(n){Qs.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Ca(){yr.call(this),this.status=1}function Ot(n){this.g=n}(L=se.prototype).Ka=function(n){this.L=n},L.da=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ys.g(),this.C=function gi(n){return n.h||(n.h=n.i())}(this.u?this.u:Ys),this.g.onreadystatechange=Ue(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(o){return void ki(this,o)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const o of r.keys())t.set(o,r.get(o))}r=Array.from(t.keys()).find(o=>"content-type"==o.toLowerCase()),i=N.FormData&&n instanceof N.FormData,!(0<=ia(so,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[o,u]of t)this.g.setRequestHeader(o,u);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Di(this),0<this.B&&((this.K=function yc(n){return $t&&function oa(){return function ut(n){var e=Ps;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=tt(String(fr)).split("."),t=tt("9").split("."),r=Math.max(e.length,t.length);for(let u=0;0==n&&u<r;u++){var i=e[u]||"",o=t[u]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==i[0].length&&0==o[0].length)break;n=ii(0==i[1].length?0:parseInt(i[1],10),0==o[1].length?0:parseInt(o[1],10))||ii(0==i[2].length,0==o[2].length)||ii(i[2],o[2]),i=i[3],o=o[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ue(this.qa,this)):this.A=hi(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(o){ki(this,o)}},L.qa=function(){void 0!==na&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,me(this,"timeout"),this.abort(8))},L.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,me(this,"complete"),me(this,"abort"),oo(this))},L.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),oo(this,!0)),se.X.M.call(this)},L.Ha=function(){this.s||(this.F||this.v||this.l?Ni(this):this.fb())},L.fb=function(){Ni(this)},L.aa=function(){try{return 2<st(this)?this.g.status:-1}catch(n){return-1}},L.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},L.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),io(e)}},L.Ea=function(){return this.m},L.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(L=_c.prototype).ma=8,L.G=1,L.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const i=new Ct(this,this.j,n,void 0);let o=this.s;if(this.S&&(o?(o=ua(o),ca(o,this.S)):o=this.S),null!==this.o||this.N||(i.H=o,o=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var r=this.i[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Na(this,i,e),ie(t=it(this.F),"RID",n),ie(t,"CVER",22),this.D&&ie(t,"X-HTTP-Session-Id",this.D),rn(this,t),o&&(this.N?e="headers="+encodeURIComponent(String(br(o)))+"&"+e:this.o&&ka(t,this.o,o)),xa(this.h,i),this.Ya&&ie(t,"TYPE","init"),this.O?(ie(t,"$req",e),ie(t,"SID","null"),i.Z=!0,vr(i,t,null)):vr(i,t,e),this.G=2}}else 3==this.G&&(n?vc(this,n):0==this.i.length||Ei(this.h)||vc(this))},L.Ia=function(){if(this.u=null,Mi(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=Pn(Ue(this.eb,this),n)}},L.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Re(10),ao(this),Mi(this))},L.cb=function(){null!=this.v&&(this.v=null,ao(this),co(this),Re(19))},L.kb=function(n){n?(this.j.info("Successfully pinged google.com"),Re(2)):(this.j.info("Failed to ping google.com"),Re(1))},(L=wc.prototype).xa=function(){},L.wa=function(){},L.va=function(){},L.ua=function(){},L.Ra=function(){},Gn.prototype.g=function(n,e){return new Qe(n,e)},Ce(Qe,Ie),Qe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;Re(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=Tc(n,null,n.V),Pi(n)},Qe.prototype.close=function(){xr(this.g)},Qe.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Gs(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&Pi(e)},Qe.prototype.M=function(){this.g.l=null,delete this.j,xr(this.g),delete this.g,Qe.X.M.call(this)},Ce(Vi,Qs),Ce(Ca,yr),Ce(Ot,wc),Ot.prototype.xa=function(){me(this.g,"a")},Ot.prototype.wa=function(n){me(this.g,new Vi(n))},Ot.prototype.va=function(n){me(this.g,new Ca)},Ot.prototype.ua=function(){me(this.g,"b")},Gn.prototype.createWebChannel=Gn.prototype.g,Qe.prototype.send=Qe.prototype.u,Qe.prototype.open=Qe.prototype.m,Qe.prototype.close=Qe.prototype.close,pi.NO_ERROR=0,pi.TIMEOUT=8,pi.HTTP_ERROR=6,Zs.COMPLETE="complete",Hs.EventType=Ht,Ht.OPEN="a",Ht.CLOSE="b",Ht.ERROR="c",Ht.MESSAGE="d",Ie.prototype.listen=Ie.prototype.N,se.prototype.listenOnce=se.prototype.O,se.prototype.getLastError=se.prototype.Oa,se.prototype.getLastErrorCode=se.prototype.Ea,se.prototype.getStatus=se.prototype.aa,se.prototype.getResponseJson=se.prototype.Sa,se.prototype.getResponseText=se.prototype.fa,se.prototype.send=se.prototype.da,se.prototype.setWithCredentials=se.prototype.Ka;var Hh=et.createWebChannelTransport=function(){return new Gn},ho=et.getStatEventTarget=function(){return fi()},Ra=et.ErrorCode=pi,Qh=et.EventType=Zs,Pa=et.Event=Dt,qi=et.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Ec=et.FetchXmlHttpFactory=Jt,Bn=et.WebChannel=Hs,Yh=et.XhrIo=se;const Oa="@firebase/firestore";class be{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}be.UNAUTHENTICATED=new be(null),be.GOOGLE_CREDENTIALS=new be("google-credentials-uid"),be.FIRST_PARTY=new be("first-party-uid"),be.MOCK_USER=new be("mock-user");let jn="9.17.1";const Mt=new mt.Yd("@firebase/firestore");function Ma(){return Mt.logLevel}function k(n,...e){if(Mt.logLevel<=mt.in.DEBUG){const t=e.map(La);Mt.debug(`Firestore (${jn}): ${n}`,...t)}}function ge(n,...e){if(Mt.logLevel<=mt.in.ERROR){const t=e.map(La);Mt.error(`Firestore (${jn}): ${n}`,...t)}}function Kn(n,...e){if(Mt.logLevel<=mt.in.WARN){const t=e.map(La);Mt.warn(`Firestore (${jn}): ${n}`,...t)}}function La(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function M(n="Unexpected state"){const e=`FIRESTORE (${jn}) INTERNAL ASSERTION FAILED: `+n;throw ge(e),new Error(e)}function F(n,e){n||M()}function C(n,e){return n}const w={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class A extends pe.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class xe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Fa{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class bc{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(be.UNAUTHENTICATED))}shutdown(){}}class xc{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class fo{constructor(e){this.t=e,this.currentUser=be.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const o=p=>this.i!==i?(i=this.i,t(p)):Promise.resolve();let u=new xe;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new xe,e.enqueueRetryable(()=>o(this.currentUser))};const h=()=>{const p=u;e.enqueueRetryable((0,y.Z)(function*(){yield p.promise,yield o(r.currentUser)}))},d=p=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(p=>d(p)),setTimeout(()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?d(p):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new xe)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(F("string"==typeof r.accessToken),new Fa(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return F(null===e||"string"==typeof e),new be(e)}}class po{constructor(e,t,r,i){this.h=e,this.l=t,this.m=r,this.g=i,this.type="FirstParty",this.user=be.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(F(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Xh{constructor(e,t,r,i){this.h=e,this.l=t,this.m=r,this.g=i}getToken(){return Promise.resolve(new po(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(be.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ar{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ua{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const r=o=>{null!=o.error&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const u=o.token!==this.A;return this.A=o.token,k("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const i=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.appCheck.addTokenListener(this.o)};this.T.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.T.getImmediate({optional:!0});o?i(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(F("string"==typeof t.token),this.A=t.token,new Ar(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ac(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Va{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=Ac(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%e.length))}return r}}function j(n,e){return n<e?-1:n>e?1:0}function $n(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Sc(n){return n+"\0"}class oe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new A(w.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new A(w.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new A(w.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new A(w.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return oe.fromMillis(Date.now())}static fromDate(e){return oe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new oe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?j(this.nanoseconds,e.nanoseconds):j(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class q{constructor(e){this.timestamp=e}static fromTimestamp(e){return new q(e)}static min(){return new q(new oe(0,0))}static max(){return new q(new oe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Sr{constructor(e,t,r){void 0===t?t=0:t>e.length&&M(),void 0===r?r=e.length-t:r>e.length-t&&M(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Sr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Sr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=e.get(i),u=t.get(i);if(o<u)return-1;if(o>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Z extends Sr{construct(e,t,r){return new Z(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new A(w.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new Z(t)}static emptyPath(){return new Z([])}}const kc=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $ extends Sr{construct(e,t,r){return new $(e,t,r)}static isValidIdentifier(e){return kc.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new $(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const o=()=>{if(0===r.length)throw new A(w.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let u=!1;for(;i<e.length;){const h=e[i];if("\\"===h){if(i+1===e.length)throw new A(w.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new A(w.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===h?(u=!u,i++):"."!==h||u?(r+=h,i++):(o(),i++)}if(o(),u)throw new A(w.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new $(t)}static emptyPath(){return new $([])}}class R{constructor(e){this.path=e}static fromPath(e){return new R(Z.fromString(e))}static fromName(e){return new R(Z.fromString(e).popFirst(5))}static empty(){return new R(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Z.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Z.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new R(new Z(e.slice()))}}class zn{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function mo(n){return n.fields.find(e=>2===e.kind)}function wt(n){return n.fields.filter(e=>2!==e.kind)}zn.UNKNOWN_ID=-1;class Gi{constructor(e,t){this.fieldPath=e,this.kind=t}}class kr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new kr(0,De.min())}}function go(n){return new De(n.readTime,n.key,-1)}class De{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new De(q.min(),R.empty(),-1)}static max(){return new De(q.max(),R.empty(),-1)}}function Wn(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=R.comparator(n.documentKey,e.documentKey),0!==t?t:j(n.largestBatchId,e.largestBatchId))}const Ga="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Bi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Et(n){return Dr.apply(this,arguments)}function Dr(){return Dr=(0,y.Z)(function*(n){if(n.code!==w.FAILED_PRECONDITION||n.message!==Ga)throw n;k("LocalStore","Unexpectedly lost primary lease")}),Dr.apply(this,arguments)}class T{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new T((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof T?t:T.resolve(t)}catch(t){return T.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):T.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):T.reject(t)}static resolve(e){return new T((t,r)=>{t(e)})}static reject(e){return new T((t,r)=>{r(e)})}static waitFor(e){return new T((t,r)=>{let i=0,o=0,u=!1;e.forEach(h=>{++i,h.next(()=>{++o,u&&o===i&&t()},d=>r(d))}),u=!0,o===i&&t()})}static or(e){let t=T.resolve(!1);for(const r of e)t=t.next(i=>i?T.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new T((r,i)=>{const o=e.length,u=new Array(o);let h=0;for(let d=0;d<o;d++){const p=d;t(e[p]).next(g=>{u[p]=g,++h,h===o&&r(u)},g=>i(g))}})}static doWhile(e,t){return new T((r,i)=>{const o=()=>{!0===e()?t().next(()=>{o()},i):r()};o()})}}class Zn{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new xe,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new Cr(e,t.error)):this.P.resolve()},this.transaction.onerror=r=>{const i=yo(r.target.error);this.P.reject(new Cr(e,i))}}static open(e,t,r,i){try{return new Zn(t,e.transaction(i,r))}catch(o){throw new Cr(t,o)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(k("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Cc(t)}}class Ye{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===Ye.D((0,pe.z$)())&&ge("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return k("SimpleDb","Removing database:",e),an(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,pe.hl)())return!1;if(Ye.N())return!0;const e=(0,pe.z$)(),t=Ye.D(e),r=0<t&&t<10,i=Ye.k(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}F(e){var t=this;return(0,y.Z)(function*(){return t.db||(k("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const o=indexedDB.open(t.name,t.version);o.onsuccess=u=>{r(u.target.result)},o.onblocked=()=>{i(new Cr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=u=>{const h=u.target.error;i("VersionError"===h.name?new A(w.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new A(w.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new Cr(e,h))},o.onupgradeneeded=u=>{k("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.S.$(u.target.result,o.transaction,u.oldVersion,t.version).next(()=>{k("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var o=this;return(0,y.Z)(function*(){const u="readonly"===t;let h=0;for(;;){++h;try{o.db=yield o.F(e);const d=Zn.open(o.db,e,u?"readonly":"readwrite",r),p=i(d).next(g=>(d.V(),g)).catch(g=>(d.abort(g),T.reject(g))).toPromise();return p.catch(()=>{}),yield d.v,p}catch(d){const p=d,g="FirebaseError"!==p.name&&h<3;if(k("SimpleDb","Transaction failed with error:",p.message,"Retrying:",g),o.close(),!g)return Promise.reject(p)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Dc{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return an(this.q.delete())}}class Cr extends A{constructor(e,t){super(w.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function on(n){return"IndexedDbTransactionError"===n.name}class Cc{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(k("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(k("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),an(r)}add(e){return k("SimpleDb","ADD",this.store.name,e,e),an(this.store.add(e))}get(e){return an(this.store.get(e)).next(t=>(void 0===t&&(t=null),k("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return k("SimpleDb","DELETE",this.store.name,e),an(this.store.delete(e))}count(){return k("SimpleDb","COUNT",this.store.name),an(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),o=[];return this.H(i,(u,h)=>{o.push(h)}).next(()=>o)}{const i=this.store.getAll(r.range);return new T((o,u)=>{i.onerror=h=>{u(h.target.error)},i.onsuccess=h=>{o(h.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new T((i,o)=>{r.onerror=u=>{o(u.target.error)},r.onsuccess=u=>{i(u.target.result)}})}Y(e,t){k("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const i=this.cursor(r);return this.H(i,(o,u,h)=>h.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.H(i,t)}tt(e){const t=this.cursor({});return new T((r,i)=>{t.onerror=o=>{const u=yo(o.target.error);i(u)},t.onsuccess=o=>{const u=o.target.result;u?e(u.primaryKey,u.value).next(h=>{h?u.continue():r()}):r()}})}H(e,t){const r=[];return new T((i,o)=>{e.onerror=u=>{o(u.target.error)},e.onsuccess=u=>{const h=u.target.result;if(!h)return void i();const d=new Dc(h),p=t(h.primaryKey,h.value,d);if(p instanceof T){const g=p.catch(_=>(d.done(),T.reject(_)));r.push(g)}d.isDone?i():null===d.G?h.continue():h.continue(d.G)}}).next(()=>T.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function an(n){return new T((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=yo(r.target.error);t(i)}})}let Ba=!1;function yo(n){const e=Ye.D((0,pe.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new A("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ba||(Ba=!0,setTimeout(()=>{throw r},0)),r}}return n}class _o{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;k("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,y.Z)(function*(){t.task=null;try{k("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(r){on(r)?k("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield Et(r)}yield t.nt(6e4)}))}}class Rc{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,y.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.it(r,e))})()}it(e,t){const r=new Set;let i=t,o=!0;return T.doWhile(()=>!0===o&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!r.has(u))return k("IndexBackiller",`Processing collection: ${u}`),this.rt(e,u,i).next(h=>{i-=h,r.add(u)});o=!1})).next(()=>t-i)}rt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(o=>{const u=o.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.ot(i,o)).next(h=>(k("IndexBackiller",`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h))).next(()=>u.size)}))}ot(e,t){let r=e;return t.changes.forEach((i,o)=>{const u=go(o);Wn(u,r)>0&&(r=u)}),new De(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Ke=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ut(i),this.ct=i=>r.writeSequenceNumber(i))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class ja{constructor(e,t,r,i,o,u,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.useFetchStreams=d}}class un{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new un("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof un&&e.projectId===this.projectId&&e.database===this.database}}function Ka(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function dt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function $a(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Rr(n){return null==n}function Pr(n){return 0===n&&1/n==-1/0}class Te{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Te(t)}static fromUint8Array(e){const t=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new Te(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return j(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Te.EMPTY_BYTE_STRING=new Te("");const Pc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lt(n){if(F(!!n),"string"==typeof n){let e=0;const t=Pc.exec(n);if(F(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:he(n.seconds),nanos:he(n.nanos)}}function he(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Ft(n){return"string"==typeof n?Te.fromBase64String(n):Te.fromUint8Array(n)}function vo(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Oc(n){const e=n.mapValue.fields.__previous_value__;return vo(e)?Oc(e):e}function Or(n){const e=Lt(n.mapValue.fields.__local_write_time__.timestampValue);return new oe(e.seconds,e.nanos)}const ft={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Io={nullValue:"NULL_VALUE"};function bt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?vo(n)?4:za(n)?9007199254740991:10:M()}function xt(n,e){if(n===e)return!0;const t=bt(n);if(t!==bt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Or(n).isEqual(Or(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Lt(r.timestampValue),u=Lt(i.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return i=e,Ft(n.bytesValue).isEqual(Ft(i.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return he(r.geoPointValue.latitude)===he(i.geoPointValue.latitude)&&he(r.geoPointValue.longitude)===he(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return he(r.integerValue)===he(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=he(r.doubleValue),u=he(i.doubleValue);return o===u?Pr(o)===Pr(u):isNaN(o)&&isNaN(u)}return!1}(n,e);case 9:return $n(n.arrayValue.values||[],e.arrayValue.values||[],xt);case 10:return function(r,i){const o=r.mapValue.fields||{},u=i.mapValue.fields||{};if(Ka(o)!==Ka(u))return!1;for(const h in o)if(o.hasOwnProperty(h)&&(void 0===u[h]||!xt(o[h],u[h])))return!1;return!0}(n,e);default:return M()}var i}function cn(n,e){return void 0!==(n.values||[]).find(t=>xt(t,e))}function ln(n,e){if(n===e)return 0;const t=bt(n),r=bt(e);if(t!==r)return j(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return j(n.booleanValue,e.booleanValue);case 2:return function(i,o){const u=he(i.integerValue||i.doubleValue),h=he(o.integerValue||o.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return Ki(n.timestampValue,e.timestampValue);case 4:return Ki(Or(n),Or(e));case 5:return j(n.stringValue,e.stringValue);case 6:return function(i,o){const u=Ft(i),h=Ft(o);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const u=i.split("/"),h=o.split("/");for(let d=0;d<u.length&&d<h.length;d++){const p=j(u[d],h[d]);if(0!==p)return p}return j(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const u=j(he(i.latitude),he(o.latitude));return 0!==u?u:j(he(i.longitude),he(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,o){const u=i.values||[],h=o.values||[];for(let d=0;d<u.length&&d<h.length;++d){const p=ln(u[d],h[d]);if(p)return p}return j(u.length,h.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,o){if(i===ft.mapValue&&o===ft.mapValue)return 0;if(i===ft.mapValue)return 1;if(o===ft.mapValue)return-1;const u=i.fields||{},h=Object.keys(u),d=o.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const _=j(h[g],p[g]);if(0!==_)return _;const I=ln(u[h[g]],d[p[g]]);if(0!==I)return I}return j(h.length,p.length)}(n.mapValue,e.mapValue);default:throw M()}}function Ki(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return j(n,e);const t=Lt(n),r=Lt(e),i=j(t.seconds,r.seconds);return 0!==i?i:j(t.nanos,r.nanos)}function Ut(n){return Mr(n)}function Mr(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=Lt(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Ft(n.bytesValue).toBase64():"referenceValue"in n?R.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",o=!0;for(const u of r.values||[])o?o=!1:i+=",",i+=Mr(u);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let o="{",u=!0;for(const h of i)u?u=!1:o+=",",o+=`${h}:${Mr(r.fields[h])}`;return o+"}"}(n.mapValue):M();var e}function Hn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Lr(n){return!!n&&"integerValue"in n}function $i(n){return!!n&&"arrayValue"in n}function Vt(n){return!!n&&"nullValue"in n}function zi(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Wi(n){return!!n&&"mapValue"in n}function Fr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return dt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Fr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Fr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function za(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function To(n){return"nullValue"in n?Io:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Hn(un.empty(),R.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:M()}function Mc(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Hn(un.empty(),R.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?ft:M()}function Lc(n,e){const t=ln(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Fc(n,e){const t=ln(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class pt{constructor(e,t){this.position=e,this.inclusive=t}}function Uc(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const o=e[i],u=n.position[i];if(r=o.field.isKeyField()?R.comparator(R.fromName(u.referenceValue),t.key):ln(u,t.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return r}function Zi(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!xt(n.position[t],e.position[t]))return!1;return!0}class Vc{}class W extends Vc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Gc(e,t,r):"array-contains"===t?new jc(e,r):"in"===t?new Yi(e,r):"not-in"===t?new td(e,r):"array-contains-any"===t?new Kc(e,r):new W(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Za(e,r):new Ha(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(ln(t,this.value)):null!==t&&bt(this.value)===bt(t)&&this.matchesComparison(ln(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return M()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Y extends Vc{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new Y(e,t)}matches(e){return Qn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Qn(n){return"and"===n.op}function hn(n){return"or"===n.op}function wo(n){return Wa(n)&&Qn(n)}function Wa(n){for(const e of n.filters)if(e instanceof Y)return!1;return!0}function Ur(n){if(n instanceof W)return n.field.canonicalString()+n.op.toString()+Ut(n.value);if(wo(n))return n.filters.map(e=>Ur(e)).join(",");{const e=n.filters.map(t=>Ur(t)).join(",");return`${n.op}(${e})`}}function Hi(n,e){return n instanceof W?(t=n,(r=e)instanceof W&&t.op===r.op&&t.field.isEqual(r.field)&&xt(t.value,r.value)):n instanceof Y?function(t,r){return r instanceof Y&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((i,o,u)=>i&&Hi(o,r.filters[u]),!0)}(n,e):void M();var t,r}function Qi(n,e){const t=n.filters.concat(e);return Y.create(t,n.op)}function qc(n){return n instanceof W?`${(e=n).field.canonicalString()} ${e.op} ${Ut(e.value)}`:n instanceof Y?function(e){return e.op.toString()+" {"+e.getFilters().map(qc).join(" ,")+"}"}(n):"Filter";var e}class Gc extends W{constructor(e,t,r){super(e,t,r),this.key=R.fromName(r.referenceValue)}matches(e){const t=R.comparator(e.key,this.key);return this.matchesComparison(t)}}class Za extends W{constructor(e,t){super(e,"in",t),this.keys=Bc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Ha extends W{constructor(e,t){super(e,"not-in",t),this.keys=Bc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Bc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>R.fromName(r.referenceValue))}class jc extends W{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return $i(t)&&cn(t.arrayValue,this.value)}}class Yi extends W{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&cn(this.value.arrayValue,t)}}class td extends W{constructor(e,t){super(e,"not-in",t)}matches(e){if(cn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!cn(this.value.arrayValue,t)}}class Kc extends W{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$i(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>cn(this.value.arrayValue,r))}}class qt{constructor(e,t="asc"){this.field=e,this.dir=t}}function nd(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class de{constructor(e,t){this.comparator=e,this.root=t||Pe.EMPTY}insert(e,t){return new de(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pe.BLACK,null,null))}remove(e){return new de(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Yn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Yn(this.root,e,this.comparator,!1)}getReverseIterator(){return new Yn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Yn(this.root,e,this.comparator,!0)}}class Yn{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(0===o){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pe{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=null!=r?r:Pe.RED,this.left=null!=i?i:Pe.EMPTY,this.right=null!=o?o:Pe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new Pe(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===o?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Pe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Pe.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw M();const e=this.left.check();if(e!==this.right.check())throw M();return e+(this.isRed()?0:1)}}Pe.EMPTY=null,Pe.RED=!0,Pe.BLACK=!1,Pe.EMPTY=new class{constructor(){this.size=0}get key(){throw M()}get value(){throw M()}get color(){throw M()}get left(){throw M()}get right(){throw M()}copy(n,e,t,r,i){return this}insert(n,e,t){return new Pe(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class X{constructor(e){this.comparator=e,this.data=new de(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Eo(this.data.getIterator())}getIteratorFrom(e){return new Eo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof X)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new X(this.comparator);return t.data=e,t}}class Eo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Gt(n){return n.hasNext()?n.getNext():void 0}class qe{constructor(e){this.fields=e,e.sort($.comparator)}static empty(){return new qe([])}unionWith(e){let t=new X($.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new qe(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return $n(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class we{constructor(e){this.value=e}static empty(){return new we({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Wi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Fr(t)}setAll(e){let t=$.emptyPath(),r={},i=[];e.forEach((u,h)=>{if(!t.isImmediateParentOf(h)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=h.popLast()}u?r[h.lastSegment()]=Fr(u):i.push(h.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){const t=this.field(e.popLast());Wi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return xt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Wi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){dt(t,(i,o)=>e[i]=o);for(const i of r)delete e[i]}clone(){return new we(Fr(this.value))}}function Qa(n){const e=[];return dt(n.fields,(t,r)=>{const i=new $([t]);if(Wi(r)){const o=Qa(r.mapValue).fields;if(0===o.length)e.push(i);else for(const u of o)e.push(i.child(u))}else e.push(i)}),new qe(e)}class ne{constructor(e,t,r,i,o,u,h){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=u,this.documentState=h}static newInvalidDocument(e){return new ne(e,0,q.min(),q.min(),q.min(),we.empty(),0)}static newFoundDocument(e,t,r,i){return new ne(e,1,t,q.min(),r,i,0)}static newNoDocument(e,t){return new ne(e,2,t,q.min(),q.min(),we.empty(),0)}static newUnknownDocument(e,t){return new ne(e,3,t,q.min(),q.min(),we.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=we.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=we.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ne&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ne(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ya{constructor(e,t=null,r=[],i=[],o=null,u=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=u,this.endAt=h,this.ft=null}}function Xi(n,e=null,t=[],r=[],i=null,o=null,u=null){return new Ya(n,e,t,r,i,o,u)}function dn(n){const e=C(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ur(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(i=r).field.canonicalString()+i.dir;var i}).join(","),Rr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ut(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ut(r)).join(",")),e.ft=t}return e.ft}function Vr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!nd(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Hi(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Zi(n.startAt,e.startAt)&&Zi(n.endAt,e.endAt)}function Xn(n){return R.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Ji(n,e){return n.filters.filter(t=>t instanceof W&&t.field.isEqual(e))}function Xa(n,e,t){let r=Io,i=!0;for(const o of Ji(n,e)){let u=Io,h=!0;switch(o.op){case"<":case"<=":u=To(o.value);break;case"==":case"in":case">=":u=o.value;break;case">":u=o.value,h=!1;break;case"!=":case"not-in":u=Io}Lc({value:r,inclusive:i},{value:u,inclusive:h})<0&&(r=u,i=h)}if(null!==t)for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){const u=t.position[o];Lc({value:r,inclusive:i},{value:u,inclusive:t.inclusive})<0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}function Ja(n,e,t){let r=ft,i=!0;for(const o of Ji(n,e)){let u=ft,h=!0;switch(o.op){case">=":case">":u=Mc(o.value),h=!1;break;case"==":case"in":case"<=":u=o.value;break;case"<":u=o.value,h=!1;break;case"!=":case"not-in":u=ft}Fc({value:r,inclusive:i},{value:u,inclusive:h})>0&&(r=u,i=h)}if(null!==t)for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){const u=t.position[o];Fc({value:r,inclusive:i},{value:u,inclusive:t.inclusive})>0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}class ot{constructor(e,t=null,r=[],i=[],o=null,u="F",h=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=u,this.startAt=h,this.endAt=d,this.dt=null,this._t=null}}function Jn(n){return new ot(n)}function bo(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function xo(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function fn(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Ao(n){return null!==n.collectionGroup}function pn(n){const e=C(n);if(null===e.dt){e.dt=[];const t=fn(e),r=xo(e);if(null!==t&&null===r)t.isKeyField()||e.dt.push(new qt(t)),e.dt.push(new qt($.keyField(),"asc"));else{let i=!1;for(const o of e.explicitOrderBy)e.dt.push(o),o.field.isKeyField()&&(i=!0);if(!i){const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new qt($.keyField(),o))}}}return e.dt}function Ge(n){const e=C(n);if(!e._t)if("F"===e.limitType)e._t=Xi(e.path,e.collectionGroup,pn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const o of pn(e))t.push(new qt(o.field,"desc"===o.dir?"asc":"desc"));const r=e.endAt?new pt(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new pt(e.startAt.position,e.startAt.inclusive):null;e._t=Xi(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e._t}function So(n,e){e.getFirstInequalityField(),fn(n);const t=n.filters.concat([e]);return new ot(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function es(n,e,t){return new ot(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function qr(n,e){return Vr(Ge(n),Ge(e))&&n.limitType===e.limitType}function tu(n){return`${dn(Ge(n))}|lt:${n.limitType}`}function ko(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>qc(r)).join(", ")}]`),Rr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>{return`${(i=r).field.canonicalString()} (${i.dir})`;var i}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ut(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ut(r)).join(",")),`Target(${t})`}(Ge(n))}; limitType=${n.limitType})`}function mn(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):R.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of pn(t))if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(i,o,u){const h=Uc(i,o,u);return i.inclusive?h<=0:h<0}(t.startAt,pn(t),r)||t.endAt&&!function(i,o,u){const h=Uc(i,o,u);return i.inclusive?h>=0:h>0}(t.endAt,pn(t),r)));var t,r}function ru(n){return(e,t)=>{let r=!1;for(const i of pn(n)){const o=$c(i,e,t);if(0!==o)return o;r=r||i.field.isKeyField()}return 0}}function $c(n,e,t){const r=n.field.isKeyField()?R.comparator(e.key,t.key):function(i,o,u){const h=o.data.field(i),d=u.data.field(i);return null!==h&&null!==d?ln(h,d):M()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M()}}function iu(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pr(e)?"-0":e}}function su(n){return{integerValue:""+n}}function No(n,e){return function ji(n){return"number"==typeof n&&Number.isInteger(n)&&!Pr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}(e)?su(e):iu(n,e)}class ts{constructor(){this._=void 0}}function zc(n,e,t){return n instanceof gn?function(r,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof yn?ns(n,e):n instanceof _n?au(n,e):function(r,i){const o=ou(r,i),u=Do(o)+Do(r.gt);return Lr(o)&&Lr(r.gt)?su(u):iu(r.yt,u)}(n,e)}function Wc(n,e,t){return n instanceof yn?ns(n,e):n instanceof _n?au(n,e):t}function ou(n,e){return n instanceof Gr?Lr(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class gn extends ts{}class yn extends ts{constructor(e){super(),this.elements=e}}function ns(n,e){const t=Zc(e);for(const r of n.elements)t.some(i=>xt(i,r))||t.push(r);return{arrayValue:{values:t}}}class _n extends ts{constructor(e){super(),this.elements=e}}function au(n,e){let t=Zc(e);for(const r of n.elements)t=t.filter(i=>!xt(i,r));return{arrayValue:{values:t}}}class Gr extends ts{constructor(e,t){super(),this.yt=e,this.gt=t}}function Do(n){return he(n.integerValue||n.doubleValue)}function Zc(n){return $i(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class er{constructor(e,t){this.field=e,this.transform=t}}class Hc{constructor(e,t){this.version=e,this.transformResults=t}}class ae{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ae}static exists(e){return new ae(void 0,e)}static updateTime(e){return new ae(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rs(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class is{}function cu(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new nr(n.key,ae.none()):new tr(n.key,n.data,ae.none());{const t=n.data,r=we.empty();let i=new X($.comparator);for(let o of e.fields)if(!i.has(o)){let u=t.field(o);null===u&&o.length>1&&(o=o.popLast(),u=t.field(o)),null===u?r.delete(o):r.set(o,u),i=i.add(o)}return new At(n.key,r,new qe(i.toArray()),ae.none())}}function lu(n,e,t){n instanceof tr?function(r,i,o){const u=r.value.clone(),h=fu(r.fieldTransforms,i,o.transformResults);u.setAll(h),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):n instanceof At?function(r,i,o){if(!rs(r.precondition,i))return void i.convertToUnknownDocument(o.version);const u=fu(r.fieldTransforms,i,o.transformResults),h=i.data;h.setAll(du(r)),h.setAll(u),i.convertToFoundDocument(o.version,h).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Br(n,e,t,r){return n instanceof tr?function(i,o,u,h){if(!rs(i.precondition,o))return u;const d=i.value.clone(),p=pu(i.fieldTransforms,h,o);return d.setAll(p),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof At?function(i,o,u,h){if(!rs(i.precondition,o))return u;const d=pu(i.fieldTransforms,h,o),p=o.data;return p.setAll(du(i)),p.setAll(d),o.convertToFoundDocument(o.version,p).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(n,e,t,r):(u=t,rs(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u);var o,u}function Qc(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),o=ou(r.transform,i||null);null!=o&&(null===t&&(t=we.empty()),t.set(r.field,o))}return t||null}function hu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&$n(t,r,(i,o)=>function uu(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof yn&&r instanceof yn||t instanceof _n&&r instanceof _n?$n(t.elements,r.elements,xt):t instanceof Gr&&r instanceof Gr?xt(t.gt,r.gt):t instanceof gn&&r instanceof gn);var t,r}(i,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class tr extends is{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class At extends is{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function du(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function fu(n,e,t){const r=new Map;F(n.length===t.length);for(let i=0;i<t.length;i++){const o=n[i],u=o.transform,h=e.data.field(o.field);r.set(o.field,Wc(u,h,t[i]))}return r}function pu(n,e,t){const r=new Map;for(const i of n){const o=i.transform,u=t.data.field(i.field);r.set(i.field,zc(o,u,e))}return r}class nr extends is{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Co extends is{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Yc{constructor(e){this.count=e}}var _e,H;function mu(n){switch(n){default:return M();case w.CANCELLED:case w.UNKNOWN:case w.DEADLINE_EXCEEDED:case w.RESOURCE_EXHAUSTED:case w.INTERNAL:case w.UNAVAILABLE:case w.UNAUTHENTICATED:return!1;case w.INVALID_ARGUMENT:case w.NOT_FOUND:case w.ALREADY_EXISTS:case w.PERMISSION_DENIED:case w.FAILED_PRECONDITION:case w.ABORTED:case w.OUT_OF_RANGE:case w.UNIMPLEMENTED:case w.DATA_LOSS:return!0}}function gu(n){if(void 0===n)return ge("GRPC error has no .code"),w.UNKNOWN;switch(n){case _e.OK:return w.OK;case _e.CANCELLED:return w.CANCELLED;case _e.UNKNOWN:return w.UNKNOWN;case _e.DEADLINE_EXCEEDED:return w.DEADLINE_EXCEEDED;case _e.RESOURCE_EXHAUSTED:return w.RESOURCE_EXHAUSTED;case _e.INTERNAL:return w.INTERNAL;case _e.UNAVAILABLE:return w.UNAVAILABLE;case _e.UNAUTHENTICATED:return w.UNAUTHENTICATED;case _e.INVALID_ARGUMENT:return w.INVALID_ARGUMENT;case _e.NOT_FOUND:return w.NOT_FOUND;case _e.ALREADY_EXISTS:return w.ALREADY_EXISTS;case _e.PERMISSION_DENIED:return w.PERMISSION_DENIED;case _e.FAILED_PRECONDITION:return w.FAILED_PRECONDITION;case _e.ABORTED:return w.ABORTED;case _e.OUT_OF_RANGE:return w.OUT_OF_RANGE;case _e.UNIMPLEMENTED:return w.UNIMPLEMENTED;case _e.DATA_LOSS:return w.DATA_LOSS;default:return M()}}(H=_e||(_e={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";class Bt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,o]of r)if(this.equalsFn(i,e))return o}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){dt(this.inner,(t,r)=>{for(const[i,o]of r)e(i,o)})}isEmpty(){return $a(this.inner)}size(){return this.innerSize}}const Xc=new de(R.comparator);function $e(){return Xc}const rr=new de(R.comparator);function vn(...n){let e=rr;for(const t of n)e=e.insert(t.key,t);return e}function yu(n){let e=rr;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function St(){return jr()}function _u(){return jr()}function jr(){return new Bt(n=>n.toString(),(n,e)=>n.isEqual(e))}const rd=new de(R.comparator),id=new X(R.comparator);function K(...n){let e=id;for(const t of n)e=e.add(t);return e}const sd=new X(j);function Ro(){return sd}class ss{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,os.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ss(q.min(),i,Ro(),$e(),K())}}class os{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new os(r,t,K(),K(),K())}}class Kr{constructor(e,t,r,i){this.It=e,this.removedTargetIds=t,this.key=r,this.Tt=i}}class Po{constructor(e,t){this.targetId=e,this.Et=t}}class vu{constructor(e,t,r=Te.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Iu{constructor(){this.At=0,this.Rt=a(),this.bt=Te.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=K(),t=K(),r=K();return this.Rt.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M()}}),new os(this.bt,this.Pt,e,t,r)}xt(){this.vt=!1,this.Rt=a()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class c{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=$e(),this.qt=s(),this.Ut=new X(j)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const r=this.Wt(t);switch(e.state){case 0:this.zt(t)&&r.Dt(e.resumeToken);break;case 1:r.Mt(),r.Vt||r.xt(),r.Dt(e.resumeToken);break;case 2:r.Mt(),r.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(r.Ft(),r.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),r.Dt(e.resumeToken));break;default:M()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((r,i)=>{this.zt(i)&&t(i)})}Jt(e){const t=e.targetId,r=e.Et.count,i=this.Yt(t);if(i){const o=i.target;if(Xn(o))if(0===r){const u=new R(o.path);this.Qt(t,u,ne.newNoDocument(u,q.min()))}else F(1===r);else this.Xt(t)!==r&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((o,u)=>{const h=this.Yt(u);if(h){if(o.current&&Xn(h.target)){const d=new R(h.target.path);null!==this.Lt.get(d)||this.te(u,d)||this.Qt(u,d,ne.newNoDocument(d,e))}o.St&&(t.set(u,o.Ct()),o.xt())}});let r=K();this.qt.forEach((o,u)=>{let h=!0;u.forEachWhile(d=>{const p=this.Yt(d);return!p||2===p.purpose||(h=!1,!1)}),h&&(r=r.add(o))}),this.Lt.forEach((o,u)=>u.setReadTime(e));const i=new ss(e,t,this.Ut,this.Lt,r);return this.Lt=$e(),this.qt=s(),this.Ut=new X(j),i}Gt(e,t){if(!this.zt(e))return;const r=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,r),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,r){if(!this.zt(e))return;const i=this.Wt(e);this.te(e,t)?i.Nt(t,1):i.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),r&&(this.Lt=this.Lt.insert(t,r))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Iu,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new X(j),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||k("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new Iu),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function s(){return new de(R.comparator)}function a(){return new de(R.comparator)}const l={asc:"ASCENDING",desc:"DESCENDING"},f={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},m={and:"AND",or:"OR"};class v{constructor(e,t){this.databaseId=e,this.wt=t}}function E(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function P(n,e){return n.wt?e.toBase64():e.toUint8Array()}function G(n,e){return E(n,e.toTimestamp())}function U(n){return F(!!n),q.fromTimestamp(function(e){const t=Lt(e);return new oe(t.seconds,t.nanos)}(n))}function te(n,e){return(t=n,new Z(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function at(n){const e=Z.fromString(n);return F(cd(e)),e}function Xe(n,e){return te(n.databaseId,e.path)}function We(n,e){const t=at(e);if(t.get(1)!==n.databaseId.projectId)throw new A(w.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new A(w.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new R(Oo(t))}function as(n,e){return te(n.databaseId,e)}function us(n){const e=at(n);return 4===e.length?Z.emptyPath():Oo(e)}function ir(n){return new Z(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Oo(n){return F(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function cs(n,e,t){return{name:Xe(n,e),fields:t.value.mapValue.fields}}function sr(n,e){let t;if(e instanceof tr)t={update:cs(n,e.key,e.value)};else if(e instanceof nr)t={delete:Xe(n,e.key)};else if(e instanceof At)t={update:cs(n,e.key,e.data),updateMask:lp(e.fieldMask)};else{if(!(e instanceof Co))return M();t={verify:Xe(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const u=o.transform;if(u instanceof gn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof yn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof _n)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Gr)return{fieldPath:o.field.canonicalString(),increment:u.gt};throw M()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:G(n,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:M()),t;var i}function Fo(n,e){const t=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?ae.updateTime(U(i.updateTime)):void 0!==i.exists?ae.exists(i.exists):ae.none():ae.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,u){let h=null;"setToServerValue"in u?(F("REQUEST_TIME"===u.setToServerValue),h=new gn):"appendMissingElements"in u?h=new yn(u.appendMissingElements.values||[]):"removeAllFromArray"in u?h=new _n(u.removeAllFromArray.values||[]):"increment"in u?h=new Gr(o,u.increment):M();const d=$.fromServerFormat(u.fieldPath);return new er(d,h)}(n,i)):[];var i;if(e.update){const i=We(n,e.update.name),o=new we({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new qe((e.updateMask.fieldPaths||[]).map(p=>$.fromServerFormat(p)));return new At(i,o,u,t,r)}return new tr(i,o,t,r)}if(e.delete){const i=We(n,e.delete);return new nr(i,t)}if(e.verify){const i=We(n,e.verify);return new Co(i,t)}return M()}function wu(n,e){return{documents:[as(n,e.path)]}}function Jc(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=as(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=as(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(d){if(0!==d.length)return ud(Y.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(d){if(0!==d.length)return d.map(p=>{return{field:ls((g=p).field),direction:ap(g.dir)};var g})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=(p=e.limit,n.wt||Rr(p)?p:{value:p});var p,h,d;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt={before:!(d=e.endAt).inclusive,values:d.position}),t}function od(n){let e=us(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){F(1===r);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let o=[];t.where&&(o=function(g){const _=ad(g);return _ instanceof Y&&wo(_)?_.getFilters():[_]}(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(g=>{return new qt(hs((_=g).field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction));var _}));let h=null;t.limit&&(h=function(g){let _;return _="object"==typeof g?g.value:g,Rr(_)?null:_}(t.limit));let d=null;var g;t.startAt&&(d=new pt((g=t.startAt).values||[],!!g.before));let p=null;return t.endAt&&(p=function(g){return new pt(g.values||[],!g.before)}(t.endAt)),function eu(n,e,t,r,i,o,u,h){return new ot(n,e,t,r,i,o,u,h)}(e,i,u,o,h,"F",d,p)}function ad(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=hs(e.unaryFilter.field);return W.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=hs(e.unaryFilter.field);return W.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=hs(e.unaryFilter.field);return W.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=hs(e.unaryFilter.field);return W.create(o,"!=",{nullValue:"NULL_VALUE"});default:return M()}}(n):void 0!==n.fieldFilter?W.create(hs((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return M()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return Y.create(e.compositeFilter.filters.map(t=>ad(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return M()}}(e.compositeFilter.op))}(n):M();var e}function ap(n){return l[n]}function up(n){return f[n]}function cp(n){return m[n]}function ls(n){return{fieldPath:n.canonicalString()}}function hs(n){return $.fromServerFormat(n.fieldPath)}function ud(n){return n instanceof W?function(e){if("=="===e.op){if(zi(e.value))return{unaryFilter:{field:ls(e.field),op:"IS_NAN"}};if(Vt(e.value))return{unaryFilter:{field:ls(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(zi(e.value))return{unaryFilter:{field:ls(e.field),op:"IS_NOT_NAN"}};if(Vt(e.value))return{unaryFilter:{field:ls(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ls(e.field),op:up(e.op),value:e.value}}}(n):n instanceof Y?function(e){const t=e.getFilters().map(r=>ud(r));return 1===t.length?t[0]:{compositeFilter:{op:cp(e.op),filters:t}}}(n):M()}function lp(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function cd(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function Ze(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ld(e)),e=hp(n.get(t),e);return ld(e)}function hp(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const o=n.charAt(i);switch(o){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=o}}return t}function ld(n){return n+"\x01\x01"}function jt(n){const e=n.length;if(F(e>=2),2===e)return F("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),Z.emptyPath();const t=e-2,r=[];let i="";for(let o=0;o<e;){const u=n.indexOf("\x01",o);switch((u<0||u>t)&&M(),n.charAt(u+1)){case"\x01":const h=n.substring(o,u);let d;0===i.length?d=h:(i+=h,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(o,u),i+="\0";break;case"\x11":i+=n.substring(o,u+1);break;default:M()}o=u+2}return new Z(r)}const hd=["userId","batchId"];function Eu(n,e){return[n,Ze(e)]}function dd(n,e,t){return[n,Ze(e),t]}const dp={},fp=["prefixPath","collectionGroup","readTime","documentId"],pp=["prefixPath","collectionGroup","documentId"],mp=["collectionGroup","readTime","prefixPath","documentId"],gp=["canonicalId","targetId"],yp=["targetId","path"],_p=["path","targetId"],vp=["collectionId","parent"],Ip=["indexId","uid"],Tp=["uid","sequenceNumber"],wp=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ep=["indexId","uid","orderedDocumentKey"],bp=["userId","collectionPath","documentId"],xp=["userId","collectionPath","largestBatchId"],Ap=["userId","collectionGroup","largestBatchId"],fd=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Sp=[...fd,"documentOverlays"],pd=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],md=pd,kp=[...md,"indexConfiguration","indexState","indexEntries"];class el extends Bi{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function Oe(n,e){const t=C(n);return Ye.M(t.se,e)}class tl{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&lu(o,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Br(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Br(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=_u();return this.mutations.forEach(i=>{const o=e.get(i.key),u=o.overlayedDocument;let h=this.applyToLocalView(u,o.mutatedFields);h=t.has(i.key)?null:h;const d=cu(u,h);null!==d&&r.set(i.key,d),u.isValidDocument()||u.convertToNoDocument(q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),K())}isEqual(e){return this.batchId===e.batchId&&$n(this.mutations,e.mutations,(t,r)=>hu(t,r))&&$n(this.baseMutations,e.baseMutations,(t,r)=>hu(t,r))}}class nl{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){F(e.mutations.length===r.length);let i=rd;const o=e.mutations;for(let u=0;u<o.length;u++)i=i.insert(o[u].key,r[u].version);return new nl(e,t,r,i)}}class rl{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class or{constructor(e,t,r,i,o=q.min(),u=q.min(),h=Te.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h}withSequenceNumber(e){return new or(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new or(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new or(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class gd{constructor(e){this.ie=e}}function yd(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:bu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Xe(i=n.ie,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:E(i,o.version.toTimestamp()),createTime:E(i,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:$r(e.version)};else{if(!e.isUnknownDocument())return M();r.unknownDocument={path:t.path.toArray(),version:$r(e.version)}}var i,o;return r}function bu(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function $r(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function zr(n){const e=new oe(n.seconds,n.nanoseconds);return q.fromTimestamp(e)}function Wr(n,e){const t=(e.baseMutations||[]).map(o=>Fo(n.ie,o));for(let o=0;o<e.mutations.length-1;++o){const u=e.mutations[o];o+1<e.mutations.length&&void 0!==e.mutations[o+1].transform&&(u.updateTransforms=e.mutations[o+1].transform.fieldTransforms,e.mutations.splice(o+1,1),++o)}const r=e.mutations.map(o=>Fo(n.ie,o)),i=oe.fromMillis(e.localWriteTimeMs);return new tl(e.batchId,i,t,r)}function Vo(n){const e=zr(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?zr(n.lastLimboFreeSnapshotVersion):q.min();let r;var i;return void 0!==n.query.documents?(F(1===(i=n.query).documents.length),r=Ge(Jn(us(i.documents[0])))):r=Ge(od(n.query)),new or(r,n.targetId,0,n.lastListenSequenceNumber,e,t,Te.fromBase64String(n.resumeToken))}function _d(n,e){const t=$r(e.snapshotVersion),r=$r(e.lastLimboFreeSnapshotVersion);let i;i=Xn(e.target)?wu(n.ie,e.target):Jc(n.ie,e.target);const o=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:dn(e.target),readTime:t,resumeToken:o,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function il(n){const e=od({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?es(e,e.limit,"L"):e}function sl(n,e){return new rl(e.largestBatchId,Fo(n.ie,e.overlayMutation))}function vd(n,e){const t=e.path.lastSegment();return[n,Ze(e.path.popLast()),t]}function Id(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:$r(r.readTime),documentKey:Ze(r.documentKey.path),largestBatchId:r.largestBatchId}}class Dp{getBundleMetadata(e,t){return Td(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:zr(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return Td(e).put({bundleId:(r=t).id,createTime:$r(U(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return wd(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:il(i.bundledQuery),readTime:zr(i.readTime)};var i})}saveNamedQuery(e,t){return wd(e).put({name:(r=t).name,readTime:$r(U(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Td(n){return Oe(n,"bundles")}function wd(n){return Oe(n,"namedQueries")}class xu{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new xu(e,t.uid||"")}getOverlay(e,t){return qo(e).get(vd(this.userId,t)).next(r=>r?sl(this.yt,r):null)}getOverlays(e,t){const r=St();return T.forEach(t,i=>this.getOverlay(e,i).next(o=>{null!==o&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((o,u)=>{const h=new rl(t,u);i.push(this.oe(e,h))}),T.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(u=>i.add(Ze(u.getCollectionPath())));const o=[];return i.forEach(u=>{const h=IDBKeyRange.bound([this.userId,u,r],[this.userId,u,r+1],!1,!0);o.push(qo(e).Y("collectionPathOverlayIndex",h))}),T.waitFor(o)}getOverlaysForCollection(e,t,r){const i=St(),o=Ze(t),u=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,Number.POSITIVE_INFINITY],!0);return qo(e).W("collectionPathOverlayIndex",u).next(h=>{for(const d of h){const p=sl(this.yt,d);i.set(p.getKey(),p)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const o=St();let u;const h=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return qo(e).Z({index:"collectionGroupOverlayIndex",range:h},(d,p,g)=>{const _=sl(this.yt,p);o.size()<i||_.largestBatchId===u?(o.set(_.getKey(),_),u=_.largestBatchId):g.done()}).next(()=>o)}oe(e,t){return qo(e).put(function(r,i,o){const[u,h,d]=vd(i,o.mutation.key);return{userId:i,collectionPath:h,documentId:d,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:sr(r.ie,o.mutation)}}(this.yt,this.userId,t))}}function qo(n){return Oe(n,"documentOverlays")}class Zr{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(he(e.integerValue));else if("doubleValue"in e){const r=he(e.doubleValue);isNaN(r)?this.he(t,13):(this.he(t,15),Pr(r)?t.le(0):t.le(r))}else if("timestampValue"in e){const r=e.timestampValue;this.he(t,20),"string"==typeof r?t.fe(r):(t.fe(`${r.seconds||""}`),t.le(r.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(Ft(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)}else"mapValue"in e?za(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):M()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const r=e.fields||{};this.he(t,55);for(const i of Object.keys(r))this.de(i,t),this.ce(r[i],t)}ye(e,t){const r=e.values||[];this.he(t,50);for(const i of r)this.ce(i,t)}me(e,t){this.he(t,37),R.fromName(e).path.forEach(r=>{this.he(t,60),this.pe(r,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function Cp(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function Ed(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const o=Cp(255&t[i]);if(r+=o,8!==o)break}return r}(n);return Math.ceil(e/8)}Zr.Ie=new Zr;class Rp{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ee(r.value),r=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.be(r.value),r=t.next();this.Pe()}ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ee(r);else if(r<2048)this.Ee(960|r>>>6),this.Ee(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r);else{const i=t.codePointAt(0);this.Ee(240|i>>>18),this.Ee(128|63&i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i)}}this.Ae()}Ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.be(r);else if(r<2048)this.be(960|r>>>6),this.be(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.be(480|r>>>12),this.be(128|63&r>>>6),this.be(128|63&r);else{const i=t.codePointAt(0);this.be(240|i>>>18),this.be(128|63&i>>>12),this.be(128|63&i>>>6),this.be(128|63&i)}}this.Pe()}Se(e){const t=this.De(e),r=Ed(t);this.Ce(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}xe(e){const t=this.De(e),r=Ed(t);this.Ce(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class Pp{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class Op{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class Go{constructor(){this.$e=new Rp,this.Be=new Pp(this.$e),this.Le=new Op(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class Hr{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Hr(this.indexId,this.documentKey,this.arrayValue,r)}}function ar(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=bd(n.arrayValue,e.arrayValue),0!==t?t:(t=bd(n.directionalValue,e.directionalValue),0!==t?t:R.comparator(n.documentKey,e.documentKey)))}function bd(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Mp{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const r=t;r.isInequality()?this.Qe=r:this.Ge.push(r)}}je(e){F(e.collectionGroup===this.collectionId);const t=mo(e);if(void 0!==t&&!this.We(t))return!1;const r=wt(e);let i=0,o=0;for(;i<r.length&&this.We(r[i]);++i);if(i===r.length)return!0;if(void 0!==this.Qe){const u=r[i];if(!this.ze(this.Qe,u)||!this.He(this.Ke[o++],u))return!1;++i}for(;i<r.length;++i){const u=r[i];if(o>=this.Ke.length||!this.He(this.Ke[o++],u))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function xd(n){var e,t;if(F(n instanceof W||n instanceof Y),n instanceof W){if(n instanceof Yi){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(o=>W.create(n.field,"==",o)))||[];return Y.create(i,"or")}return n}const r=n.filters.map(i=>xd(i));return Y.create(r,n.op)}function Lp(n){if(0===n.getFilters().length)return[];const e=ul(xd(n));return F(Ad(e)),ol(e)||al(e)?[e]:e.getFilters()}function ol(n){return n instanceof W}function al(n){return n instanceof Y&&wo(n)}function Ad(n){return ol(n)||al(n)||function(e){if(e instanceof Y&&hn(e)){for(const t of e.getFilters())if(!ol(t)&&!al(t))return!1;return!0}return!1}(n)}function ul(n){if(F(n instanceof W||n instanceof Y),n instanceof W)return n;if(1===n.filters.length)return ul(n.filters[0]);const e=n.filters.map(r=>ul(r));let t=Y.create(e,n.op);return t=Au(t),Ad(t)?t:(F(t instanceof Y),F(Qn(t)),F(t.filters.length>1),t.filters.reduce((r,i)=>cl(r,i)))}function cl(n,e){let t;return F(n instanceof W||n instanceof Y),F(e instanceof W||e instanceof Y),t=n instanceof W?e instanceof W?Y.create([n,e],"and"):Sd(n,e):e instanceof W?Sd(e,n):function(r,i){if(F(r.filters.length>0&&i.filters.length>0),Qn(r)&&Qn(i))return Qi(r,i.getFilters());const o=hn(r)?r:i,u=hn(r)?i:r,h=o.filters.map(d=>cl(d,u));return Y.create(h,"or")}(n,e),Au(t)}function Sd(n,e){if(Qn(e))return Qi(e,n.getFilters());{const t=e.filters.map(r=>cl(n,r));return Y.create(t,"or")}}function Au(n){if(F(n instanceof W||n instanceof Y),n instanceof W)return n;const e=n.getFilters();if(1===e.length)return Au(e[0]);if(Wa(n))return n;const t=e.map(i=>Au(i)),r=[];return t.forEach(i=>{i instanceof W?r.push(i):i instanceof Y&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:Y.create(r,n.op)}class Fp{constructor(){this.Je=new ll}addToCollectionParentIndex(e,t){return this.Je.add(t),T.resolve()}getCollectionParents(e,t){return T.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return T.resolve()}deleteFieldIndex(e,t){return T.resolve()}getDocumentsMatchingTarget(e,t){return T.resolve(null)}getIndexType(e,t){return T.resolve(0)}getFieldIndexes(e,t){return T.resolve([])}getNextCollectionGroupToUpdate(e){return T.resolve(null)}getMinOffset(e,t){return T.resolve(De.min())}getMinOffsetFromCollectionGroup(e,t){return T.resolve(De.min())}updateCollectionGroup(e,t,r){return T.resolve()}updateIndexEntries(e,t){return T.resolve()}}class ll{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new X(Z.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new X(Z.comparator)).toArray()}}const Su=new Uint8Array(0);class Up{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new ll,this.Xe=new Bt(r=>dn(r),(r,i)=>Vr(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const o={collectionId:r,parent:Ze(i)};return kd(e).put(o)}return T.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Sc(t),""],!1,!0);return kd(e).W(i).next(o=>{for(const u of o){if(u.collectionId!==t)break;r.push(jt(u.parent))}return r})}addFieldIndex(e,t){const r=ku(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(h=>[h.fieldPath.canonicalString(),h.kind])};var u;delete i.indexId;const o=r.add(i);if(t.indexState){const u=jo(e);return o.next(h=>{u.put(Id(h,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return o.next()}deleteFieldIndex(e,t){const r=ku(e),i=jo(e),o=Bo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>o.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=Bo(e);let i=!0;const o=new Map;return T.forEach(this.Ze(t),u=>this.tn(e,u).next(h=>{i&&(i=!!h),o.set(u,h)})).next(()=>{if(i){let u=K();const h=[];return T.forEach(o,(d,p)=>{var g;k("IndexedDbIndexManager",`Using index ${g=d,`id=${g.indexId}|cg=${g.collectionGroup}|f=${g.fields.map(ee=>`${ee.fieldPath}:${ee.kind}`).join(",")}`} to execute ${dn(t)}`);const _=function(ee,Le){const re=mo(Le);if(void 0===re)return null;for(const J of Ji(ee,re.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null}(p,d),I=function(ee,Le){const re=new Map;for(const J of wt(Le))for(const je of Ji(ee,J.fieldPath))switch(je.op){case"==":case"in":re.set(J.fieldPath.canonicalString(),je.value);break;case"not-in":case"!=":return re.set(J.fieldPath.canonicalString(),je.value),Array.from(re.values())}return null}(p,d),b=function(ee,Le){const re=[];let J=!0;for(const je of wt(Le)){const ta=0===je.kind?Xa(ee,je.fieldPath,ee.startAt):Ja(ee,je.fieldPath,ee.startAt);re.push(ta.value),J&&(J=ta.inclusive)}return new pt(re,J)}(p,d),S=function(ee,Le){const re=[];let J=!0;for(const je of wt(Le)){const ta=0===je.kind?Ja(ee,je.fieldPath,ee.endAt):Xa(ee,je.fieldPath,ee.endAt);re.push(ta.value),J&&(J=ta.inclusive)}return new pt(re,J)}(p,d),O=this.en(d,p,b),B=this.en(d,p,S),ue=this.nn(d,p,I),ye=this.sn(d.indexId,_,O,b.inclusive,B,S.inclusive,ue);return T.forEach(ye,ee=>r.J(ee,t.limit).next(Le=>{Le.forEach(re=>{const J=R.fromSegments(re.documentKey);u.has(J)||(u=u.add(J),h.push(J))})}))}).next(()=>h)}return T.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:Lp(Y.create(e.filters,"and")).map(r=>Xi(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,r,i,o,u,h){const d=(null!=t?t.length:1)*Math.max(r.length,o.length),p=d/(null!=t?t.length:1),g=[];for(let _=0;_<d;++_){const I=t?this.rn(t[_/p]):Su,b=this.on(e,I,r[_%p],i),S=this.un(e,I,o[_%p],u),O=h.map(B=>this.on(e,I,B,!0));g.push(...this.createRange(b,S,O))}return g}on(e,t,r,i){const o=new Hr(e,R.empty(),t,r);return i?o:o.Ue()}un(e,t,r,i){const o=new Hr(e,R.empty(),t,r);return i?o.Ue():o}tn(e,t){const r=new Mp(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(o=>{let u=null;for(const h of o)r.je(h)&&(!u||h.fields.length>u.fields.length)&&(u=h);return u})}getIndexType(e,t){let r=2;const i=this.Ze(t);return T.forEach(i,o=>this.tn(e,o).next(u=>{u?0!==r&&u.fields.length<function(h){let d=new X($.comparator),p=!1;for(const g of h.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?p=!0:d=d.add(_.field));for(const g of h.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(p?1:0)}(o)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}cn(e,t){const r=new Go;for(const i of wt(e)){const o=t.data.field(i.fieldPath);if(null==o)return null;const u=r.qe(i.kind);Zr.Ie.ue(o,u)}return r.Fe()}rn(e){const t=new Go;return Zr.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const r=new Go;return Zr.Ie.ue(Hn(this.databaseId,t),r.qe(function(i){const o=wt(i);return 0===o.length?0:o[o.length-1].kind}(e))),r.Fe()}nn(e,t,r){if(null===r)return[];let i=[];i.push(new Go);let o=0;for(const u of wt(e)){const h=r[o++];for(const d of i)if(this.hn(t,u.fieldPath)&&$i(h))i=this.ln(i,u,h);else{const p=d.qe(u.kind);Zr.Ie.ue(h,p)}}return this.fn(i)}en(e,t,r){return this.nn(e,t,r.position)}fn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Fe();return t}ln(e,t,r){const i=[...e],o=[];for(const u of r.arrayValue.values||[])for(const h of i){const d=new Go;d.seed(h.Fe()),Zr.Ie.ue(u,d.qe(t.kind)),o.push(d)}return o}hn(e,t){return!!e.filters.find(r=>r instanceof W&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=ku(e),i=jo(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(o=>{const u=[];return T.forEach(o,h=>i.get([h.indexId,this.uid]).next(d=>{u.push(function(p,g){const _=g?new kr(g.sequenceNumber,new De(zr(g.readTime),new R(jt(g.documentKey)),g.largestBatchId)):kr.empty(),I=p.fields.map(([b,S])=>new Gi($.fromServerFormat(b),S));return new zn(p.indexId,p.collectionGroup,I,_)}(h,d))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const o=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==o?o:j(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=ku(e),o=jo(e);return this.dn(e).next(u=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>T.forEach(h,d=>o.put(Id(d.indexId,this.user,u,r)))))}updateIndexEntries(e,t){const r=new Map;return T.forEach(t,(i,o)=>{const u=r.get(i.collectionGroup);return(u?T.resolve(u):this.getFieldIndexes(e,i.collectionGroup)).next(h=>(r.set(i.collectionGroup,h),T.forEach(h,d=>this._n(e,i,d).next(p=>{const g=this.wn(o,d);return p.isEqual(g)?T.resolve():this.mn(e,o,d,p,g)}))))})}gn(e,t,r,i){return Bo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.an(r,t.key),documentKey:t.key.path.toArray()})}yn(e,t,r,i){return Bo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.an(r,t.key),t.key.path.toArray()])}_n(e,t,r){const i=Bo(e);let o=new X(ar);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,t)])},(u,h)=>{o=o.add(new Hr(r.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>o)}wn(e,t){let r=new X(ar);const i=this.cn(t,e);if(null==i)return r;const o=mo(t);if(null!=o){const u=e.data.field(o.fieldPath);if($i(u))for(const h of u.arrayValue.values||[])r=r.add(new Hr(t.indexId,e.key,this.rn(h),i))}else r=r.add(new Hr(t.indexId,e.key,Su,i));return r}mn(e,t,r,i,o){k("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(h,d,p,g,_){const I=h.getIterator(),b=d.getIterator();let S=Gt(I),O=Gt(b);for(;S||O;){let B=!1,ue=!1;if(S&&O){const ye=p(S,O);ye<0?ue=!0:ye>0&&(B=!0)}else null!=S?ue=!0:B=!0;B?(g(O),O=Gt(b)):ue?(_(S),S=Gt(I)):(S=Gt(I),O=Gt(b))}}(i,o,ar,h=>{u.push(this.gn(e,t,r,h))},h=>{u.push(this.yn(e,t,r,h))}),T.waitFor(u)}dn(e){let t=1;return jo(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,o)=>{o.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((u,h)=>ar(u,h)).filter((u,h,d)=>!h||0!==ar(u,d[h-1]));const i=[];i.push(e);for(const u of r){const h=ar(u,e),d=ar(u,t);if(0===h)i[0]=e.Ue();else if(h>0&&d<0)i.push(u),i.push(u.Ue());else if(d>0)break}i.push(t);const o=[];for(let u=0;u<i.length;u+=2){if(this.pn(i[u],i[u+1]))return[];o.push(IDBKeyRange.bound([i[u].indexId,this.uid,i[u].arrayValue,i[u].directionalValue,Su,[]],[i[u+1].indexId,this.uid,i[u+1].arrayValue,i[u+1].directionalValue,Su,[]]))}return o}pn(e,t){return ar(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Nd)}getMinOffset(e,t){return T.mapArray(this.Ze(t),r=>this.tn(e,r).next(i=>i||M())).next(Nd)}}function kd(n){return Oe(n,"collectionParents")}function Bo(n){return Oe(n,"indexEntries")}function ku(n){return Oe(n,"indexConfiguration")}function jo(n){return Oe(n,"indexState")}function Nd(n){F(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Wn(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new De(e.readTime,e.documentKey,t)}const Dd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Je{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Je(e,Je.DEFAULT_COLLECTION_PERCENTILE,Je.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Cd(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),o=[],u=IDBKeyRange.only(t.batchId);let h=0;const d=r.Z({range:u},(g,_,I)=>(h++,I.delete()));o.push(d.next(()=>{F(1===h)}));const p=[];for(const g of t.mutations){const _=dd(e,g.key.path,t.batchId);o.push(i.delete(_)),p.push(g.key)}return T.waitFor(o).next(()=>p)}function Nu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw M();e=n.noDocument}return JSON.stringify(e).length}Je.DEFAULT_COLLECTION_PERCENTILE=10,Je.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Je.DEFAULT=new Je(41943040,Je.DEFAULT_COLLECTION_PERCENTILE,Je.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Je.DISABLED=new Je(-1,0,0);class Du{constructor(e,t,r,i){this.userId=e,this.yt=t,this.indexManager=r,this.referenceDelegate=i,this.In={}}static re(e,t,r,i){F(""!==e.uid);const o=e.isAuthenticated()?e.uid:"";return new Du(o,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ur(e).Z({index:"userMutationsIndex",range:r},(i,o,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const o=ds(e),u=ur(e);return u.add({}).next(h=>{F("number"==typeof h);const d=new tl(h,t,r,i),p=function(I,b,S){const O=S.baseMutations.map(ue=>sr(I.ie,ue)),B=S.mutations.map(ue=>sr(I.ie,ue));return{userId:b,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:O,mutations:B}}(this.yt,this.userId,d),g=[];let _=new X((I,b)=>j(I.canonicalString(),b.canonicalString()));for(const I of i){const b=dd(this.userId,I.key.path,h);_=_.add(I.key.path.popLast()),g.push(u.put(p)),g.push(o.put(b,dp))}return _.forEach(I=>{g.push(this.indexManager.addToCollectionParentIndex(e,I))}),e.addOnCommittedListener(()=>{this.In[h]=d.keys()}),T.waitFor(g).next(()=>d)})}lookupMutationBatch(e,t){return ur(e).get(t).next(r=>r?(F(r.userId===this.userId),Wr(this.yt,r)):null)}Tn(e,t){return this.In[t]?T.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.In[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let o=null;return ur(e).Z({index:"userMutationsIndex",range:i},(u,h,d)=>{h.userId===this.userId&&(F(h.batchId>=r),o=Wr(this.yt,h)),d.done()}).next(()=>o)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ur(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(i,o,u)=>{r=o.batchId,u.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ur(e).W("userMutationsIndex",t).next(r=>r.map(i=>Wr(this.yt,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Eu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),o=[];return ds(e).Z({range:i},(u,h,d)=>{const[p,g,_]=u,I=jt(g);if(p===this.userId&&t.path.isEqual(I))return ur(e).get(_).next(b=>{if(!b)throw M();F(b.userId===this.userId),o.push(Wr(this.yt,b))});d.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new X(j);const i=[];return t.forEach(o=>{const u=Eu(this.userId,o.path),h=IDBKeyRange.lowerBound(u),d=ds(e).Z({range:h},(p,g,_)=>{const[I,b,S]=p,O=jt(b);I===this.userId&&o.path.isEqual(O)?r=r.add(S):_.done()});i.push(d)}),T.waitFor(i).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,o=Eu(this.userId,r),u=IDBKeyRange.lowerBound(o);let h=new X(j);return ds(e).Z({range:u},(d,p,g)=>{const[_,I,b]=d,S=jt(I);_===this.userId&&r.isPrefixOf(S)?S.length===i&&(h=h.add(b)):g.done()}).next(()=>this.En(e,h))}En(e,t){const r=[],i=[];return t.forEach(o=>{i.push(ur(e).get(o).next(u=>{if(null===u)throw M();F(u.userId===this.userId),r.push(Wr(this.yt,u))}))}),T.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Cd(e.se,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),T.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return T.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return ds(e).Z({range:r},(o,u,h)=>{if(o[0]===this.userId){const d=jt(o[1]);i.push(d)}else h.done()}).next(()=>{F(0===i.length)})})}containsKey(e,t){return Rd(e,this.userId,t)}Rn(e){return Pd(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Rd(n,e,t){const r=Eu(e,t.path),i=r[1],o=IDBKeyRange.lowerBound(r);let u=!1;return ds(n).Z({range:o,X:!0},(h,d,p)=>{const[g,_,I]=h;g===e&&_===i&&(u=!0),p.done()}).next(()=>u)}function ur(n){return Oe(n,"mutations")}function ds(n){return Oe(n,"documentMutations")}function Pd(n){return Oe(n,"mutationQueues")}class Qr{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Qr(0)}static vn(){return new Qr(-1)}}class Vp{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const r=new Qr(t.highestTargetId);return t.highestTargetId=r.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>q.fromTimestamp(new oe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Vn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Sn(e,i)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(t,r),this.Sn(e,r))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>fs(e).delete(t.targetId)).next(()=>this.Vn(e)).next(r=>(F(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,t,r){let i=0;const o=[];return fs(e).Z((u,h)=>{const d=Vo(h);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,o.push(this.removeTargetData(e,d)))}).next(()=>T.waitFor(o)).next(()=>i)}forEachTarget(e,t){return fs(e).Z((r,i)=>{const o=Vo(i);t(o)})}Vn(e){return Od(e).get("targetGlobalKey").next(t=>(F(null!==t),t))}Sn(e,t){return Od(e).put("targetGlobalKey",t)}Dn(e,t){return fs(e).put(_d(this.yt,t))}Cn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=dn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let o=null;return fs(e).Z({range:i,index:"queryTargetsIndex"},(u,h,d)=>{const p=Vo(h);Vr(t,p.target)&&(o=p,d.done())}).next(()=>o)}addMatchingKeys(e,t,r){const i=[],o=cr(e);return t.forEach(u=>{const h=Ze(u.path);i.push(o.put({targetId:r,path:h})),i.push(this.referenceDelegate.addReference(e,r,u))}),T.waitFor(i)}removeMatchingKeys(e,t,r){const i=cr(e);return T.forEach(t,o=>{const u=Ze(o.path);return T.waitFor([i.delete([r,u]),this.referenceDelegate.removeReference(e,r,o)])})}removeMatchingKeysForTargetId(e,t){const r=cr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=cr(e);let o=K();return i.Z({range:r,X:!0},(u,h,d)=>{const p=jt(u[1]),g=new R(p);o=o.add(g)}).next(()=>o)}containsKey(e,t){const r=Ze(t.path),i=IDBKeyRange.bound([r],[Sc(r)],!1,!0);let o=0;return cr(e).Z({index:"documentTargetsIndex",X:!0,range:i},([u,h],d,p)=>{0!==u&&(o++,p.done())}).next(()=>o>0)}ne(e,t){return fs(e).get(t).next(r=>r?Vo(r):null)}}function fs(n){return Oe(n,"targets")}function Od(n){return Oe(n,"targetGlobal")}function cr(n){return Oe(n,"targetDocuments")}function Md([n,e],[t,r]){const i=j(n,t);return 0===i?j(e,r):i}class qp{constructor(e){this.xn=e,this.buffer=new X(Md),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Md(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Gp{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;k("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,y.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){on(r)?k("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Et(r)}yield t.Fn(3e5)}))}}class Bp{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return T.resolve(Ke.at);const r=new qp(t);return this.$n.forEachTarget(e,i=>r.On(i.sequenceNumber)).next(()=>this.$n.Ln(e,i=>r.On(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.$n.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector","Garbage collection skipped; disabled"),T.resolve(Dd)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Dd):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let r,i,o,u,h,d,p;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,u=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,h=Date.now(),this.removeTargets(e,r,t))).next(_=>(o=_,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(p=Date.now(),Ma()<=mt.in.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-g}ms\n\tDetermined least recently used ${i} in `+(h-u)+`ms\n\tRemoved ${o} targets in `+(d-h)+`ms\n\tRemoved ${_} documents in `+(p-d)+`ms\nTotal Duration: ${p-g}ms`),T.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:_})))}}class jp{constructor(e,t){this.db=e,this.garbageCollector=new Bp(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Un(e){let t=0;return this.Ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(r,i)=>t(i))}addReference(e,t,r){return Cu(e,r)}removeReference(e,t,r){return Cu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cu(e,t)}Gn(e,t){return function(r,i){let o=!1;return Pd(r).tt(u=>Rd(r,u,i).next(h=>(h&&(o=!0),T.resolve(!h)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let o=0;return this.Kn(e,(u,h)=>{if(h<=t){const d=this.Gn(e,u).next(p=>{if(!p)return o++,r.getEntry(e,u).next(()=>(r.removeEntry(u,q.min()),cr(e).delete([0,Ze(u.path)])))});i.push(d)}}).next(()=>T.waitFor(i)).next(()=>r.apply(e)).next(()=>o)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cu(e,t)}Kn(e,t){const r=cr(e);let i,o=Ke.at;return r.Z({index:"documentTargetsIndex"},([u,h],{path:d,sequenceNumber:p})=>{0===u?(o!==Ke.at&&t(new R(jt(i)),o),o=p,i=d):o=Ke.at}).next(()=>{o!==Ke.at&&t(new R(jt(i)),o)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cu(n,e){return cr(n).put((r=n.currentSequenceNumber,{targetId:0,path:Ze(e.path),sequenceNumber:r}));var r}class Ld{constructor(){this.changes=new Bt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ne.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?T.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Kp{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Yr(e).put(r)}removeEntry(e,t,r){return Yr(e).delete(function(i,o){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],bu(o),u[u.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Qn(e,r)))}getEntry(e,t){let r=ne.newInvalidDocument(t);return Yr(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Ko(t))},(i,o)=>{r=this.jn(t,o)}).next(()=>r)}Wn(e,t){let r={size:0,document:ne.newInvalidDocument(t)};return Yr(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Ko(t))},(i,o)=>{r={document:this.jn(t,o),size:Nu(o)}}).next(()=>r)}getEntries(e,t){let r=$e();return this.zn(e,t,(i,o)=>{const u=this.jn(i,o);r=r.insert(i,u)}).next(()=>r)}Hn(e,t){let r=$e(),i=new de(R.comparator);return this.zn(e,t,(o,u)=>{const h=this.jn(o,u);r=r.insert(o,h),i=i.insert(o,Nu(u))}).next(()=>({documents:r,Jn:i}))}zn(e,t,r){if(t.isEmpty())return T.resolve();let i=new X(qd);t.forEach(d=>i=i.add(d));const o=IDBKeyRange.bound(Ko(i.first()),Ko(i.last())),u=i.getIterator();let h=u.getNext();return Yr(e).Z({index:"documentKeyIndex",range:o},(d,p,g)=>{const _=R.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;h&&qd(h,_)<0;)r(h,null),h=u.getNext();h&&h.isEqual(_)&&(r(h,p),h=u.hasNext()?u.getNext():null),h?g.j(Ko(h)):g.done()}).next(()=>{for(;h;)r(h,null),h=u.hasNext()?u.getNext():null})}getDocumentsMatchingQuery(e,t,r,i){const o=t.path,u=[o.popLast().toArray(),o.lastSegment(),bu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],h=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Yr(e).W(IDBKeyRange.bound(u,h,!0)).next(d=>{let p=$e();for(const g of d){const _=this.jn(R.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(mn(t,_)||i.has(_.key))&&(p=p.insert(_.key,_))}return p})}getAllFromCollectionGroup(e,t,r,i){let o=$e();const u=Vd(t,r),h=Vd(t,De.max());return Yr(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,h,!0)},(d,p,g)=>{const _=this.jn(R.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);o=o.insert(_.key,_),o.size===i&&g.done()}).next(()=>o)}newChangeBuffer(e){return new $p(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Ud(e).get("remoteDocumentGlobalKey").next(t=>(F(!!t),t))}Qn(e,t){return Ud(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const r=function Np(n,e){let t;if(e.document)t=function Mo(n,e,t){const r=We(n,e.name),i=U(e.updateTime),o=e.createTime?U(e.createTime):q.min(),u=new we({mapValue:{fields:e.fields}}),h=ne.newFoundDocument(r,i,o,u);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=R.fromSegments(e.noDocument.path),i=zr(e.noDocument.readTime);t=ne.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return M();{const r=R.fromSegments(e.unknownDocument.path),i=zr(e.unknownDocument.version);t=ne.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new oe(r[0],r[1]);return q.fromTimestamp(i)}(e.readTime)),t}(this.yt,t);if(!r.isNoDocument()||!r.version.isEqual(q.min()))return r}return ne.newInvalidDocument(e)}}function Fd(n){return new Kp(n)}class $p extends Ld{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Bt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new X((o,u)=>j(o.canonicalString(),u.canonicalString()));return this.changes.forEach((o,u)=>{const h=this.Xn.get(o);if(t.push(this.Yn.removeEntry(e,o,h.readTime)),u.isValidDocument()){const d=yd(this.Yn.yt,u);i=i.add(o.path.popLast()),r+=Nu(d)-h.size,t.push(this.Yn.addEntry(e,o,d))}else if(r-=h.size,this.trackRemovals){const d=yd(this.Yn.yt,u.convertToNoDocument(q.min()));t.push(this.Yn.addEntry(e,o,d))}}),i.forEach(o=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,o))}),t.push(this.Yn.updateMetadata(e,r)),T.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(r=>(this.Xn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:r,Jn:i})=>(i.forEach((o,u)=>{this.Xn.set(o,{size:u,readTime:r.get(o).readTime})}),r))}}function Ud(n){return Oe(n,"remoteDocumentGlobal")}function Yr(n){return Oe(n,"remoteDocumentsV14")}function Ko(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Vd(n,e){const t=e.documentKey.path.toArray();return[n,bu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function qd(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let o=0;o<t.length-2&&o<r.length-2;++o)if(i=j(t[o],r[o]),i)return i;return i=j(t.length,r.length),i||(i=j(t[t.length-2],r[r.length-2]),i||j(t[t.length-1],r[r.length-1]))}class zp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Gd{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Br(r.mutation,i,qe.empty(),oe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,K()).next(()=>r))}getLocalViewOfDocuments(e,t,r=K()){const i=St();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let u=vn();return o.forEach((h,d)=>{u=u.insert(h,d.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const r=St();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,K()))}populateOverlays(e,t,r){const i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((u,h)=>{t.set(u,h)})})}computeViews(e,t,r,i){let o=$e();const u=jr(),h=jr();return t.forEach((d,p)=>{const g=r.get(p.key);i.has(p.key)&&(void 0===g||g.mutation instanceof At)?o=o.insert(p.key,p):void 0!==g?(u.set(p.key,g.mutation.getFieldMask()),Br(g.mutation,p,g.mutation.getFieldMask(),oe.now())):u.set(p.key,qe.empty())}),this.recalculateAndSaveOverlays(e,o).next(d=>(d.forEach((p,g)=>u.set(p,g)),t.forEach((p,g)=>{var _;return h.set(p,new zp(g,null!==(_=u.get(p))&&void 0!==_?_:null))}),h))}recalculateAndSaveOverlays(e,t){const r=jr();let i=new de((u,h)=>u-h),o=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const h of u)h.keys().forEach(d=>{const p=t.get(d);if(null===p)return;let g=r.get(d)||qe.empty();g=h.applyToLocalView(p,g),r.set(d,g);const _=(i.get(h.batchId)||K()).add(d);i=i.insert(h.batchId,_)})}).next(()=>{const u=[],h=i.getReverseIterator();for(;h.hasNext();){const d=h.getNext(),p=d.key,g=d.value,_=_u();g.forEach(I=>{if(!o.has(I)){const b=cu(t.get(I),r.get(I));null!==b&&_.set(I,b),o=o.add(I)}}),u.push(this.documentOverlayCache.saveOverlays(e,p,_))}return T.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return R.isDocumentKey((i=t).path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Ao(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var i}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{const u=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):T.resolve(St());let h=-1,d=o;return u.next(p=>T.forEach(p,(g,_)=>(h<_.largestBatchId&&(h=_.largestBatchId),o.get(g)?T.resolve():this.remoteDocumentCache.getEntry(e,g).next(I=>{d=d.insert(g,I)}))).next(()=>this.populateOverlays(e,p,o)).next(()=>this.computeViews(e,d,p,K())).next(g=>({batchId:h,changes:yu(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new R(t)).next(r=>{let i=vn();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let o=vn();return this.indexManager.getCollectionParents(e,i).next(u=>T.forEach(u,h=>{const d=(p=t,g=h.child(i),new ot(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));var p,g;return this.getDocumentsMatchingCollectionQuery(e,d,r).next(p=>{p.forEach((g,_)=>{o=o.insert(g,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i))).next(o=>{i.forEach((h,d)=>{const p=d.getKey();null===o.get(p)&&(o=o.insert(p,ne.newInvalidDocument(p)))});let u=vn();return o.forEach((h,d)=>{const p=i.get(h);void 0!==p&&Br(p.mutation,d,qe.empty(),oe.now()),mn(t,d)&&(u=u.insert(h,d))}),u})}}class Wp{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return T.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var r;return this.Zn.set(t.id,{id:(r=t).id,version:r.version,createTime:U(r.createTime)}),T.resolve()}getNamedQuery(e,t){return T.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(r=t).name,query:il(r.bundledQuery),readTime:U(r.readTime)}),T.resolve();var r}}class Zp{constructor(){this.overlays=new de(R.comparator),this.es=new Map}getOverlay(e,t){return T.resolve(this.overlays.get(t))}getOverlays(e,t){const r=St();return T.forEach(t,i=>this.getOverlay(e,i).next(o=>{null!==o&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.oe(e,t,o)}),T.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.es.get(r);return void 0!==i&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.es.delete(r)),T.resolve()}getOverlaysForCollection(e,t,r){const i=St(),o=t.length+1,u=new R(t.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const d=h.getNext().value,p=d.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===o&&d.largestBatchId>r&&i.set(d.getKey(),d)}return T.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new de((p,g)=>p-g);const u=this.overlays.getIterator();for(;u.hasNext();){const p=u.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>r){let g=o.get(p.largestBatchId);null===g&&(g=St(),o=o.insert(p.largestBatchId,g)),g.set(p.getKey(),p)}}const h=St(),d=o.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((p,g)=>h.set(p,g)),!(h.size()>=i)););return T.resolve(h)}oe(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const u=this.es.get(i.largestBatchId).delete(r.key);this.es.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new rl(t,r));let o=this.es.get(t);void 0===o&&(o=K(),this.es.set(t,o)),this.es.set(t,o.add(r.key))}}class hl{constructor(){this.ns=new X(Me.ss),this.rs=new X(Me.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const r=new Me(e,t);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.cs(new Me(e,t))}hs(e,t){e.forEach(r=>this.removeReference(r,t))}ls(e){const t=new R(new Z([])),r=new Me(t,e),i=new Me(t,e+1),o=[];return this.rs.forEachInRange([r,i],u=>{this.cs(u),o.push(u.key)}),o}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new R(new Z([])),r=new Me(t,e),i=new Me(t,e+1);let o=K();return this.rs.forEachInRange([r,i],u=>{o=o.add(u.key)}),o}containsKey(e){const t=new Me(e,0),r=this.ns.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Me{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return R.comparator(e.key,t.key)||j(e._s,t._s)}static os(e,t){return j(e._s,t._s)||R.comparator(e.key,t.key)}}class Hp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new X(Me.ss)}checkEmpty(e){return T.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const o=this.ws;this.ws++;const u=new tl(o,t,r,i);this.mutationQueue.push(u);for(const h of i)this.gs=this.gs.add(new Me(h.key,o)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return T.resolve(u)}lookupMutationBatch(e,t){return T.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.ps(t+1),o=i<0?0:i;return T.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return T.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return T.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Me(t,0),i=new Me(t,Number.POSITIVE_INFINITY),o=[];return this.gs.forEachInRange([r,i],u=>{const h=this.ys(u._s);o.push(h)}),T.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new X(j);return t.forEach(i=>{const o=new Me(i,0),u=new Me(i,Number.POSITIVE_INFINITY);this.gs.forEachInRange([o,u],h=>{r=r.add(h._s)})}),T.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let o=r;R.isDocumentKey(o)||(o=o.child(""));const u=new Me(new R(o),0);let h=new X(j);return this.gs.forEachWhile(d=>{const p=d.key.path;return!!r.isPrefixOf(p)&&(p.length===i&&(h=h.add(d._s)),!0)},u),T.resolve(this.Is(h))}Is(e){const t=[];return e.forEach(r=>{const i=this.ys(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){F(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let r=this.gs;return T.forEach(t.mutations,i=>{const o=new Me(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,t){const r=new Me(t,0),i=this.gs.firstAfterOrEqual(r);return T.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return T.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Qp{constructor(e){this.Es=e,this.docs=new de(R.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),o=i?i.size:0,u=this.Es(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return T.resolve(r?r.document.mutableCopy():ne.newInvalidDocument(t))}getEntries(e,t){let r=$e();return t.forEach(i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():ne.newInvalidDocument(i))}),T.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=$e();const u=t.path,h=new R(u.child("")),d=this.docs.getIteratorFrom(h);for(;d.hasNext();){const{key:p,value:{document:g}}=d.getNext();if(!u.isPrefixOf(p.path))break;p.path.length>u.length+1||Wn(go(g),r)<=0||(i.has(g.key)||mn(t,g))&&(o=o.insert(g.key,g.mutableCopy()))}return T.resolve(o)}getAllFromCollectionGroup(e,t,r,i){M()}As(e,t){return T.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Yp(this)}getSize(e){return T.resolve(this.size)}}class Yp extends Ld{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Yn.addEntry(e,i)):this.Yn.removeEntry(r)}),T.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Xp{constructor(e){this.persistence=e,this.Rs=new Bt(t=>dn(t),Vr),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.bs=0,this.Ps=new hl,this.targetCount=0,this.vs=Qr.Pn()}forEachTarget(e,t){return this.Rs.forEach((r,i)=>t(i)),T.resolve()}getLastRemoteSnapshotVersion(e){return T.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return T.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),T.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.bs&&(this.bs=t),T.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Qr(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,T.resolve()}updateTargetData(e,t){return this.Dn(t),T.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,T.resolve()}removeTargets(e,t,r){let i=0;const o=[];return this.Rs.forEach((u,h)=>{h.sequenceNumber<=t&&null===r.get(h.targetId)&&(this.Rs.delete(u),o.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)}),T.waitFor(o).next(()=>i)}getTargetCount(e){return T.resolve(this.targetCount)}getTargetData(e,t){const r=this.Rs.get(t)||null;return T.resolve(r)}addMatchingKeys(e,t,r){return this.Ps.us(t,r),T.resolve()}removeMatchingKeys(e,t,r){this.Ps.hs(t,r);const i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(u=>{o.push(i.markPotentiallyOrphaned(e,u))}),T.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),T.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ps.ds(t);return T.resolve(r)}containsKey(e,t){return T.resolve(this.Ps.containsKey(t))}}class Bd{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new Ke(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Xp(this),this.indexManager=new Fp,this.remoteDocumentCache=new Qp(r=>this.referenceDelegate.xs(r)),this.yt=new gd(t),this.Ns=new Wp(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Zp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Vs[e.toKey()];return r||(r=new Hp(t,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,r){k("MemoryPersistence","Starting transaction:",e);const i=new Jp(this.Ss.next());return this.referenceDelegate.ks(),r(i).next(o=>this.referenceDelegate.Os(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ms(e,t){return T.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,t)))}}class Jp extends Bi{constructor(e){super(),this.currentSequenceNumber=e}}class Ru{constructor(e){this.persistence=e,this.Fs=new hl,this.$s=null}static Bs(e){return new Ru(e)}get Ls(){if(this.$s)return this.$s;throw M()}addReference(e,t,r){return this.Fs.addReference(r,t),this.Ls.delete(r.toString()),T.resolve()}removeReference(e,t,r){return this.Fs.removeReference(r,t),this.Ls.add(r.toString()),T.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),T.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(i=>this.Ls.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.Ls.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return T.forEach(this.Ls,r=>{const i=R.fromPath(r);return this.qs(e,i).next(o=>{o||t.removeEntry(i,q.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(r=>{r?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return T.or([()=>T.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class em{constructor(e){this.yt=e}$(e,t,r,i){const o=new Zn("createOrUpgrade",t);var h;r<1&&i>=1&&(e.createObjectStore("owner"),(h=e).createObjectStore("mutationQueues",{keyPath:"userId"}),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hd,{unique:!0}),h.createObjectStore("documentMutations"),jd(e),function(h){h.createObjectStore("remoteDocuments")}(e));let u=T.resolve();return r<3&&i>=3&&(0!==r&&(function(h){h.deleteObjectStore("targetDocuments"),h.deleteObjectStore("targets"),h.deleteObjectStore("targetGlobal")}(e),jd(e)),u=u.next(()=>function(h){const d=h.store("targetGlobal"),p={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:q.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",p)}(o))),r<4&&i>=4&&(0!==r&&(u=u.next(()=>function(h,d){return d.store("mutations").W().next(p=>{h.deleteObjectStore("mutations"),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hd,{unique:!0});const g=d.store("mutations"),_=p.map(I=>g.put(I));return T.waitFor(_)})}(e,o))),u=u.next(()=>{!function(h){h.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(u=u.next(()=>this.Us(o))),r<6&&i>=6&&(u=u.next(()=>(function(h){h.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(o)))),r<7&&i>=7&&(u=u.next(()=>this.Gs(o))),r<8&&i>=8&&(u=u.next(()=>this.Qs(e,o))),r<9&&i>=9&&(u=u.next(()=>{!function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(u=u.next(()=>this.js(o))),r<11&&i>=11&&(u=u.next(()=>{(function(h){h.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(h){h.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(u=u.next(()=>{!function(h){const d=h.createObjectStore("documentOverlays",{keyPath:bp});d.createIndex("collectionPathOverlayIndex",xp,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",Ap,{unique:!1})}(e)})),r<13&&i>=13&&(u=u.next(()=>function(h){const d=h.createObjectStore("remoteDocumentsV14",{keyPath:fp});d.createIndex("documentKeyIndex",pp),d.createIndex("collectionGroupIndex",mp)}(e)).next(()=>this.Ws(e,o)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(u=u.next(()=>this.zs(e,o))),r<15&&i>=15&&(u=u.next(()=>function(h){h.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),h.createObjectStore("indexState",{keyPath:Ip}).createIndex("sequenceNumberIndex",Tp,{unique:!1}),h.createObjectStore("indexEntries",{keyPath:wp}).createIndex("documentKeyIndex",Ep,{unique:!1})}(e))),u}Ks(e){let t=0;return e.store("remoteDocuments").Z((r,i)=>{t+=Nu(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Us(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>T.forEach(i,o=>{const u=IDBKeyRange.bound([o.userId,-1],[o.userId,o.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",u).next(h=>T.forEach(h,d=>{F(d.userId===o.userId);const p=Wr(this.yt,d);return Cd(e,o.userId,p).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const o=[];return r.Z((u,h)=>{const d=new Z(u),p=[0,Ze(d)];o.push(t.get(p).next(g=>g?T.resolve():t.put({targetId:0,path:Ze(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>T.waitFor(o))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:vp});const r=t.store("collectionParents"),i=new ll,o=u=>{if(i.add(u)){const h=u.lastSegment(),d=u.popLast();return r.put({collectionId:h,parent:Ze(d)})}};return t.store("remoteDocuments").Z({X:!0},(u,h)=>{const d=new Z(u);return o(d.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([u,h,d],p)=>{const g=jt(h);return o(g.popLast())}))}js(e){const t=e.store("targets");return t.Z((r,i)=>{const o=Vo(i),u=_d(this.yt,o);return t.put(u)})}Ws(e,t){const r=t.store("remoteDocuments"),i=[];return r.Z((o,u)=>{const h=t.store("remoteDocumentsV14"),d=(p=u,p.document?new R(Z.fromString(p.document.name).popFirst(5)):p.noDocument?R.fromSegments(p.noDocument.path):p.unknownDocument?R.fromSegments(p.unknownDocument.path):M()).path.toArray();var p;const g={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};i.push(h.put(g))}).next(()=>T.waitFor(i))}zs(e,t){const r=t.store("mutations"),i=Fd(this.yt),o=new Bd(Ru.Bs,this.yt.ie);return r.W().next(u=>{const h=new Map;return u.forEach(d=>{var p;let g=null!==(p=h.get(d.userId))&&void 0!==p?p:K();Wr(this.yt,d).keys().forEach(_=>g=g.add(_)),h.set(d.userId,g)}),T.forEach(h,(d,p)=>{const g=new be(p),_=xu.re(this.yt,g),I=o.getIndexManager(g),b=Du.re(g,this.yt,I,o.referenceDelegate);return new Gd(i,b,_,I).recalculateAndSaveOverlaysForDocumentKeys(new el(t,Ke.at),d).next()})})}}function jd(n){n.createObjectStore("targetDocuments",{keyPath:yp}).createIndex("documentTargetsIndex",_p,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",gp,{unique:!0}),n.createObjectStore("targetGlobal")}const dl="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class fl{constructor(e,t,r,i,o,u,h,d,p,g,_=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Hs=o,this.window=u,this.document=h,this.Js=p,this.Ys=g,this.Xs=_,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=I=>Promise.resolve(),!fl.C())throw new A(w.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new jp(this,i),this.ii=t+"main",this.yt=new gd(d),this.ri=new Ye(this.ii,this.Xs,new em(this.yt)),this.Cs=new Vp(this.referenceDelegate,this.yt),this.remoteDocumentCache=Fd(this.yt),this.Ns=new Dp,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===g&&ge("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new A(w.FAILED_PRECONDITION,dl);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new Ke(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var r=(0,y.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,y.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,y.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Pu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(on(e))return k("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return k("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return $o(e).get("owner").next(t=>T.resolve(this.mi(t)))}gi(e){return Pu(e).delete(this.clientId)}yi(){var e=this;return(0,y.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=Oe(r,"clientMetadata");return i.W().next(o=>{const u=e.Ii(o,18e5),h=o.filter(d=>-1===u.indexOf(d));return T.forEach(h,d=>i.delete(d.clientId)).next(()=>h)})}).catch(()=>[]);if(e.oi)for(const r of t)e.oi.removeItem(e.Ti(r.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?T.resolve(!0):$o(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new A(w.FAILED_PRECONDITION,dl);return!1}}return!(!this.networkEnabled||!this.inForeground)||Pu(e).W().next(r=>void 0===this.Ii(r,5e3).find(i=>{if(this.clientId!==i.clientId){const u=!this.inForeground&&i.inForeground,h=this.networkEnabled===i.networkEnabled;if(!this.networkEnabled&&i.networkEnabled||u&&h)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&k("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,y.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new el(t,Ke.at);return e._i(r).next(()=>e.gi(r))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(r=>this.pi(r.updateTimeMs,t)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>Pu(e).W().next(t=>this.Ii(t,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Du.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Up(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return xu.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,r){k("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",o=15===(u=this.Xs)?kp:14===u?md:13===u?pd:12===u?Sp:11===u?fd:void M();var u;let h;return this.ri.runTransaction(e,i,o,d=>(h=new el(d,this.Ss?this.Ss.next():Ke.at),"readwrite-primary"===t?this.fi(h).next(p=>!!p||this.di(h)).next(p=>{if(!p)throw ge(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new A(w.FAILED_PRECONDITION,Ga);return r(h)}).next(p=>this.wi(h).next(()=>p)):this.Vi(h).next(()=>r(h)))).then(d=>(h.raiseOnCommittedEvent(),d))}Vi(e){return $o(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new A(w.FAILED_PRECONDITION,dl)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return $o(e).put("owner",t)}static C(){return Ye.C()}_i(e){const t=$o(e);return t.get("owner").next(r=>this.mi(r)?(k("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):T.resolve())}pi(e,t){const r=Date.now();return!(e<r-t||e>r&&(ge(`Detected an update time that is in the future: ${e} > ${r}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,pe.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const r=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return k("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ge("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){ge("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function $o(n){return Oe(n,"owner")}function Pu(n){return Oe(n,"clientMetadata")}class ml{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Si=r,this.Di=i}static Ci(e,t){let r=K(),i=K();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new ml(e,t.fromCache,r,i)}}class Kd{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.ki(e,t).next(o=>o||this.Oi(e,t,i,r)).next(o=>o||this.Mi(e,t))}ki(e,t){if(bo(t))return T.resolve(null);let r=Ge(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=es(t,null,"F"),r=Ge(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const u=K(...o);return this.Ni.getDocuments(e,u).next(h=>this.indexManager.getMinOffset(e,r).next(d=>{const p=this.Fi(t,h);return this.$i(t,p,u,d.readTime)?this.ki(e,es(t,null,"F")):this.Bi(e,p,t,d)}))})))}Oi(e,t,r,i){return bo(t)||i.isEqual(q.min())?this.Mi(e,t):this.Ni.getDocuments(e,r).next(o=>{const u=this.Fi(t,o);return this.$i(t,u,r,i)?this.Mi(e,t):(Ma()<=mt.in.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ko(t)),this.Bi(e,u,t,function Nr(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=q.fromTimestamp(1e9===r?new oe(t+1,0):new oe(t,r));return new De(i,R.empty(),e)}(i,-1)))})}Fi(e,t){let r=new X(ru(e));return t.forEach((i,o)=>{mn(e,o)&&(r=r.add(o))}),r}$i(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const o="F"===e.limitType?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Mi(e,t){return Ma()<=mt.in.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",ko(t)),this.Ni.getDocumentsMatchingQuery(e,t,De.min())}Bi(e,t,r,i){return this.Ni.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(u=>{o=o.insert(u.key,u)}),o))}}class tm{constructor(e,t,r,i){this.persistence=e,this.Li=t,this.yt=i,this.qi=new de(j),this.Ui=new Bt(o=>dn(o),Vr),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Gd(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function $d(n,e,t,r){return new tm(n,e,t,r)}function zd(n,e){return gl.apply(this,arguments)}function gl(){return gl=(0,y.Z)(function*(n,e){const t=C(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Qi(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{const u=[],h=[];let d=K();for(const p of i){u.push(p.batchId);for(const g of p.mutations)d=d.add(g.key)}for(const p of o){h.push(p.batchId);for(const g of p.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(r,d).next(p=>({ji:p,removedBatchIds:u,addedBatchIds:h}))})})}),gl.apply(this,arguments)}function nm(n,e){const t=C(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),o=t.Gi.newChangeBuffer({trackRemovals:!0});return function(u,h,d,p){const g=d.batch,_=g.keys();let I=T.resolve();return _.forEach(b=>{I=I.next(()=>p.getEntry(h,b)).next(S=>{const O=d.docVersions.get(b);F(null!==O),S.version.compareTo(O)<0&&(g.applyToRemoteDocument(S,d),S.isValidDocument()&&(S.setReadTime(d.commitVersion),p.addEntry(S)))})}),I.next(()=>u.mutationQueue.removeMutationBatch(h,g))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=K();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Wd(n){const e=C(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function rm(n,e){const t=C(n),r=e.snapshotVersion;let i=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const u=t.Gi.newChangeBuffer({trackRemovals:!0});i=t.qi;const h=[];e.targetChanges.forEach((g,_)=>{const I=i.get(_);if(!I)return;h.push(t.Cs.removeMatchingKeys(o,g.removedDocuments,_).next(()=>t.Cs.addMatchingKeys(o,g.addedDocuments,_)));let b=I.withSequenceNumber(o.currentSequenceNumber);var S,O,B;e.targetMismatches.has(_)?b=b.withResumeToken(Te.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):g.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(g.resumeToken,r)),i=i.insert(_,b),O=b,B=g,(0===(S=I).resumeToken.approximateByteSize()||O.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8||B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0)&&h.push(t.Cs.updateTargetData(o,b))});let d=$e(),p=K();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(o,g))}),h.push(function Zd(n,e,t){let r=K(),i=K();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let u=$e();return t.forEach((h,d)=>{const p=o.get(h);d.isFoundDocument()!==p.isFoundDocument()&&(i=i.add(h)),d.isNoDocument()&&d.version.isEqual(q.min())?(e.removeEntry(h,d.readTime),u=u.insert(h,d)):!p.isValidDocument()||d.version.compareTo(p.version)>0||0===d.version.compareTo(p.version)&&p.hasPendingWrites?(e.addEntry(d),u=u.insert(h,d)):k("LocalStore","Ignoring outdated watch update for ",h,". Current version:",p.version," Watch version:",d.version)}),{Wi:u,zi:i}})}(o,u,e.documentUpdates).next(g=>{d=g.Wi,p=g.zi})),!r.isEqual(q.min())){const g=t.Cs.getLastRemoteSnapshotVersion(o).next(_=>t.Cs.setTargetsMetadata(o,o.currentSequenceNumber,r));h.push(g)}return T.waitFor(h).next(()=>u.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,d,p)).next(()=>d)}).then(o=>(t.qi=i,o))}function im(n,e){const t=C(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ps(n,e){const t=C(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Cs.getTargetData(r,e).next(o=>o?(i=o,T.resolve(i)):t.Cs.allocateTargetId(r).next(u=>(i=new or(e,u,0,r.currentSequenceNumber),t.Cs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.qi.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.qi=t.qi.insert(r.targetId,r),t.Ui.set(e,r.targetId)),r})}function ms(n,e,t){return yl.apply(this,arguments)}function yl(){return yl=(0,y.Z)(function*(n,e,t){const r=C(n),i=r.qi.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,u=>r.persistence.referenceDelegate.removeTarget(u,i)))}catch(u){if(!on(u))throw u;k("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}r.qi=r.qi.remove(e),r.Ui.delete(i.target)}),yl.apply(this,arguments)}function Ou(n,e,t){const r=C(n);let i=q.min(),o=K();return r.persistence.runTransaction("Execute query","readonly",u=>function(h,d,p){const g=C(h),_=g.Ui.get(p);return void 0!==_?T.resolve(g.qi.get(_)):g.Cs.getTargetData(d,p)}(r,u,Ge(e)).next(h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(u,h.targetId).next(d=>{o=d})}).next(()=>r.Li.getDocumentsMatchingQuery(u,e,t?i:q.min(),t?o:K())).next(h=>(function Yd(n,e,t){let r=n.Ki.get(e)||q.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ki.set(e,r)}(r,function nu(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}(e),h),{documents:h,Hi:o})))}class wl{constructor(){this.activeTargetIds=Ro()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ef{constructor(){this.Lr=new wl,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,r){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new wl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class am{Ur(e){}shutdown(){}}class tf{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){k("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){k("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const um={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class cm{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class lm extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,r,i,o){const u=this.ho(e,t);k("RestConnection","Sending: ",u,r);const h={};return this.lo(h,i,o),this.fo(e,u,h,r).then(d=>(k("RestConnection","Received: ",d),d),d=>{throw Kn("RestConnection",`${e} failed with error: `,d,"url: ",u,"request:",r),d})}_o(e,t,r,i,o,u){return this.ao(e,t,r,i,o)}lo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+jn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}ho(e,t){return`${this.oo}/v1/${t}:${um[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,r,i){return new Promise((o,u)=>{const h=new Yh;h.setWithCredentials(!0),h.listenOnce(Qh.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Ra.NO_ERROR:const p=h.getResponseJson();k("Connection","XHR received:",JSON.stringify(p)),o(p);break;case Ra.TIMEOUT:k("Connection",'RPC "'+e+'" timed out'),u(new A(w.DEADLINE_EXCEEDED,"Request time out"));break;case Ra.HTTP_ERROR:const g=h.getStatus();if(k("Connection",'RPC "'+e+'" failed with status:',g,"response text:",h.getResponseText()),g>0){let _=h.getResponseJson();Array.isArray(_)&&(_=_[0]);const I=null==_?void 0:_.error;if(I&&I.status&&I.message){const b=function(S){const O=S.toLowerCase().replace(/_/g,"-");return Object.values(w).indexOf(O)>=0?O:w.UNKNOWN}(I.status);u(new A(b,I.message))}else u(new A(w.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new A(w.UNAVAILABLE,"Connection failed."));break;default:M()}}finally{k("Connection",'RPC "'+e+'" completed.')}});const d=JSON.stringify(i);h.send(t,"POST",d,r,15)})}wo(e,t,r){const i=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Hh(),u=ho(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(h.xmlHttpFactory=new Ec({})),this.lo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const d=i.join("");k("Connection","Creating WebChannel: "+d,h);const p=o.createWebChannel(d,h);let g=!1,_=!1;const I=new cm({Hr:S=>{_?k("Connection","Not sending because WebChannel is closed:",S):(g||(k("Connection","Opening WebChannel transport."),p.open(),g=!0),k("Connection","WebChannel sending:",S),p.send(S))},Jr:()=>p.close()}),b=(S,O,B)=>{S.listen(O,ue=>{try{B(ue)}catch(ye){setTimeout(()=>{throw ye},0)}})};return b(p,Bn.EventType.OPEN,()=>{_||k("Connection","WebChannel transport opened.")}),b(p,Bn.EventType.CLOSE,()=>{_||(_=!0,k("Connection","WebChannel transport closed"),I.io())}),b(p,Bn.EventType.ERROR,S=>{_||(_=!0,Kn("Connection","WebChannel transport errored:",S),I.io(new A(w.UNAVAILABLE,"The operation could not be completed")))}),b(p,Bn.EventType.MESSAGE,S=>{var O;if(!_){const B=S.data[0];F(!!B);const ue=B,ye=ue.error||(null===(O=ue[0])||void 0===O?void 0:O.error);if(ye){k("Connection","WebChannel received error:",ye);const ee=ye.status;let Le=function(J){const je=_e[J];if(void 0!==je)return gu(je)}(ee),re=ye.message;void 0===Le&&(Le=w.INTERNAL,re="Unknown error status: "+ee+" with message "+ye.message),_=!0,I.io(new A(Le,re)),p.close()}else k("Connection","WebChannel received:",B),I.ro(B)}}),b(u,Pa.STAT_EVENT,S=>{S.stat===qi.PROXY?k("Connection","Detected buffering proxy"):S.stat===qi.NOPROXY&&k("Connection","Detected no buffering proxy")}),setTimeout(()=>{I.so()},0),I}}function Fu(){return"undefined"!=typeof document?document:null}function Wo(n){return new v(n,!0)}class bl{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Hs=e,this.timerId=t,this.mo=r,this.yo=i,this.po=o,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),i=Math.max(0,t-r);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,i,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class rf{constructor(e,t,r,i,o,u,h,d){this.Hs=e,this.vo=r,this.Vo=i,this.connection=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=d,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new bl(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,y.Z)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,y.Z)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var r=this;return(0,y.Z)(function*(){r.Lo(),r.qo(),r.xo.cancel(),r.So++,4!==e?r.xo.reset():t&&t.code===w.RESOURCE_EXHAUSTED?(ge(t.toString()),ge("Using maximum backoff delay to prevent overloading the backend."),r.xo.Ao()):t&&t.code===w.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Uo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.So===t&&this.Go(r,i)},r=>{e(()=>{const i=new A(w.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Qo(i)})})}Go(e,t){const r=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{r(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(i=>{r(()=>this.Qo(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,y.Z)(function*(){e.state=0,e.start()}))}Qo(e){return k("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(k("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hm extends rf{constructor(e,t,r,i,o,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,u),this.yt=o}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function Lo(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(d=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===d?1:"REMOVE"===d?2:"CURRENT"===d?3:"RESET"===d?4:M(),i=e.targetChange.targetIds||[],o=function(d,p){return d.wt?(F(void 0===p||"string"==typeof p),Te.fromBase64String(p||"")):(F(void 0===p||p instanceof Uint8Array),Te.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&function(d){const p=void 0===d.code?w.UNKNOWN:gu(d.code);return new A(p,d.message||"")}(u);t=new vu(r,i,o,h||null)}else if("documentChange"in e){const r=e.documentChange,i=We(n,r.document.name),o=U(r.document.updateTime),u=r.document.createTime?U(r.document.createTime):q.min(),h=new we({mapValue:{fields:r.document.fields}}),d=ne.newFoundDocument(i,o,u,h);t=new Kr(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=We(n,r.document),o=r.readTime?U(r.readTime):q.min(),u=ne.newNoDocument(i,o);t=new Kr([],r.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const r=e.documentRemove,i=We(n,r.document);t=new Kr([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return M();{const r=e.filter,o=new Yc(r.count||0);t=new Po(r.targetId,o)}}var d;return t}(this.yt,e),r=function(i){if(!("targetChange"in i))return q.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?q.min():o.readTime?U(o.readTime):q.min()}(e);return this.listener.Wo(t,r)}zo(e){const t={};t.database=ir(this.yt),t.addTarget=function(i,o){let u;const h=o.target;return u=Xn(h)?{documents:wu(i,h)}:{query:Jc(i,h)},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0?u.resumeToken=P(i,o.resumeToken):o.snapshotVersion.compareTo(q.min())>0&&(u.readTime=E(i,o.snapshotVersion.toTimestamp())),u}(this.yt,e);const r=function op(n,e){const t=function(r,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return M()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Bo(t)}Ho(e){const t={};t.database=ir(this.yt),t.removeTarget=e,this.Bo(t)}}class dm extends rf{constructor(e,t,r,i,o,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,u),this.yt=o,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(F(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function Uo(n,e){return n&&n.length>0?(F(void 0!==e),n.map(t=>function(r,i){let o=U(r.updateTime?r.updateTime:i);return o.isEqual(q.min())&&(o=U(i)),new Hc(o,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=U(e.commitTime);return this.listener.Zo(r,t)}return F(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=ir(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>sr(this.yt,r))};this.Bo(t)}}class fm extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.yt=i,this.nu=!1}su(){if(this.nu)throw new A(w.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.ao(e,t,r,i,o)).catch(i=>{throw"FirebaseError"===i.name?(i.code===w.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new A(w.UNKNOWN,i.toString())})}_o(e,t,r,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection._o(e,t,r,o,u,i)).catch(o=>{throw"FirebaseError"===o.name?(o.code===w.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new A(w.UNKNOWN,o.toString())})}terminate(){this.nu=!0}}class mm{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(ge(t),this.ou=!1):k("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class gm{constructor(e,t,r,i,o){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=o,this.mu.Ur(h=>{r.enqueueAndForget((0,y.Z)(function*(){var d;In(u)&&(k("RemoteStore","Restarting streams for network reachability change."),yield(d=(0,y.Z)(function*(p){const g=C(p);g._u.add(4),yield gs(g),g.gu.set("Unknown"),g._u.delete(4),yield Zo(g)}),function(p){return d.apply(this,arguments)})(u))}))}),this.gu=new mm(r,i)}}function Zo(n){return Al.apply(this,arguments)}function Al(){return Al=(0,y.Z)(function*(n){if(In(n))for(const e of n.wu)yield e(!0)}),Al.apply(this,arguments)}function gs(n){return Sl.apply(this,arguments)}function Sl(){return Sl=(0,y.Z)(function*(n){for(const e of n.wu)yield e(!1)}),Sl.apply(this,arguments)}function Uu(n,e){const t=C(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Dl(t)?Nl(t):_s(t).ko()&&kl(t,e))}function Ho(n,e){const t=C(n),r=_s(t);t.du.delete(e),r.ko()&&sf(t,e),0===t.du.size&&(r.ko()?r.Fo():In(t)&&t.gu.set("Unknown"))}function kl(n,e){n.yu.Ot(e.targetId),_s(n).zo(e)}function sf(n,e){n.yu.Ot(e),_s(n).Ho(e)}function Nl(n){n.yu=new c({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),_s(n).start(),n.gu.uu()}function Dl(n){return In(n)&&!_s(n).No()&&n.du.size>0}function In(n){return 0===C(n)._u.size}function of(n){n.yu=void 0}function ym(n){return Cl.apply(this,arguments)}function Cl(){return Cl=(0,y.Z)(function*(n){n.du.forEach((e,t)=>{kl(n,e)})}),Cl.apply(this,arguments)}function _m(n,e){return Rl.apply(this,arguments)}function Rl(){return Rl=(0,y.Z)(function*(n,e){of(n),Dl(n)?(n.gu.hu(e),Nl(n)):n.gu.set("Unknown")}),Rl.apply(this,arguments)}function vm(n,e,t){return Pl.apply(this,arguments)}function Pl(){return Pl=(0,y.Z)(function*(n,e,t){if(n.gu.set("Online"),e instanceof vu&&2===e.state&&e.cause)try{yield(r=(0,y.Z)(function*(i,o){const u=o.cause;for(const h of o.targetIds)i.du.has(h)&&(yield i.remoteSyncer.rejectListen(h,u),i.du.delete(h),i.yu.removeTarget(h))}),function(i,o){return r.apply(this,arguments)})(n,e)}catch(r){k("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Vu(n,r)}else if(e instanceof Kr?n.yu.Kt(e):e instanceof Po?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(q.min()))try{const r=yield Wd(n.localStore);t.compareTo(r)>=0&&(yield function(i,o){const u=i.yu.Zt(o);return u.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=i.du.get(d);p&&i.du.set(d,p.withResumeToken(h.resumeToken,o))}}),u.targetMismatches.forEach(h=>{const d=i.du.get(h);if(!d)return;i.du.set(h,d.withResumeToken(Te.EMPTY_BYTE_STRING,d.snapshotVersion)),sf(i,h);const p=new or(d.target,h,1,d.sequenceNumber);kl(i,p)}),i.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){k("RemoteStore","Failed to raise snapshot:",r),yield Vu(n,r)}var r}),Pl.apply(this,arguments)}function Vu(n,e,t){return Ol.apply(this,arguments)}function Ol(){return Ol=(0,y.Z)(function*(n,e,t){if(!on(e))throw e;n._u.add(1),yield gs(n),n.gu.set("Offline"),t||(t=()=>Wd(n.localStore)),n.asyncQueue.enqueueRetryable((0,y.Z)(function*(){k("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield Zo(n)}))}),Ol.apply(this,arguments)}function af(n,e){return e().catch(t=>Vu(n,t,e))}function ys(n){return Ml.apply(this,arguments)}function Ml(){return Ml=(0,y.Z)(function*(n){const e=C(n),t=lr(e);let r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;Im(e);)try{const i=yield im(e.localStore,r);if(null===i){0===e.fu.length&&t.Fo();break}r=i.batchId,Tm(e,i)}catch(i){yield Vu(e,i)}uf(e)&&cf(e)}),Ml.apply(this,arguments)}function Im(n){return In(n)&&n.fu.length<10}function Tm(n,e){n.fu.push(e);const t=lr(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function uf(n){return In(n)&&!lr(n).No()&&n.fu.length>0}function cf(n){lr(n).start()}function wm(n){return Ll.apply(this,arguments)}function Ll(){return Ll=(0,y.Z)(function*(n){lr(n).eu()}),Ll.apply(this,arguments)}function Em(n){return Fl.apply(this,arguments)}function Fl(){return Fl=(0,y.Z)(function*(n){const e=lr(n);for(const t of n.fu)e.Xo(t.mutations)}),Fl.apply(this,arguments)}function bm(n,e,t){return Ul.apply(this,arguments)}function Ul(){return Ul=(0,y.Z)(function*(n,e,t){const r=n.fu.shift(),i=nl.from(r,e,t);yield af(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ys(n)}),Ul.apply(this,arguments)}function xm(n,e){return Vl.apply(this,arguments)}function Vl(){return Vl=(0,y.Z)(function*(n,e){var t;e&&lr(n).Yo&&(yield(t=(0,y.Z)(function*(r,i){if(mu(o=i.code)&&o!==w.ABORTED){const u=r.fu.shift();lr(r).Mo(),yield af(r,()=>r.remoteSyncer.rejectFailedWrite(u.batchId,i)),yield ys(r)}var o}),function(r,i){return t.apply(this,arguments)})(n,e)),uf(n)&&cf(n)}),Vl.apply(this,arguments)}function lf(n,e){return ql.apply(this,arguments)}function ql(){return ql=(0,y.Z)(function*(n,e){const t=C(n);t.asyncQueue.verifyOperationInProgress(),k("RemoteStore","RemoteStore received new credentials");const r=In(t);t._u.add(3),yield gs(t),r&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield Zo(t)}),ql.apply(this,arguments)}function Bl(){return Bl=(0,y.Z)(function*(n,e){const t=C(n);e?(t._u.delete(2),yield Zo(t)):e||(t._u.add(2),yield gs(t),t.gu.set("Unknown"))}),Bl.apply(this,arguments)}function _s(n){return n.pu||(n.pu=function(e,t,r){const i=C(e);return i.su(),new hm(t,i.connection,i.authCredentials,i.appCheckCredentials,i.yt,r)}(n.datastore,n.asyncQueue,{Yr:ym.bind(null,n),Zr:_m.bind(null,n),Wo:vm.bind(null,n)}),n.wu.push(function(){var e=(0,y.Z)(function*(t){t?(n.pu.Mo(),Dl(n)?Nl(n):n.gu.set("Unknown")):(yield n.pu.stop(),of(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function lr(n){return n.Iu||(n.Iu=function(e,t,r){const i=C(e);return i.su(),new dm(t,i.connection,i.authCredentials,i.appCheckCredentials,i.yt,r)}(n.datastore,n.asyncQueue,{Yr:wm.bind(null,n),Zr:xm.bind(null,n),tu:Em.bind(null,n),Zo:bm.bind(null,n)}),n.wu.push(function(){var e=(0,y.Z)(function*(t){t?(n.Iu.Mo(),yield ys(n)):(yield n.Iu.stop(),n.fu.length>0&&(k("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class jl{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new xe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,r,i,o){const u=Date.now()+r,h=new jl(e,t,u,i,o);return h.start(r),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(w.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vs(n,e){if(ge("AsyncQueue",`${e}: ${n}`),on(n))return new A(w.UNAVAILABLE,`${e}: ${n}`);throw n}class Is{constructor(e){this.comparator=e?(t,r)=>e(t,r)||R.comparator(t.key,r.key):(t,r)=>R.comparator(t.key,r.key),this.keyedMap=vn(),this.sortedSet=new de(this.comparator)}static emptySet(e){return new Is(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Is)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Is;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class hf{constructor(){this.Tu=new de(R.comparator)}track(e){const t=e.doc.key,r=this.Tu.get(t);r?0!==e.type&&3===r.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==r.type?this.Tu=this.Tu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Tu=this.Tu.remove(t):1===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):M():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ts{constructor(e,t,r,i,o,u,h,d,p){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=d,this.hasCachedResults=p}static fromInitialDocuments(e,t,r,i,o){const u=[];return t.forEach(h=>{u.push({type:0,doc:h})}),new Ts(e,t,Is.emptySet(t),u,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Am{constructor(){this.Au=void 0,this.listeners=[]}}class Sm{constructor(){this.queries=new Bt(e=>tu(e),qr),this.onlineState="Unknown",this.Ru=new Set}}function Kl(n,e){return $l.apply(this,arguments)}function $l(){return $l=(0,y.Z)(function*(n,e){const t=C(n),r=e.query;let i=!1,o=t.queries.get(r);if(o||(i=!0,o=new Am),i)try{o.Au=yield t.onListen(r)}catch(u){const h=vs(u,`Initialization of query '${ko(e.query)}' failed`);return void e.onError(h)}t.queries.set(r,o),o.listeners.push(e),e.bu(t.onlineState),o.Au&&e.Pu(o.Au)&&Zl(t)}),$l.apply(this,arguments)}function zl(n,e){return Wl.apply(this,arguments)}function Wl(){return Wl=(0,y.Z)(function*(n,e){const t=C(n),r=e.query;let i=!1;const o=t.queries.get(r);if(o){const u=o.listeners.indexOf(e);u>=0&&(o.listeners.splice(u,1),i=0===o.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Wl.apply(this,arguments)}function km(n,e){const t=C(n);let r=!1;for(const i of e){const u=t.queries.get(i.query);if(u){for(const h of u.listeners)h.Pu(i)&&(r=!0);u.Au=i}}r&&Zl(t)}function Nm(n,e,t){const r=C(n),i=r.queries.get(e);if(i)for(const o of i.listeners)o.onError(t);r.queries.delete(e)}function Zl(n){n.Ru.forEach(e=>{e.next()})}class Hl{constructor(e,t,r){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=r||{}}Pu(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Ts(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=Ts.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class pf{constructor(e){this.key=e}}class mf{constructor(e){this.key=e}}class gf{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=K(),this.mutatedKeys=K(),this.Gu=ru(e),this.Qu=new Is(this.Gu)}get ju(){return this.qu}Wu(e,t){const r=t?t.zu:new hf,i=t?t.Qu:this.Qu;let o=t?t.mutatedKeys:this.mutatedKeys,u=i,h=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,p="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,_)=>{const I=i.get(g),b=mn(this.query,_)?_:null,S=!!I&&this.mutatedKeys.has(I.key),O=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let B=!1;I&&b?I.data.isEqual(b.data)?S!==O&&(r.track({type:3,doc:b}),B=!0):this.Hu(I,b)||(r.track({type:2,doc:b}),B=!0,(d&&this.Gu(b,d)>0||p&&this.Gu(b,p)<0)&&(h=!0)):!I&&b?(r.track({type:0,doc:b}),B=!0):I&&!b&&(r.track({type:1,doc:I}),B=!0,(d||p)&&(h=!0)),B&&(b?(u=u.add(b),o=O?o.add(g):o.delete(g)):(u=u.delete(g),o=o.delete(g)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const g="F"===this.query.limitType?u.last():u.first();u=u.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{Qu:u,zu:r,$i:h,mutatedKeys:o}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const o=e.zu.Eu();o.sort((p,g)=>function(_,I){const b=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M()}};return b(_)-b(I)}(p.type,g.type)||this.Gu(p.doc,g.doc)),this.Ju(r);const u=t?this.Yu():[],h=0===this.Ku.size&&this.current?1:0,d=h!==this.Uu;return this.Uu=h,0!==o.length||d?{snapshot:new Ts(this.query,e.Qu,i,o,e.mutatedKeys,0===h,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),Xu:u}:{Xu:u}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new hf,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=K(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const t=[];return e.forEach(r=>{this.Ku.has(r)||t.push(new mf(r))}),this.Ku.forEach(r=>{e.has(r)||t.push(new pf(r))}),t}tc(e){this.qu=e.Hi,this.Ku=K();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Ts.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Rm{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Pm{constructor(e){this.key=e,this.nc=!1}}class Om{constructor(e,t,r,i,o,u){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.sc={},this.ic=new Bt(h=>tu(h),qr),this.rc=new Map,this.oc=new Set,this.uc=new de(R.comparator),this.cc=new Map,this.ac=new hl,this.hc={},this.lc=new Map,this.fc=Qr.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function Mm(n,e){return Ql.apply(this,arguments)}function Ql(){return Ql=(0,y.Z)(function*(n,e){const t=vh(n);let r,i;const o=t.ic.get(e);if(o)r=o.targetId,t.sharedClientState.addLocalQueryTarget(r),i=o.view.ec();else{const u=yield ps(t.localStore,Ge(e));t.isPrimaryClient&&Uu(t.remoteStore,u);const h=t.sharedClientState.addLocalQueryTarget(u.targetId);r=u.targetId,i=yield Yl(t,e,r,"current"===h,u.resumeToken)}return i}),Ql.apply(this,arguments)}function Yl(n,e,t,r,i){return Xl.apply(this,arguments)}function Xl(){return Xl=(0,y.Z)(function*(n,e,t,r,i){n._c=(_,I,b)=>{return(S=(0,y.Z)(function*(O,B,ue,ye){let ee=B.view.Wu(ue);ee.$i&&(ee=yield Ou(O.localStore,B.query,!1).then(({documents:J})=>B.view.Wu(J,ee)));const Le=ye&&ye.targetChanges.get(B.targetId),re=B.view.applyChanges(ee,O.isPrimaryClient,Le);return uh(O,B.targetId,re.Xu),re.snapshot}),function(O,B,ue,ye){return S.apply(this,arguments)})(n,_,I,b);var S};const o=yield Ou(n.localStore,e,!0),u=new gf(e,o.Hi),h=u.Wu(o.documents),d=os.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),p=u.applyChanges(h,n.isPrimaryClient,d);uh(n,t,p.Xu);const g=new Rm(e,t,u);return n.ic.set(e,g),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),p.snapshot}),Xl.apply(this,arguments)}function Lm(n,e){return Jl.apply(this,arguments)}function Jl(){return Jl=(0,y.Z)(function*(n,e){const t=C(n),r=t.ic.get(e),i=t.rc.get(r.targetId);if(i.length>1)return t.rc.set(r.targetId,i.filter(o=>!qr(o,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield ms(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Ho(t.remoteStore,r.targetId),ws(t,r.targetId)}).catch(Et))):(ws(t,r.targetId),yield ms(t.localStore,r.targetId,!0))}),Jl.apply(this,arguments)}function eh(){return eh=(0,y.Z)(function*(n,e,t){const r=Ih(n);try{const i=yield function(o,u){const h=C(o),d=oe.now(),p=u.reduce((I,b)=>I.add(b.key),K());let g,_;return h.persistence.runTransaction("Locally write mutations","readwrite",I=>{let b=$e(),S=K();return h.Gi.getEntries(I,p).next(O=>{b=O,b.forEach((B,ue)=>{ue.isValidDocument()||(S=S.add(B))})}).next(()=>h.localDocuments.getOverlayedDocuments(I,b)).next(O=>{g=O;const B=[];for(const ue of u){const ye=Qc(ue,g.get(ue.key).overlayedDocument);null!=ye&&B.push(new At(ue.key,ye,Qa(ye.value.mapValue),ae.exists(!0)))}return h.mutationQueue.addMutationBatch(I,d,B,u)}).next(O=>{_=O;const B=O.applyToLocalDocumentSet(g,S);return h.documentOverlayCache.saveOverlays(I,O.batchId,B)})}).then(()=>({batchId:_.batchId,changes:yu(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,u,h){let d=o.hc[o.currentUser.toKey()];d||(d=new de(j)),d=d.insert(u,h),o.hc[o.currentUser.toKey()]=d}(r,i.batchId,t),yield Tn(r,i.changes),yield ys(r.remoteStore)}catch(i){const o=vs(i,"Failed to persist write");t.reject(o)}}),eh.apply(this,arguments)}function yf(n,e){return th.apply(this,arguments)}function th(){return th=(0,y.Z)(function*(n,e){const t=C(n);try{const r=yield rm(t.localStore,e);e.targetChanges.forEach((i,o)=>{const u=t.cc.get(o);u&&(F(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?u.nc=!0:i.modifiedDocuments.size>0?F(u.nc):i.removedDocuments.size>0&&(F(u.nc),u.nc=!1))}),yield Tn(t,r,e)}catch(r){yield Et(r)}}),th.apply(this,arguments)}function _f(n,e,t){const r=C(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ic.forEach((o,u)=>{const h=u.view.bu(e);h.snapshot&&i.push(h.snapshot)}),function(o,u){const h=C(o);h.onlineState=u;let d=!1;h.queries.forEach((p,g)=>{for(const _ of g.listeners)_.bu(u)&&(d=!0)}),d&&Zl(h)}(r.eventManager,e),i.length&&r.sc.Wo(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Um(n,e,t){return nh.apply(this,arguments)}function nh(){return nh=(0,y.Z)(function*(n,e,t){const r=C(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.cc.get(e),o=i&&i.key;if(o){let u=new de(R.comparator);u=u.insert(o,ne.newNoDocument(o,q.min()));const h=K().add(o),d=new ss(q.min(),new Map,new X(j),u,h);yield yf(r,d),r.uc=r.uc.remove(o),r.cc.delete(e),ch(r)}else yield ms(r.localStore,e,!1).then(()=>ws(r,e,t)).catch(Et)}),nh.apply(this,arguments)}function Vm(n,e){return rh.apply(this,arguments)}function rh(){return rh=(0,y.Z)(function*(n,e){const t=C(n),r=e.batch.batchId;try{const i=yield nm(t.localStore,e);ah(t,r,null),oh(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Tn(t,i)}catch(i){yield Et(i)}}),rh.apply(this,arguments)}function qm(n,e,t){return ih.apply(this,arguments)}function ih(){return ih=(0,y.Z)(function*(n,e,t){const r=C(n);try{const i=yield function(o,u){const h=C(o);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next(g=>(F(null!==g),p=g.keys(),h.mutationQueue.removeMutationBatch(d,g))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})}(r.localStore,e);ah(r,e,t),oh(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Tn(r,i)}catch(i){yield Et(i)}}),ih.apply(this,arguments)}function oh(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function ah(n,e,t){const r=C(n);let i=r.hc[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.hc[r.currentUser.toKey()]=i}}function ws(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.rc.get(e))n.ic.delete(r),t&&n.sc.wc(r,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(r=>{n.ac.containsKey(r)||vf(n,r)})}function vf(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(Ho(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),ch(n))}function uh(n,e,t){for(const r of t)r instanceof pf?(n.ac.addReference(r.key,e),Bm(n,r)):r instanceof mf?(k("SyncEngine","Document no longer in limbo: "+r.key),n.ac.removeReference(r.key,e),n.ac.containsKey(r.key)||vf(n,r.key)):M()}function Bm(n,e){const t=e.key,r=t.path.canonicalString();n.uc.get(t)||n.oc.has(r)||(k("SyncEngine","New document in limbo: "+t),n.oc.add(r),ch(n))}function ch(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new R(Z.fromString(e)),r=n.fc.next();n.cc.set(r,new Pm(t)),n.uc=n.uc.insert(t,r),Uu(n.remoteStore,new or(Ge(Jn(t.path)),r,2,Ke.at))}}function Tn(n,e,t){return lh.apply(this,arguments)}function lh(){return lh=(0,y.Z)(function*(n,e,t){const r=C(n),i=[],o=[],u=[];var h;r.ic.isEmpty()||(r.ic.forEach((h,d)=>{u.push(r._c(d,e,t).then(p=>{if((p||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(d.targetId,null!=p&&p.fromCache?"not-current":"current"),p){i.push(p);const g=ml.Ci(d.targetId,p);o.push(g)}}))}),yield Promise.all(u),r.sc.Wo(i),yield(h=(0,y.Z)(function*(d,p){const g=C(d);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>T.forEach(p,I=>T.forEach(I.Si,b=>g.persistence.referenceDelegate.addReference(_,I.targetId,b)).next(()=>T.forEach(I.Di,b=>g.persistence.referenceDelegate.removeReference(_,I.targetId,b)))))}catch(_){if(!on(_))throw _;k("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of p){const I=_.targetId;if(!_.fromCache){const b=g.qi.get(I),O=b.withLastLimboFreeSnapshotVersion(b.snapshotVersion);g.qi=g.qi.insert(I,O)}}}),function(d,p){return h.apply(this,arguments)})(r.localStore,o))}),lh.apply(this,arguments)}function jm(n,e){return hh.apply(this,arguments)}function hh(){return hh=(0,y.Z)(function*(n,e){const t=C(n);if(!t.currentUser.isEqual(e)){k("SyncEngine","User change. New user:",e.toKey());const r=yield zd(t.localStore,e);t.currentUser=e,(i=t).lc.forEach(u=>{u.forEach(h=>{h.reject(new A(w.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.lc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Tn(t,r.ji)}var i}),hh.apply(this,arguments)}function Km(n,e){const t=C(n),r=t.cc.get(e);if(r&&r.nc)return K().add(r.key);{let i=K();const o=t.rc.get(e);if(!o)return i;for(const u of o){const h=t.ic.get(u);i=i.unionWith(h.view.ju)}return i}}function vh(n){const e=C(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=yf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Km.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Um.bind(null,e),e.sc.Wo=km.bind(null,e.eventManager),e.sc.wc=Nm.bind(null,e.eventManager),e}function Ih(n){const e=C(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vm.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=qm.bind(null,e),e}class wf{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,y.Z)(function*(){t.yt=Wo(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return $d(this.persistence,new Kd,e.initialUser,this.yt)}yc(e){return new Bd(Ru.Bs,this.yt)}gc(e){return new ef}terminate(){var e=this;return(0,y.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Jm extends wf{constructor(e,t,r){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,y.Z)(function*(){yield t().call(r,e),yield r.Ac.initialize(r,e),yield Ih(r.Ac.syncEngine),yield ys(r.Ac.remoteStore),yield r.persistence.li(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return $d(this.persistence,new Kd,e.initialUser,this.yt)}Tc(e,t){return new Gp(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const r=new Rc(t,this.persistence);return new _o(e.asyncQueue,r)}yc(e){const t=function pl(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Je.withCacheSize(this.cacheSizeBytes):Je.DEFAULT;return new fl(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,function nf(){return"undefined"!=typeof window?window:null}(),Fu(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new ef}}class Th{initialize(e,t){var r=this;return(0,y.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>_f(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=jm.bind(null,r.syncEngine),yield function Gl(n,e){return Bl.apply(this,arguments)}(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Sm}createDatastore(e){const t=Wo(e.databaseInfo.databaseId),r=new lm(e.databaseInfo);return new fm(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,o=h=>_f(this.syncEngine,h,0),u=tf.C()?new tf:new am,new gm(t,r,i,o,u);var t,r,i,o,u}createSyncEngine(e,t){return function(r,i,o,u,h,d,p){const g=new Om(r,i,o,u,h,d);return p&&(g.dc=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,y.Z)(function*(t){const r=C(t);k("RemoteStore","RemoteStore shutting down."),r._u.add(5),yield gs(r),r.mu.shutdown(),r.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function wh(n,e,t){if(!t)throw new A(w.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Ef(n){if(!R.isDocumentKey(n))throw new A(w.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function bf(n){if(R.isDocumentKey(n))throw new A(w.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function qu(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":M()}function Q(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new A(w.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=qu(n);throw new A(w.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}const Af=new Map;class Sf{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new A(w.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new A(w.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function tg(n,e,t,r){if(!0===e&&!0===r)throw new A(w.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qo{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Sf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new A(w.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new A(w.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sf(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new bc;switch(t.type){case"gapi":return new Xh(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new A(w.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Af.get(e);t&&(k("ComponentProvider","Removing Datastore"),Af.delete(e),t.terminate())}(this),Promise.resolve()}}class Ee{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Kt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ee(this.firestore,e,this._key)}}class Be{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Be(this.firestore,e,this._query)}}class Kt extends Be{constructor(e,t,r){super(e,t,Jn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ee(this.firestore,null,new R(e))}withConverter(e){return new Kt(this.firestore,e,this._path)}}function rg(n,e,...t){if(n=(0,pe.m9)(n),wh("collection","path",e),n instanceof Qo){const r=Z.fromString(e,...t);return bf(r),new Kt(n,null,r)}{if(!(n instanceof Ee||n instanceof Kt))throw new A(w.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Z.fromString(e,...t));return bf(r),new Kt(n.firestore,null,r)}}function kf(n,e,...t){if(n=(0,pe.m9)(n),1===arguments.length&&(e=Va.R()),wh("doc","path",e),n instanceof Qo){const r=Z.fromString(e,...t);return Ef(r),new Ee(n,null,new R(r))}{if(!(n instanceof Ee||n instanceof Kt))throw new A(w.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Z.fromString(e,...t));return Ef(r),new Ee(n.firestore,n instanceof Kt?n.converter:null,new R(r))}}class Gu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):ge("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class cg{constructor(e,t,r,i){var o=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=be.UNAUTHENTICATED,this.clientId=Va.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var u=(0,y.Z)(function*(h){k("FirestoreClient","Received user=",h.uid),yield o.authCredentialListener(h),o.user=h});return function(h){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(r,u=>(k("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,y.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new A(w.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new xe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,y.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=vs(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Cf(n,e){return Eh.apply(this,arguments)}function Eh(){return Eh=(0,y.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),k("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,y.Z)(function*(o){r.isEqual(o)||(yield zd(e.localStore,o),r=o)});return function(o){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Eh.apply(this,arguments)}function Rf(n,e){return bh.apply(this,arguments)}function bh(){return bh=(0,y.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield xh(n);k("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>lf(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,o)=>lf(e.remoteStore,o)),n.onlineComponents=e}),bh.apply(this,arguments)}function xh(n){return Ah.apply(this,arguments)}function Ah(){return Ah=(0,y.Z)(function*(n){return n.offlineComponents||(k("FirestoreClient","Using default OfflineComponentProvider"),yield Cf(n,new wf)),n.offlineComponents}),Ah.apply(this,arguments)}function Bu(n){return Sh.apply(this,arguments)}function Sh(){return Sh=(0,y.Z)(function*(n){return n.onlineComponents||(k("FirestoreClient","Using default OnlineComponentProvider"),yield Rf(n,new Th)),n.onlineComponents}),Sh.apply(this,arguments)}function Es(n){return Dh.apply(this,arguments)}function Dh(){return Dh=(0,y.Z)(function*(n){const e=yield Bu(n),t=e.eventManager;return t.onListen=Mm.bind(null,e.syncEngine),t.onUnlisten=Lm.bind(null,e.syncEngine),t}),Dh.apply(this,arguments)}class yg{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new bl(this,"async_queue_retry"),this.Wc=()=>{const t=Fu();t&&k("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=Fu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=Fu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new xe;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,y.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!on(t))throw t;k("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{throw this.Kc=r,this.Gc=!1,ge("INTERNAL UNHANDLED ERROR: ",function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),u}(r)),r}).then(r=>(this.Gc=!1,r))));return this.Bc=t,t}enqueueAfterDelay(e,t,r){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const i=jl.createAndSchedule(this,e,t,r,o=>this.Yc(o));return this.Uc.push(i),i}zc(){this.Kc&&M()}verifyOperationInProgress(){}Xc(){var e=this;return(0,y.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Ch(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class ce extends Qo{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new yg,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Ff(this),this._firestoreClient.terminate()}}function vg(n,e){const t="object"==typeof n?n:(0,Se.Mq)(),r="string"==typeof n?n:e||"(default)",i=(0,Se.qX)(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=(0,pe.P0)("firestore");o&&function ng(n,e,t,r={}){var i;const o=(n=Q(n,Qo))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Kn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},o),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let u,h;if("string"==typeof r.mockUserToken)u=r.mockUserToken,h=be.MOCK_USER;else{u=(0,pe.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new A(w.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new be(d)}n._authCredentials=new xc(new Fa(u,h))}}(i,...o)}return i}function Ae(n){return n._firestoreClient||Ff(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Ff(n){var e;const t=n._freezeSettings(),r=(o=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new ja(n._databaseId,o,n._persistenceKey,(h=t).host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,h.useFetchStreams));var o,h;n._firestoreClient=new cg(n._authCredentials,n._appCheckCredentials,n._queue,r)}function Ig(n,e){!function Vf(n){if(n._initialized||n._terminated)throw new A(w.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}(n=Q(n,ce));const t=Ae(n),r=n._freezeSettings(),i=new Th;return function Uf(n,e,t){const r=new xe;return n.asyncQueue.enqueue((0,y.Z)(function*(){try{yield Cf(n,t),yield Rf(n,e),r.resolve()}catch(i){const o=i;if(!("FirebaseError"===(u=o).name?u.code===w.FAILED_PRECONDITION||u.code===w.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code))throw o;Kn("Error enabling offline persistence. Falling back to persistence disabled: "+o),r.reject(o)}var u})).then(()=>r.promise)}(t,i,new Jm(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}class Xr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xr(Te.fromBase64String(e))}catch(t){throw new A(w.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Xr(Te.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class bs{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new A(w.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ku{constructor(e){this._methodName=e}}class Rh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new A(w.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new A(w.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return j(this._lat,e._lat)||j(this._long,e._long)}}const Tg=/^__.*__$/;class wg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new At(e,this.data,this.fieldMask,t,this.fieldTransforms):new tr(e,this.data,t,this.fieldTransforms)}}class qf{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new At(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Gf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}class $u{constructor(e,t,r,i,o,u){this.settings=e,this.databaseId=t,this.yt=r,this.ignoreUndefinedProperties=i,void 0===o&&this.na(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new $u(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:r,oa:!1});return i.ua(e),i}ca(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:r,oa:!1});return i.na(),i}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Wu(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Gf(this.sa)&&Tg.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class Eg{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=r||Wo(e)}da(e,t,r,i=!1){return new $u({sa:e,methodName:t,fa:r,path:$.emptyPath(),oa:!1,la:i},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function xs(n){const e=n._freezeSettings(),t=Wo(n._databaseId);return new Eg(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ph(n,e,t,r,i,o={}){const u=n.da(o.merge||o.mergeFields?2:0,e,t,i);Mh("Data must be an object, but it was:",u,r);const h=zf(r,u);let d,p;if(o.merge)d=new qe(u.fieldMask),p=u.fieldTransforms;else if(o.mergeFields){const g=[];for(const _ of o.mergeFields){const I=Lh(e,_,t);if(!u.contains(I))throw new A(w.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);Zf(g,I)||g.push(I)}d=new qe(g),p=u.fieldTransforms.filter(_=>d.covers(_.field))}else d=null,p=u.fieldTransforms;return new wg(new we(h),d,p)}class Yo extends Ku{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Yo}}class Oh extends Ku{_toFieldTransform(e){return new er(e.path,new gn)}isEqual(e){return e instanceof Oh}}function $f(n,e,t,r=!1){return Jr(t,n.da(r?4:3,e))}function Jr(n,e){if(Wf(n=(0,pe.m9)(n)))return Mh("Unsupported field value:",e,n),zf(n,e);if(n instanceof Ku)return function(t,r){if(!Gf(r.sa))throw r.ha(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,r){const i=[];let o=0;for(const u of t){let h=Jr(u,r.aa(o));null==h&&(h={nullValue:"NULL_VALUE"}),i.push(h),o++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,pe.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return No(r.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=oe.fromDate(t);return{timestampValue:E(r.yt,i)}}if(t instanceof oe){const i=new oe(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:E(r.yt,i)}}if(t instanceof Rh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Xr)return{bytesValue:P(r.yt,t._byteString)};if(t instanceof Ee){const i=r.databaseId,o=t.firestore._databaseId;if(!o.isEqual(i))throw r.ha(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:te(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.ha(`Unsupported field value: ${qu(t)}`)}(n,e)}function zf(n,e){const t={};return $a(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):dt(n,(r,i)=>{const o=Jr(i,e.ra(r));null!=o&&(t[r]=o)}),{mapValue:{fields:t}}}function Wf(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof oe||n instanceof Rh||n instanceof Xr||n instanceof Ee||n instanceof Ku)}function Mh(n,e,t){if(!Wf(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=qu(t);throw e.ha("an object"===r?n+" a custom object":n+" "+r)}var r}function Lh(n,e,t){if((e=(0,pe.m9)(e))instanceof bs)return e._internalPath;if("string"==typeof e)return zu(n,e);throw Wu("Field path arguments must be of type string or ",n,!1,void 0,t)}const Sg=new RegExp("[~\\*/\\[\\]]");function zu(n,e,t){if(e.search(Sg)>=0)throw Wu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new bs(...e.split("."))._internalPath}catch(r){throw Wu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Wu(n,e,t,r,i){const o=r&&!r.isEmpty(),u=void 0!==i;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let d="";return(o||u)&&(d+=" (found",o&&(d+=` in field ${r}`),u&&(d+=` in document ${i}`),d+=")"),new A(w.INVALID_ARGUMENT,h+n+d)}function Zf(n,e){return n.some(t=>t.isEqual(e))}class Fh{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ee(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new kg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Zu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class kg extends Fh{data(){return super.data()}}function Zu(n,e){return"string"==typeof e?zu(n,e):e instanceof bs?e._internalPath:e._delegate._internalPath}function Hf(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new A(w.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Uh{}class Xo extends Uh{}function Ng(n,e,...t){let r=[];e instanceof Uh&&r.push(e),r=r.concat(t),function(i){const o=i.filter(h=>h instanceof As).length,u=i.filter(h=>h instanceof Jo).length;if(o>1||o>0&&u>0)throw new A(w.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Jo extends Xo{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Jo(e,t,r)}_apply(e){const t=this._parse(e);return Jf(e._query,t),new Be(e.firestore,e.converter,So(e._query,t))}_parse(e){const t=xs(e.firestore);return function(i,o,u,h,d,p,g){let _;if(d.isKeyField()){if("array-contains"===p||"array-contains-any"===p)throw new A(w.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if("in"===p||"not-in"===p){Xf(g,p);const I=[];for(const b of g)I.push(Yf(h,i,b));_={arrayValue:{values:I}}}else _=Yf(h,i,g)}else"in"!==p&&"not-in"!==p&&"array-contains-any"!==p||Xf(g,p),_=$f(u,"where",g,"in"===p||"not-in"===p);return W.create(d,p,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class As extends Uh{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new As(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:Y.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,i){let o=r;const u=i.getFlattenedFilters();for(const h of u)Jf(o,h),o=So(o,h)}(e._query,t),new Be(e.firestore,e.converter,So(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Vh extends Xo{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Vh(e,t)}_apply(e){const t=function(r,i,o){if(null!==r.startAt)throw new A(w.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new A(w.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new qt(i,o);return function(h,d){if(null===xo(h)){const p=fn(h);null!==p&&ep(0,p,d.field)}}(r,u),u}(e._query,this._field,this._direction);return new Be(e.firestore,e.converter,function(r,i){const o=r.explicitOrderBy.concat([i]);return new ot(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function Dg(n,e="asc"){const t=e,r=Zu("orderBy",n);return Vh._create(r,t)}class Hu extends Xo{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Hu(e,t,r)}_apply(e){return new Be(e.firestore,e.converter,es(e._query,this._limit,this._limitType))}}function Cg(n){return function xf(n,e){if(e<=0)throw new A(w.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}("limit",n),Hu._create("limit",n,"F")}class Qu extends Xo{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Qu(e,t,r)}_apply(e){const t=Qf(e,this.type,this._docOrFields,this._inclusive);return new Be(e.firestore,e.converter,(i=t,new ot((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)));var r,i}}function Rg(...n){return Qu._create("startAfter",n,!1)}class Yu extends Xo{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Yu(e,t,r)}_apply(e){const t=Qf(e,this.type,this._docOrFields,this._inclusive);return new Be(e.firestore,e.converter,(i=t,new ot((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)));var r,i}}function Pg(...n){return Yu._create("endBefore",n,!1)}function Qf(n,e,t,r){if(t[0]=(0,pe.m9)(t[0]),t[0]instanceof Fh)return function(i,o,u,h,d){if(!h)throw new A(w.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const p=[];for(const g of pn(i))if(g.field.isKeyField())p.push(Hn(o,h.key));else{const _=h.data.field(g.field);if(vo(_))throw new A(w.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const I=g.field.canonicalString();throw new A(w.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${I}' (used as the orderBy) does not exist.`)}p.push(_)}return new pt(p,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=xs(n.firestore);return function(o,u,h,d,p,g){const _=o.explicitOrderBy;if(p.length>_.length)throw new A(w.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const I=[];for(let b=0;b<p.length;b++){const S=p[b];if(_[b].field.isKeyField()){if("string"!=typeof S)throw new A(w.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof S}`);if(!Ao(o)&&-1!==S.indexOf("/"))throw new A(w.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${S}' contains a slash.`);const O=o.path.child(Z.fromString(S));if(!R.isDocumentKey(O))throw new A(w.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${O}' is not because it contains an odd number of segments.`);const B=new R(O);I.push(Hn(u,B))}else{const O=$f(h,d,S);I.push(O)}}return new pt(I,g)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Yf(n,e,t){if("string"==typeof(t=(0,pe.m9)(t))){if(""===t)throw new A(w.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ao(e)&&-1!==t.indexOf("/"))throw new A(w.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Z.fromString(t));if(!R.isDocumentKey(r))throw new A(w.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Hn(n,new R(r))}if(t instanceof Ee)return Hn(n,t._key);throw new A(w.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qu(t)}.`)}function Xf(n,e){if(!Array.isArray(n)||0===n.length)throw new A(w.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new A(w.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Jf(n,e){if(e.isInequality()){const r=fn(n),i=e.field;if(null!==r&&!r.isEqual(i))throw new A(w.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const o=xo(n);null!==o&&ep(0,i,o)}const t=function(r,i){for(const o of r)for(const u of o.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new A(w.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function ep(n,e,t){if(!t.isEqual(e))throw new A(w.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class ei{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ss extends Fh{constructor(e,t,r,i,o,u){super(e,t,r,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Xu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Zu("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Xu extends Ss{data(e={}){return super.data(e)}}class ks{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ei(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Xu(this._firestore,this._userDataWriter,r.key,r,new ei(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new A(w.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(u=>({type:"added",doc:new Xu(r._firestore,r._userDataWriter,u.doc.key,u.doc,new ei(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:o++}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const h=new Xu(r._firestore,r._userDataWriter,u.doc.key,u.doc,new ei(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,p=-1;return 0!==u.type&&(d=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),p=o.indexOf(u.doc.key)),{type:Mg(u.type),doc:h,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Mg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M()}}function Lg(n){n=Q(n,Ee);const e=Q(n.firestore,ce);return function Mf(n,e,t={}){const r=new xe;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function(i,o,u,h,d){const p=new Gu({next:_=>{o.enqueueAndForget(()=>zl(i,g));const I=_.docs.has(u);!I&&_.fromCache?d.reject(new A(w.UNAVAILABLE,"Failed to get document because the client is offline.")):I&&_.fromCache&&h&&"server"===h.source?d.reject(new A(w.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Hl(Jn(u.path),p,{includeMetadataChanges:!0,Nu:!0});return Kl(i,g)}(yield Es(n),n.asyncQueue,e,t,r)})),r.promise}(Ae(e),n._key).then(t=>Gh(e,n,t))}class hr extends class Og{convertValue(e,t="none"){switch(bt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return he(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ft(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw M()}}convertObject(e,t){const r={};return dt(e.fields,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertGeoPoint(e){return new Rh(he(e.latitude),he(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Oc(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Or(e));default:return null}}convertTimestamp(e){const t=Lt(e);return new oe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Z.fromString(e);F(cd(r));const i=new un(r.get(1),r.get(3)),o=new R(r.popFirst(5));return i.isEqual(t)||ge(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ee(this.firestore,null,t)}}function Fg(n){n=Q(n,Ee);const e=Q(n.firestore,ce),t=Ae(e),r=new hr(e);return function dg(n,e){const t=new xe;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return(r=(0,y.Z)(function*(i,o,u){try{const h=yield function(d,p){const g=C(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,p))}(i,o);h.isFoundDocument()?u.resolve(h):h.isNoDocument()?u.resolve(null):u.reject(new A(w.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const d=vs(h,`Failed to get document '${o} from cache`);u.reject(d)}}),function(i,o,u){return r.apply(this,arguments)})(yield function ju(n){return xh(n).then(e=>e.localStore)}(n),e,t);var r})),t.promise}(t,n._key).then(i=>new Ss(e,r,n._key,i,new ei(null!==i&&i.hasLocalMutations,!0),n.converter))}function Ug(n){n=Q(n,Be);const e=Q(n.firestore,ce),t=Ae(e),r=new hr(e);return Hf(n._query),function Lf(n,e,t={}){const r=new xe;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function(i,o,u,h,d){const p=new Gu({next:_=>{o.enqueueAndForget(()=>zl(i,g)),_.fromCache&&"server"===h.source?d.reject(new A(w.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Hl(u,p,{includeMetadataChanges:!0,Nu:!0});return Kl(i,g)}(yield Es(n),n.asyncQueue,e,t,r)})),r.promise}(t,n._query).then(i=>new ks(e,r,n,i))}function Vg(n,e,t,...r){n=Q(n,Ee);const i=Q(n.firestore,ce),o=xs(i);let u;return u="string"==typeof(e=(0,pe.m9)(e))||e instanceof bs?function Kf(n,e,t,r,i,o){const u=n.da(1,e,t),h=[Lh(e,r,t)],d=[i];if(o.length%2!=0)throw new A(w.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<o.length;I+=2)h.push(Lh(e,o[I])),d.push(o[I+1]);const p=[],g=we.empty();for(let I=h.length-1;I>=0;--I)if(!Zf(p,h[I])){const b=h[I];let S=d[I];S=(0,pe.m9)(S);const O=u.ca(b);if(S instanceof Yo)p.push(b);else{const B=Jr(S,O);null!=B&&(p.push(b),g.set(b,B))}}const _=new qe(p);return new qf(g,_,u.fieldTransforms)}(o,"updateDoc",n._key,e,t,r):function jf(n,e,t,r){const i=n.da(1,e,t);Mh("Data must be an object, but it was:",i,r);const o=[],u=we.empty();dt(r,(d,p)=>{const g=zu(e,d,t);p=(0,pe.m9)(p);const _=i.ca(g);if(p instanceof Yo)o.push(g);else{const I=Jr(p,_);null!=I&&(o.push(g),u.set(g,I))}});const h=new qe(o);return new qf(u,h,i.fieldTransforms)}(o,"updateDoc",n._key,e),ea(i,[u.toMutation(n._key,ae.exists(!0))])}function qg(n){return ea(Q(n.firestore,ce),[new nr(n._key,ae.none())])}function Gg(n,e){const t=Q(n.firestore,ce),r=kf(n),i=function qh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}(n.converter,e);return ea(t,[Ph(xs(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,ae.exists(!1))]).then(()=>r)}function Bg(n,...e){var t,r,i;n=(0,pe.m9)(n);let o={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||Ch(e[u])||(o=e[u],u++);const h={includeMetadataChanges:o.includeMetadataChanges};if(Ch(e[u])){const _=e[u];e[u]=null===(t=_.next)||void 0===t?void 0:t.bind(_),e[u+1]=null===(r=_.error)||void 0===r?void 0:r.bind(_),e[u+2]=null===(i=_.complete)||void 0===i?void 0:i.bind(_)}let d,p,g;if(n instanceof Ee)p=Q(n.firestore,ce),g=Jn(n._key.path),d={next:_=>{e[u]&&e[u](Gh(p,n,_))},error:e[u+1],complete:e[u+2]};else{const _=Q(n,Be);p=Q(_.firestore,ce),g=_._query;const I=new hr(p);d={next:b=>{e[u]&&e[u](new ks(p,I,_,b))},error:e[u+1],complete:e[u+2]},Hf(n._query)}return function(_,I,b,S){const O=new Gu(S),B=new Hl(I,O,b);return _.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return Kl(yield Es(_),B)})),()=>{O.bc(),_.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return zl(yield Es(_),B)}))}}(Ae(p),g,h,d)}function ea(n,e){return function(t,r){const i=new xe;return t.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function Fm(n,e,t){return eh.apply(this,arguments)}(yield function Nh(n){return Bu(n).then(e=>e.syncEngine)}(t),r,i)})),i.promise}(Ae(n),e)}function Gh(n,e,t){const r=t.docs.get(e._key),i=new hr(n);return new Ss(n,i,e._key,r,new ei(t.hasPendingWrites,t.fromCache),e.converter)}function zg(){return new Oh("serverTimestamp")}!function(n,e=!0){jn=Se.Jn,(0,Se.Xd)(new z.wA("firestore",(t,{instanceIdentifier:r,options:i})=>{const o=t.getProvider("app").getImmediate(),u=new ce(new fo(t.getProvider("auth-internal")),new Ua(t.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new A(w.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new un(h.options.projectId,d)}(o,r),o);return i=Object.assign({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,Se.KN)(Oa,"3.8.3",n),(0,Se.KN)(Oa,"3.8.3","esm2017")}()}}]);