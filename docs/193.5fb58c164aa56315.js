"use strict";(self.webpackChunkportfolio_all_in_one=self.webpackChunkportfolio_all_in_one||[]).push([[193],{193:(Yt,Ne,R)=>{R.r(Ne),R.d(Ne,{FirebaseModule:()=>r4});var T=R(177),oe=R(884),l=R(4438),Ae=R(6651),Q=R(1994);const M=(n,e,t)=>({"badge-success":n,"badge-warning":e,"badge-danger":t});function Me(n,e){if(1&n&&(l.j41(0,"div",5),l.EFF(1),l.k0s()),2&n){const t=e.ngIf;l.Y8G("ngClass",l.sMw(2,M,"online"===(null==t?null:t.status),"away"===(null==t?null:t.status),"offline"===(null==t?null:t.status))),l.R7$(),l.SpI(" ",null==t?null:t.status,"\n")}}let y=(()=>{class n{constructor(t,i){this.presenceService=t,this.checkPresenceService=i,this.uid="1",this.presenceService.configureUserPresenceByLocal(),this.setPresence("user1")}ngOnInit(){this.presence$=this.presenceService.getPresence(this.uid),this.counts$=this.presenceService.getUserOnlineCounts$}setPresence(t){this.checkPresenceService.checkPresence(`checkPresence/${t}`)}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(Ae.BF),l.rXU(Q.h))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-realtime-presence"]],standalone:!1,decls:8,vars:6,consts:[["class","badge",3,"ngClass",4,"ngIf"],[1,"ping"],[1,"outer"],[1,"inner"],[1,"num"],[1,"badge",3,"ngClass"]],template:function(i,r){1&i&&(l.DNE(0,Me,2,6,"div",0),l.nI1(1,"async"),l.j41(2,"span",1),l.nrm(3,"span",2)(4,"span",3),l.k0s(),l.j41(5,"span",4),l.EFF(6),l.nI1(7,"async"),l.k0s()),2&i&&(l.Y8G("ngIf",l.bMT(1,2,r.presence$)),l.R7$(6),l.JRh(l.bMT(7,4,r.counts$)))},dependencies:[T.NgClass,T.NgIf,T.AsyncPipe],encapsulation:2})}}return n})();var ee=R(8141);const kt=n=>({active:n});let et=(()=>{class n{constructor(t){this.firebaseRealtimeDatabaseService=t,this.userId="1",this.itemId="election mp",this.voteCount=0,this.userVote=0}ngOnInit(){this.getItemVotes("election mp")}getItemVotes(t){this.subscription=this.firebaseRealtimeDatabaseService.readRealtimeOriginal$(`votes/${t}`).pipe((0,ee.M)(i=>{this.voteCount=i.reduce((r,s)=>r+s,0)})).subscribe(i=>{this.userId&&(this.userVote=i[this.userId])})}updateUserVote(t,i,r){let s={};s[i]=r,this.firebaseRealtimeDatabaseService.update(`votes/${t}`,s).then()}upvote(){this.updateUserVote(this.itemId,this.userId,1==this.userVote?0:1)}downvote(){this.updateUserVote(this.itemId,this.userId,-1==this.userVote?0:-1)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(Q.h))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-voting"]],inputs:{userId:"userId",itemId:"itemId"},standalone:!1,decls:5,vars:7,consts:[[1,"votebox"],[1,"fa","fa-arrow-up","vote","up",3,"click","ngClass"],[1,"vote-count"],[1,"fa","fa-arrow-down","vote","down",3,"click","ngClass"]],template:function(i,r){1&i&&(l.j41(0,"div",0)(1,"span",1),l.bIt("click",function(){return r.upvote()}),l.k0s(),l.j41(2,"span",2),l.EFF(3),l.k0s(),l.j41(4,"span",3),l.bIt("click",function(){return r.downvote()}),l.k0s()()),2&i&&(l.R7$(),l.Y8G("ngClass",l.eq3(3,kt,r.userVote>0)),l.R7$(2),l.JRh(r.voteCount),l.R7$(),l.Y8G("ngClass",l.eq3(5,kt,r.userVote<0)))},dependencies:[T.NgClass],styles:[".votebox[_ngcontent-%COMP%]{height:120px;width:120px;display:flex;text-align:center;flex-direction:column;font-size:2em}.votebox[_ngcontent-%COMP%]   .vote[_ngcontent-%COMP%]{cursor:pointer}.votebox[_ngcontent-%COMP%]   .vote[_ngcontent-%COMP%]:hover{color:orange}.votebox[_ngcontent-%COMP%]   .active.up[_ngcontent-%COMP%]{color:green}.votebox[_ngcontent-%COMP%]   .active.down[_ngcontent-%COMP%]{color:red}"]})}}return n})();var U=R(9417);function Ct(n,e){if(1&n){const t=l.RV6();l.j41(0,"span",12),l.bIt("click",function(){l.eBV(t);const r=l.XpG().$implicit,s=l.XpG();return l.Njj(s.updateActive(!1,r.key))}),l.EFF(1,"Mark Complete"),l.k0s()}}function Zi(n,e){if(1&n){const t=l.RV6();l.j41(0,"span",13),l.bIt("click",function(){l.eBV(t);const r=l.XpG().$implicit,s=l.XpG();return l.Njj(s.updateActive(!0,r.key))}),l.EFF(1,"Mark Active"),l.k0s()}}function $x(n,e){if(1&n){const t=l.RV6();l.qex(0),l.j41(1,"h5"),l.EFF(2),l.k0s(),l.EFF(3),l.nI1(4,"date"),l.j41(5,"span",8),l.bIt("click",function(){const r=l.eBV(t).$implicit,s=l.XpG();return l.Njj(s.updateTimeStamp(r.key))}),l.EFF(6,"Update Timestamp"),l.k0s(),l.DNE(7,Ct,2,0,"span",9)(8,Zi,2,0,"span",10),l.j41(9,"span",11),l.bIt("click",function(){const r=l.eBV(t).$implicit,s=l.XpG();return l.Njj(s.delete(r.key))}),l.EFF(10,"Delete"),l.k0s(),l.bVm()}if(2&n){const t=e.$implicit;l.R7$(2),l.JRh(t.title||"missing title"),l.R7$(),l.Lme(" Active: ",t.active," ",l.bMT(4,5,t.timeStamp)," "),l.R7$(4),l.Y8G("ngIf",t.active),l.R7$(),l.Y8G("ngIf",!t.active)}}function Hx(n,e){if(1&n){const t=l.RV6();l.j41(0,"span",15),l.bIt("click",function(){l.eBV(t);const r=l.XpG(2);return l.Njj(r.deleteItem())}),l.EFF(1,"Delete All"),l.k0s()}}function Kx(n,e){if(1&n&&(l.qex(0),l.DNE(1,Hx,2,0,"span",14),l.bVm()),2&n){const t=e.ngIf;l.R7$(),l.Y8G("ngIf",t.length)}}function zx(n,e){1&n&&(l.j41(0,"span"),l.EFF(1,"template renders here..."),l.k0s())}function Qx(n,e){if(1&n&&(l.j41(0,"div"),l.DNE(1,zx,2,0,"span",16),l.k0s()),2&n){l.XpG();const t=l.sdS(7),i=l.sdS(12),r=l.sdS(14);l.R7$(),l.Y8G("ngIf",t.errors)("ngIfThen",r)("ngIfElse",i)}}function Yx(n,e){1&n&&(l.j41(0,"p",17),l.EFF(1,"looks good! "),l.k0s())}function Xx(n,e){1&n&&(l.j41(0,"p",18),l.EFF(1,"form contains errors!"),l.k0s())}class Oy{constructor(){this.active=!0}}let Jx=(()=>{class n{constructor(t){this.firebaseRealtimeDatabaseService=t,this.item=new Oy}ngOnInit(){this.items$=this.firebaseRealtimeDatabaseService.readRealtime$("tasks")}updateTimeStamp(t){let i=(new Date).getTime();this.firebaseRealtimeDatabaseService.update(`tasks/${t}`,{timeStamp:i}).then()}updateActive(t,i){this.firebaseRealtimeDatabaseService.update(`tasks/${i}`,{active:t}).then()}deleteItem(){this.firebaseRealtimeDatabaseService.remove("tasks").then()}createItem(){this.firebaseRealtimeDatabaseService.create("tasks",this.item).then(t=>{this.item=new Oy})}delete(t){this.firebaseRealtimeDatabaseService.remove(`tasks/${t}`).then()}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(Q.h))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-task"]],standalone:!1,decls:15,vars:9,consts:[["title","ngModel"],["valid",""],["errors",""],[1,"container"],[4,"ngFor","ngForOf"],[4,"ngIf"],["placeholder","Item Title","required","","minlength","2","maxlength","23","autofocus","",1,"form-control","mt-4",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-info",3,"click"],["class","btn btn-primary ml-1",3,"click",4,"ngIf"],["class","btn btn-primary ml-2",3,"click",4,"ngIf"],[1,"btn","btn-danger","ml-2",3,"click"],[1,"btn","btn-primary","ml-1",3,"click"],[1,"btn","btn-primary","ml-2",3,"click"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-danger",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],[1,"text-success"],[1,"text-danger"]],template:function(i,r){if(1&i){const s=l.RV6();l.j41(0,"div",3),l.DNE(1,$x,11,7,"ng-container",4),l.nI1(2,"async"),l.nrm(3,"br"),l.DNE(4,Kx,2,1,"ng-container",5),l.nI1(5,"async"),l.j41(6,"input",6,0),l.mxI("ngModelChange",function(a){return l.eBV(s),l.DH7(r.item.title,a)||(r.item.title=a),l.Njj(a)}),l.k0s(),l.DNE(8,Qx,2,3,"div",5),l.j41(9,"button",7),l.bIt("click",function(){return l.eBV(s),l.Njj(r.createItem())}),l.EFF(10,"Create"),l.k0s(),l.DNE(11,Yx,2,0,"ng-template",null,1,l.C5r)(13,Xx,2,0,"ng-template",null,2,l.C5r),l.k0s()}if(2&i){const s=l.sdS(7);l.R7$(),l.Y8G("ngForOf",l.bMT(2,5,r.items$)),l.R7$(3),l.Y8G("ngIf",l.bMT(5,7,r.items$)),l.R7$(2),l.R50("ngModel",r.item.title),l.R7$(2),l.Y8G("ngIf",s.dirty),l.R7$(),l.Y8G("disabled",!s.valid)}},dependencies:[T.NgForOf,T.NgIf,U.me,U.BC,U.YS,U.xh,U.tU,U.vS,T.AsyncPipe,T.DatePipe],encapsulation:2})}}return n})(),Zx=(()=>{class n{transform(t){return t?t.filter(r=>!r.dismissed).reverse():void 0}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275pipe=l.EJ8({name:"reverse",type:n,pure:!0,standalone:!1})}}return n})();const ek=(n,e,t)=>({"bg-info":n,"bg-danger":e,"bg-success":t});function tk(n,e){if(1&n){const t=l.RV6();l.qex(0),l.j41(1,"div",4)(2,"div",5)(3,"button",6),l.bIt("click",function(){const r=l.eBV(t).$implicit,s=l.XpG();return l.Njj(s.dismiss(r.key))}),l.j41(4,"span",7),l.EFF(5,"\xd7"),l.k0s()()(),l.j41(6,"div",8),l.EFF(7),l.k0s()(),l.bVm()}if(2&n){const t=e.$implicit;l.R7$(),l.Y8G("ngClass",l.sMw(2,ek,"info"===t.style,"danger"===t.style,"success"===t.style)),l.R7$(6),l.SpI(" ",t.content," ")}}class nk{constructor(e,t){this.dismissed=!1,this.content=e,this.style=t||"info"}}let ik=(()=>{class n{constructor(t,i){this.firebaseRealtimeDatabaseService=t,this.firebaseRealtimeDatabaseService2=i}ngOnInit(){this.getMessages()}getMessages(){this.messages=this.firebaseRealtimeDatabaseService.readRealtime$("messages")}sendMessage(t,i){const r=new nk(t,i);this.firebaseRealtimeDatabaseService.create("messages",r).then()}dismissMessage(t){this.firebaseRealtimeDatabaseService.update(`messages/${t}`,{dismissed:!0}).then()}dismiss(t){this.dismissMessage(t)}infoMessage(t="info"){this.sendMessage("I have some useful information for you...",t)}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(Q.l),l.rXU(Q.h))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-toast-message-notifications"]],standalone:!1,decls:11,vars:5,consts:[[2,"position","relative","min-height","200px"],[2,"position","absolute","top","0","right","0"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"click"],[1,"toast","fade","show",3,"ngClass"],[1,"toast-header"],[1,"ml-2","mb-1","close",3,"click"],["aria-hidden","true"],[1,"toast-body"]],template:function(i,r){1&i&&(l.j41(0,"div",0)(1,"div",1),l.DNE(2,tk,8,6,"ng-container",2),l.nI1(3,"async"),l.nI1(4,"reverse"),l.k0s()(),l.j41(5,"button",3),l.bIt("click",function(){return r.infoMessage()}),l.EFF(6,"Info Toast"),l.k0s(),l.j41(7,"button",3),l.bIt("click",function(){return r.infoMessage("success")}),l.EFF(8,"success Toast"),l.k0s(),l.j41(9,"button",3),l.bIt("click",function(){return r.infoMessage("danger")}),l.EFF(10,"danger Toast"),l.k0s()),2&i&&(l.R7$(2),l.Y8G("ngForOf",l.bMT(4,3,l.bMT(3,1,r.messages))))},dependencies:[T.NgClass,T.NgForOf,T.AsyncPipe,Zx],encapsulation:2})}}return n})();function rk(n,e){1&n&&(l.j41(0,"div"),l.EFF(1," button renders here "),l.k0s())}function sk(n,e){if(1&n&&(l.qex(0),l.DNE(1,rk,2,0,"div",5),l.bVm()),2&n){const t=l.XpG(2),i=l.sdS(2),r=l.sdS(4);l.R7$(),l.Y8G("ngIf",t.isFollowing)("ngIfThen",r)("ngIfElse",i)}}function ok(n,e){if(1&n&&(l.j41(0,"div",3),l.EFF(1),l.j41(2,"strong"),l.EFF(3),l.k0s(),l.EFF(4," followers "),l.DNE(5,sk,2,3,"ng-container",4),l.k0s()),2&n){const t=l.XpG();l.R7$(),l.Lme(" ","@","",t.user.name," has "),l.R7$(2),l.JRh(t.followerCount),l.R7$(2),l.Y8G("ngIf",t.currentUser.key!==t.user.key)}}function ak(n,e){if(1&n){const t=l.RV6();l.j41(0,"button",6),l.bIt("click",function(){l.eBV(t);const r=l.XpG();return l.Njj(r.toggleFollow(r.user))}),l.EFF(1,"Follow"),l.k0s()}}function ck(n,e){if(1&n){const t=l.RV6();l.j41(0,"button",7),l.bIt("click",function(){l.eBV(t);const r=l.XpG();return l.Njj(r.toggleFollow(r.user))}),l.EFF(1,"Unfollow"),l.k0s()}}let uk=(()=>{class n{constructor(t){this.firebaseRealtimeDatabaseService=t}ngOnInit(){this.user&&this.user.key&&this.getFollowers(this.user.key),this.currentUser&&this.currentUser.key&&this.getFollowing(this.currentUser.key,this.user.key)}ngOnChanges(t){}getFollowers(t){this.followers=this.firebaseRealtimeDatabaseService.readRealtimeOriginal$(`followers/${t}`).pipe((0,ee.M)(i=>{this.followerCount=Object.keys(i).reduce((r,s)=>r+i[s],0)})).subscribe()}getFollowing(t,i){this.following=this.firebaseRealtimeDatabaseService.readRealtimeOriginal$(`following/${t}/${i}`).pipe((0,ee.M)(r=>this.isFollowing=!!r)).subscribe()}follow(t,i){this.firebaseRealtimeDatabaseService.update(`followers/${i}`,{[t]:!0}),this.firebaseRealtimeDatabaseService.update(`following/${t}`,{[i]:!0})}unfollow(t,i){this.firebaseRealtimeDatabaseService.remove(`followers/${i}/${t}`),this.firebaseRealtimeDatabaseService.remove(`following/${t}/${i}`)}toggleFollow(t){const i=t.key,r=this.currentUser.key;this.isFollowing?this.unfollow(r,i):this.follow(r,i)}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(Q.h))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-user-profile"]],inputs:{user:"user",currentUser:"currentUser"},standalone:!1,features:[l.OA$],decls:5,vars:1,consts:[["followButton",""],["unfollowButton",""],["class","profile",4,"ngIf"],[1,"profile"],[4,"ngIf"],[4,"ngIf","ngIfThen","ngIfElse"],[1,"button","is-info",3,"click"],[1,"button","is-warning",3,"click"]],template:function(i,r){1&i&&l.DNE(0,ok,6,4,"div",2)(1,ak,2,0,"ng-template",null,0,l.C5r)(3,ck,2,0,"ng-template",null,1,l.C5r),2&i&&l.Y8G("ngIf",r.currentUser)},dependencies:[T.NgIf],encapsulation:2})}}return n})();function lk(n,e){if(1&n&&(l.j41(0,"div"),l.nrm(1,"app-user-profile",1),l.k0s()),2&n){const t=e.$implicit,i=l.XpG();l.R7$(),l.Y8G("user",t)("currentUser",i.currentUser)}}let dk=(()=>{class n{constructor(t){this.firebaseRealtimeDatabaseService=t,this.loginUserId="-NJv4HtIRVHIk7bB-7Px"}ngOnInit(){this.firebaseRealtimeDatabaseService.readOnceOriginal("users/"+this.loginUserId).then(t=>{this.currentUser=t}),this.users$=this.firebaseRealtimeDatabaseService.readRealtime$("users")}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(Q.h))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-follow-system"]],standalone:!1,decls:6,vars:4,consts:[[4,"ngFor","ngForOf"],[3,"user","currentUser"]],template:function(i,r){1&i&&(l.EFF(0,"You are logged in as "),l.j41(1,"strong"),l.EFF(2),l.k0s(),l.nrm(3,"hr"),l.DNE(4,lk,2,2,"div",0),l.nI1(5,"async")),2&i&&(l.R7$(2),l.JRh(null==r.currentUser?null:r.currentUser.name),l.R7$(2),l.Y8G("ngForOf",l.bMT(5,2,r.users$)))},dependencies:[T.NgForOf,uk,T.AsyncPipe],encapsulation:2})}}return n})(),hk=(()=>{class n{constructor(t){this.firebaseRealtimeDatabaseService=t}ngOnInit(){}onIncrement(){this.incDisable=!0,this.firebaseRealtimeDatabaseService.updateCounter("pages",!0).then(()=>this.incDisable=!1)}onDecrement(){this.decDisable=!0,this.firebaseRealtimeDatabaseService.updateCounter("pages",!1).then(()=>this.decDisable=!1)}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(Q.h))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-couter-stats"]],standalone:!1,decls:4,vars:2,consts:[[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-warning",3,"click","disabled"]],template:function(i,r){1&i&&(l.j41(0,"button",0),l.bIt("click",function(){return r.onIncrement()}),l.EFF(1,"Inc"),l.k0s(),l.j41(2,"button",1),l.bIt("click",function(){return r.onDecrement()}),l.EFF(3,"Dec"),l.k0s()),2&i&&(l.Y8G("disabled",r.incDisable),l.R7$(2),l.Y8G("disabled",r.decDisable))},encapsulation:2})}}return n})();var fk=R(7901);const pk=["postForm"];function mk(n,e){if(1&n){const t=l.RV6();l.j41(0,"li",5),l.bIt("click",function(){const r=l.eBV(t).$implicit,s=l.XpG();return l.Njj(s.fetchPost(r.key))}),l.EFF(1),l.nI1(2,"json"),l.j41(3,"span",5),l.bIt("click",function(){const r=l.eBV(t).$implicit,s=l.XpG();return l.Njj(s.deletePost(r.key))}),l.EFF(4,"X"),l.k0s()()}if(2&n){const t=e.$implicit;l.R7$(),l.Lme("",t.key," | ",l.bMT(2,2,null==t?null:t.value)," ")}}let gk=(()=>{class n{constructor(t){this.realtimeDbService=t}ngOnInit(){}onCreatePost(t){this.realtimeDbService.post("2023/posts.json",t).subscribe(i=>{this.postForm.reset()})}fetchPosts(){this.realtimeDbService.get("2023/posts.json").subscribe(t=>{this.posts=t})}fetchPost(t){this.realtimeDbService.get(`2023/posts/${t}.json`).subscribe(i=>{this.post=i})}deletePost(t){this.realtimeDbService.delete(`2023/posts/${t}.json`).subscribe(i=>{this.fetchPosts()})}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(fk.d))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-realtimedb-playground"]],viewQuery:function(i,r){if(1&i&&l.GBs(pk,5),2&i){let s;l.mGM(s=l.lsd())&&(r.postForm=s.first)}},standalone:!1,decls:25,vars:6,consts:[["postForm","ngForm"],[3,"ngSubmit"],["type","text","name","title","ngModel","","required",""],["id","content","name","content","ngModel","","required",""],["type","submit"],[3,"click"],[3,"click",4,"ngFor","ngForOf"]],template:function(i,r){if(1&i){const s=l.RV6();l.j41(0,"h2"),l.EFF(1,"Angular: Making HTTP Requests with Firebase "),l.k0s(),l.j41(2,"form",1,0),l.bIt("ngSubmit",function(){l.eBV(s);const a=l.sdS(3);return l.Njj(r.onCreatePost(a.value))}),l.j41(4,"div")(5,"label")(6,"b"),l.EFF(7,"Title"),l.k0s()(),l.nrm(8,"input",2),l.j41(9,"label")(10,"b"),l.EFF(11,"Content"),l.k0s()(),l.nrm(12,"textarea",3),l.j41(13,"button",4),l.EFF(14,"Send Post"),l.k0s()()(),l.j41(15,"div")(16,"button",5),l.bIt("click",function(){return l.eBV(s),l.Njj(r.fetchPosts())}),l.EFF(17,"Fetch Posts"),l.k0s()(),l.nrm(18,"hr"),l.j41(19,"ul"),l.DNE(20,mk,5,4,"li",6),l.nI1(21,"keyvalue"),l.k0s(),l.nrm(22,"hr"),l.EFF(23),l.nI1(24,"json")}2&i&&(l.R7$(20),l.Y8G("ngForOf",l.bMT(21,2,r.posts)),l.R7$(3),l.SpI("\n",l.bMT(24,4,r.post),"\n"))},dependencies:[T.NgForOf,U.qT,U.me,U.BC,U.cb,U.YS,U.vS,U.cV,T.JsonPipe,T.KeyValuePipe],encapsulation:2})}}return n})();var f=R(467);const b=function(n,e){if(!n)throw er(e)},er=function(n){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+n)},My=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=63&r|128):55296==(64512&r)&&i+1<n.length&&56320==(64512&n.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&n.charCodeAt(++i)),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=63&r|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=63&r|128)}return e},dl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const s=n[r],o=r+1<n.length,a=o?n[r+1]:0,c=r+2<n.length,u=c?n[r+2]:0;let p=(15&a)<<2|u>>6,m=63&u;c||(m=64,o||(p=64)),i.push(t[s>>2],t[(3&s)<<4|a>>4],t[p],t[m])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(My(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=n[t++];e[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const c=((7&r)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(1023&c))}else{const s=n[t++],o=n[t++];e[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const h=r<n.length?t[n.charAt(r)]:64;if(++r,null==s||null==a||null==u||null==h)throw Error();i.push(s<<2|a>>4),64!==u&&(i.push(a<<4&240|u>>2),64!==h&&i.push(u<<6&192|h))}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Ly=function(n){const e=My(n);return dl.encodeByteArray(e,!0)},_a=function(n){return Ly(n).replace(/\./g,"")},ya=function(n){try{return dl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function yk(n){return Fy(void 0,n)}function Fy(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===n&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!vk(t)||(n[t]=Fy(n[t],e[t]));return n}function vk(n){return"__proto__"!==n}const va=()=>{try{return function Ik(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;return n?JSON.parse(n):void 0})()||(()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ya(n[1]);return e&&JSON.parse(e)})()}catch(n){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`)}},Uy=n=>{var e,t;return null===(t=null===(e=va())||void 0===e?void 0:e.emulatorHosts)||void 0===t?void 0:t[n]},Gy=n=>{var e;return null===(e=va())||void 0===e?void 0:e[`_${n}`]};class St{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,i))}}}function xe(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function hl(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(xe())}function qy(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function jy(){try{return"object"==typeof indexedDB}catch{return!1}}class Jt extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,Jt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,as.prototype.create)}}class as{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?function Nk(n,e){return n.replace(Pk,(t,i)=>{const r=e[i];return null!=r?String(r):`<${i}?>`})}(s,i):"Error";return new Jt(r,`${this.serviceName}: ${o} (${r}).`,i)}}const Pk=/\{\$([^}]+)}/g;function cs(n){return JSON.parse(n)}function Le(n){return JSON.stringify(n)}const Ia=function(n){let e={},t={},i={},r="";try{const s=n.split(".");e=cs(ya(s[0])||""),t=cs(ya(s[1])||""),r=s[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:r}};function Ot(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function tr(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Ta(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ea(n,e,t){const i={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=e.call(t,n[r],r,n));return i}function wa(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const s=n[r],o=e[r];if(Wy(s)&&Wy(o)){if(!wa(s,o))return!1}else if(s!==o)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function Wy(n){return null!==n&&"object"==typeof n}function nr(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function us(n){const e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function ls(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}class Mk{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if("string"==typeof e)for(let h=0;h<16;h++)i[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)i[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const p=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=4294967295&(p<<1|p>>>31)}let u,d,r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4];for(let h=0;h<80;h++){h<40?h<20?(u=a^s&(o^a),d=1518500249):(u=s^o^a,d=1859775393):h<60?(u=s&o|a&(s|o),d=2400959708):(u=s^o^a,d=3395469782);const p=(r<<5|r>>>27)+u+c+d+i[h]&4294967295;c=a,a=o,o=4294967295&(s<<30|s>>>2),s=r,r=p}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const i=t-this.blockSize;let r=0;const s=this.buf_;let o=this.inbuf_;for(;r<t;){if(0===o)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<t;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}}class Fk{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(void 0===e&&void 0===t&&void 0===i)throw new Error("Missing Observer.");r=function Uk(n,e){if("object"!=typeof n||null===n)return!1;for(const t of e)if(t in n&&"function"==typeof n[t])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:i},void 0===r.next&&(r.next=fl),void 0===r.error&&(r.error=fl),void 0===r.complete&&(r.complete=fl);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){void 0===this.observers||void 0===this.observers[e]||(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function fl(){}const ba=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};function ie(n){return n&&n._delegate?n._delegate:n}class wn{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ii="[DEFAULT]";class $k{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new St;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),r=null!==(t=e?.optional)&&void 0!==t&&t;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function Kk(n){return"EAGER"===n.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:ii})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=ii){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return(0,f.A)(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...t.filter(i=>"_delete"in i).map(i=>i._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=ii){return this.instances.has(e)}getOptions(e=ii){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,o]of this.instancesDeferred.entries())i===this.normalizeInstanceIdentifier(s)&&o.resolve(r);return r}onInit(e,t){var i;const r=this.normalizeInstanceIdentifier(t),s=null!==(i=this.onInitCallbacks.get(r))&&void 0!==i?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===ii?void 0:n),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}var n;return i||null}normalizeInstanceIdentifier(e=ii){return this.component?this.component.multipleInstances?e:ii:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class zk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new $k(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var st=R(8041);let $y,Hy;const Ky=new WeakMap,pl=new WeakMap,zy=new WeakMap,ml=new WeakMap,gl=new WeakMap;let _l={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return pl.get(n);if("objectStoreNames"===e)return n.objectStoreNames||zy.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return bn(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function nC(n){return"function"==typeof n?function tC(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function Xk(){return Hy||(Hy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(n)?function(...e){return n.apply(yl(this),e),bn(Ky.get(this))}:function(...e){return bn(n.apply(yl(this),e))}:function(e,...t){const i=n.call(yl(this),e,...t);return zy.set(i,e.sort?e.sort():[e]),bn(i)}}(n):(n instanceof IDBTransaction&&function Zk(n){if(pl.has(n))return;const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),r()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});pl.set(n,e)}(n),((n,e)=>e.some(t=>n instanceof t))(n,function Yk(){return $y||($y=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(n,_l):n)}function bn(n){if(n instanceof IDBRequest)return function Jk(n){const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(bn(n.result)),r()},o=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Ky.set(t,n)}).catch(()=>{}),gl.set(e,n),e}(n);if(ml.has(n))return ml.get(n);const e=nC(n);return e!==n&&(ml.set(n,e),gl.set(e,n)),e}const yl=n=>gl.get(n),rC=["get","getKey","getAll","getAllKeys","count"],sC=["put","add","delete","clear"],vl=new Map;function Qy(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(vl.get(e))return vl.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,r=sC.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!rC.includes(t))return;const s=function(){var o=(0,f.A)(function*(a,...c){const u=this.transaction(a,r?"readwrite":"readonly");let d=u.store;return i&&(d=d.index(c.shift())),(yield Promise.all([d[t](...c),r&&u.done]))[0]});return function(c){return o.apply(this,arguments)}}();return vl.set(e,s),s}!function eC(n){_l=n(_l)}(n=>({...n,get:(e,t,i)=>Qy(e,t)||n.get(e,t,i),has:(e,t)=>!!Qy(e,t)||n.has(e,t)}));class oC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function aC(n){const e=n.getComponent();return"VERSION"===e?.type}(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}return null}).filter(t=>t).join(" ")}}const Il="@firebase/app",ri=new st.Vy("@firebase/app"),cC="@firebase/app-compat",uC="@firebase/analytics-compat",lC="@firebase/analytics",dC="@firebase/app-check-compat",hC="@firebase/app-check",fC="@firebase/auth",pC="@firebase/auth-compat",mC="@firebase/database",gC="@firebase/database-compat",_C="@firebase/functions",yC="@firebase/functions-compat",vC="@firebase/installations",IC="@firebase/installations-compat",TC="@firebase/messaging",EC="@firebase/messaging-compat",wC="@firebase/performance",bC="@firebase/performance-compat",AC="@firebase/remote-config",xC="@firebase/remote-config-compat",kC="@firebase/storage",CC="@firebase/storage-compat",SC="@firebase/firestore",RC="@firebase/firestore-compat",NC="firebase",Aa="[DEFAULT]",DC={[Il]:"fire-core",[cC]:"fire-core-compat",[lC]:"fire-analytics",[uC]:"fire-analytics-compat",[hC]:"fire-app-check",[dC]:"fire-app-check-compat",[fC]:"fire-auth",[pC]:"fire-auth-compat",[mC]:"fire-rtdb",[gC]:"fire-rtdb-compat",[_C]:"fire-fn",[yC]:"fire-fn-compat",[vC]:"fire-iid",[IC]:"fire-iid-compat",[TC]:"fire-fcm",[EC]:"fire-fcm-compat",[wC]:"fire-perf",[bC]:"fire-perf-compat",[AC]:"fire-rc",[xC]:"fire-rc-compat",[kC]:"fire-gcs",[CC]:"fire-gcs-compat",[SC]:"fire-fst",[RC]:"fire-fst-compat","fire-js":"fire-js",[NC]:"fire-js-all"},si=new Map,xa=new Map;function OC(n,e){try{n.container.addComponent(e)}catch(t){ri.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function oi(n){const e=n.name;if(xa.has(e))return ri.debug(`There were multiple attempts to register component ${e}.`),!1;xa.set(e,n);for(const t of si.values())OC(t,n);return!0}function ds(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}const en=new as("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class LC{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new wn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw en.create("app-deleted",{appName:this._name})}}const ir="9.17.1";function Tl(n=Aa){const e=si.get(n);if(!e&&n===Aa)return function FC(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:Aa,automaticDataCollectionEnabled:!1},e),r=i.name;if("string"!=typeof r||!r)throw en.create("bad-app-name",{appName:String(r)});if(t||(t=(()=>{var n;return null===(n=va())||void 0===n?void 0:n.config})()),!t)throw en.create("no-options");const s=si.get(r);if(s){if(wa(t,s.options)&&wa(i,s.config))return s;throw en.create("duplicate-app",{appName:r})}const o=new zk(r);for(const c of xa.values())o.addComponent(c);const a=new LC(t,i,o);return si.set(r,a),a}();if(!e)throw en.create("no-app",{appName:n});return e}function Mt(n,e,t){var i;let r=null!==(i=DC[n])&&void 0!==i?i:n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];return s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void ri.warn(a.join(" "))}oi(new wn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const hs="firebase-heartbeat-store";let wl=null;function Xy(){return wl||(wl=function iC(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(n,e),a=bn(o);return i&&o.addEventListener("upgradeneeded",c=>{i(bn(o.result),c.oldVersion,c.newVersion,bn(o.transaction))}),t&&o.addEventListener("blocked",()=>t()),a.then(c=>{s&&c.addEventListener("close",()=>s()),r&&c.addEventListener("versionchange",()=>r())}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(n,e)=>{0===e&&n.createObjectStore(hs)}}).catch(n=>{throw en.create("idb-open",{originalErrorMessage:n.message})})),wl}function bl(){return(bl=(0,f.A)(function*(n){try{return(yield Xy()).transaction(hs).objectStore(hs).get(Zy(n))}catch(e){if(e instanceof Jt)ri.warn(e.message);else{const t=en.create("idb-get",{originalErrorMessage:e?.message});ri.warn(t.message)}}})).apply(this,arguments)}function Jy(n,e){return Al.apply(this,arguments)}function Al(){return(Al=(0,f.A)(function*(n,e){try{const i=(yield Xy()).transaction(hs,"readwrite");return yield i.objectStore(hs).put(e,Zy(n)),i.done}catch(t){if(t instanceof Jt)ri.warn(t.message);else{const i=en.create("idb-set",{originalErrorMessage:t?.message});ri.warn(i.message)}}})).apply(this,arguments)}function Zy(n){return`${n.name}!${n.options.appId}`}class jC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $C(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){var e=this;return(0,f.A)(function*(){const i=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ev();if(null===e._heartbeatsCache&&(e._heartbeatsCache=yield e._heartbeatsCachePromise),e._heartbeatsCache.lastSentHeartbeatDate!==r&&!e._heartbeatsCache.heartbeats.some(s=>s.date===r))return e._heartbeatsCache.heartbeats.push({date:r,agent:i}),e._heartbeatsCache.heartbeats=e._heartbeatsCache.heartbeats.filter(s=>{const o=new Date(s.date).valueOf();return Date.now()-o<=2592e6}),e._storage.overwrite(e._heartbeatsCache)})()}getHeartbeatsHeader(){var e=this;return(0,f.A)(function*(){if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null===e._heartbeatsCache||0===e._heartbeatsCache.heartbeats.length)return"";const t=ev(),{heartbeatsToSend:i,unsentEntries:r}=function WC(n,e=1024){const t=[];let i=n.slice();for(const r of n){const s=t.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),tv(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),tv(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}(e._heartbeatsCache.heartbeats),s=_a(JSON.stringify({version:2,heartbeats:i}));return e._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(e._heartbeatsCache.heartbeats=r,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),s})()}}function ev(){return(new Date).toISOString().substring(0,10)}class $C{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,f.A)(function*(){return!!jy()&&function Sk(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e((null===(s=r.error)||void 0===s?void 0:s.message)||"")}}catch(t){e(t)}})}().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return(0,f.A)(function*(){return(yield e._canUseIndexedDBPromise)&&(yield function GC(n){return bl.apply(this,arguments)}(e.app))||{heartbeats:[]}})()}overwrite(e){var t=this;return(0,f.A)(function*(){var i;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return Jy(t.app,{lastSentHeartbeatDate:null!==(i=e.lastSentHeartbeatDate)&&void 0!==i?i:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return(0,f.A)(function*(){var i;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return Jy(t.app,{lastSentHeartbeatDate:null!==(i=e.lastSentHeartbeatDate)&&void 0!==i?i:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})()}}function tv(n){return _a(JSON.stringify({version:2,heartbeats:n})).length}!function HC(n){oi(new wn("platform-logger",e=>new oC(e),"PRIVATE")),oi(new wn("heartbeat",e=>new jC(e),"PRIVATE")),Mt(Il,"0.9.3",n),Mt(Il,"0.9.3","esm2017"),Mt("fire-js","")}("");const nv="@firebase/database";let xl="";class zC{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Le(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:cs(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class QC{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ot(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const rv=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new zC(e)}}catch{}return new QC},ai=rv("localStorage"),kl=rv("sessionStorage"),rr=new st.Vy("@firebase/database"),sv=function(){let n=1;return function(){return n++}}(),ov=function(n){const e=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);if(r>=55296&&r<=56319){const s=r-55296;i++,b(i<n.length,"Surrogate pair missing trail surrogate."),r=65536+(s<<10)+(n.charCodeAt(i)-56320)}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=63&r|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=63&r|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=63&r|128)}return e}(n),t=new Mk;t.update(e);const i=t.digest();return dl.encodeByteArray(i)},fs=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?e+=fs.apply(null,i):e+="object"==typeof i?Le(i):i,e+=" "}return e};let ci=null,av=!0;const Be=function(...n){if(!0===av&&(av=!1,null===ci&&!0===kl.get("logging_enabled")&&function(n,e){b(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(rr.logLevel=st.$b.VERBOSE,ci=rr.log.bind(rr),e&&kl.set("logging_enabled",!0)):"function"==typeof n?ci=n:(ci=null,kl.remove("logging_enabled"))}(!0)),ci){const e=fs.apply(null,n);ci(e)}},ps=function(n){return function(...e){Be(n,...e)}},Cl=function(...n){const e="FIREBASE INTERNAL ERROR: "+fs(...n);rr.error(e)},Lt=function(...n){const e=`FIREBASE FATAL ERROR: ${fs(...n)}`;throw rr.error(e),new Error(e)},tt=function(...n){const e="FIREBASE WARNING: "+fs(...n);rr.warn(e)},ka=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},An="[MIN_NAME]",tn="[MAX_NAME]",ui=function(n,e){if(n===e)return 0;if(n===An||e===tn)return-1;if(e===An||n===tn)return 1;{const t=dv(n),i=dv(e);return null!==t?null!==i?t-i==0?n.length-e.length:t-i:-1:null!==i?1:n<e?-1:1}},JC=function(n,e){return n===e?0:n<e?-1:1},ms=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Le(e))},Sl=function(n){if("object"!=typeof n||null===n)return Le(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)0!==i&&(t+=","),t+=Le(e[i]),t+=":",t+=Sl(n[e[i]]);return t+="}",t},uv=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let r=0;r<t;r+=e)i.push(n.substring(r,r+e>t?t:r+e));return i};function qe(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const lv=function(n){b(!ka(n),"Invalid JSON number");const i=1023;let r,s,o,a,c;0===n?(s=0,o=0,r=1/n==-1/0?1:0):(r=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,52-a)-Math.pow(2,52))):(s=0,o=Math.round(n/Math.pow(2,-1074))));const u=[];for(c=52;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=11;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(r?1:0),u.reverse();const d=u.join("");let h="";for(c=0;c<64;c+=8){let p=parseInt(d.substr(c,8),2).toString(16);1===p.length&&(p="0"+p),h+=p}return h.toLowerCase()},nS=new RegExp("^-?(0*)\\d{1,10}$"),dv=function(n){if(nS.test(n)){const e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},sr=function(n){try{n()}catch(e){setTimeout(()=>{throw tt("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},gs=function(n,e){const t=setTimeout(n,e);return"number"==typeof t&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class oS{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){tt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class aS{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(Be("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tt(e)}}let _s=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const gv=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,vv="websocket",Iv="long_polling";class Nl{constructor(e,t,i,r,s=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ai.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ai.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Tv(n,e,t){let i;if(b("string"==typeof e,"typeof type must == string"),b("object"==typeof t,"typeof params must == object"),e===vv)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==Iv)throw new Error("Unknown connection type: "+e);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function cS(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const r=[];return qe(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}class uS{constructor(){this.counters_={}}incrementCounter(e,t=1){Ot(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return yk(this.counters_)}}const Pl={},Dl={};function Ol(n){const e=n.toString();return Pl[e]||(Pl[e]=new uS),Pl[e]}class dS{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&sr(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class xn{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ps(e),this.stats_=Ol(t),this.urlFn=c=>(this.appCheckToken&&(c.ac=this.appCheckToken),Tv(t,Iv,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new dS(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if("complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ml((...s)=>{const[o,a,c,u,d]=s;if(this.incrementIncomingBytes_(s),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===o)this.id=a,this.password=c;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&gv.test(location.hostname)&&(i.r="f");const r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){xn.forceAllow_=!0}static forceDisallow(){xn.forceDisallow_=!0}static isAvailable(){return!(!xn.forceAllow_&&(xn.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Le(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Ly(t),r=uv(i,1840);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Le(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ml{constructor(e,t,i,r){this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=sv(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ml.createIFrame_();let s="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Be("frame writing exception"),a.stack&&Be(a.stack),Be(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Be("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const o=this.pendingSegs.shift();i=i+"&seg"+r+"="+o.seg+"&ts"+r+"="+o.ts+"&d"+r+"="+o.d,r++}return t+=i,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),i()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const r=i.readyState;(!r||"loaded"===r||"complete"===r)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Be("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let Sa=null;typeof MozWebSocket<"u"?Sa=MozWebSocket:typeof WebSocket<"u"&&(Sa=WebSocket);let or=(()=>{class n{constructor(t,i,r,s,o,a,c){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ps(this.connId),this.stats_=Ol(i),this.connURL=n.connectionURL_(i,a,c,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){const a={v:"5"};return typeof location<"u"&&location.hostname&&gv.test(location.hostname)&&(a.r="f"),i&&(a.s=i),r&&(a.ls=r),s&&(a.ac=s),o&&(a.p=o),Tv(t,vv,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ai.set("previous_websocket_failure",!0);try{let r;0,this.mySock=new Sa(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const r=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&null!==Sa&&!n.forceDisallow_}static previouslyFailed(){return ai.isInMemoryStorage||!0===ai.get("previous_websocket_failure")}markConnectionHealthy(){ai.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const r=cs(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(b(null===this.frames,"We already have a frame buffer"),t.length<=6){const i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const r=this.extractFrameCount_(i);null!==r&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();const i=Le(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const r=uv(i,16384);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Cv=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[xn,or]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const i=or&&or.isAvailable();let r=i&&!or.previouslyFailed();if(t.webSocketOnly&&(i||tt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[or];else{const s=this.transports_=[];for(const o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class Mv{constructor(e,t,i,r,s,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ps("c:"+this.id+":"),this.transportManager_=new Cv(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=gs(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=ms("t",e),i=ms("d",e);if("c"===t)this.onSecondaryControl_(i);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=ms("t",e),i=ms("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=ms("t",e);if("d"in e){const i=e.d;if("h"===t){const r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?Cl("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Cl("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&tt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),gs(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gs(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ai.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Lv{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class Fv{constructor(e){this.allowedEvents_=e,this.listeners_={},b(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context))return void r.splice(s,1)}validateEventType_(e){b(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Ra extends Fv{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!hl()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Ra}getInitialEvent(e){return b("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class re{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function ne(){return new re("")}function j(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function kn(n){return n.pieces_.length-n.pieceNum_}function ce(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new re(n.pieces_,e)}function Fl(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function ys(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Gv(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new re(e,0)}function pe(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof re)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new re(t,0)}function W(n){return n.pieceNum_>=n.pieces_.length}function ot(n,e){const t=j(n),i=j(e);if(null===t)return e;if(t===i)return ot(ce(n),ce(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Ul(n,e){if(kn(n)!==kn(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function wt(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(kn(n)>kn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class OS{constructor(e,t){this.errorPrefix_=t,this.parts_=ys(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=ba(this.parts_[i]);Bv(this)}}function Bv(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+li(n))}function li(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class Vl extends Fv{constructor(){let e,t;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new Vl}getInitialEvent(e){return b("visible"===e,"Unknown event type: "+e),[this.visible_]}}const vs=1e3;let Pa,di=(()=>{class n extends Lv{constructor(t,i,r,s,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=ps("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=vs,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Vl.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Ra.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){const s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(Le(o)),b(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();const i=new St,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{const c=a.d;"ok"===a.s?i.resolve(c):i.reject(c)}};return this.outstandingGets_.push(s),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(t,i,r,s){this.initConnection_();const o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),b(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),b(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const c={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){const i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){const i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);const o={p:r};t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,c=>{const u=c.d,d=c.s;n.warnOnListenWarnings_(u,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",c),"ok"!==d&&this.removeListen_(r,s),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,i){if(t&&"object"==typeof t&&Ot(t,"w")){const r=tr(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();tt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(n){const e=Ia(n).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,i=function(n){const t=Ia(n).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{const o=s.s,a=s.d||"error";this.authToken_===t&&("ok"===o?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const i=t.s,r=t.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){const r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),b(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);const o={p:t};s&&(o.q=r,o.t=s),this.sendRequest("n",o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){const o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();const a={p:i,d:r};void 0!==o&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(t){const i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){const i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{"ok"!==r.s&&this.log_("reportStats","Error sending stats: "+r.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Le(t));const i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),"d"===t?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===t?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===t?this.onListenRevoked_(i.p,i.q):"ac"===t?this.onAuthRevoked_(i.s,i.d):"apc"===t?this.onAppCheckRevoked_(i.s,i.d):"sd"===t?this.onSecurityDebugPacket_(i):Cl("Unrecognized action received from server: "+Le(t)+"\nAre you using the latest client?")}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){b(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=vs,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=vs,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=vs),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,f.A)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const i=t.onDataMessage_.bind(t),r=t.onReady_.bind(t),s=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+n.nextConnectionId_++,a=t.lastSessionId;let c=!1,u=null;const d=function(){u?u.close():(c=!0,s())};t.realtime_={close:d,sendRequest:function(m){b(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(m)}};const p=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[m,g]=yield Promise.all([t.authTokenProvider_.getToken(p),t.appCheckTokenProvider_.getToken(p)]);c?Be("getToken() completed but was canceled"):(Be("getToken() completed. Creating connection."),t.authToken_=m&&m.accessToken,t.appCheckToken_=g&&g.token,u=new Mv(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,i,r,s,I=>{tt(I+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(m){t.log_("Failed to get token: "+m),c||(t.repoInfo_.nodeAdmin&&tt(m),d())}}})()}interrupt(t){Be("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Be("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ta(this.interruptReasons_)&&(this.reconnectDelay_=vs,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const i=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;r=i?i.map(o=>Sl(o)).join("$"):"default";const s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){const r=new re(t).toString();let s;if(this.listens.has(r)){const o=this.listens.get(r);s=o.get(i),o.delete(i),0===o.size&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){Be("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){Be("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let i="js";t["sdk."+i+"."+xl.replace(/\./g,"-")]=1,hl()?t["framework.cordova"]=1:qy()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Ra.getInstance().currentlyOnline();return Ta(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class H{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new H(e,t)}}class Na{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new H(An,e),r=new H(An,t);return 0!==this.compare(i,r)}minPost(){return H.MIN}}class Wv extends Na{static get __EMPTY_NODE(){return Pa}static set __EMPTY_NODE(e){Pa=e}compare(e,t){return ui(e.name,t.name)}isDefinedOn(e){throw er("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return H.MIN}maxPost(){return new H(tn,Pa)}makePost(e,t){return b("string"==typeof e,"KeyIndex indexValue must always be a string."),new H(e,Pa)}toString(){return".key"}}const Ft=new Wv;class Da{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let Bl,Rt=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??lt.EMPTY_NODE,this.right=o??lt.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this;const o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,i,r),null):0===o?s.copy(null,i,null,null,null):s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return lt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),0===i(t,r.key)){if(r.right.isEmpty())return lt.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class lt{constructor(e,t=lt.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new lt(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Rt.BLACK,null,null))}remove(e){return new lt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Rt.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(r=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Da(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Da(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Da(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Da(this.root_,null,this.comparator_,!0,e)}}function qS(n,e){return ui(n.name,e.name)}function Gl(n,e){return ui(n,e)}lt.EMPTY_NODE=new class BS{copy(e,t,i,r,s){return this}insert(e,t,i){return new Rt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const $v=function(n){return"number"==typeof n?"number:"+lv(n):"string:"+n},Hv=function(n){if(n.isLeafNode()){const e=n.val();b("string"==typeof e||"number"==typeof e||"object"==typeof e&&Ot(e,".sv"),"Priority must be a string or number.")}else b(n===Bl||n.isEmpty(),"priority of unexpected type.");b(n===Bl||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Kv,zv,Qv,ar=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,b(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Hv(this.priorityNode_)}static set __childrenNodeConstructor(t){Kv=t}static get __childrenNodeConstructor(){return Kv}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return W(t)?this:".priority"===j(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return".priority"===t?this.updatePriority(i):i.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){const r=j(t);return null===r?i:i.isEmpty()&&".priority"!==r?this:(b(".priority"!==r||1===kn(t),".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(ce(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+$v(this.priorityNode_.val())+":");const i=typeof this.value_;t+=i+":",t+="number"===i?lv(this.value_):this.value_,this.lazyHash_=ov(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(b(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return b(s>=0,"Unknown leaf type: "+i),b(o>=0,"Unknown leaf type: "+r),s===o?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){return t===this||!!t.isLeafNode()&&(this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const ue=new class HS extends Na{compare(e,t){const i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return 0===s?ui(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return H.MIN}maxPost(){return new H(tn,new ar("[PRIORITY-POST]",Qv))}makePost(e,t){const i=zv(e);return new H(t,new ar("[PRIORITY-POST]",i))}toString(){return".priority"}},KS=Math.log(2);class zS{constructor(e){this.count=parseInt(Math.log(e+1)/KS,10),this.current_=this.count-1;const r=(()=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Oa=function(n,e,t,i){n.sort(e);const r=function(c,u){const d=u-c;let h,p;if(0===d)return null;if(1===d)return h=n[c],p=t?t(h):h,new Rt(p,h.node,Rt.BLACK,null,null);{const m=parseInt(d/2,10)+c,g=r(c,m),I=r(m+1,u);return h=n[m],p=t?t(h):h,new Rt(p,h.node,Rt.BLACK,g,I)}},a=function(c){let u=null,d=null,h=n.length;const p=function(g,I){const A=h-g,$=h;h-=g;const Z=r(A+1,$),q=n[A],de=t?t(q):q;m(new Rt(de,q.node,I,null,Z))},m=function(g){u?(u.left=g,u=g):(d=g,u=g)};for(let g=0;g<c.count;++g){const I=c.nextBitIsOne(),A=Math.pow(2,c.count-(g+1));I?p(A,Rt.BLACK):(p(A,Rt.BLACK),p(A,Rt.RED))}return d}(new zS(n.length));return new lt(i||e,a)};let ql;const cr={};class nn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return b(cr&&ue,"ChildrenNode.ts has not been loaded"),ql=ql||new nn({".priority":cr},{".priority":ue}),ql}get(e){const t=tr(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof lt?t:null}hasIndex(e){return Ot(this.indexSet_,e.toString())}addIndex(e,t){b(e!==Ft,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let r=!1;const s=t.getIterator(H.Wrap);let a,o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();a=r?Oa(i,e.getCompare()):cr;const c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;const d=Object.assign({},this.indexes_);return d[c]=a,new nn(d,u)}addToIndexes(e,t){const i=Ea(this.indexes_,(r,s)=>{const o=tr(this.indexSet_,s);if(b(o,"Missing index implementation for "+s),r===cr){if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(H.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Oa(a,o.getCompare())}return cr}{const a=t.get(e.name);let c=r;return a&&(c=c.remove(new H(e.name,a))),c.insert(e,e.node)}});return new nn(i,this.indexSet_)}removeFromIndexes(e,t){const i=Ea(this.indexes_,r=>{if(r===cr)return r;{const s=t.get(e.name);return s?r.remove(new H(e.name,s)):r}});return new nn(i,this.indexSet_)}}let Is,V=(()=>{class n{constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Hv(this.priorityNode_),this.children_.isEmpty()&&b(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Is||(Is=new n(new lt(Gl),null,nn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Is}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const i=this.children_.get(t);return null===i?Is:i}}getChild(t){const i=j(t);return null===i?this:this.getImmediateChild(i).getChild(ce(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,i){if(b(i,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(i);{const r=new H(t,i);let s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));const a=s.isEmpty()?Is:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){const r=j(t);if(null===r)return i;{b(".priority"!==j(t)||1===kn(t),".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(ce(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const i={};let r=0,s=0,o=!0;if(this.forEachChild(ue,(a,c)=>{i[a]=c.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){const a=[];for(const c in i)a[c]=i[c];return a}return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+$v(this.getPriority().val())+":"),this.forEachChild(ue,(i,r)=>{const s=r.hash();""!==s&&(t+=":"+i+":"+s)}),this.lazyHash_=""===t?"":ov(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){const s=this.resolveIndex_(r);if(s){const o=s.getPredecessorKey(new H(t,i));return o?o.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const i=this.resolveIndex_(t);if(i){const r=i.minKey();return r&&r.name}return this.children_.minKey()}getFirstChild(t){const i=this.getFirstChildName(t);return i?new H(i,this.children_.get(i)):null}getLastChildName(t){const i=this.resolveIndex_(t);if(i){const r=i.maxKey();return r&&r.name}return this.children_.maxKey()}getLastChild(t){const i=this.getLastChildName(t);return i?new H(i,this.children_.get(i)):null}forEachChild(t,i){const r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){const r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{const s=this.children_.getIteratorFrom(t.name,H.Wrap);let o=s.peek();for(;null!=o&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){const r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{const s=this.children_.getReverseIteratorFrom(t.name,H.Wrap);let o=s.peek();for(;null!=o&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ts?-1:0}withIndex(t){if(t===Ft||this.indexMap_.hasIndex(t))return this;{const i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===Ft||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const i=t;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const r=this.getIterator(ue),s=i.getIterator(ue);let o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return null===o&&null===a}return!1}return!1}}resolveIndex_(t){return t===Ft?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const Ts=new class QS extends V{constructor(){super(new lt(Gl),V.EMPTY_NODE,nn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return V.EMPTY_NODE}isEmpty(){return!1}};function _e(n,e=null){if(null===n)return V.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),b(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new ar(n,_e(e));if(n instanceof Array){let t=V.EMPTY_NODE;return qe(n,(i,r)=>{if(Ot(n,i)&&"."!==i.substring(0,1)){const s=_e(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(_e(e))}{const t=[];let i=!1;if(qe(n,(o,a)=>{if("."!==o.substring(0,1)){const c=_e(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new H(o,c)))}}),0===t.length)return V.EMPTY_NODE;const s=Oa(t,qS,o=>o.name,Gl);if(i){const o=Oa(t,ue.getCompare());return new V(s,_e(e),new nn({".priority":o},{".priority":ue}))}return new V(s,_e(e),nn.Default)}}Object.defineProperties(H,{MIN:{value:new H(An,V.EMPTY_NODE)},MAX:{value:new H(tn,Ts)}}),Wv.__EMPTY_NODE=V.EMPTY_NODE,ar.__childrenNodeConstructor=V,function jS(n){Bl=n}(Ts),function $S(n){Qv=n}(Ts),function WS(n){zv=n}(_e);class jl extends Na{constructor(e){super(),this.indexPath_=e,b(!W(e)&&".priority"!==j(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return 0===s?ui(e.name,t.name):s}makePost(e,t){const i=_e(e),r=V.EMPTY_NODE.updateChild(this.indexPath_,i);return new H(t,r)}maxPost(){const e=V.EMPTY_NODE.updateChild(this.indexPath_,Ts);return new H(tn,e)}toString(){return ys(this.indexPath_,0).join("/")}}const Wl=new class XS extends Na{compare(e,t){const i=e.node.compareTo(t.node);return 0===i?ui(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return H.MIN}maxPost(){return H.MAX}makePost(e,t){const i=_e(e);return new H(t,i)}toString(){return".value"}};function ws(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class Hl{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ue}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return b(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return b(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:An}hasEnd(){return this.endSet_}getIndexEndValue(){return b(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return b(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:tn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return b(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ue}copy(){const e=new Hl;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Xv(n){const e={};if(n.isDefault())return e;let t;if(n.index_===ue?t="$priority":n.index_===Wl?t="$value":n.index_===Ft?t="$key":(b(n.index_ instanceof jl,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Le(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=Le(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+Le(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=Le(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+Le(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Jv(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==ue&&(e.i=n.index_.toString()),e}class La extends Lv{constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=ps("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(b(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,r){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=La.getListenId_(e,i),a={};this.listens_[o]=a;const c=Xv(e._queryParams);this.restRequest_(s+".json",c,(u,d)=>{let h=d;if(404===u&&(h=null,u=null),null===u&&this.onDataUpdate_(s,h,!1,i),tr(this.listens_,o)===a){let p;p=u?401===u?"permission_denied":"rest_error:"+u:"ok",r(p,null)}})}unlisten(e,t){const i=La.getListenId_(e,t);delete this.listens_[i]}get(e){const t=Xv(e._queryParams),i=e._path.toString(),r=new St;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;404===s&&(a=null,s=null),null===s?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+nr(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=cs(a.responseText)}catch{tt("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else 401!==a.status&&404!==a.status&&tt("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class sR{constructor(){this.rootNode_=V.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Fa(){return{value:null,children:new Map}}function lr(n,e,t){if(W(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const i=j(e);n.children.has(i)||n.children.set(i,Fa()),lr(n.children.get(i),e=ce(e),t)}}function Yl(n,e,t){null!==n.value?t(e,n.value):function oR(n,e){n.children.forEach((t,i)=>{e(i,t)})}(n,(i,r)=>{Yl(r,new re(e.toString()+"/"+i),t)})}class aR{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&qe(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}}class lR{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new aR(e);const i=1e4+2e4*Math.random();gs(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;qe(e,(r,s)=>{s>0&&Ot(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),gs(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Ut=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Ut||{});function Zl(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Ua{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Ut.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(W(this.path)){if(null!=this.affectedTree.value)return b(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new re(e));return new Ua(ne(),t,this.revert)}}return b(j(this.path)===e,"operationForChild called for unrelated child."),new Ua(ce(this.path),this.affectedTree,this.revert)}}class hi{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Ut.OVERWRITE}operationForChild(e){return W(this.path)?new hi(this.source,ne(),this.snap.getImmediateChild(e)):new hi(this.source,ce(this.path),this.snap)}}class dr{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Ut.MERGE}operationForChild(e){if(W(this.path)){const t=this.children.subtree(new re(e));return t.isEmpty()?null:t.value?new hi(this.source,ne(),t.value):new dr(this.source,ne(),t)}return b(j(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new dr(this.source,ce(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Cn{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(W(e))return this.isFullyInitialized()&&!this.filtered_;const t=j(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function xs(n,e,t,i,r,s){const o=i.filter(a=>a.type===t);o.sort((a,c)=>function pR(n,e,t){if(null==e.childName||null==t.childName)throw er("Should only compare child_ events.");const i=new H(e.childName,e.snapshotNode),r=new H(t.childName,t.snapshotNode);return n.index_.compare(i,r)}(n,a,c)),o.forEach(a=>{const c=function fR(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,a,s);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function Va(n,e){return{eventCache:n,serverCache:e}}function ks(n,e,t,i){return Va(new Cn(e,t,i),n.serverCache)}function eI(n,e,t,i){return Va(n.eventCache,new Cn(e,t,i))}function Ga(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function fi(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let ed;class le{constructor(e,t=(()=>(ed||(ed=new lt(JC)),ed))()){this.value=e,this.children=t}static fromObject(e){let t=new le(null);return qe(e,(i,r)=>{t=t.set(new re(i),r)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ne(),value:this.value};if(W(e))return null;{const i=j(e),r=this.children.get(i);if(null!==r){const s=r.findRootMostMatchingPathAndValue(ce(e),t);return null!=s?{path:pe(new re(i),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(W(e))return this;{const t=j(e),i=this.children.get(t);return null!==i?i.subtree(ce(e)):new le(null)}}set(e,t){if(W(e))return new le(t,this.children);{const i=j(e),s=(this.children.get(i)||new le(null)).set(ce(e),t),o=this.children.insert(i,s);return new le(this.value,o)}}remove(e){if(W(e))return this.children.isEmpty()?new le(null):new le(null,this.children);{const t=j(e),i=this.children.get(t);if(i){const r=i.remove(ce(e));let s;return s=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&s.isEmpty()?new le(null):new le(this.value,s)}return this}}get(e){if(W(e))return this.value;{const t=j(e),i=this.children.get(t);return i?i.get(ce(e)):null}}setTree(e,t){if(W(e))return t;{const i=j(e),s=(this.children.get(i)||new le(null)).setTree(ce(e),t);let o;return o=s.isEmpty()?this.children.remove(i):this.children.insert(i,s),new le(this.value,o)}}fold(e){return this.fold_(ne(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(pe(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,ne(),t)}findOnPath_(e,t,i){const r=!!this.value&&i(t,this.value);if(r)return r;if(W(e))return null;{const s=j(e),o=this.children.get(s);return o?o.findOnPath_(ce(e),pe(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ne(),t)}foreachOnPath_(e,t,i){if(W(e))return this;{this.value&&i(t,this.value);const r=j(e),s=this.children.get(r);return s?s.foreachOnPath_(ce(e),pe(t,r),i):new le(null)}}foreach(e){this.foreach_(ne(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(pe(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class Nt{constructor(e){this.writeTree_=e}static empty(){return new Nt(new le(null))}}function Cs(n,e,t){if(W(e))return new Nt(new le(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(null!=i){const r=i.path;let s=i.value;const o=ot(r,e);return s=s.updateChild(o,t),new Nt(n.writeTree_.set(r,s))}{const r=new le(t),s=n.writeTree_.setTree(e,r);return new Nt(s)}}}function td(n,e,t){let i=n;return qe(t,(r,s)=>{i=Cs(i,pe(e,r),s)}),i}function tI(n,e){if(W(e))return Nt.empty();{const t=n.writeTree_.setTree(e,new le(null));return new Nt(t)}}function nd(n,e){return null!=pi(n,e)}function pi(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(ot(t.path,e)):null}function nI(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(ue,(i,r)=>{e.push(new H(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{null!=r.value&&e.push(new H(i,r.value))}),e}function Sn(n,e){if(W(e))return n;{const t=pi(n,e);return new Nt(null!=t?new le(t):n.writeTree_.subtree(e))}}function id(n){return n.writeTree_.isEmpty()}function hr(n,e){return iI(ne(),n.writeTree_,e)}function iI(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{".priority"===r?(b(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):t=iI(pe(n,r),s,t)}),!t.getChild(n).isEmpty()&&null!==i&&(t=t.updateChild(pe(n,".priority"),i)),t}}function Ba(n,e){return cI(e,n)}function IR(n,e){if(n.snap)return wt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&wt(pe(n.path,t),e))return!0;return!1}function ER(n){return n.visible}function rI(n,e,t){let i=Nt.empty();for(let r=0;r<n.length;++r){const s=n[r];if(e(s)){const o=s.path;let a;if(s.snap)wt(t,o)?(a=ot(t,o),i=Cs(i,a,s.snap)):wt(o,t)&&(a=ot(o,t),i=Cs(i,ne(),s.snap.getChild(a)));else{if(!s.children)throw er("WriteRecord should have .snap or .children");if(wt(t,o))a=ot(t,o),i=td(i,a,s.children);else if(wt(o,t))if(a=ot(o,t),W(a))i=td(i,ne(),s.children);else{const c=tr(s.children,j(a));if(c){const u=c.getChild(ce(a));i=Cs(i,ne(),u)}}}}}return i}function sI(n,e,t,i,r){if(i||r){const s=Sn(n.visibleWrites,e);return!r&&id(s)?t:r||null!=t||nd(s,ne())?hr(rI(n.allWrites,function(u){return(u.visible||r)&&(!i||!~i.indexOf(u.writeId))&&(wt(u.path,e)||wt(e,u.path))},e),t||V.EMPTY_NODE):null}{const s=pi(n.visibleWrites,e);if(null!=s)return s;{const o=Sn(n.visibleWrites,e);return id(o)?t:null!=t||nd(o,ne())?hr(o,t||V.EMPTY_NODE):null}}}function qa(n,e,t,i){return sI(n.writeTree,n.treePath,e,t,i)}function rd(n,e){return function wR(n,e,t){let i=V.EMPTY_NODE;const r=pi(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(ue,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){const s=Sn(n.visibleWrites,e);return t.forEachChild(ue,(o,a)=>{const c=hr(Sn(s,new re(o)),a);i=i.updateImmediateChild(o,c)}),nI(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}return nI(Sn(n.visibleWrites,e)).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}(n.writeTree,n.treePath,e)}function oI(n,e,t,i){return function bR(n,e,t,i,r){b(i||r,"Either existingEventSnap or existingServerSnap must exist");const s=pe(e,t);if(nd(n.visibleWrites,s))return null;{const o=Sn(n.visibleWrites,s);return id(o)?r.getChild(t):hr(o,r.getChild(t))}}(n.writeTree,n.treePath,e,t,i)}function ja(n,e){return function xR(n,e){return pi(n.visibleWrites,e)}(n.writeTree,pe(n.treePath,e))}function sd(n,e,t){return function AR(n,e,t,i){const r=pe(e,t),s=pi(n.visibleWrites,r);return null!=s?s:i.isCompleteForChild(t)?hr(Sn(n.visibleWrites,r),i.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function aI(n,e){return cI(pe(n.treePath,e),n.writeTree)}function cI(n,e){return{treePath:n,writeTree:e}}class RR{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;b("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),b(".priority"!==i,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(i);if(r){const s=r.type;if("child_added"===t&&"child_removed"===s)this.changeMap.set(i,ws(i,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===s)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===s)this.changeMap.set(i,function Es(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}(i,r.oldSnap));else if("child_changed"===t&&"child_added"===s)this.changeMap.set(i,function ur(n,e){return{type:"child_added",snapshotNode:e,childName:n}}(i,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==s)throw er("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(i,ws(i,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}const uI=new class NR{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}};class od{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=null!=this.optCompleteServerCache_?new Cn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return sd(this.writes_,e,i)}}getChildAfterChild(e,t,i){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:fi(this.viewCache_),s=function SR(n,e,t,i,r,s){return function kR(n,e,t,i,r,s,o){let a;const c=Sn(n.visibleWrites,e),u=pi(c,ne());if(null!=u)a=u;else{if(null==t)return[];a=hr(c,t)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const d=[],h=o.getCompare(),p=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let m=p.getNext();for(;m&&d.length<r;)0!==h(m,i)&&d.push(m),m=p.getNext();return d}}(n.writeTree,n.treePath,e,t,i,r,s)}(this.writes_,r,t,1,i,e);return 0===s.length?null:s[0]}}function lI(n,e,t,i,r,s){const o=e.eventCache;if(null!=ja(i,t))return e;{let a,c;if(W(t))if(b(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=fi(e),h=rd(i,u instanceof V?u:V.EMPTY_NODE);a=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{const u=qa(i,fi(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{const u=j(t);if(".priority"===u){b(1===kn(t),"Can't have a priority with additional path components");const d=o.getNode();c=e.serverCache.getNode();const h=oI(i,t,d,c);a=null!=h?n.filter.updatePriority(d,h):o.getNode()}else{const d=ce(t);let h;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const p=oI(i,t,o.getNode(),c);h=null!=p?o.getNode().getImmediateChild(u).updateChild(d,p):o.getNode().getImmediateChild(u)}else h=sd(i,u,e.serverCache);a=null!=h?n.filter.updateChild(o.getNode(),u,h,d,r,s):o.getNode()}}return ks(e,a,o.isFullyInitialized()||W(t),n.filter.filtersNodes())}}function Wa(n,e,t,i,r,s,o,a){const c=e.serverCache;let u;const d=o?n.filter:n.filter.getIndexedFilter();if(W(t))u=d.updateFullNode(c.getNode(),i,null);else if(d.filtersNodes()&&!c.isFiltered()){const m=c.getNode().updateChild(t,i);u=d.updateFullNode(c.getNode(),m,null)}else{const m=j(t);if(!c.isCompleteForPath(t)&&kn(t)>1)return e;const g=ce(t),A=c.getNode().getImmediateChild(m).updateChild(g,i);u=".priority"===m?d.updatePriority(c.getNode(),A):d.updateChild(c.getNode(),m,A,g,uI,null)}const h=eI(e,u,c.isFullyInitialized()||W(t),d.filtersNodes());return lI(n,h,t,r,new od(r,h,s),a)}function ad(n,e,t,i,r,s,o){const a=e.eventCache;let c,u;const d=new od(r,e,s);if(W(t))u=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=ks(e,u,!0,n.filter.filtersNodes());else{const h=j(t);if(".priority"===h)u=n.filter.updatePriority(e.eventCache.getNode(),i),c=ks(e,u,a.isFullyInitialized(),a.isFiltered());else{const p=ce(t),m=a.getNode().getImmediateChild(h);let g;if(W(p))g=i;else{const I=d.getCompleteChild(h);g=null!=I?".priority"===Fl(p)&&I.getChild(Gv(p)).isEmpty()?I:I.updateChild(p,i):V.EMPTY_NODE}c=m.equals(g)?e:ks(e,n.filter.updateChild(a.getNode(),h,g,p,d,o),a.isFullyInitialized(),n.filter.filtersNodes())}}return c}function dI(n,e){return n.eventCache.isCompleteForChild(e)}function hI(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function cd(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u,c=e;u=W(t)?i:new le(null).setTree(t,i);const d=e.serverCache.getNode();return u.children.inorderTraversal((h,p)=>{if(d.hasChild(h)){const g=hI(0,e.serverCache.getNode().getImmediateChild(h),p);c=Wa(n,c,new re(h),g,r,s,o,a)}}),u.children.inorderTraversal((h,p)=>{const m=!e.serverCache.isCompleteForChild(h)&&null===p.value;if(!d.hasChild(h)&&!m){const I=hI(0,e.serverCache.getNode().getImmediateChild(h),p);c=Wa(n,c,new re(h),I,r,s,o,a)}}),c}function jR(n,e){const t=fi(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!W(e)&&!t.getImmediateChild(j(e)).isEmpty())?t.getChild(e):null}function mI(n,e,t,i){e.type===Ut.MERGE&&null!==e.source.queryId&&(b(fi(n.viewCache_),"We should always have a full cache before handling merges"),b(Ga(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,s=function OR(n,e,t,i,r){const s=new RR;let o,a;if(t.type===Ut.OVERWRITE){const u=t;u.source.fromUser?o=ad(n,e,u.path,u.snap,i,r,s):(b(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!W(u.path),o=Wa(n,e,u.path,u.snap,i,r,a,s))}else if(t.type===Ut.MERGE){const u=t;u.source.fromUser?o=function LR(n,e,t,i,r,s,o){let a=e;return i.foreach((c,u)=>{const d=pe(t,c);dI(e,j(d))&&(a=ad(n,a,d,u,r,s,o))}),i.foreach((c,u)=>{const d=pe(t,c);dI(e,j(d))||(a=ad(n,a,d,u,r,s,o))}),a}(n,e,u.path,u.children,i,r,s):(b(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=cd(n,e,u.path,u.children,i,r,a,s))}else if(t.type===Ut.ACK_USER_WRITE){const u=t;o=u.revert?function VR(n,e,t,i,r,s){let o;if(null!=ja(i,t))return e;{const a=new od(i,e,r),c=e.eventCache.getNode();let u;if(W(t)||".priority"===j(t)){let d;if(e.serverCache.isFullyInitialized())d=qa(i,fi(e));else{const h=e.serverCache.getNode();b(h instanceof V,"serverChildren would be complete if leaf node"),d=rd(i,h)}u=n.filter.updateFullNode(c,d,s)}else{const d=j(t);let h=sd(i,d,e.serverCache);null==h&&e.serverCache.isCompleteForChild(d)&&(h=c.getImmediateChild(d)),u=null!=h?n.filter.updateChild(c,d,h,ce(t),a,s):e.eventCache.getNode().hasChild(d)?n.filter.updateChild(c,d,V.EMPTY_NODE,ce(t),a,s):c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=qa(i,fi(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||null!=ja(i,ne()),ks(e,u,o,n.filter.filtersNodes())}}(n,e,u.path,i,r,s):function FR(n,e,t,i,r,s,o){if(null!=ja(r,t))return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(null!=i.value){if(W(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Wa(n,e,t,c.getNode().getChild(t),r,s,a,o);if(W(t)){let u=new le(null);return c.getNode().forEachChild(Ft,(d,h)=>{u=u.set(new re(d),h)}),cd(n,e,t,u,r,s,a,o)}return e}{let u=new le(null);return i.foreach((d,h)=>{const p=pe(t,d);c.isCompleteForPath(p)&&(u=u.set(d,c.getNode().getChild(p)))}),cd(n,e,t,u,r,s,a,o)}}(n,e,u.path,u.affectedTree,i,r,s)}else{if(t.type!==Ut.LISTEN_COMPLETE)throw er("Unknown operation type: "+t.type);o=function UR(n,e,t,i,r){const s=e.serverCache;return lI(n,eI(e,s.getNode(),s.isFullyInitialized()||W(t),s.isFiltered()),t,i,uI,r)}(n,e,t.path,i,s)}const c=s.getChanges();return function MR(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Ga(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(function Yv(n){return{type:"value",snapshotNode:n}}(Ga(e)))}}(e,o,c),{viewCache:o,changes:c}}(n.processor_,r,e,t,i);return function DR(n,e){b(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),b(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,s.viewCache),b(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,function gI(n,e,t,i){return function hR(n,e,t,i){const r=[],s=[];return e.forEach(o=>{"child_changed"===o.type&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(function JS(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(o.childName,o.snapshotNode))}),xs(n,r,"child_removed",e,i,t),xs(n,r,"child_added",e,i,t),xs(n,r,"child_moved",s,i,t),xs(n,r,"child_changed",e,i,t),xs(n,r,"value",e,i,t),r}(n.eventGenerator_,e,t,i?[i]:n.eventRegistrations_)}(n,s.changes,s.viewCache.eventCache.getNode(),null)}let $a,Ka;function ud(n,e,t,i){const r=e.source.queryId;if(null!==r){const s=n.views.get(r);return b(null!=s,"SyncTree gave us an op for an invalid query."),mI(s,e,t,i)}{let s=[];for(const o of n.views.values())s=s.concat(mI(o,e,t,i));return s}}function Rn(n,e){let t=null;for(const i of n.views.values())t=t||jR(i,e);return t}class EI{constructor(e){this.listenProvider_=e,this.syncPointTree_=new le(null),this.pendingWriteTree_=function CR(){return{visibleWrites:Nt.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ld(n,e,t,i,r){return function gR(n,e,t,i,r){b(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=Cs(n.visibleWrites,e,t)),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i,r),r?fr(n,new hi({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function Pn(n,e,t=!1){const i=function yR(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}(n.pendingWriteTree_,e);if(function vR(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);b(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&IR(a,i.path)?r=!1:wt(i.path,a.path)&&(s=!0)),o--}return!!r&&(s?(function TR(n){n.visibleWrites=rI(n.allWrites,ER,ne()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=tI(n.visibleWrites,i.path):qe(i.children,c=>{n.visibleWrites=tI(n.visibleWrites,pe(i.path,c))}),!0))}(n.pendingWriteTree_,e)){let s=new le(null);return null!=i.snap?s=s.set(ne(),!0):qe(i.children,o=>{s=s.set(new re(o),!0)}),fr(n,new Ua(i.path,s,t))}return[]}function Ss(n,e,t){return fr(n,new hi({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function Qa(n,e,t){const r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{const u=Rn(a,ot(o,e));if(u)return u});return sI(r,e,s,t,!0)}function fr(n,e){return bI(e,n.syncPointTree_,null,Ba(n.pendingWriteTree_,ne()))}function bI(n,e,t,i){if(W(n.path))return AI(n,e,t,i);{const r=e.get(ne());null==t&&null!=r&&(t=Rn(r,ne()));let s=[];const o=j(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const u=t?t.getImmediateChild(o):null,d=aI(i,o);s=s.concat(bI(a,c,u,d))}return r&&(s=s.concat(ud(r,n,i,t))),s}}function AI(n,e,t,i){const r=e.get(ne());null==t&&null!=r&&(t=Rn(r,ne()));let s=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,u=aI(i,o),d=n.operationForChild(o);d&&(s=s.concat(AI(d,a,c,u)))}),r&&(s=s.concat(ud(r,n,i,t))),s}function hd(n,e){return n.tagToQueryMap.get(e)}function fd(n){const e=n.indexOf("$");return b(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new re(n.substr(0,e))}}function pd(n,e,t){const i=n.syncPointTree_.get(e);return b(i,"Missing sync point for query tag that we're tracking"),ud(i,t,Ba(n.pendingWriteTree_,e),null)}class md{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new md(t)}node(){return this.node_}}class gd{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=pe(this.path_,e);return new gd(this.syncTree_,t)}node(){return Qa(this.syncTree_,this.path_)}}const kI=function(n,e,t){return n&&"object"==typeof n?(b(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?dN(n[".sv"],e,t):"object"==typeof n[".sv"]?hN(n[".sv"],e):void b(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},dN=function(n,e,t){if("timestamp"===n)return t.timestamp;b(!1,"Unexpected server value: "+n)},hN=function(n,e,t){n.hasOwnProperty("increment")||b(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&b(!1,"Unexpected increment value: "+i);const r=e.node();if(b(null!==r&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return"number"!=typeof o?i:o+i},_d=function(n,e,t){return yd(n,new md(e),t)};function yd(n,e,t){const i=n.getPriority().val(),r=kI(i,e.getImmediateChild(".priority"),t);let s;if(n.isLeafNode()){const o=n,a=kI(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new ar(a,_e(r)):n}{const o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new ar(r))),o.forEachChild(ue,(a,c)=>{const u=yd(c,e.getImmediateChild(a),t);u!==c&&(s=s.updateImmediateChild(a,u))}),s}}class vd{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function Xa(n,e){let t=e instanceof re?e:new re(e),i=n,r=j(t);for(;null!==r;){const s=tr(i.node.children,r)||{children:{},childCount:0};i=new vd(r,i,s),t=ce(t),r=j(t)}return i}function mi(n){return n.node.value}function Id(n,e){n.node.value=e,Td(n)}function SI(n){return n.node.childCount>0}function Ja(n,e){qe(n.node.children,(t,i)=>{e(new vd(t,n,i))})}function RI(n,e,t,i){t&&!i&&e(n),Ja(n,r=>{RI(r,e,!0,i)}),t&&i&&e(n)}function Ps(n){return new re(null===n.parent?n.name:Ps(n.parent)+"/"+n.name)}function Td(n){null!==n.parent&&function mN(n,e,t){const i=function fN(n){return void 0===mi(n)&&!SI(n)}(t),r=Ot(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,Td(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,Td(n))}(n.parent,n.name,n)}const gN=/[\[\].#$\/\u0000-\u001F\u007F]/,_N=/[\[\].#$\u0000-\u001F\u007F]/,Ed=10485760,Za=function(n){return"string"==typeof n&&0!==n.length&&!gN.test(n)},Os=function(n,e,t){const i=t instanceof re?new OS(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+li(i));if("function"==typeof e)throw new Error(n+"contains a function "+li(i)+" with contents = "+e.toString());if(ka(e))throw new Error(n+"contains "+e.toString()+" "+li(i));if("string"==typeof e&&e.length>Ed/3&&ba(e)>Ed)throw new Error(n+"contains a string greater than "+Ed+" utf8 bytes "+li(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let r=!1,s=!1;if(qe(e,(o,a)=>{if(".value"===o)r=!0;else if(".priority"!==o&&".sv"!==o&&(s=!0,!Za(o)))throw new Error(n+" contains an invalid key ("+o+") "+li(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function MS(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=ba(e),Bv(n)})(i,o),Os(n,a,i),function LS(n){const e=n.parts_.pop();n.byteLength_-=ba(e),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),r&&s)throw new Error(n+' contains ".value" child '+li(i)+" in addition to actual children.")}},DI=function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Za(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),function(n){return"string"==typeof n&&0!==n.length&&!_N.test(n)}(n)}(t))throw new Error(function Zt(n,e){return`${n} failed: ${e} argument `}(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class TN{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function _t(n,e,t){(function ec(n,e){let t=null;for(let i=0;i<e.length;i++){const r=e[i],s=r.getPath();null!==t&&!Ul(s,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)})(n,t),function MI(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const r=n.eventLists_[i];r&&(e(r.path)?(EN(n.eventLists_[i]),n.eventLists_[i]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}(n,i=>wt(i,e)||wt(e,i))}function EN(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const i=t.getEventRunner();ci&&Be("event: "+t.toString()),sr(i)}}}class bN{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new TN,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fa(),this.transactionQueueTree_=new vd,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function FI(n){const t=n.infoData_.getNode(new re(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Ls(n){return function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n}({timestamp:FI(n)})}function UI(n,e,t,i,r){n.dataUpdateCount++;const s=new re(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){const c=Ea(t,u=>_e(u));o=function rN(n,e,t,i){const r=hd(n,i);if(r){const s=fd(r),o=s.path,a=s.queryId,c=ot(o,e),u=le.fromObject(t);return pd(n,o,new dr(Zl(a),c,u))}return[]}(n.serverSyncTree_,s,c,r)}else{const c=_e(t);o=function wI(n,e,t,i){const r=hd(n,i);if(null!=r){const s=fd(r),o=s.path,a=s.queryId,c=ot(o,e);return pd(n,o,new hi(Zl(a),c,t))}return[]}(n.serverSyncTree_,s,c,r)}else if(i){const c=Ea(t,u=>_e(u));o=function tN(n,e,t){const i=le.fromObject(t);return fr(n,new dr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(n.serverSyncTree_,s,c)}else{const c=_e(t);o=Ss(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=mr(n,s)),_t(n.eventQueue_,a,o)}function VI(n,e){Ad(n,"connected",e),!1===e&&function SN(n){pr(n,"onDisconnectEvents");const e=Ls(n),t=Fa();Yl(n.onDisconnect_,ne(),(r,s)=>{const o=function(n,e,t,i){return yd(e,new gd(t,n),i)}(r,s,n.serverSyncTree_,e);lr(t,r,o)});let i=[];Yl(t,ne(),(r,s)=>{i=i.concat(Ss(n.serverSyncTree_,r,s));const o=function Sd(n,e){const t=Ps(qI(n,e)),i=Xa(n.transactionQueueTree_,e);return function pN(n,e,t){let i=t?n:n.parent;for(;null!==i;){if(e(i))return!0;i=i.parent}}(i,r=>{Rd(n,r)}),Rd(n,i),RI(i,r=>{Rd(n,r)}),t}(n,r);mr(n,o)}),n.onDisconnect_=Fa(),_t(n.eventQueue_,ne(),i)}(n)}function Ad(n,e,t){const i=new re("/.info/"+e),r=_e(t);n.infoData_.updateSnapshot(i,r);const s=Ss(n.infoSyncTree_,i,r);_t(n.eventQueue_,i,s)}function tc(n){return n.nextWriteId_++}function pr(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Be(t,...e)}function Cd(n,e,t){return Qa(n.serverSyncTree_,e,t)||V.EMPTY_NODE}function nc(n,e=n.transactionQueueTree_){if(e||ic(n,e),mi(e)){const t=jI(n,e);b(t.length>0,"Sending zero length transaction queue"),t.every(r=>0===r.status)&&function LN(n,e,t){const i=t.map(u=>u.currentWriteId),r=Cd(n,e,i);let s=r;const o=r.hash();for(let u=0;u<t.length;u++){const d=t[u];b(0===d.status,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const h=ot(e,d.path);s=s.updateChild(h,d.currentOutputSnapshotRaw)}const a=s.val(!0),c=e;n.server_.put(c.toString(),a,u=>{pr(n,"transaction put response",{path:c.toString(),status:u});let d=[];if("ok"===u){const h=[];for(let p=0;p<t.length;p++)t[p].status=2,d=d.concat(Pn(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&h.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();ic(n,Xa(n.transactionQueueTree_,e)),nc(n,n.transactionQueueTree_),_t(n.eventQueue_,e,d);for(let p=0;p<h.length;p++)sr(h[p])}else{if("datastale"===u)for(let h=0;h<t.length;h++)t[h].status=3===t[h].status?4:0;else{tt("transaction at "+c.toString()+" failed: "+u);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=u}mr(n,e)}},o)}(n,Ps(e),t)}else SI(e)&&Ja(e,t=>{nc(n,t)})}function mr(n,e){const t=qI(n,e),i=Ps(t);return function FN(n,e,t){if(0===e.length)return;const i=[];let r=[];const o=e.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=ot(t,c.path);let h,d=!1;if(b(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)d=!0,h=c.abortReason,r=r.concat(Pn(n.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=25)d=!0,h="maxretry",r=r.concat(Pn(n.serverSyncTree_,c.currentWriteId,!0));else{const p=Cd(n,c.path,o);c.currentInputSnapshot=p;const m=e[a].update(p.val());if(void 0!==m){Os("transaction failed: Data returned ",m,c.path);let g=_e(m);"object"==typeof m&&null!=m&&Ot(m,".priority")||(g=g.updatePriority(p.getPriority()));const A=c.currentWriteId,$=Ls(n),Z=_d(g,p,$);c.currentOutputSnapshotRaw=g,c.currentOutputSnapshotResolved=Z,c.currentWriteId=tc(n),o.splice(o.indexOf(A),1),r=r.concat(ld(n.serverSyncTree_,c.path,Z,c.currentWriteId,c.applyLocally)),r=r.concat(Pn(n.serverSyncTree_,A,!0))}else d=!0,h="nodata",r=r.concat(Pn(n.serverSyncTree_,c.currentWriteId,!0))}_t(n.eventQueue_,t,r),r=[],d&&(e[a].status=2,setTimeout(e[a].unwatcher,Math.floor(0)),e[a].onComplete&&i.push("nodata"===h?()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot):()=>e[a].onComplete(new Error(h),!1,null)))}ic(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)sr(i[a]);nc(n,n.transactionQueueTree_)}(n,jI(n,t),i),i}function qI(n,e){let t,i=n.transactionQueueTree_;for(t=j(e);null!==t&&void 0===mi(i);)i=Xa(i,t),t=j(e=ce(e));return i}function jI(n,e){const t=[];return WI(n,e,t),t.sort((i,r)=>i.order-r.order),t}function WI(n,e,t){const i=mi(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);Ja(e,r=>{WI(n,r,t)})}function ic(n,e){const t=mi(e);if(t){let i=0;for(let r=0;r<t.length;r++)2!==t[r].status&&(t[i]=t[r],i++);t.length=i,Id(e,t.length>0?t:void 0)}Ja(e,i=>{ic(n,i)})}function Rd(n,e){const t=mi(e);if(t){const i=[];let r=[],s=-1;for(let o=0;o<t.length;o++)3===t[o].status||(1===t[o].status?(b(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(b(0===t[o].status,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Pn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));-1===s?Id(e,void 0):t.length=s+1,_t(n.eventQueue_,Ps(e),r);for(let o=0;o<i.length;o++)sr(i[o])}}const Nd=function(n,e){const t=GN(n),i=t.namespace;return"firebase.com"===t.domain&&Lt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==t.domain&&Lt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&tt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Nl(t.host,t.secure,i,"ws"===t.scheme||"wss"===t.scheme,e,"",i!==t.subdomain),path:new re(t.pathString)}},GN=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if("string"==typeof n){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let d=n.indexOf("/");-1===d&&(d=n.length);let h=n.indexOf("?");-1===h&&(h=n.length),e=n.substring(0,Math.min(d,h)),d<h&&(r=function UN(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}(n.substring(d,h)));const p=function VN(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const i=t.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):tt(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,h)));u=e.indexOf(":"),u>=0?(o="https"===a||"wss"===a,c=parseInt(e.substring(u+1),10)):u=e.length;const m=e.slice(0,u);if("localhost"===m.toLowerCase())t="localhost";else if(m.split(".").length<=2)t=m;else{const g=e.indexOf(".");i=e.substring(0,g).toLowerCase(),t=e.substring(g+1),s=i}"ns"in p&&(s=p.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class yt{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return W(this._path)?null:Fl(this._path)}get ref(){return new Pt(this._repo,this._path)}get _queryIdentifier(){const e=Jv(this._queryParams),t=Sl(e);return"{}"===t?"default":t}get _queryObject(){return Jv(this._queryParams)}isEqual(e){if(!((e=ie(e))instanceof yt))return!1;const t=this._repo===e._repo,i=Ul(this._path,e._path);return t&&i&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function PS(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}class Pt extends yt{constructor(e,t){super(e,t,new Hl,!1)}get parent(){const e=Gv(this._path);return null===e?null:new Pt(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}(function HR(n){b(!$a,"__referenceConstructor has already been defined"),$a=n})(Pt),function XR(n){b(!Ka,"__referenceConstructor has already been defined"),Ka=n}(Pt);const Od={};class s1{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function AN(n,e,t){if(n.stats_=Ol(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new La(n.repoInfo_,(i,r,s,o)=>{UI(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>VI(n,!0),0);else{if(typeof t<"u"&&null!==t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Le(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new di(n.repoInfo_,e,(i,r,s,o)=>{UI(n,i,r,s,o)},i=>{VI(n,i)},i=>{!function xN(n,e){qe(e,(t,i)=>{Ad(n,t,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function lS(n,e){const t=n.toString();return Dl[t]||(Dl[t]=e()),Dl[t]}(n.repoInfo_,()=>new lR(n.stats_,n.server_)),n.infoData_=new sR,n.infoSyncTree_=new EI({startListening:(i,r,s,o)=>{let a=[];const c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=Ss(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Ad(n,"connected",!1),n.serverSyncTree_=new EI({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{const u=o(a,c);_t(n.eventQueue_,i._path,u)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Pt(this._repo,ne())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function n1(n,e){const t=Od[e];(!t||t[n.key]!==n)&&Lt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),function BI(n){n.persistentConnection_&&n.persistentConnection_.interrupt("repo_interrupt")}(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Lt("Cannot call "+e+" on a deleted database.")}}di.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},di.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function c1(n){(function KC(n){xl=n})(ir),oi(new wn("database",(e,{instanceIdentifier:t})=>function t1(n,e,t,i,r){let s=i||n.options.databaseURL;void 0===s&&(n.options.projectId||Lt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Be("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let c,u,o=Nd(s,r),a=o.repoInfo;typeof process<"u"&&process.env&&(u=process.env.FIREBASE_DATABASE_EMULATOR_HOST),u?(c=!0,s=`http://${u}?ns=${a.namespace}`,o=Nd(s,r),a=o.repoInfo):c=!o.repoInfo.secure;const d=r&&c?new _s(_s.OWNER):new aS(n.name,n.options,e);DI("Invalid Firebase Database URL",o),W(o.path)||Lt("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function i1(n,e,t,i){let r=Od[e.name];r||(r={},Od[e.name]=r);let s=r[n.toURLString()];return s&&Lt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new bN(n,!1,t,i),r[n.toURLString()]=s,s}(a,n,d,new oS(n.name,t));return new s1(h,n)}(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),Mt(nv,"0.14.3",n),Mt(nv,"0.14.3","esm2017")}(),R(1985),R(6354);var n0=R(1626);Mt("firebase","9.17.1","app");var D,p1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},rn={},Fd=Fd||{},L=p1||self;function ac(){}function cc(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Gs(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Ud="closure_uid_"+(1e9*Math.random()>>>0),g1=0;function _1(n,e,t){return n.call.apply(n.bind,arguments)}function y1(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function it(n,e,t){return(it=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_1:y1).apply(null,arguments)}function uc(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Qe(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(i,r,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(i,o)}}function Ln(){this.s=this.s,this.o=this.o}Ln.prototype.s=!1,Ln.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function m1(n){Object.prototype.hasOwnProperty.call(n,Ud)&&n[Ud]||(n[Ud]=++g1)}(this)},Ln.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const r0=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Vd(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function s0(n,e){for(let t=1;t<arguments.length;t++){const i=arguments[t];if(cc(i)){const r=n.length||0,s=i.length||0;n.length=r+s;for(let o=0;o<s;o++)n[r+o]=i[o]}else n.push(i)}}function rt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}rt.prototype.h=function(){this.defaultPrevented=!0};var I1=function(){if(!L.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{L.addEventListener("test",ac,e),L.removeEventListener("test",ac,e)}catch{}return n}();function lc(n){return/^[\s\xa0]*$/.test(n)}var o0=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Gd(n,e){return n<e?-1:n>e?1:0}function dc(){var n=L.navigator;return n&&(n=n.userAgent)?n:""}function Bt(n){return-1!=dc().indexOf(n)}function Bd(n){return Bd[" "](n),n}Bd[" "]=ac;var hc,n,E1=Bt("Opera"),_r=Bt("Trident")||Bt("MSIE"),a0=Bt("Edge"),qd=a0||_r,c0=Bt("Gecko")&&!(-1!=dc().toLowerCase().indexOf("webkit")&&!Bt("Edge"))&&!(Bt("Trident")||Bt("MSIE"))&&!Bt("Edge"),w1=-1!=dc().toLowerCase().indexOf("webkit")&&!Bt("Edge");function u0(){var n=L.document;return n?n.documentMode:void 0}e:{var jd="",Wd=(n=dc(),c0?/rv:([^\);]+)(\)|;)/.exec(n):a0?/Edge\/([\d\.]+)/.exec(n):_r?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):w1?/WebKit\/(\S+)/.exec(n):E1?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Wd&&(jd=Wd?Wd[1]:""),_r){var $d=u0();if(null!=$d&&$d>parseFloat(jd)){hc=String($d);break e}}hc=jd}var b1={};var x1=L.document&&_r&&(u0()||parseInt(hc,10))||void 0;function Bs(n,e){if(rt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(c0){e:{try{Bd(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:k1[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Bs.X.h.call(this)}}Qe(Bs,rt);var k1={2:"touch",3:"pen",4:"mouse"};Bs.prototype.h=function(){Bs.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var qs="closure_listenable_"+(1e6*Math.random()|0),C1=0;function S1(n,e,t,i,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.ha=r,this.key=++C1,this.ba=this.ea=!1}function fc(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function Kd(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function d0(n){const e={};for(const t in n)e[t]=n[t];return e}const h0="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function f0(n,e){let t,i;for(let r=1;r<arguments.length;r++){for(t in i=arguments[r],i)n[t]=i[t];for(let s=0;s<h0.length;s++)t=h0[s],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function pc(n){this.src=n,this.g={},this.h=0}function zd(n,e){var t=e.type;if(t in n.g){var s,i=n.g[t],r=r0(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(fc(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Qd(n,e,t,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.ba&&s.listener==e&&s.capture==!!t&&s.ha==i)return r}return-1}pc.prototype.add=function(n,e,t,i,r){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=Qd(n,e,i,r);return-1<o?(e=n[o],t||(e.ea=!1)):((e=new S1(e,this.src,s,!!i,r)).ea=t,n.push(e)),e};var Yd="closure_lm_"+(1e6*Math.random()|0),Xd={};function p0(n,e,t,i,r){if(i&&i.once)return g0(n,e,t,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)p0(n,e[s],t,i,r);return null}return t=th(t),n&&n[qs]?n.N(e,t,Gs(i)?!!i.capture:!!i,r):m0(n,e,t,!1,i,r)}function m0(n,e,t,i,r,s){if(!e)throw Error("Invalid event type");var o=Gs(r)?!!r.capture:!!r,a=Zd(n);if(a||(n[Yd]=a=new pc(n)),(t=a.add(e,t,i,o,s)).proxy)return t;if(i=function R1(){const e=N1;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)I1||(r=o),void 0===r&&(r=!1),n.addEventListener(e.toString(),i,r);else if(n.attachEvent)n.attachEvent(y0(e.toString()),i);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(i)}return t}function g0(n,e,t,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)g0(n,e[s],t,i,r);return null}return t=th(t),n&&n[qs]?n.O(e,t,Gs(i)?!!i.capture:!!i,r):m0(n,e,t,!0,i,r)}function _0(n,e,t,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)_0(n,e[s],t,i,r);else i=Gs(i)?!!i.capture:!!i,t=th(t),n&&n[qs]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Qd(s=n.g[e],t,i,r))&&(fc(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Zd(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Qd(e,t,i,r)),(t=-1<n?e[n]:null)&&Jd(t))}function Jd(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[qs])zd(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(y0(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=Zd(e))?(zd(t,n),0==t.h&&(t.src=null,e[Yd]=null)):fc(n)}}}function y0(n){return n in Xd?Xd[n]:Xd[n]="on"+n}function N1(n,e){if(n.ba)n=!0;else{e=new Bs(e,this);var t=n.listener,i=n.ha||n.src;n.ea&&Jd(n),n=t.call(i,e)}return n}function Zd(n){return(n=n[Yd])instanceof pc?n:null}var eh="__closure_events_fn_"+(1e9*Math.random()>>>0);function th(n){return"function"==typeof n?n:(n[eh]||(n[eh]=function(e){return n.handleEvent(e)}),n[eh])}function je(){Ln.call(this),this.i=new pc(this),this.P=this,this.I=null}function Ye(n,e){var t,i=n.I;if(i)for(t=[];i;i=i.I)t.push(i);if(n=n.P,i=e.type||e,"string"==typeof e)e=new rt(e,n);else if(e instanceof rt)e.target=e.target||n;else{var r=e;f0(e=new rt(i,n),r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];r=mc(o,i,!0,e)&&r}if(r=mc(o=e.g=n,i,!0,e)&&r,r=mc(o,i,!1,e)&&r,t)for(s=0;s<t.length;s++)r=mc(o=e.g=t[s],i,!1,e)&&r}function mc(n,e,t,i){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.ba&&o.capture==t){var a=o.listener,c=o.ha||o.src;o.ea&&zd(n.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}Qe(je,Ln),je.prototype[qs]=!0,je.prototype.removeEventListener=function(n,e,t,i){_0(this,n,e,t,i)},je.prototype.M=function(){if(je.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)fc(t[i]);delete n.g[e],n.h--}}this.I=null},je.prototype.N=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)},je.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};var nh=L.JSON.stringify;function P1(){var n=T0;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var ih,v0=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new O1,n=>n.reset());class O1{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function M1(n){L.setTimeout(()=>{throw n},0)}function I0(n,e){ih||function L1(){var n=L.Promise.resolve(void 0);ih=function(){n.then(F1)}}(),rh||(ih(),rh=!0),T0.add(n,e)}var rh=!1,T0=new class D1{constructor(){this.h=this.g=null}add(e,t){const i=v0.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}};function F1(){for(var n;n=P1();){try{n.h.call(n.g)}catch(t){M1(t)}var e=v0;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}rh=!1}function gc(n,e){je.call(this),this.h=n||1,this.g=e||L,this.j=it(this.lb,this),this.l=Date.now()}function sh(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function oh(n,e,t){if("function"==typeof n)t&&(n=it(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=it(n.handleEvent,n)}return 2147483647<Number(e)?-1:L.setTimeout(n,e||0)}function E0(n){n.g=oh(()=>{n.g=null,n.i&&(n.i=!1,E0(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Qe(gc,je),(D=gc.prototype).ca=!1,D.R=null,D.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Ye(this,"tick"),this.ca&&(sh(this),this.start()))}},D.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},D.M=function(){gc.X.M.call(this),sh(this),delete this.g};class U1 extends Ln{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:E0(this)}M(){super.M(),this.g&&(L.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function js(n){Ln.call(this),this.h=n,this.g={}}Qe(js,Ln);var w0=[];function b0(n,e,t,i){Array.isArray(t)||(t&&(w0[0]=t.toString()),t=w0);for(var r=0;r<t.length;r++){var s=p0(e,t[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function A0(n){Kd(n.g,function(e,t){this.g.hasOwnProperty(t)&&Jd(e)},n),n.g={}}function _c(){this.g=!0}function yr(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function q1(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return nh(t)}catch{return e}}(n,t)+(i?" "+i:"")})}js.prototype.M=function(){js.X.M.call(this),A0(this)},js.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},_c.prototype.Aa=function(){this.g=!1},_c.prototype.info=function(){};var yi={},x0=null;function yc(){return x0=x0||new je}function k0(n){rt.call(this,yi.Pa,n)}function Ws(n){const e=yc();Ye(e,new k0(e))}function C0(n,e){rt.call(this,yi.STAT_EVENT,n),this.stat=e}function at(n){const e=yc();Ye(e,new C0(e,n))}function S0(n,e){rt.call(this,yi.Qa,n),this.size=e}function $s(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return L.setTimeout(function(){n()},e)}yi.Pa="serverreachability",Qe(k0,rt),yi.STAT_EVENT="statevent",Qe(C0,rt),yi.Qa="timingevent",Qe(S0,rt);var vc={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},R0={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function ah(){}function P0(){}ah.prototype.h=null;var lh,Hs={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function ch(){rt.call(this,"d")}function uh(){rt.call(this,"c")}function Ic(){}function Ks(n,e,t,i){this.l=n,this.j=e,this.m=t,this.U=i||1,this.S=new js(this),this.O=j1,this.T=new gc(n=qd?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new D0}function D0(){this.i=null,this.g="",this.h=!1}Qe(ch,rt),Qe(uh,rt),Qe(Ic,ah),Ic.prototype.g=function(){return new XMLHttpRequest},Ic.prototype.i=function(){return{}},lh=new Ic;var j1=45e3,dh={},Tc={};function hh(n,e,t){n.K=1,n.v=Ac(sn(e)),n.s=t,n.P=!0,O0(n,null)}function O0(n,e){n.F=Date.now(),zs(n),n.A=sn(n.v);var t=n.A,i=n.U;Array.isArray(i)||(i=[String(i)]),W0(t.i,"t",i),n.C=0,t=n.l.H,n.h=new D0,n.g=pT(n.l,t?e:null,!n.s),0<n.N&&(n.L=new U1(it(n.La,n,n.g),n.N)),b0(n.S,n.g,"readystatechange",n.ib),e=n.H?d0(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Ws(),function V1(n,e,t,i,r,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var d=u[0];u=u[1];var h=d.split("_");o=2<=h.length&&"type"==h[1]?o+(d+"=")+u+"&":o+(d+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.U,n.s)}function M0(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function L0(n,e,t){let r,i=!0;for(;!n.I&&n.C<t.length;){if(r=W1(n,t),r==Tc){4==e&&(n.o=4,at(14),i=!1),yr(n.j,n.m,null,"[Incomplete Response]");break}if(r==dh){n.o=4,at(15),yr(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}yr(n.j,n.m,r,null),fh(n,r)}M0(n)&&r!=Tc&&r!=dh&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,at(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Th(e),e.K=!0,at(11))):(yr(n.j,n.m,t,"[Invalid Chunked Response]"),vi(n),Qs(n))}function W1(n,e){var t=n.C,i=e.indexOf("\n",t);return-1==i?Tc:(t=Number(e.substring(t,i)),isNaN(t)?dh:(i+=1)+t>e.length?Tc:(e=e.substr(i,t),n.C=i+t,e))}function zs(n){n.V=Date.now()+n.O,F0(n,n.O)}function F0(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=$s(it(n.gb,n),e)}function Ec(n){n.B&&(L.clearTimeout(n.B),n.B=null)}function Qs(n){0==n.l.G||n.I||lT(n.l,n)}function vi(n){Ec(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,sh(n.T),A0(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function fh(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||ph(t.h,n)))if(!n.J&&ph(t.h,n)&&3==t.G){try{var i=t.Fa.g.parse(e)}catch{i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!t.u){if(t.g){if(!(t.g.F+3e3<n.F))break e;Nc(t),Sc(t)}Ih(t),at(18)}}else t.Ba=r[1],0<t.Ba-t.T&&37500>r[2]&&t.L&&0==t.A&&!t.v&&(t.v=$s(it(t.cb,t),6e3));if(1>=K0(t.h)&&t.ja){try{t.ja()}catch{}t.ja=void 0}}else Ti(t,11)}else if((n.J||t.g==n)&&Nc(t),!lc(e))for(r=t.Fa.g.parse(e),e=0;e<r.length;e++){let u=r[e];if(t.T=u[0],u=u[1],2==t.G)if("c"==u[0]){t.I=u[1],t.ka=u[2];const d=u[3];null!=d&&(t.ma=d,t.j.info("VER="+t.ma));const h=u[4];null!=h&&(t.Ca=h,t.j.info("SVER="+t.Ca));const p=u[5];null!=p&&"number"==typeof p&&0<p&&(t.J=i=1.5*p,t.j.info("backChannelRequestTimeoutMs_="+i)),i=t;const m=n.g;if(m){const g=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(g){var s=i.h;s.g||-1==g.indexOf("spdy")&&-1==g.indexOf("quic")&&-1==g.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(mh(s,s.h),s.h=null))}if(i.D){const I=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;I&&(i.za=I,me(i.F,i.D,I))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var o=n;if((i=t).sa=fT(i,i.H?i.ka:null,i.V),o.J){z0(i.h,o);var a=o,c=i.J;c&&a.setTimeout(c),a.B&&(Ec(a),zs(a)),i.g=o}else cT(i);0<t.i.length&&Rc(t)}else"stop"!=u[0]&&"close"!=u[0]||Ti(t,7);else 3==t.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Ti(t,7):vh(t):"noop"!=u[0]&&t.l&&t.l.wa(u),t.A=0)}Ws()}catch{}}function U0(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(cc(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function H1(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(cc(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const i in n)e[t++]=i;return e}}}(n),i=function $1(n){if(n.W&&"function"==typeof n.W)return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(cc(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}for(i in e=[],t=0,n)e[t++]=n[i];return e}(n),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],t&&t[s],n)}(D=Ks.prototype).setTimeout=function(n){this.O=n},D.ib=function(n){n=n.target;const e=this.L;e&&3==on(n)?e.l():this.La(n)},D.La=function(n){try{if(n==this.g)e:{const d=on(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>d)&&(3!=d||qd||this.g&&(this.h.h||this.g.fa()||nT(this.g)))){this.I||4!=d||7==e||Ws(),Ec(this);var t=this.g.aa();this.Y=t;t:if(M0(this)){var i=nT(this.g);n="";var r=i.length,s=4==on(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){vi(this),Qs(this);var o="";break t}this.h.i=new L.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==t,function G1(n,e,t,i,r,s,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.U,d,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!lc(a)){var u=a;break t}}u=null}if(!(t=u)){this.i=!1,this.o=3,at(12),vi(this),Qs(this);break e}yr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,fh(this,t)}this.P?(L0(this,d,o),qd&&this.i&&3==d&&(b0(this.S,this.T,"tick",this.hb),this.T.start())):(yr(this.j,this.m,o,null),fh(this,o)),4==d&&vi(this),this.i&&!this.I&&(4==d?lT(this.l,this):(this.i=!1,zs(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,at(12)):(this.o=0,at(13)),vi(this),Qs(this)}}}catch{}},D.hb=function(){if(this.g){var n=on(this.g),e=this.g.fa();this.C<e.length&&(Ec(this),L0(this,n,e),this.i&&4!=n&&zs(this))}},D.cancel=function(){this.I=!0,vi(this)},D.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function B1(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Ws(),at(17)),vi(this),this.o=2,Qs(this)):F0(this,this.V-n)};var V0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ii(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ii){this.h=void 0!==e?e:n.h,wc(this,n.j),this.s=n.s,this.g=n.g,bc(this,n.m),this.l=n.l,e=n.i;var t=new Js;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),G0(this,t),this.o=n.o}else n&&(t=String(n).match(V0))?(this.h=!!e,wc(this,t[1]||"",!0),this.s=Ys(t[2]||""),this.g=Ys(t[3]||"",!0),bc(this,t[4]),this.l=Ys(t[5]||"",!0),G0(this,t[6]||"",!0),this.o=Ys(t[7]||"")):(this.h=!!e,this.i=new Js(null,this.h))}function sn(n){return new Ii(n)}function wc(n,e,t){n.j=t?Ys(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function bc(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function G0(n,e,t){e instanceof Js?(n.i=e,function Z1(n,e){e&&!n.j&&(Fn(n),n.i=null,n.g.forEach(function(t,i){var r=i.toLowerCase();i!=r&&(q0(this,i),W0(this,r,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Xs(e,X1)),n.i=new Js(e,n.h))}function me(n,e,t){n.i.set(e,t)}function Ac(n){return me(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ys(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Xs(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,z1),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function z1(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Ii.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Xs(e,B0,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Xs(e,B0,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Xs(t,"/"==t.charAt(0)?Y1:Q1,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Xs(t,J1)),n.join("")};var B0=/[#\/\?@]/g,Q1=/[#\?:]/g,Y1=/[#\?]/g,X1=/[#\?@]/g,J1=/#/g;function Js(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Fn(n){n.g||(n.g=new Map,n.h=0,n.i&&function K1(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),r=null;if(0<=i){var s=n[t].substring(0,i);r=n[t].substring(i+1)}else s=n[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function q0(n,e){Fn(n),e=vr(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function j0(n,e){return Fn(n),e=vr(n,e),n.g.has(e)}function W0(n,e,t){q0(n,e),0<t.length&&(n.i=null,n.g.set(vr(n,e),Vd(t)),n.h+=t.length)}function vr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}(D=Js.prototype).add=function(n,e){Fn(this),this.i=null,n=vr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},D.forEach=function(n,e){Fn(this),this.g.forEach(function(t,i){t.forEach(function(r){n.call(e,r,i,this)},this)},this)},D.oa=function(){Fn(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){const r=n[i];for(let s=0;s<r.length;s++)t.push(e[i])}return t},D.W=function(n){Fn(this);let e=[];if("string"==typeof n)j0(this,n)&&(e=e.concat(this.g.get(vr(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},D.set=function(n,e){return Fn(this),this.i=null,j0(this,n=vr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},D.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},D.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];const s=encodeURIComponent(String(i)),o=this.W(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),n.push(r)}}return this.i=n.join("&")};var eP=class{constructor(n,e){this.h=n,this.g=e}};function $0(n){this.l=n||tP,n=L.PerformanceNavigationTiming?0<(n=L.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(L.g&&L.g.Ga&&L.g.Ga()&&L.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tP=10;function H0(n){return!!n.h||!!n.g&&n.g.size>=n.j}function K0(n){return n.h?1:n.g?n.g.size:0}function ph(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function mh(n,e){n.g?n.g.add(e):n.h=e}function z0(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Q0(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return Vd(n.i)}function gh(){}function nP(){this.g=new gh}function iP(n,e,t){const i=t||"";try{U0(n,function(r,s){let o=r;Gs(r)&&(o=nh(r)),e.push(i+s+"="+encodeURIComponent(o))})}catch(r){throw e.push(i+"type="+encodeURIComponent("_badmap")),r}}function xc(n,e,t,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch{}}function Zs(n){this.l=n.ac||null,this.j=n.jb||!1}function kc(n,e){je.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=_h,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}$0.prototype.cancel=function(){if(this.i=Q0(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},gh.prototype.stringify=function(n){return L.JSON.stringify(n,void 0)},gh.prototype.parse=function(n){return L.JSON.parse(n,void 0)},Qe(Zs,ah),Zs.prototype.g=function(){return new kc(this.l,this.j)},Zs.prototype.i=function(n){return function(){return n}}({}),Qe(kc,je);var _h=0;function Y0(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function eo(n){n.readyState=4,n.l=null,n.j=null,n.A=null,to(n)}function to(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(D=kc.prototype).open=function(n,e){if(this.readyState!=_h)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,to(this)},D.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||L).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},D.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,eo(this)),this.readyState=_h},D.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,to(this)),this.g&&(this.readyState=3,to(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof L.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Y0(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},D.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?eo(this):to(this),3==this.readyState&&Y0(this)}},D.Va=function(n){this.g&&(this.response=this.responseText=n,eo(this))},D.Ua=function(n){this.g&&(this.response=n,eo(this))},D.ga=function(){this.g&&eo(this)},D.setRequestHeader=function(n,e){this.v.append(n,e)},D.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},D.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(kc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var sP=L.JSON.parse;function Te(n){je.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=X0,this.K=this.L=!1}Qe(Te,je);var X0="",oP=/^https?$/i,aP=["POST","PUT"];function J0(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Z0(n),Cc(n)}function Z0(n){n.D||(n.D=!0,Ye(n,"complete"),Ye(n,"error"))}function eT(n){if(n.h&&typeof Fd<"u"&&(!n.C[1]||4!=on(n)||2!=n.aa()))if(n.v&&4==on(n))oh(n.Ha,0,n);else if(Ye(n,"readystatechange"),4==on(n)){n.h=!1;try{const a=n.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=0===a){var r=String(n.H).match(V0)[1]||null;if(!r&&L.self&&L.self.location){var s=L.self.location.protocol;r=s.substr(0,s.length-1)}i=!oP.test(r?r.toLowerCase():"")}t=i}if(t)Ye(n,"complete"),Ye(n,"success");else{n.m=6;try{var o=2<on(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.aa()+"]",Z0(n)}}finally{Cc(n)}}}function Cc(n,e){if(n.g){tT(n);const t=n.g,i=n.C[0]?ac:null;n.g=null,n.C=null,e||Ye(n,"ready");try{t.onreadystatechange=i}catch{}}}function tT(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(L.clearTimeout(n.A),n.A=null)}function on(n){return n.g?n.g.readyState:0}function nT(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case X0:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function iT(n){let e="";return Kd(n,function(t,i){e+=i,e+=":",e+=t,e+="\r\n"}),e}function yh(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=iT(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):me(n,e,t))}function no(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function rT(n){this.Ca=0,this.i=[],this.j=new _c,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=no("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=no("baseRetryDelayMs",5e3,n),this.bb=no("retryDelaySeedMs",1e4,n),this.$a=no("forwardChannelMaxRetries",2,n),this.ta=no("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new $0(n&&n.concurrentRequestLimit),this.Fa=new nP,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function vh(n){if(sT(n),3==n.G){var e=n.U++,t=sn(n.F);me(t,"SID",n.I),me(t,"RID",e),me(t,"TYPE","terminate"),io(n,t),(e=new Ks(n,n.j,e,void 0)).K=2,e.v=Ac(sn(t)),t=!1,L.navigator&&L.navigator.sendBeacon&&(t=L.navigator.sendBeacon(e.v.toString(),"")),!t&&L.Image&&((new Image).src=e.v,t=!0),t||(e.g=pT(e.l,null),e.g.da(e.v)),e.F=Date.now(),zs(e)}hT(n)}function Sc(n){n.g&&(Th(n),n.g.cancel(),n.g=null)}function sT(n){Sc(n),n.u&&(L.clearTimeout(n.u),n.u=null),Nc(n),n.h.cancel(),n.m&&("number"==typeof n.m&&L.clearTimeout(n.m),n.m=null)}function Rc(n){H0(n.h)||n.m||(n.m=!0,I0(n.Ja,n),n.C=0)}function oT(n,e){var t;t=e?e.m:n.U++;const i=sn(n.F);me(i,"SID",n.I),me(i,"RID",t),me(i,"AID",n.T),io(n,i),n.o&&n.s&&yh(i,n.o,n.s),t=new Ks(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=aT(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),mh(n.h,t),hh(t,i,e)}function io(n,e){n.ia&&Kd(n.ia,function(t,i){me(e,i,t)}),n.l&&U0({},function(t,i){me(e,i,t)})}function aT(n,e,t){t=Math.min(n.i.length,t);var i=n.l?it(n.l.Ra,n.l,n):null;e:{var r=n.i;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=r[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<t;c++){let u=r[c].h;const d=r[c].g;if(u-=s,0>u)s=Math.max(0,r[c].h-100),a=!1;else try{iP(d,o,"req"+u+"_")}catch{i&&i(d)}}if(a){i=o.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,i}function cT(n){n.g||n.u||(n.Z=1,I0(n.Ia,n),n.A=0)}function Ih(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=$s(it(n.Ia,n),dT(n,n.A)),n.A++,0))}function Th(n){null!=n.B&&(L.clearTimeout(n.B),n.B=null)}function uT(n){n.g=new Ks(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=sn(n.sa);me(e,"RID","rpc"),me(e,"SID",n.I),me(e,"CI",n.L?"0":"1"),me(e,"AID",n.T),me(e,"TYPE","xmlhttp"),io(n,e),n.o&&n.s&&yh(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Ac(sn(e)),t.s=null,t.P=!0,O0(t,n)}function Nc(n){null!=n.v&&(L.clearTimeout(n.v),n.v=null)}function lT(n,e){var t=null;if(n.g==e){Nc(n),Th(n),n.g=null;var i=2}else{if(!ph(n.h,e))return;t=e.D,z0(n.h,e),i=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==i){t=e.s?e.s.length:0,e=Date.now()-e.F;var r=n.C;Ye(i=yc(),new S0(i,t)),Rc(n)}else cT(n);else if(3==(r=e.o)||0==r&&0<n.pa||!(1==i&&function uP(n,e){return!(K0(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=$s(it(n.Ja,n,e),dT(n,n.C)),n.C++,0)))}(n,e)||2==i&&Ih(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),r){case 1:Ti(n,5);break;case 4:Ti(n,10);break;case 3:Ti(n,6);break;default:Ti(n,2)}}function dT(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function Ti(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var i=it(n.kb,n);t||(t=new Ii("//www.google.com/images/cleardot.gif"),L.location&&"http"==L.location.protocol||wc(t,"https"),Ac(t)),function rP(n,e){const t=new _c;if(L.Image){const i=new Image;i.onload=uc(xc,t,i,"TestLoadImage: loaded",!0,e),i.onerror=uc(xc,t,i,"TestLoadImage: error",!1,e),i.onabort=uc(xc,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=uc(xc,t,i,"TestLoadImage: timeout",!1,e),L.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}(t.toString(),i)}else at(2);n.G=0,n.l&&n.l.va(e),hT(n),sT(n)}function hT(n){if(n.G=0,n.la=[],n.l){const e=Q0(n.h);(0!=e.length||0!=n.i.length)&&(s0(n.la,e),s0(n.la,n.i),n.h.i.length=0,Vd(n.i),n.i.length=0),n.l.ua()}}function fT(n,e,t){var i=t instanceof Ii?sn(t):new Ii(t,void 0);if(""!=i.g)e&&(i.g=e+"."+i.g),bc(i,i.m);else{var r=L.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new Ii(null,void 0);i&&wc(s,i),e&&(s.g=e),r&&bc(s,r),t&&(s.l=t),i=s}return e=n.za,(t=n.D)&&e&&me(i,t,e),me(i,"VER",n.ma),io(n,i),i}function pT(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Te(t&&n.Da&&!n.ra?new Zs({jb:!0}):n.ra)).Ka(n.H),e}function mT(){}function Pc(){if(_r&&!(10<=Number(x1)))throw Error("Environmental error: no available transport.")}function vt(n,e){je.call(this),this.g=new rT(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!lc(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!lc(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Ir(this)}function gT(n){ch.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function _T(){uh.call(this),this.status=1}function Ir(n){this.g=n}(D=Te.prototype).Ka=function(n){this.L=n},D.da=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():lh.g(),this.C=function N0(n){return n.h||(n.h=n.i())}(this.u?this.u:lh),this.g.onreadystatechange=it(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){return void J0(this,s)}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)t.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const s of i.keys())t.set(s,i.get(s))}i=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),r=L.FormData&&n instanceof L.FormData,!(0<=r0(aP,e))||i||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{tT(this),0<this.B&&((this.K=function cP(n){return _r&&function A1(){return function T1(n){var e=b1;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=o0(String(hc)).split("."),t=o0("9").split("."),i=Math.max(e.length,t.length);for(let o=0;0==n&&o<i;o++){var r=e[o]||"",s=t[o]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==r[0].length&&0==s[0].length)break;n=Gd(0==r[1].length?0:parseInt(r[1],10),0==s[1].length?0:parseInt(s[1],10))||Gd(0==r[2].length,0==s[2].length)||Gd(r[2],s[2]),r=r[3],s=s[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=it(this.qa,this)):this.A=oh(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){J0(this,s)}},D.qa=function(){typeof Fd<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ye(this,"timeout"),this.abort(8))},D.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ye(this,"complete"),Ye(this,"abort"),Cc(this))},D.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Cc(this,!0)),Te.X.M.call(this)},D.Ha=function(){this.s||(this.F||this.v||this.l?eT(this):this.fb())},D.fb=function(){eT(this)},D.aa=function(){try{return 2<on(this)?this.g.status:-1}catch{return-1}},D.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}},D.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),sP(e)}},D.Ea=function(){return this.m},D.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(D=rT.prototype).ma=8,D.G=1,D.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const r=new Ks(this,this.j,n,void 0);let s=this.s;if(this.S&&(s?(s=d0(s),f0(s,this.S)):s=this.S),null!==this.o||this.N||(r.H=s,s=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var i=this.i[t];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=aT(this,r,e),me(t=sn(this.F),"RID",n),me(t,"CVER",22),this.D&&me(t,"X-HTTP-Session-Id",this.D),io(this,t),s&&(this.N?e="headers="+encodeURIComponent(String(iT(s)))+"&"+e:this.o&&yh(t,this.o,s)),mh(this.h,r),this.Ya&&me(t,"TYPE","init"),this.O?(me(t,"$req",e),me(t,"SID","null"),r.Z=!0,hh(r,t,null)):hh(r,t,e),this.G=2}}else 3==this.G&&(n?oT(this,n):0==this.i.length||H0(this.h)||oT(this))},D.Ia=function(){if(this.u=null,uT(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=$s(it(this.eb,this),n)}},D.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,at(10),Sc(this),uT(this))},D.cb=function(){null!=this.v&&(this.v=null,Sc(this),Ih(this),at(19))},D.kb=function(n){n?(this.j.info("Successfully pinged google.com"),at(2)):(this.j.info("Failed to ping google.com"),at(1))},(D=mT.prototype).xa=function(){},D.wa=function(){},D.va=function(){},D.ua=function(){},D.Ra=function(){},Pc.prototype.g=function(n,e){return new vt(n,e)},Qe(vt,je),vt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;at(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=fT(n,null,n.V),Rc(n)},vt.prototype.close=function(){vh(this.g)},vt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=nh(n),n=t);e.i.push(new eP(e.ab++,n)),3==e.G&&Rc(e)},vt.prototype.M=function(){this.g.l=null,delete this.j,vh(this.g),delete this.g,vt.X.M.call(this)},Qe(gT,ch),Qe(_T,uh),Qe(Ir,mT),Ir.prototype.xa=function(){Ye(this.g,"a")},Ir.prototype.wa=function(n){Ye(this.g,new gT(n))},Ir.prototype.va=function(n){Ye(this.g,new _T)},Ir.prototype.ua=function(){Ye(this.g,"b")},Pc.prototype.createWebChannel=Pc.prototype.g,vt.prototype.send=vt.prototype.u,vt.prototype.open=vt.prototype.m,vt.prototype.close=vt.prototype.close,vc.NO_ERROR=0,vc.TIMEOUT=8,vc.HTTP_ERROR=6,R0.COMPLETE="complete",P0.EventType=Hs,Hs.OPEN="a",Hs.CLOSE="b",Hs.ERROR="c",Hs.MESSAGE="d",je.prototype.listen=je.prototype.N,Te.prototype.listenOnce=Te.prototype.O,Te.prototype.getLastError=Te.prototype.Oa,Te.prototype.getLastErrorCode=Te.prototype.Ea,Te.prototype.getStatus=Te.prototype.aa,Te.prototype.getResponseJson=Te.prototype.Sa,Te.prototype.getResponseText=Te.prototype.fa,Te.prototype.send=Te.prototype.da,Te.prototype.setWithCredentials=Te.prototype.Ka;var lP=rn.createWebChannelTransport=function(){return new Pc},dP=rn.getStatEventTarget=function(){return yc()},Eh=rn.ErrorCode=vc,hP=rn.EventType=R0,fP=rn.Event=yi,yT=rn.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},pP=rn.FetchXmlHttpFactory=Zs,Dc=rn.WebChannel=P0,mP=rn.XhrIo=Te;const vT="@firebase/firestore";class We{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}We.UNAUTHENTICATED=new We(null),We.GOOGLE_CREDENTIALS=new We("google-credentials-uid"),We.FIRST_PARTY=new We("first-party-uid"),We.MOCK_USER=new We("mock-user");let Tr="9.17.1";const Un=new st.Vy("@firebase/firestore");function wh(){return Un.logLevel}function w(n,...e){if(Un.logLevel<=st.$b.DEBUG){const t=e.map(bh);Un.debug(`Firestore (${Tr}): ${n}`,...t)}}function ke(n,...e){if(Un.logLevel<=st.$b.ERROR){const t=e.map(bh);Un.error(`Firestore (${Tr}): ${n}`,...t)}}function Er(n,...e){if(Un.logLevel<=st.$b.WARN){const t=e.map(bh);Un.warn(`Firestore (${Tr}): ${n}`,...t)}}function bh(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function N(n="Unexpected state"){const e=`FIRESTORE (${Tr}) INTERNAL ASSERTION FAILED: `+n;throw ke(e),new Error(e)}function P(n,e){n||N()}function S(n,e){return n}const v={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class E extends Jt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Fe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class IT{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class gP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(We.UNAUTHENTICATED))}shutdown(){}}class _P{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class yP{constructor(e){this.t=e,this.currentUser=We.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var i=this;let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let o=new Fe;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Fe,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const u=o;e.enqueueRetryable((0,f.A)(function*(){yield u.promise,yield s(i.currentUser)}))},c=u=>{w("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(w("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Fe)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(w("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(P("string"==typeof i.accessToken),new IT(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return P(null===e||"string"==typeof e),new We(e)}}class vP{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r,this.type="FirstParty",this.user=We.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(P(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class IP{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r}getToken(){return Promise.resolve(new vP(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(We.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class TT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class TP{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const i=s=>{null!=s.error&&w("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.A;return this.A=s.token,w("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{w("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?r(s):w("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(P("string"==typeof t.token),this.A=t.token,new TT(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function EP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}class ET{static R(){const t=62*Math.floor(256/62);let i="";for(;i.length<20;){const r=EP(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[s]%62))}return i}}function F(n,e){return n<e?-1:n>e?1:0}function wr(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function wT(n){return n+"\0"}class ye{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new E(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new E(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new E(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new E(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ye.fromMillis(Date.now())}static fromDate(e){return ye.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new ye(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?F(this.nanoseconds,e.nanoseconds):F(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class O{constructor(e){this.timestamp=e}static fromTimestamp(e){return new O(e)}static min(){return new O(new ye(0,0))}static max(){return new O(new ye(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ro{constructor(e,t,i){void 0===t?t=0:t>e.length&&N(),void 0===i?i=e.length-t:i>e.length-t&&N(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return 0===ro.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ro?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class X extends ro{construct(e,t,i){return new X(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new E(v.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new X(t)}static emptyPath(){return new X([])}}const wP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ce extends ro{construct(e,t,i){return new Ce(e,t,i)}static isValidIdentifier(e){return wP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ce.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Ce(["__name__"])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(0===i.length)throw new E(v.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let o=!1;for(;r<e.length;){const a=e[r];if("\\"===a){if(r+1===e.length)throw new E(v.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[r+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new E(v.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else"`"===a?(o=!o,r++):"."!==a||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new E(v.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ce(t)}static emptyPath(){return new Ce([])}}class C{constructor(e){this.path=e}static fromPath(e){return new C(X.fromString(e))}static fromName(e){return new C(X.fromString(e).popFirst(5))}static empty(){return new C(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===X.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new C(new X(e.slice()))}}class Oc{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}}function Ah(n){return n.fields.find(e=>2===e.kind)}function Ei(n){return n.fields.filter(e=>2!==e.kind)}Oc.UNKNOWN_ID=-1;class Mc{constructor(e,t){this.fieldPath=e,this.kind=t}}class so{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new so(0,It.min())}}function AT(n){return new It(n.readTime,n.key,-1)}class It{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new It(O.min(),C.empty(),-1)}static max(){return new It(O.max(),C.empty(),-1)}}function xh(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=C.comparator(n.documentKey,e.documentKey),0!==t?t:F(n.largestBatchId,e.largestBatchId))}const xT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Vn(n){return kh.apply(this,arguments)}function kh(){return kh=(0,f.A)(function*(n){if(n.code!==v.FAILED_PRECONDITION||n.message!==xT)throw n;w("LocalStore","Unexpectedly lost primary lease")}),kh.apply(this,arguments)}class _{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&N(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new _((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof _?t:_.resolve(t)}catch(t){return _.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):_.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):_.reject(t)}static resolve(e){return new _((t,i)=>{t(e)})}static reject(e){return new _((t,i)=>{i(e)})}static waitFor(e){return new _((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},c=>i(c))}),o=!0,s===r&&t()})}static or(e){let t=_.resolve(!1);for(const i of e)t=t.next(r=>r?_.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new _((i,r)=>{const s=e.length,o=new Array(s);let a=0;for(let c=0;c<s;c++){const u=c;t(e[u]).next(d=>{o[u]=d,++a,a===s&&i(o)},d=>r(d))}})}static doWhile(e,t){return new _((i,r)=>{const s=()=>{!0===e()?t().next(()=>{s()},r):i()};s()})}}class Lc{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new Fe,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new oo(e,t.error)):this.P.resolve()},this.transaction.onerror=i=>{const r=Ch(i.target.error);this.P.reject(new oo(e,r))}}static open(e,t,i,r){try{return new Lc(t,e.transaction(r,i))}catch(s){throw new oo(t,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(w("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new kP(t)}}class Dt{constructor(e,t,i){this.name=e,this.version=t,this.S=i,12.2===Dt.D(xe())&&ke("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return w("SimpleDb","Removing database:",e),wi(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!jy())return!1;if(Dt.N())return!0;const e=xe(),t=Dt.D(e),i=0<t&&t<10,r=Dt.k(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static N(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static k(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}F(e){var t=this;return(0,f.A)(function*(){return t.db||(w("SimpleDb","Opening database:",t.name),t.db=yield new Promise((i,r)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{i(o.target.result)},s.onblocked=()=>{r(new oo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;r("VersionError"===a.name?new E(v.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new E(v.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new oo(e,a))},s.onupgradeneeded=o=>{w("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.S.$(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{w("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=i=>t.B(i)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){var s=this;return(0,f.A)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.F(e);const c=Lc.open(s.db,e,o?"readonly":"readwrite",i),u=r(c).next(d=>(c.V(),d)).catch(d=>(c.abort(d),_.reject(d))).toPromise();return u.catch(()=>{}),yield c.v,u}catch(c){const u=c,d="FirebaseError"!==u.name&&a<3;if(w("SimpleDb","Transaction failed with error:",u.message,"Retrying:",d),s.close(),!d)return Promise.reject(u)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class xP{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return wi(this.q.delete())}}class oo extends E{constructor(e,t){super(v.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Gn(n){return"IndexedDbTransactionError"===n.name}class kP{constructor(e){this.store=e}put(e,t){let i;return void 0!==t?(w("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(w("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),wi(i)}add(e){return w("SimpleDb","ADD",this.store.name,e,e),wi(this.store.add(e))}get(e){return wi(this.store.get(e)).next(t=>(void 0===t&&(t=null),w("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return w("SimpleDb","DELETE",this.store.name,e),wi(this.store.delete(e))}count(){return w("SimpleDb","COUNT",this.store.name),wi(this.store.count())}W(e,t){const i=this.options(e,t);if(i.index||"function"!=typeof this.store.getAll){const r=this.cursor(i),s=[];return this.H(r,(o,a)=>{s.push(a)}).next(()=>s)}{const r=this.store.getAll(i.range);return new _((s,o)=>{r.onerror=a=>{o(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}}J(e,t){const i=this.store.getAll(e,null===t?void 0:t);return new _((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}Y(e,t){w("SimpleDb","DELETE ALL",this.store.name);const i=this.options(e,t);i.X=!1;const r=this.cursor(i);return this.H(r,(s,o,a)=>a.delete())}Z(e,t){let i;t?i=e:(i={},t=e);const r=this.cursor(i);return this.H(r,t)}tt(e){const t=this.cursor({});return new _((i,r)=>{t.onerror=s=>{const o=Ch(s.target.error);r(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}H(e,t){const i=[];return new _((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const c=new xP(a),u=t(a.primaryKey,a.value,c);if(u instanceof _){const d=u.catch(h=>(c.done(),_.reject(h)));i.push(d)}c.isDone?r():null===c.G?a.continue():a.continue(c.G)}}).next(()=>_.waitFor(i))}options(e,t){let i;return void 0!==e&&("string"==typeof e?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.X?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function wi(n){return new _((e,t)=>{n.onsuccess=i=>{e(i.target.result)},n.onerror=i=>{const r=Ch(i.target.error);t(r)}})}let CT=!1;function Ch(n){const e=Dt.D(xe());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new E("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return CT||(CT=!0,setTimeout(()=>{throw i},0)),i}}return n}class CP{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;w("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,f.A)(function*(){t.task=null;try{w("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(i){Gn(i)?w("IndexBackiller","Ignoring IndexedDB error during index backfill: ",i):yield Vn(i)}yield t.nt(6e4)}))}}class SP{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,f.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",i=>t.it(i,e))})()}it(e,t){const i=new Set;let r=t,s=!0;return _.doWhile(()=>!0===s&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!i.has(o))return w("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,r).next(a=>{r-=a,i.add(o)});s=!1})).next(()=>t-r)}rt(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(r,s)).next(a=>(w("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ot(e,t){let i=e;return t.changes.forEach((r,s)=>{const o=AT(s);xh(o,i)>0&&(i=o)}),new It(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Tt=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>i.writeSequenceNumber(r))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class RP{constructor(e,t,i,r,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=c}}class bi{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new bi("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof bi&&e.projectId===this.projectId&&e.database===this.database}}function ST(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ai(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function RT(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ao(n){return null==n}function co(n){return 0===n&&1/n==-1/0}class Ue{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Ue(t)}static fromUint8Array(e){const t=function(i){let r="";for(let s=0;s<i.length;++s)r+=String.fromCharCode(i[s]);return r}(e);return new Ue(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return F(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ue.EMPTY_BYTE_STRING=new Ue("");const NP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bn(n){if(P(!!n),"string"==typeof n){let e=0;const t=NP.exec(n);if(P(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ee(n.seconds),nanos:Ee(n.nanos)}}function Ee(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function xi(n){return"string"==typeof n?Ue.fromBase64String(n):Ue.fromUint8Array(n)}function Sh(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function PT(n){const e=n.mapValue.fields.__previous_value__;return Sh(e)?PT(e):e}function uo(n){const e=Bn(n.mapValue.fields.__local_write_time__.timestampValue);return new ye(e.seconds,e.nanos)}const qn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Fc={nullValue:"NULL_VALUE"};function ki(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Sh(n)?4:LT(n)?9007199254740991:10:N()}function qt(n,e){if(n===e)return!0;const t=ki(n);if(t!==ki(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return uo(n).isEqual(uo(e));case 3:return function(i,r){if("string"==typeof i.timestampValue&&"string"==typeof r.timestampValue&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const s=Bn(i.timestampValue),o=Bn(r.timestampValue);return s.seconds===o.seconds&&s.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return r=e,xi(n.bytesValue).isEqual(xi(r.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,r){return Ee(i.geoPointValue.latitude)===Ee(r.geoPointValue.latitude)&&Ee(i.geoPointValue.longitude)===Ee(r.geoPointValue.longitude)}(n,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return Ee(i.integerValue)===Ee(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const s=Ee(i.doubleValue),o=Ee(r.doubleValue);return s===o?co(s)===co(o):isNaN(s)&&isNaN(o)}return!1}(n,e);case 9:return wr(n.arrayValue.values||[],e.arrayValue.values||[],qt);case 10:return function(i,r){const s=i.mapValue.fields||{},o=r.mapValue.fields||{};if(ST(s)!==ST(o))return!1;for(const a in s)if(s.hasOwnProperty(a)&&(void 0===o[a]||!qt(s[a],o[a])))return!1;return!0}(n,e);default:return N()}var r}function lo(n,e){return void 0!==(n.values||[]).find(t=>qt(t,e))}function jn(n,e){if(n===e)return 0;const t=ki(n),i=ki(e);if(t!==i)return F(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return F(n.booleanValue,e.booleanValue);case 2:return function(r,s){const o=Ee(r.integerValue||r.doubleValue),a=Ee(s.integerValue||s.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return DT(n.timestampValue,e.timestampValue);case 4:return DT(uo(n),uo(e));case 5:return F(n.stringValue,e.stringValue);case 6:return function(r,s){const o=xi(r),a=xi(s);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(r,s){const o=r.split("/"),a=s.split("/");for(let c=0;c<o.length&&c<a.length;c++){const u=F(o[c],a[c]);if(0!==u)return u}return F(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,s){const o=F(Ee(r.latitude),Ee(s.latitude));return 0!==o?o:F(Ee(r.longitude),Ee(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,s){const o=r.values||[],a=s.values||[];for(let c=0;c<o.length&&c<a.length;++c){const u=jn(o[c],a[c]);if(u)return u}return F(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,s){if(r===qn.mapValue&&s===qn.mapValue)return 0;if(r===qn.mapValue)return 1;if(s===qn.mapValue)return-1;const o=r.fields||{},a=Object.keys(o),c=s.fields||{},u=Object.keys(c);a.sort(),u.sort();for(let d=0;d<a.length&&d<u.length;++d){const h=F(a[d],u[d]);if(0!==h)return h;const p=jn(o[a[d]],c[u[d]]);if(0!==p)return p}return F(a.length,u.length)}(n.mapValue,e.mapValue);default:throw N()}}function DT(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return F(n,e);const t=Bn(n),i=Bn(e),r=F(t.seconds,i.seconds);return 0!==r?r:F(t.nanos,i.nanos)}function br(n){return Rh(n)}function Rh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const r=Bn(i);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?xi(n.bytesValue).toBase64():"referenceValue"in n?C.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(i){let r="[",s=!0;for(const o of i.values||[])s?s=!1:r+=",",r+=Rh(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(i){const r=Object.keys(i.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Rh(i.fields[a])}`;return s+"}"}(n.mapValue):N();var e}function Ci(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Nh(n){return!!n&&"integerValue"in n}function ho(n){return!!n&&"arrayValue"in n}function OT(n){return!!n&&"nullValue"in n}function MT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Uc(n){return!!n&&"mapValue"in n}function fo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ai(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=fo(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=fo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function LT(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function PP(n){return"nullValue"in n?Fc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ci(bi.empty(),C.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:N()}function DP(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ci(bi.empty(),C.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?qn:N()}function FT(n,e){const t=jn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function UT(n,e){const t=jn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Wn{constructor(e,t){this.position=e,this.inclusive=t}}function VT(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],o=n.position[r];if(i=s.field.isKeyField()?C.comparator(C.fromName(o.referenceValue),t.key):jn(o,t.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function GT(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qt(n.position[t],e.position[t]))return!1;return!0}class BT{}class z extends BT{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,i):new OP(e,t,i):"array-contains"===t?new FP(e,i):"in"===t?new KT(e,i):"not-in"===t?new UP(e,i):"array-contains-any"===t?new VP(e,i):new z(e,t,i)}static createKeyFieldInFilter(e,t,i){return"in"===t?new MP(e,i):new LP(e,i)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(jn(t,this.value)):null!==t&&ki(this.value)===ki(t)&&this.matchesComparison(jn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return N()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class se extends BT{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new se(e,t)}matches(e){return Ar(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Ar(n){return"and"===n.op}function Ph(n){return"or"===n.op}function Dh(n){return qT(n)&&Ar(n)}function qT(n){for(const e of n.filters)if(e instanceof se)return!1;return!0}function Oh(n){if(n instanceof z)return n.field.canonicalString()+n.op.toString()+br(n.value);if(Dh(n))return n.filters.map(e=>Oh(e)).join(",");{const e=n.filters.map(t=>Oh(t)).join(",");return`${n.op}(${e})`}}function jT(n,e){return n instanceof z?(t=n,(i=e)instanceof z&&t.op===i.op&&t.field.isEqual(i.field)&&qt(t.value,i.value)):n instanceof se?function(t,i){return i instanceof se&&t.op===i.op&&t.filters.length===i.filters.length&&t.filters.reduce((r,s,o)=>r&&jT(s,i.filters[o]),!0)}(n,e):void N();var t,i}function WT(n,e){const t=n.filters.concat(e);return se.create(t,n.op)}function $T(n){return n instanceof z?`${(e=n).field.canonicalString()} ${e.op} ${br(e.value)}`:n instanceof se?function(e){return e.op.toString()+" {"+e.getFilters().map($T).join(" ,")+"}"}(n):"Filter";var e}class OP extends z{constructor(e,t,i){super(e,t,i),this.key=C.fromName(i.referenceValue)}matches(e){const t=C.comparator(e.key,this.key);return this.matchesComparison(t)}}class MP extends z{constructor(e,t){super(e,"in",t),this.keys=HT(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class LP extends z{constructor(e,t){super(e,"not-in",t),this.keys=HT(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function HT(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(i=>C.fromName(i.referenceValue))}class FP extends z{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ho(t)&&lo(t.arrayValue,this.value)}}class KT extends z{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&lo(this.value.arrayValue,t)}}class UP extends z{constructor(e,t){super(e,"not-in",t)}matches(e){if(lo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!lo(this.value.arrayValue,t)}}class VP extends z{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ho(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>lo(this.value.arrayValue,i))}}class xr{constructor(e,t="asc"){this.field=e,this.dir=t}}function GP(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class we{constructor(e,t){this.comparator=e,this.root=t||Xe.EMPTY}insert(e,t){return new we(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xe.BLACK,null,null))}remove(e){return new we(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(0===i)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(0===r)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vc(this.root,e,this.comparator,!0)}}class Vc{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Xe{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??Xe.RED,this.left=r??Xe.EMPTY,this.right=s??Xe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new Xe(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Xe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Xe.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Xe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Xe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw N();const e=this.left.check();if(e!==this.right.check())throw N();return e+(this.isRed()?0:1)}}Xe.EMPTY=null,Xe.RED=!0,Xe.BLACK=!1,Xe.EMPTY=new class{constructor(){this.size=0}get key(){throw N()}get value(){throw N()}get color(){throw N()}get left(){throw N()}get right(){throw N()}copy(n,e,t,i,r){return this}insert(n,e,t){return new Xe(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ae{constructor(e){this.comparator=e,this.data=new we(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zT(this.data.getIterator())}getIteratorFrom(e){return new zT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof ae)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(0!==this.comparator(r,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ae(this.comparator);return t.data=e,t}}class zT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function kr(n){return n.hasNext()?n.getNext():void 0}class dt{constructor(e){this.fields=e,e.sort(Ce.comparator)}static empty(){return new dt([])}unionWith(e){let t=new ae(Ce.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new dt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return wr(this.fields,e.fields,(t,i)=>t.isEqual(i))}}class Je{constructor(e){this.value=e}static empty(){return new Je({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Uc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=fo(t)}setAll(e){let t=Ce.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=fo(o):r.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());Uc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Uc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Ai(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new Je(fo(this.value))}}function QT(n){const e=[];return Ai(n.fields,(t,i)=>{const r=new Ce([t]);if(Uc(i)){const s=QT(i.mapValue).fields;if(0===s.length)e.push(r);else for(const o of s)e.push(r.child(o))}else e.push(r)}),new dt(e)}class he{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new he(e,0,O.min(),O.min(),O.min(),Je.empty(),0)}static newFoundDocument(e,t,i,r){return new he(e,1,t,O.min(),i,r,0)}static newNoDocument(e,t){return new he(e,2,t,O.min(),O.min(),Je.empty(),0)}static newUnknownDocument(e,t){return new he(e,3,t,O.min(),O.min(),Je.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(O.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Je.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Je.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=O.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof he&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new he(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class BP{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ft=null}}function Mh(n,e=null,t=[],i=[],r=null,s=null,o=null){return new BP(n,e,t,i,r,s,o)}function Si(n){const e=S(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>Oh(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>{return(r=i).field.canonicalString()+r.dir;var r}).join(","),ao(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>br(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>br(i)).join(",")),e.ft=t}return e.ft}function po(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!GP(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!jT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!GT(n.startAt,e.startAt)&&GT(n.endAt,e.endAt)}function Gc(n){return C.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Bc(n,e){return n.filters.filter(t=>t instanceof z&&t.field.isEqual(e))}function YT(n,e,t){let i=Fc,r=!0;for(const s of Bc(n,e)){let o=Fc,a=!0;switch(s.op){case"<":case"<=":o=PP(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Fc}FT({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];FT({value:i,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(i=o,r=t.inclusive);break}return{value:i,inclusive:r}}function XT(n,e,t){let i=qn,r=!0;for(const s of Bc(n,e)){let o=qn,a=!0;switch(s.op){case">=":case">":o=DP(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=qn}UT({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];UT({value:i,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(i=o,r=t.inclusive);break}return{value:i,inclusive:r}}class an{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.dt=null,this._t=null}}function Cr(n){return new an(n)}function ZT(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Lh(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function qc(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Fh(n){return null!==n.collectionGroup}function Ri(n){const e=S(n);if(null===e.dt){e.dt=[];const t=qc(e),i=Lh(e);if(null!==t&&null===i)t.isKeyField()||e.dt.push(new xr(t)),e.dt.push(new xr(Ce.keyField(),"asc"));else{let r=!1;for(const s of e.explicitOrderBy)e.dt.push(s),s.field.isKeyField()&&(r=!0);if(!r){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new xr(Ce.keyField(),s))}}}return e.dt}function ct(n){const e=S(n);if(!e._t)if("F"===e.limitType)e._t=Mh(e.path,e.collectionGroup,Ri(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Ri(e))t.push(new xr(s.field,"desc"===s.dir?"asc":"desc"));const i=e.endAt?new Wn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Wn(e.startAt.position,e.startAt.inclusive):null;e._t=Mh(e.path,e.collectionGroup,t,e.filters,e.limit,i,r)}return e._t}function Uh(n,e){e.getFirstInequalityField(),qc(n);const t=n.filters.concat([e]);return new an(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function jc(n,e,t){return new an(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function mo(n,e){return po(ct(n),ct(e))&&n.limitType===e.limitType}function eE(n){return`${Si(ct(n))}|lt:${n.limitType}`}function Vh(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(i=>$T(i)).join(", ")}]`),ao(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(i=>{return`${(r=i).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>br(i)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>br(i)).join(",")),`Target(${t})`}(ct(n))}; limitType=${n.limitType})`}function go(n,e){return e.isFoundDocument()&&function(t,i){const r=i.key.path;return null!==t.collectionGroup?i.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):C.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r)}(n,e)&&function(t,i){for(const r of Ri(t))if(!r.field.isKeyField()&&null===i.data.field(r.field))return!1;return!0}(n,e)&&function(t,i){for(const r of t.filters)if(!r.matches(i))return!1;return!0}(n,e)&&(i=e,!((t=n).startAt&&!function(r,s,o){const a=VT(r,s,o);return r.inclusive?a<=0:a<0}(t.startAt,Ri(t),i)||t.endAt&&!function(r,s,o){const a=VT(r,s,o);return r.inclusive?a>=0:a>0}(t.endAt,Ri(t),i)));var t,i}function nE(n){return(e,t)=>{let i=!1;for(const r of Ri(n)){const s=qP(r,e,t);if(0!==s)return s;i=i||r.field.isKeyField()}return 0}}function qP(n,e,t){const i=n.field.isKeyField()?C.comparator(e.key,t.key):function(r,s,o){const a=s.data.field(r),c=o.data.field(r);return null!==a&&null!==c?jn(a,c):N()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return N()}}function iE(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:co(e)?"-0":e}}function rE(n){return{integerValue:""+n}}function sE(n,e){return function NT(n){return"number"==typeof n&&Number.isInteger(n)&&!co(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}(e)?rE(e):iE(n,e)}class Wc{constructor(){this._=void 0}}function jP(n,e,t){return n instanceof Sr?function(i,r){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&(s.fields.__previous_value__=r),{mapValue:s}}(t,e):n instanceof Ni?aE(n,e):n instanceof Pi?cE(n,e):function(i,r){const s=oE(i,r),o=uE(s)+uE(i.gt);return Nh(s)&&Nh(i.gt)?rE(o):iE(i.yt,o)}(n,e)}function WP(n,e,t){return n instanceof Ni?aE(n,e):n instanceof Pi?cE(n,e):t}function oE(n,e){return n instanceof Rr?Nh(t=e)||(i=t)&&"doubleValue"in i?e:{integerValue:0}:null;var i,t}class Sr extends Wc{}class Ni extends Wc{constructor(e){super(),this.elements=e}}function aE(n,e){const t=lE(e);for(const i of n.elements)t.some(r=>qt(r,i))||t.push(i);return{arrayValue:{values:t}}}class Pi extends Wc{constructor(e){super(),this.elements=e}}function cE(n,e){let t=lE(e);for(const i of n.elements)t=t.filter(r=>!qt(r,i));return{arrayValue:{values:t}}}class Rr extends Wc{constructor(e,t){super(),this.yt=e,this.gt=t}}function uE(n){return Ee(n.integerValue||n.doubleValue)}function lE(n){return ho(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class _o{constructor(e,t){this.field=e,this.transform=t}}class HP{constructor(e,t){this.version=e,this.transformResults=t}}class ge{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ge}static exists(e){return new ge(void 0,e)}static updateTime(e){return new ge(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function $c(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Hc{}function dE(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Pr(n.key,ge.none()):new Nr(n.key,n.data,ge.none());{const t=n.data,i=Je.empty();let r=new ae(Ce.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?i.delete(s):i.set(s,o),r=r.add(s)}return new cn(n.key,i,new dt(r.toArray()),ge.none())}}function KP(n,e,t){n instanceof Nr?function(i,r,s){const o=i.value.clone(),a=pE(i.fieldTransforms,r,s.transformResults);o.setAll(a),r.convertToFoundDocument(s.version,o).setHasCommittedMutations()}(n,e,t):n instanceof cn?function(i,r,s){if(!$c(i.precondition,r))return void r.convertToUnknownDocument(s.version);const o=pE(i.fieldTransforms,r,s.transformResults),a=r.data;a.setAll(fE(i)),a.setAll(o),r.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function yo(n,e,t,i){return n instanceof Nr?function(r,s,o,a){if(!$c(r.precondition,s))return o;const c=r.value.clone(),u=mE(r.fieldTransforms,a,s);return c.setAll(u),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),null}(n,e,t,i):n instanceof cn?function(r,s,o,a){if(!$c(r.precondition,s))return o;const c=mE(r.fieldTransforms,a,s),u=s.data;return u.setAll(fE(r)),u.setAll(c),s.convertToFoundDocument(s.version,u).setHasLocalMutations(),null===o?null:o.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(d=>d.field))}(n,e,t,i):(o=t,$c(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):o);var s,o}function zP(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=oE(i.transform,r||null);null!=s&&(null===t&&(t=Je.empty()),t.set(i.field,s))}return t||null}function hE(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===i||t&&i&&wr(t,i,(r,s)=>function $P(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(t=n.transform)instanceof Ni&&i instanceof Ni||t instanceof Pi&&i instanceof Pi?wr(t.elements,i.elements,qt):t instanceof Rr&&i instanceof Rr?qt(t.gt,i.gt):t instanceof Sr&&i instanceof Sr);var t,i}(r,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,i}class Nr extends Hc{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class cn extends Hc{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function fE(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function pE(n,e,t){const i=new Map;P(n.length===t.length);for(let r=0;r<t.length;r++){const s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,WP(o,a,t[r]))}return i}function mE(n,e,t){const i=new Map;for(const r of n){const s=r.transform,o=t.data.field(r.field);i.set(r.field,jP(s,o,e))}return i}class Pr extends Hc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Gh extends Hc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class QP{constructor(e){this.count=e}}var Pe,J;function _E(n){if(void 0===n)return ke("GRPC error has no .code"),v.UNKNOWN;switch(n){case Pe.OK:return v.OK;case Pe.CANCELLED:return v.CANCELLED;case Pe.UNKNOWN:return v.UNKNOWN;case Pe.DEADLINE_EXCEEDED:return v.DEADLINE_EXCEEDED;case Pe.RESOURCE_EXHAUSTED:return v.RESOURCE_EXHAUSTED;case Pe.INTERNAL:return v.INTERNAL;case Pe.UNAVAILABLE:return v.UNAVAILABLE;case Pe.UNAUTHENTICATED:return v.UNAUTHENTICATED;case Pe.INVALID_ARGUMENT:return v.INVALID_ARGUMENT;case Pe.NOT_FOUND:return v.NOT_FOUND;case Pe.ALREADY_EXISTS:return v.ALREADY_EXISTS;case Pe.PERMISSION_DENIED:return v.PERMISSION_DENIED;case Pe.FAILED_PRECONDITION:return v.FAILED_PRECONDITION;case Pe.ABORTED:return v.ABORTED;case Pe.OUT_OF_RANGE:return v.OUT_OF_RANGE;case Pe.UNIMPLEMENTED:return v.UNIMPLEMENTED;case Pe.DATA_LOSS:return v.DATA_LOSS;default:return N()}}(J=Pe||(Pe={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";class $n{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0!==i)for(const[r,s]of i)if(this.equalsFn(r,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(void 0===r)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0===i)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return 1===i.length?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ai(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return RT(this.inner)}size(){return this.innerSize}}const YP=new we(C.comparator);function ht(){return YP}const yE=new we(C.comparator);function vo(...n){let e=yE;for(const t of n)e=e.insert(t.key,t);return e}function vE(n){let e=yE;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function jt(){return Io()}function IE(){return Io()}function Io(){return new $n(n=>n.toString(),(n,e)=>n.isEqual(e))}const XP=new we(C.comparator),JP=new ae(C.comparator);function B(...n){let e=JP;for(const t of n)e=e.add(t);return e}const ZP=new ae(F);function Kc(){return ZP}class To{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,Eo.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new To(O.min(),r,Kc(),ht(),B())}}class Eo{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new Eo(i,t,B(),B(),B())}}class zc{constructor(e,t,i,r){this.It=e,this.removedTargetIds=t,this.key=i,this.Tt=r}}class TE{constructor(e,t){this.targetId=e,this.Et=t}}class EE{constructor(e,t,i=Ue.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class wE{constructor(){this.At=0,this.Rt=AE(),this.bt=Ue.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=B(),t=B(),i=B();return this.Rt.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:N()}}),new Eo(this.bt,this.Pt,e,t,i)}xt(){this.vt=!1,this.Rt=AE()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class eD{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=ht(),this.qt=bE(),this.Ut=new ae(F)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const i=this.Wt(t);switch(e.state){case 0:this.zt(t)&&i.Dt(e.resumeToken);break;case 1:i.Mt(),i.Vt||i.xt(),i.Dt(e.resumeToken);break;case 2:i.Mt(),i.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(i.Ft(),i.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),i.Dt(e.resumeToken));break;default:N()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((i,r)=>{this.zt(r)&&t(r)})}Jt(e){const t=e.targetId,i=e.Et.count,r=this.Yt(t);if(r){const s=r.target;if(Gc(s))if(0===i){const o=new C(s.path);this.Qt(t,o,he.newNoDocument(o,O.min()))}else P(1===i);else this.Xt(t)!==i&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((s,o)=>{const a=this.Yt(o);if(a){if(s.current&&Gc(a.target)){const c=new C(a.target.path);null!==this.Lt.get(c)||this.te(o,c)||this.Qt(o,c,he.newNoDocument(c,e))}s.St&&(t.set(o,s.Ct()),s.xt())}});let i=B();this.qt.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{const u=this.Yt(c);return!u||2===u.purpose||(a=!1,!1)}),a&&(i=i.add(s))}),this.Lt.forEach((s,o)=>o.setReadTime(e));const r=new To(e,t,this.Ut,this.Lt,i);return this.Lt=ht(),this.qt=bE(),this.Ut=new ae(F),r}Gt(e,t){if(!this.zt(e))return;const i=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,i),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,i){if(!this.zt(e))return;const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),i&&(this.Lt=this.Lt.insert(t,i))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new wE,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new ae(F),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||w("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new wE),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function bE(){return new we(C.comparator)}function AE(){return new we(C.comparator)}const tD={asc:"ASCENDING",desc:"DESCENDING"},nD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iD={and:"AND",or:"OR"};class rD{constructor(e,t){this.databaseId=e,this.wt=t}}function Dr(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xE(n,e){return n.wt?e.toBase64():e.toUint8Array()}function sD(n,e){return Dr(n,e.toTimestamp())}function Se(n){return P(!!n),O.fromTimestamp(function(e){const t=Bn(e);return new ye(t.seconds,t.nanos)}(n))}function Bh(n,e){return(t=n,new X(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function kE(n){const e=X.fromString(n);return P(LE(e)),e}function wo(n,e){return Bh(n.databaseId,e.path)}function Wt(n,e){const t=kE(e);if(t.get(1)!==n.databaseId.projectId)throw new E(v.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new E(v.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new C(SE(t))}function qh(n,e){return Bh(n.databaseId,e)}function CE(n){const e=kE(n);return 4===e.length?X.emptyPath():SE(e)}function bo(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function SE(n){return P(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function RE(n,e,t){return{name:wo(n,e),fields:t.value.mapValue.fields}}function Ao(n,e){let t;if(e instanceof Nr)t={update:RE(n,e.key,e.value)};else if(e instanceof Pr)t={delete:wo(n,e.key)};else if(e instanceof cn)t={update:RE(n,e.key,e.data),updateMask:fD(e.fieldMask)};else{if(!(e instanceof Gh))return N();t={verify:wo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(r,s){const o=s.transform;if(o instanceof Sr)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Ni)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Pi)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Rr)return{fieldPath:s.field.canonicalString(),increment:o.gt};throw N()}(0,i))),e.precondition.isNone||(t.currentDocument=void 0!==(r=e.precondition).updateTime?{updateTime:sD(n,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:N()),t;var r}function jh(n,e){const t=e.currentDocument?void 0!==(r=e.currentDocument).updateTime?ge.updateTime(Se(r.updateTime)):void 0!==r.exists?ge.exists(r.exists):ge.none():ge.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(s,o){let a=null;"setToServerValue"in o?(P("REQUEST_TIME"===o.setToServerValue),a=new Sr):"appendMissingElements"in o?a=new Ni(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new Pi(o.removeAllFromArray.values||[]):"increment"in o?a=new Rr(s,o.increment):N();const c=Ce.fromServerFormat(o.fieldPath);return new _o(c,a)}(n,r)):[];var r;if(e.update){const r=Wt(n,e.update.name),s=new Je({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new dt((e.updateMask.fieldPaths||[]).map(u=>Ce.fromServerFormat(u)));return new cn(r,s,o,t,i)}return new Nr(r,s,t,i)}if(e.delete){const r=Wt(n,e.delete);return new Pr(r,t)}if(e.verify){const r=Wt(n,e.verify);return new Gh(r,t)}return N()}function PE(n,e){return{documents:[qh(n,e.path)]}}function Wh(n,e){const t={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(t.parent=qh(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=qh(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(c){if(0!==c.length)return ME(se.create(c,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const s=function(c){if(0!==c.length)return c.map(u=>{return{field:Or((d=u).field),direction:lD(d.dir)};var d})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=(u=e.limit,n.wt||ao(u)?u:{value:u});var u,a,c;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(c=e.endAt).inclusive,values:c.position}),t}function DE(n){let e=CE(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){P(1===i);const d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(d){const h=OE(d);return h instanceof se&&Dh(h)?h.getFilters():[h]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(d=>{return new xr(Mr((h=d).field),function(p){switch(p){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction));var h}));let a=null;t.limit&&(a=function(d){let h;return h="object"==typeof d?d.value:d,ao(h)?null:h}(t.limit));let c=null;var d;t.startAt&&(c=new Wn((d=t.startAt).values||[],!!d.before));let u=null;return t.endAt&&(u=function(d){return new Wn(d.values||[],!d.before)}(t.endAt)),function JT(n,e,t,i,r,s,o,a){return new an(n,e,t,i,r,s,o,a)}(e,r,o,s,a,"F",c,u)}function OE(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Mr(e.unaryFilter.field);return z.create(t,"==",{doubleValue:NaN});case"IS_NULL":const i=Mr(e.unaryFilter.field);return z.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Mr(e.unaryFilter.field);return z.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Mr(e.unaryFilter.field);return z.create(s,"!=",{nullValue:"NULL_VALUE"});default:return N()}}(n):void 0!==n.fieldFilter?z.create(Mr((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return N()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return se.create(e.compositeFilter.filters.map(t=>OE(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return N()}}(e.compositeFilter.op))}(n):N();var e}function lD(n){return tD[n]}function dD(n){return nD[n]}function hD(n){return iD[n]}function Or(n){return{fieldPath:n.canonicalString()}}function Mr(n){return Ce.fromServerFormat(n.fieldPath)}function ME(n){return n instanceof z?function(e){if("=="===e.op){if(MT(e.value))return{unaryFilter:{field:Or(e.field),op:"IS_NAN"}};if(OT(e.value))return{unaryFilter:{field:Or(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(MT(e.value))return{unaryFilter:{field:Or(e.field),op:"IS_NOT_NAN"}};if(OT(e.value))return{unaryFilter:{field:Or(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Or(e.field),op:dD(e.op),value:e.value}}}(n):n instanceof se?function(e){const t=e.getFilters().map(i=>ME(i));return 1===t.length?t[0]:{compositeFilter:{op:hD(e.op),filters:t}}}(n):N()}function fD(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function LE(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function ut(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=FE(e)),e=pD(n.get(t),e);return FE(e)}function pD(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function FE(n){return n+"\x01\x01"}function $t(n){const e=n.length;if(P(e>=2),2===e)return P("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),X.emptyPath();const t=e-2,i=[];let r="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&N(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let c;0===r.length?c=a:(r+=a,c=r,r=""),i.push(c);break;case"\x10":r+=n.substring(s,o),r+="\0";break;case"\x11":r+=n.substring(s,o+1);break;default:N()}s=o+2}return new X(i)}const UE=["userId","batchId"];function Qc(n,e){return[n,ut(e)]}function VE(n,e,t){return[n,ut(e),t]}const mD={},gD=["prefixPath","collectionGroup","readTime","documentId"],_D=["prefixPath","collectionGroup","documentId"],yD=["collectionGroup","readTime","prefixPath","documentId"],vD=["canonicalId","targetId"],ID=["targetId","path"],TD=["path","targetId"],ED=["collectionId","parent"],wD=["indexId","uid"],bD=["uid","sequenceNumber"],AD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],xD=["indexId","uid","orderedDocumentKey"],kD=["userId","collectionPath","documentId"],CD=["userId","collectionPath","largestBatchId"],SD=["userId","collectionGroup","largestBatchId"],GE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],RD=[...GE,"documentOverlays"],BE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],qE=BE,ND=[...qE,"indexConfiguration","indexState","indexEntries"];class $h extends kT{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function $e(n,e){const t=S(n);return Dt.M(t.se,e)}class Hh{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&KP(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=yo(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=yo(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=IE();return this.mutations.forEach(r=>{const s=e.get(r.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;const c=dE(o,a);null!==c&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(O.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),B())}isEqual(e){return this.batchId===e.batchId&&wr(this.mutations,e.mutations,(t,i)=>hE(t,i))&&wr(this.baseMutations,e.baseMutations,(t,i)=>hE(t,i))}}class Kh{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){P(e.mutations.length===i.length);let r=XP;const s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new Kh(e,t,i,r)}}class zh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Hn{constructor(e,t,i,r,s=O.min(),o=O.min(),a=Ue.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new Hn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Hn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Hn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class jE{constructor(e){this.ie=e}}function WE(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Yc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document={name:wo(r=n.ie,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:Dr(r,s.version.toTimestamp()),createTime:Dr(r,s.createTime.toTimestamp())};else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Di(e.version)};else{if(!e.isUnknownDocument())return N();i.unknownDocument={path:t.path.toArray(),version:Di(e.version)}}var r,s;return i}function Yc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Di(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Oi(n){const e=new ye(n.seconds,n.nanoseconds);return O.fromTimestamp(e)}function Mi(n,e){const t=(e.baseMutations||[]).map(s=>jh(n.ie,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const i=e.mutations.map(s=>jh(n.ie,s)),r=ye.fromMillis(e.localWriteTimeMs);return new Hh(e.batchId,r,t,i)}function xo(n){const e=Oi(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Oi(n.lastLimboFreeSnapshotVersion):O.min();let i;var r;return void 0!==n.query.documents?(P(1===(r=n.query).documents.length),i=ct(Cr(CE(r.documents[0])))):i=ct(DE(n.query)),new Hn(i,n.targetId,0,n.lastListenSequenceNumber,e,t,Ue.fromBase64String(n.resumeToken))}function $E(n,e){const t=Di(e.snapshotVersion),i=Di(e.lastLimboFreeSnapshotVersion);let r;r=Gc(e.target)?PE(n.ie,e.target):Wh(n.ie,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Si(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function Qh(n){const e=DE({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?jc(e,e.limit,"L"):e}function Yh(n,e){return new zh(e.largestBatchId,jh(n.ie,e.overlayMutation))}function HE(n,e){const t=e.path.lastSegment();return[n,ut(e.path.popLast()),t]}function KE(n,e,t,i){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Di(i.readTime),documentKey:ut(i.documentKey.path),largestBatchId:i.largestBatchId}}class DD{getBundleMetadata(e,t){return zE(e).get(t).next(i=>{if(i)return{id:(r=i).bundleId,createTime:Oi(r.createTime),version:r.version};var r})}saveBundleMetadata(e,t){return zE(e).put({bundleId:(i=t).id,createTime:Di(Se(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return QE(e).get(t).next(i=>{if(i)return{name:(r=i).name,query:Qh(r.bundledQuery),readTime:Oi(r.readTime)};var r})}saveNamedQuery(e,t){return QE(e).put({name:(i=t).name,readTime:Di(Se(i.readTime)),bundledQuery:i.bundledQuery});var i}}function zE(n){return $e(n,"bundles")}function QE(n){return $e(n,"namedQueries")}class Xc{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new Xc(e,t.uid||"")}getOverlay(e,t){return ko(e).get(HE(this.userId,t)).next(i=>i?Yh(this.yt,i):null)}getOverlays(e,t){const i=jt();return _.forEach(t,r=>this.getOverlay(e,r).next(s=>{null!==s&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){const r=[];return i.forEach((s,o)=>{const a=new zh(t,o);r.push(this.oe(e,a))}),_.waitFor(r)}removeOverlaysForBatchId(e,t,i){const r=new Set;t.forEach(o=>r.add(ut(o.getCollectionPath())));const s=[];return r.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(ko(e).Y("collectionPathOverlayIndex",a))}),_.waitFor(s)}getOverlaysForCollection(e,t,i){const r=jt(),s=ut(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ko(e).W("collectionPathOverlayIndex",o).next(a=>{for(const c of a){const u=Yh(this.yt,c);r.set(u.getKey(),u)}return r})}getOverlaysForCollectionGroup(e,t,i,r){const s=jt();let o;const a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ko(e).Z({index:"collectionGroupOverlayIndex",range:a},(c,u,d)=>{const h=Yh(this.yt,u);s.size()<r||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):d.done()}).next(()=>s)}oe(e,t){return ko(e).put(function(i,r,s){const[o,a,c]=HE(r,s.mutation.key);return{userId:r,collectionPath:a,documentId:c,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:Ao(i.ie,s.mutation)}}(this.yt,this.userId,t))}}function ko(n){return $e(n,"documentOverlays")}class Li{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(Ee(e.integerValue));else if("doubleValue"in e){const i=Ee(e.doubleValue);isNaN(i)?this.he(t,13):(this.he(t,15),co(i)?t.le(0):t.le(i))}else if("timestampValue"in e){const i=e.timestampValue;this.he(t,20),"string"==typeof i?t.fe(i):(t.fe(`${i.seconds||""}`),t.le(i.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(xi(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.he(t,45),t.le(i.latitude||0),t.le(i.longitude||0)}else"mapValue"in e?LT(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):N()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const i=e.fields||{};this.he(t,55);for(const r of Object.keys(i))this.de(r,t),this.ce(i[r],t)}ye(e,t){const i=e.values||[];this.he(t,50);for(const r of i)this.ce(r,t)}me(e,t){this.he(t,37),C.fromName(e).path.forEach(i=>{this.he(t,60),this.pe(i,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function OD(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function YE(n){const e=64-function(t){let i=0;for(let r=0;r<8;++r){const s=OD(255&t[r]);if(i+=s,8!==s)break}return i}(n);return Math.ceil(e/8)}Li.Ie=new Li;class MD{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Ee(i.value),i=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.be(i.value),i=t.next();this.Pe()}ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Ee(i);else if(i<2048)this.Ee(960|i>>>6),this.Ee(128|63&i);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i);else{const r=t.codePointAt(0);this.Ee(240|r>>>18),this.Ee(128|63&r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r)}}this.Ae()}Ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.be(i);else if(i<2048)this.be(960|i>>>6),this.be(128|63&i);else if(t<"\ud800"||"\udbff"<t)this.be(480|i>>>12),this.be(128|63&i>>>6),this.be(128|63&i);else{const r=t.codePointAt(0);this.be(240|r>>>18),this.be(128|63&r>>>12),this.be(128|63&r>>>6),this.be(128|63&r)}}this.Pe()}Se(e){const t=this.De(e),i=YE(t);this.Ce(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}xe(e){const t=this.De(e),i=YE(t);this.Ce(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(r){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,r,!1),new Uint8Array(s.buffer)}(e),i=!!(128&t[0]);t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}}class LD{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class FD{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class Co{constructor(){this.$e=new MD,this.Be=new LD(this.$e),this.Le=new FD(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class Fi{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new Fi(this.indexId,this.documentKey,this.arrayValue,i)}}function Kn(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=XE(n.arrayValue,e.arrayValue),0!==t?t:(t=XE(n.directionalValue,e.directionalValue),0!==t?t:C.comparator(n.documentKey,e.documentKey)))}function XE(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(0!==i)return i}return n.length-e.length}class UD{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const i=t;i.isInequality()?this.Qe=i:this.Ge.push(i)}}je(e){P(e.collectionGroup===this.collectionId);const t=Ah(e);if(void 0!==t&&!this.We(t))return!1;const i=Ei(e);let r=0,s=0;for(;r<i.length&&this.We(i[r]);++r);if(r===i.length)return!0;if(void 0!==this.Qe){const o=i[r];if(!this.ze(this.Qe,o)||!this.He(this.Ke[s++],o))return!1;++r}for(;r<i.length;++r)if(s>=this.Ke.length||!this.He(this.Ke[s++],i[r]))return!1;return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function JE(n){var e,t;if(P(n instanceof z||n instanceof se),n instanceof z){if(n instanceof KT){const r=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>z.create(n.field,"==",s)))||[];return se.create(r,"or")}return n}const i=n.filters.map(r=>JE(r));return se.create(i,n.op)}function VD(n){if(0===n.getFilters().length)return[];const e=Zh(JE(n));return P(ZE(e)),Xh(e)||Jh(e)?[e]:e.getFilters()}function Xh(n){return n instanceof z}function Jh(n){return n instanceof se&&Dh(n)}function ZE(n){return Xh(n)||Jh(n)||function(e){if(e instanceof se&&Ph(e)){for(const t of e.getFilters())if(!Xh(t)&&!Jh(t))return!1;return!0}return!1}(n)}function Zh(n){if(P(n instanceof z||n instanceof se),n instanceof z)return n;if(1===n.filters.length)return Zh(n.filters[0]);const e=n.filters.map(i=>Zh(i));let t=se.create(e,n.op);return t=Jc(t),ZE(t)?t:(P(t instanceof se),P(Ar(t)),P(t.filters.length>1),t.filters.reduce((i,r)=>ef(i,r)))}function ef(n,e){let t;return P(n instanceof z||n instanceof se),P(e instanceof z||e instanceof se),t=n instanceof z?e instanceof z?se.create([n,e],"and"):ew(n,e):e instanceof z?ew(e,n):function(i,r){if(P(i.filters.length>0&&r.filters.length>0),Ar(i)&&Ar(r))return WT(i,r.getFilters());const s=Ph(i)?i:r,o=Ph(i)?r:i,a=s.filters.map(c=>ef(c,o));return se.create(a,"or")}(n,e),Jc(t)}function ew(n,e){if(Ar(e))return WT(e,n.getFilters());{const t=e.filters.map(i=>ef(n,i));return se.create(t,"or")}}function Jc(n){if(P(n instanceof z||n instanceof se),n instanceof z)return n;const e=n.getFilters();if(1===e.length)return Jc(e[0]);if(qT(n))return n;const t=e.map(r=>Jc(r)),i=[];return t.forEach(r=>{r instanceof z?i.push(r):r instanceof se&&(r.op===n.op?i.push(...r.filters):i.push(r))}),1===i.length?i[0]:se.create(i,n.op)}class GD{constructor(){this.Je=new tf}addToCollectionParentIndex(e,t){return this.Je.add(t),_.resolve()}getCollectionParents(e,t){return _.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return _.resolve()}deleteFieldIndex(e,t){return _.resolve()}getDocumentsMatchingTarget(e,t){return _.resolve(null)}getIndexType(e,t){return _.resolve(0)}getFieldIndexes(e,t){return _.resolve([])}getNextCollectionGroupToUpdate(e){return _.resolve(null)}getMinOffset(e,t){return _.resolve(It.min())}getMinOffsetFromCollectionGroup(e,t){return _.resolve(It.min())}updateCollectionGroup(e,t,i){return _.resolve()}updateIndexEntries(e,t){return _.resolve()}}class tf{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new ae(X.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new ae(X.comparator)).toArray()}}const Zc=new Uint8Array(0);class BD{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new tf,this.Xe=new $n(i=>Si(i),(i,r)=>po(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const s={collectionId:i,parent:ut(r)};return tw(e).put(s)}return _.resolve()}getCollectionParents(e,t){const i=[],r=IDBKeyRange.bound([t,""],[wT(t),""],!1,!0);return tw(e).W(r).next(s=>{for(const o of s){if(o.collectionId!==t)break;i.push($t(o.parent))}return i})}addFieldIndex(e,t){const i=eu(e),r={indexId:(o=t).indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])};var o;delete r.indexId;const s=i.add(r);if(t.indexState){const o=Ro(e);return s.next(a=>{o.put(KE(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const i=eu(e),r=Ro(e),s=So(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const i=So(e);let r=!0;const s=new Map;return _.forEach(this.Ze(t),o=>this.tn(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=B();const a=[];return _.forEach(s,(c,u)=>{var d;w("IndexedDbIndexManager",`Using index ${d=c,`id=${d.indexId}|cg=${d.collectionGroup}|f=${d.fields.map(q=>`${q.fieldPath}:${q.kind}`).join(",")}`} to execute ${Si(t)}`);const h=function(q,de){const te=Ah(de);if(void 0===te)return null;for(const K of Bc(q,te.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null}(u,c),p=function(q,de){const te=new Map;for(const K of Ei(de))for(const Ie of Bc(q,K.fieldPath))switch(Ie.op){case"==":case"in":te.set(K.fieldPath.canonicalString(),Ie.value);break;case"not-in":case"!=":return te.set(K.fieldPath.canonicalString(),Ie.value),Array.from(te.values())}return null}(u,c),m=function(q,de){const te=[];let K=!0;for(const Ie of Ei(de)){const En=0===Ie.kind?YT(q,Ie.fieldPath,q.startAt):XT(q,Ie.fieldPath,q.startAt);te.push(En.value),K&&(K=En.inclusive)}return new Wn(te,K)}(u,c),g=function(q,de){const te=[];let K=!0;for(const Ie of Ei(de)){const En=0===Ie.kind?XT(q,Ie.fieldPath,q.endAt):YT(q,Ie.fieldPath,q.endAt);te.push(En.value),K&&(K=En.inclusive)}return new Wn(te,K)}(u,c),I=this.en(c,u,m),A=this.en(c,u,g),$=this.nn(c,u,p),Z=this.sn(c.indexId,h,I,m.inclusive,A,g.inclusive,$);return _.forEach(Z,q=>i.J(q,t.limit).next(de=>{de.forEach(te=>{const K=C.fromSegments(te.documentKey);o.has(K)||(o=o.add(K),a.push(K))})}))}).next(()=>a)}return _.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:VD(se.create(e.filters,"and")).map(i=>Mh(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,i,r,s,o,a){const c=(null!=t?t.length:1)*Math.max(i.length,s.length),u=c/(null!=t?t.length:1),d=[];for(let h=0;h<c;++h){const p=t?this.rn(t[h/u]):Zc,m=this.on(e,p,i[h%u],r),g=this.un(e,p,s[h%u],o),I=a.map(A=>this.on(e,p,A,!0));d.push(...this.createRange(m,g,I))}return d}on(e,t,i,r){const s=new Fi(e,C.empty(),t,i);return r?s:s.Ue()}un(e,t,i,r){const s=new Fi(e,C.empty(),t,i);return r?s.Ue():s}tn(e,t){const i=new UD(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(const a of s)i.je(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2;const r=this.Ze(t);return _.forEach(r,s=>this.tn(e,s).next(o=>{o?0!==i&&o.fields.length<function(a){let c=new ae(Ce.comparator),u=!1;for(const d of a.filters)for(const h of d.getFlattenedFilters())h.field.isKeyField()||("array-contains"===h.op||"array-contains-any"===h.op?u=!0:c=c.add(h.field));for(const d of a.orderBy)d.field.isKeyField()||(c=c.add(d.field));return c.size+(u?1:0)}(s)&&(i=1):i=0})).next(()=>null!==t.limit&&r.length>1&&2===i?1:i)}cn(e,t){const i=new Co;for(const r of Ei(e)){const s=t.data.field(r.fieldPath);if(null==s)return null;const o=i.qe(r.kind);Li.Ie.ue(s,o)}return i.Fe()}rn(e){const t=new Co;return Li.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const i=new Co;return Li.Ie.ue(Ci(this.databaseId,t),i.qe(function(r){const s=Ei(r);return 0===s.length?0:s[s.length-1].kind}(e))),i.Fe()}nn(e,t,i){if(null===i)return[];let r=[];r.push(new Co);let s=0;for(const o of Ei(e)){const a=i[s++];for(const c of r)if(this.hn(t,o.fieldPath)&&ho(a))r=this.ln(r,o,a);else{const u=c.qe(o.kind);Li.Ie.ue(a,u)}}return this.fn(r)}en(e,t,i){return this.nn(e,t,i.position)}fn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Fe();return t}ln(e,t,i){const r=[...e],s=[];for(const o of i.arrayValue.values||[])for(const a of r){const c=new Co;c.seed(a.Fe()),Li.Ie.ue(o,c.qe(t.kind)),s.push(c)}return s}hn(e,t){return!!e.filters.find(i=>i instanceof z&&i.field.isEqual(t)&&("in"===i.op||"not-in"===i.op))}getFieldIndexes(e,t){const i=eu(e),r=Ro(e);return(t?i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.W()).next(s=>{const o=[];return _.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(function(u,d){const h=d?new so(d.sequenceNumber,new It(Oi(d.readTime),new C($t(d.documentKey)),d.largestBatchId)):so.empty(),p=u.fields.map(([m,g])=>new Mc(Ce.fromServerFormat(m),g));return new Oc(u.indexId,u.collectionGroup,p,h)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((i,r)=>{const s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return 0!==s?s:F(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const r=eu(e),s=Ro(e);return this.dn(e).next(o=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>_.forEach(a,c=>s.put(KE(c.indexId,this.user,o,i)))))}updateIndexEntries(e,t){const i=new Map;return _.forEach(t,(r,s)=>{const o=i.get(r.collectionGroup);return(o?_.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),_.forEach(a,c=>this._n(e,r,c).next(u=>{const d=this.wn(s,c);return u.isEqual(d)?_.resolve():this.mn(e,s,c,u,d)}))))})}gn(e,t,i,r){return So(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(i,t.key),documentKey:t.key.path.toArray()})}yn(e,t,i,r){return So(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(i,t.key),t.key.path.toArray()])}_n(e,t,i){const r=So(e);let s=new ae(Kn);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.an(i,t)])},(o,a)=>{s=s.add(new Fi(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}wn(e,t){let i=new ae(Kn);const r=this.cn(t,e);if(null==r)return i;const s=Ah(t);if(null!=s){const o=e.data.field(s.fieldPath);if(ho(o))for(const a of o.arrayValue.values||[])i=i.add(new Fi(t.indexId,e.key,this.rn(a),r))}else i=i.add(new Fi(t.indexId,e.key,Zc,r));return i}mn(e,t,i,r,s){w("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,c,u,d,h){const p=a.getIterator(),m=c.getIterator();let g=kr(p),I=kr(m);for(;g||I;){let A=!1,$=!1;if(g&&I){const Z=u(g,I);Z<0?$=!0:Z>0&&(A=!0)}else null!=g?$=!0:A=!0;A?(d(I),I=kr(m)):$?(h(g),g=kr(p)):(g=kr(p),I=kr(m))}}(r,s,Kn,a=>{o.push(this.gn(e,t,i,a))},a=>{o.push(this.yn(e,t,i,a))}),_.waitFor(o)}dn(e){let t=1;return Ro(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>Kn(o,a)).filter((o,a,c)=>!a||0!==Kn(o,c[a-1]));const r=[];r.push(e);for(const o of i){const a=Kn(o,e),c=Kn(o,t);if(0===a)r[0]=e.Ue();else if(a>0&&c<0)r.push(o),r.push(o.Ue());else if(c>0)break}r.push(t);const s=[];for(let o=0;o<r.length;o+=2){if(this.pn(r[o],r[o+1]))return[];s.push(IDBKeyRange.bound([r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,Zc,[]],[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,Zc,[]]))}return s}pn(e,t){return Kn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(nw)}getMinOffset(e,t){return _.mapArray(this.Ze(t),i=>this.tn(e,i).next(r=>r||N())).next(nw)}}function tw(n){return $e(n,"collectionParents")}function So(n){return $e(n,"indexEntries")}function eu(n){return $e(n,"indexConfiguration")}function Ro(n){return $e(n,"indexState")}function nw(n){P(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const r=n[i].indexState.offset;xh(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new It(e.readTime,e.documentKey,t)}const iw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ft{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new ft(e,ft.DEFAULT_COLLECTION_PERCENTILE,ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function rw(n,e,t){const i=n.store("mutations"),r=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=i.Z({range:o},(d,h,p)=>(a++,p.delete()));s.push(c.next(()=>{P(1===a)}));const u=[];for(const d of t.mutations){const h=VE(e,d.key.path,t.batchId);s.push(r.delete(h)),u.push(d.key)}return _.waitFor(s).next(()=>u)}function tu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw N();e=n.noDocument}return JSON.stringify(e).length}ft.DEFAULT_COLLECTION_PERCENTILE=10,ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ft.DEFAULT=new ft(41943040,ft.DEFAULT_COLLECTION_PERCENTILE,ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ft.DISABLED=new ft(-1,0,0);class nu{constructor(e,t,i,r){this.userId=e,this.yt=t,this.indexManager=i,this.referenceDelegate=r,this.In={}}static re(e,t,i,r){P(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new nu(s,t,i,r)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zn(e).Z({index:"userMutationsIndex",range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){const s=Lr(e),o=zn(e);return o.add({}).next(a=>{P("number"==typeof a);const c=new Hh(a,t,i,r),u=function(p,m,g){const I=g.baseMutations.map($=>Ao(p.ie,$)),A=g.mutations.map($=>Ao(p.ie,$));return{userId:m,batchId:g.batchId,localWriteTimeMs:g.localWriteTime.toMillis(),baseMutations:I,mutations:A}}(this.yt,this.userId,c),d=[];let h=new ae((p,m)=>F(p.canonicalString(),m.canonicalString()));for(const p of r){const m=VE(this.userId,p.key.path,a);h=h.add(p.key.path.popLast()),d.push(o.put(u)),d.push(s.put(m,mD))}return h.forEach(p=>{d.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.In[a]=c.keys()}),_.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return zn(e).get(t).next(i=>i?(P(i.userId===this.userId),Mi(this.yt,i)):null)}Tn(e,t){return this.In[t]?_.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const r=i.keys();return this.In[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]);let s=null;return zn(e).Z({index:"userMutationsIndex",range:r},(o,a,c)=>{a.userId===this.userId&&(P(a.batchId>=i),s=Mi(this.yt,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return zn(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return zn(e).W("userMutationsIndex",t).next(i=>i.map(r=>Mi(this.yt,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=Qc(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return Lr(e).Z({range:r},(o,a,c)=>{const[u,d,h]=o,p=$t(d);if(u===this.userId&&t.path.isEqual(p))return zn(e).get(h).next(m=>{if(!m)throw N();P(m.userId===this.userId),s.push(Mi(this.yt,m))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ae(F);const r=[];return t.forEach(s=>{const o=Qc(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=Lr(e).Z({range:a},(u,d,h)=>{const[p,m,g]=u,I=$t(m);p===this.userId&&s.path.isEqual(I)?i=i.add(g):h.done()});r.push(c)}),_.waitFor(r).next(()=>this.En(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1,s=Qc(this.userId,i),o=IDBKeyRange.lowerBound(s);let a=new ae(F);return Lr(e).Z({range:o},(c,u,d)=>{const[h,p,m]=c,g=$t(p);h===this.userId&&i.isPrefixOf(g)?g.length===r&&(a=a.add(m)):d.done()}).next(()=>this.En(e,a))}En(e,t){const i=[],r=[];return t.forEach(s=>{r.push(zn(e).get(s).next(o=>{if(null===o)throw N();P(o.userId===this.userId),i.push(Mi(this.yt,o))}))}),_.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return rw(e.se,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),_.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return _.resolve();const i=IDBKeyRange.lowerBound([this.userId]),r=[];return Lr(e).Z({range:i},(s,o,a)=>{if(s[0]===this.userId){const c=$t(s[1]);r.push(c)}else a.done()}).next(()=>{P(0===r.length)})})}containsKey(e,t){return sw(e,this.userId,t)}Rn(e){return ow(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sw(n,e,t){const i=Qc(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i);let o=!1;return Lr(n).Z({range:s,X:!0},(a,c,u)=>{const[d,h,p]=a;d===e&&h===r&&(o=!0),u.done()}).next(()=>o)}function zn(n){return $e(n,"mutations")}function Lr(n){return $e(n,"documentMutations")}function ow(n){return $e(n,"mutationQueues")}class Ui{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Ui(0)}static vn(){return new Ui(-1)}}class qD{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const i=new Ui(t.highestTargetId);return t.highestTargetId=i.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>O.fromTimestamp(new ye(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Vn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(i=>(i.targetCount+=1,this.Cn(t,i),this.Sn(e,i))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Fr(e).delete(t.targetId)).next(()=>this.Vn(e)).next(i=>(P(i.targetCount>0),i.targetCount-=1,this.Sn(e,i)))}removeTargets(e,t,i){let r=0;const s=[];return Fr(e).Z((o,a)=>{const c=xo(a);c.sequenceNumber<=t&&null===i.get(c.targetId)&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>_.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Fr(e).Z((i,r)=>{const s=xo(r);t(s)})}Vn(e){return aw(e).get("targetGlobalKey").next(t=>(P(null!==t),t))}Sn(e,t){return aw(e).put("targetGlobalKey",t)}Dn(e,t){return Fr(e).put($E(this.yt,t))}Cn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const i=Si(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let s=null;return Fr(e).Z({range:r,index:"queryTargetsIndex"},(o,a,c)=>{const u=xo(a);po(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,i){const r=[],s=Qn(e);return t.forEach(o=>{const a=ut(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),_.waitFor(r)}removeMatchingKeys(e,t,i){const r=Qn(e);return _.forEach(t,s=>{const o=ut(s.path);return _.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){const i=Qn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),r=Qn(e);let s=B();return r.Z({range:i,X:!0},(o,a,c)=>{const u=$t(o[1]),d=new C(u);s=s.add(d)}).next(()=>s)}containsKey(e,t){const i=ut(t.path),r=IDBKeyRange.bound([i],[wT(i)],!1,!0);let s=0;return Qn(e).Z({index:"documentTargetsIndex",X:!0,range:r},([o,a],c,u)=>{0!==o&&(s++,u.done())}).next(()=>s>0)}ne(e,t){return Fr(e).get(t).next(i=>i?xo(i):null)}}function Fr(n){return $e(n,"targets")}function aw(n){return $e(n,"targetGlobal")}function Qn(n){return $e(n,"targetDocuments")}function cw([n,e],[t,i]){const r=F(n,t);return 0===r?F(e,i):r}class jD{constructor(e){this.xn=e,this.buffer=new ae(cw),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();cw(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class WD{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;w("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,f.A)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(i){Gn(i)?w("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i):yield Vn(i)}yield t.Fn(3e5)}))}}class $D{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(0===t)return _.resolve(Tt.at);const i=new jD(t);return this.$n.forEachTarget(e,r=>i.On(r.sequenceNumber)).next(()=>this.$n.Ln(e,r=>i.On(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.$n.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector","Garbage collection skipped; disabled"),_.resolve(iw)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),iw):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let i,r,s,o,a,c,u;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(w("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,o=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(i=h,a=Date.now(),this.removeTargets(e,i,t))).next(h=>(s=h,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(h=>(u=Date.now(),wh()<=st.$b.DEBUG&&w("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-d}ms\n\tDetermined least recently used ${r} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(c-a)+`ms\n\tRemoved ${h} documents in `+(u-c)+`ms\nTotal Duration: ${u-d}ms`),_.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:h})))}}class HD{constructor(e,t){this.db=e,this.garbageCollector=new $D(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}Un(e){let t=0;return this.Ln(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(i,r)=>t(r))}addReference(e,t,i){return iu(e,i)}removeReference(e,t,i){return iu(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return iu(e,t)}Gn(e,t){return function(i,r){let s=!1;return ow(i).tt(o=>sw(i,o,r).next(a=>(a&&(s=!0),_.resolve(!a)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Kn(e,(o,a)=>{if(a<=t){const c=this.Gn(e,o).next(u=>{if(!u)return s++,i.getEntry(e,o).next(()=>(i.removeEntry(o,O.min()),Qn(e).delete([0,ut(o.path)])))});r.push(c)}}).next(()=>_.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return iu(e,t)}Kn(e,t){const i=Qn(e);let r,s=Tt.at;return i.Z({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{0===o?(s!==Tt.at&&t(new C($t(r)),s),s=u,r=c):s=Tt.at}).next(()=>{s!==Tt.at&&t(new C($t(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function iu(n,e){return Qn(n).put((i=n.currentSequenceNumber,{targetId:0,path:ut(e.path),sequenceNumber:i}));var i}class uw{constructor(){this.changes=new $n(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,he.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return void 0!==i?_.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class KD{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return Vi(e).put(i)}removeEntry(e,t,i){return Vi(e).delete(function(r,s){const o=r.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],Yc(s),o[o.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.Qn(e,i)))}getEntry(e,t){let i=he.newInvalidDocument(t);return Vi(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(No(t))},(r,s)=>{i=this.jn(t,s)}).next(()=>i)}Wn(e,t){let i={size:0,document:he.newInvalidDocument(t)};return Vi(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(No(t))},(r,s)=>{i={document:this.jn(t,s),size:tu(s)}}).next(()=>i)}getEntries(e,t){let i=ht();return this.zn(e,t,(r,s)=>{const o=this.jn(r,s);i=i.insert(r,o)}).next(()=>i)}Hn(e,t){let i=ht(),r=new we(C.comparator);return this.zn(e,t,(s,o)=>{const a=this.jn(s,o);i=i.insert(s,a),r=r.insert(s,tu(o))}).next(()=>({documents:i,Jn:r}))}zn(e,t,i){if(t.isEmpty())return _.resolve();let r=new ae(fw);t.forEach(c=>r=r.add(c));const s=IDBKeyRange.bound(No(r.first()),No(r.last())),o=r.getIterator();let a=o.getNext();return Vi(e).Z({index:"documentKeyIndex",range:s},(c,u,d)=>{const h=C.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&fw(a,h)<0;)i(a,null),a=o.getNext();a&&a.isEqual(h)&&(i(a,u),a=o.hasNext()?o.getNext():null),a?d.j(No(a)):d.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),Yc(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Vi(e).W(IDBKeyRange.bound(o,a,!0)).next(c=>{let u=ht();for(const d of c){const h=this.jn(C.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(go(t,h)||r.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,i,r){let s=ht();const o=hw(t,i),a=hw(t,It.max());return Vi(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{const h=this.jn(C.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(h.key,h),s.size===r&&d.done()}).next(()=>s)}newChangeBuffer(e){return new zD(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return dw(e).get("remoteDocumentGlobalKey").next(t=>(P(!!t),t))}Qn(e,t){return dw(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const i=function PD(n,e){let t;if(e.document)t=function NE(n,e,t){const i=Wt(n,e.name),r=Se(e.updateTime),s=e.createTime?Se(e.createTime):O.min(),o=new Je({mapValue:{fields:e.fields}}),a=he.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=C.fromSegments(e.noDocument.path),r=Oi(e.noDocument.readTime);t=he.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return N();{const i=C.fromSegments(e.unknownDocument.path),r=Oi(e.unknownDocument.version);t=he.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(i){const r=new ye(i[0],i[1]);return O.fromTimestamp(r)}(e.readTime)),t}(this.yt,t);if(!i.isNoDocument()||!i.version.isEqual(O.min()))return i}return he.newInvalidDocument(e)}}function lw(n){return new KD(n)}class zD extends uw{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new $n(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){const t=[];let i=0,r=new ae((s,o)=>F(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.Xn.get(s);if(t.push(this.Yn.removeEntry(e,s,a.readTime)),o.isValidDocument()){const c=WE(this.Yn.yt,o);r=r.add(s.path.popLast());const u=tu(c);i+=u-a.size,t.push(this.Yn.addEntry(e,s,c))}else if(i-=a.size,this.trackRemovals){const c=WE(this.Yn.yt,o.convertToNoDocument(O.min()));t.push(this.Yn.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Yn.updateMetadata(e,i)),_.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(i=>(this.Xn.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:i,Jn:r})=>(r.forEach((s,o)=>{this.Xn.set(s,{size:o,readTime:i.get(s).readTime})}),i))}}function dw(n){return $e(n,"remoteDocumentGlobal")}function Vi(n){return $e(n,"remoteDocumentsV14")}function No(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function hw(n,e){const t=e.documentKey.path.toArray();return[n,Yc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function fw(n,e){const t=n.path.toArray(),i=e.path.toArray();let r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=F(t[s],i[s]),r)return r;return r=F(t.length,i.length),r||(r=F(t[t.length-2],i[i.length-2]),r||F(t[t.length-1],i[i.length-1]))}class QD{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class pw{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(null!==i&&yo(i.mutation,r,dt.empty(),ye.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,B()).next(()=>i))}getLocalViewOfDocuments(e,t,i=B()){const r=jt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=vo();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const i=jt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,B()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=ht();const o=Io(),a=Io();return t.forEach((c,u)=>{const d=i.get(u.key);r.has(u.key)&&(void 0===d||d.mutation instanceof cn)?s=s.insert(u.key,u):void 0!==d?(o.set(u.key,d.mutation.getFieldMask()),yo(d.mutation,u,d.mutation.getFieldMask(),ye.now())):o.set(u.key,dt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var h;return a.set(u,new QD(d,null!==(h=o.get(u))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const i=Io();let r=new we((o,a)=>o-a),s=B();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const u=t.get(c);if(null===u)return;let d=i.get(c)||dt.empty();d=a.applyToLocalView(u,d),i.set(c,d);const h=(r.get(a.batchId)||B()).add(c);r=r.insert(a.batchId,h)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),u=c.key,d=c.value,h=IE();d.forEach(p=>{if(!s.has(p)){const m=dE(t.get(p),i.get(p));null!==m&&h.set(p,m),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return _.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i){return C.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Fh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i):this.getDocumentsMatchingCollectionQuery(e,t,i);var r}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):_.resolve(jt());let a=-1,c=s;return o.next(u=>_.forEach(u,(d,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(d)?_.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{c=c.insert(d,p)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,B())).next(d=>({batchId:a,changes:vE(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new C(t)).next(i=>{let r=vo();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i){const r=t.collectionGroup;let s=vo();return this.indexManager.getCollectionParents(e,r).next(o=>_.forEach(o,a=>{const c=(u=t,d=a.child(r),new an(d,null,u.explicitOrderBy.slice(),u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt));var u,d;return this.getDocumentsMatchingCollectionQuery(e,c,i).next(u=>{u.forEach((d,h)=>{s=s.insert(d,h)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,r))).next(s=>{r.forEach((a,c)=>{const u=c.getKey();null===s.get(u)&&(s=s.insert(u,he.newInvalidDocument(u)))});let o=vo();return s.forEach((a,c)=>{const u=r.get(a);void 0!==u&&yo(u.mutation,c,dt.empty(),ye.now()),go(t,c)&&(o=o.insert(a,c))}),o})}}class YD{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return _.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var i;return this.Zn.set(t.id,{id:(i=t).id,version:i.version,createTime:Se(i.createTime)}),_.resolve()}getNamedQuery(e,t){return _.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(i=t).name,query:Qh(i.bundledQuery),readTime:Se(i.readTime)}),_.resolve();var i}}class XD{constructor(){this.overlays=new we(C.comparator),this.es=new Map}getOverlay(e,t){return _.resolve(this.overlays.get(t))}getOverlays(e,t){const i=jt();return _.forEach(t,r=>this.getOverlay(e,r).next(s=>{null!==s&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.oe(e,t,s)}),_.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.es.get(i);return void 0!==r&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(i)),_.resolve()}getOverlaysForCollection(e,t,i){const r=jt(),s=t.length+1,o=new C(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return _.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new we((u,d)=>u-d);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let d=s.get(u.largestBatchId);null===d&&(d=jt(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const a=jt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=r)););return _.resolve(a)}oe(e,t,i){const r=this.overlays.get(i.key);if(null!==r){const o=this.es.get(r.largestBatchId).delete(i.key);this.es.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new zh(t,i));let s=this.es.get(t);void 0===s&&(s=B(),this.es.set(t,s)),this.es.set(t,s.add(i.key))}}class nf{constructor(){this.ns=new ae(He.ss),this.rs=new ae(He.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const i=new He(e,t);this.ns=this.ns.add(i),this.rs=this.rs.add(i)}us(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.cs(new He(e,t))}hs(e,t){e.forEach(i=>this.removeReference(i,t))}ls(e){const t=new C(new X([])),i=new He(t,e),r=new He(t,e+1),s=[];return this.rs.forEachInRange([i,r],o=>{this.cs(o),s.push(o.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new C(new X([])),i=new He(t,e),r=new He(t,e+1);let s=B();return this.rs.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new He(e,0),i=this.ns.firstAfterOrEqual(t);return null!==i&&e.isEqual(i.key)}}class He{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return C.comparator(e.key,t.key)||F(e._s,t._s)}static os(e,t){return F(e._s,t._s)||C.comparator(e.key,t.key)}}class JD{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new ae(He.ss)}checkEmpty(e){return _.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,i,r){const s=this.ws;this.ws++;const o=new Hh(s,t,i,r);this.mutationQueue.push(o);for(const a of r)this.gs=this.gs.add(new He(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return _.resolve(o)}lookupMutationBatch(e,t){return _.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const r=this.ps(t+1),s=r<0?0:r;return _.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return _.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new He(t,0),r=new He(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([i,r],o=>{const a=this.ys(o._s);s.push(a)}),_.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ae(F);return t.forEach(r=>{const s=new He(r,0),o=new He(r,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,o],a=>{i=i.add(a._s)})}),_.resolve(this.Is(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;C.isDocumentKey(s)||(s=s.child(""));const o=new He(new C(s),0);let a=new ae(F);return this.gs.forEachWhile(c=>{const u=c.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(a=a.add(c._s)),!0)},o),_.resolve(this.Is(a))}Is(e){const t=[];return e.forEach(i=>{const r=this.ys(i);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){P(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let i=this.gs;return _.forEach(t.mutations,r=>{const s=new He(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){const i=new He(t,0),r=this.gs.firstAfterOrEqual(i);return _.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return _.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ZD{constructor(e){this.Es=e,this.docs=new we(C.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.Es(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return _.resolve(i?i.document.mutableCopy():he.newInvalidDocument(t))}getEntries(e,t){let i=ht();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():he.newInvalidDocument(r))}),_.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=ht();const o=t.path,a=new C(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||xh(AT(d),i)<=0||(r.has(d.key)||go(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return _.resolve(s)}getAllFromCollectionGroup(e,t,i,r){N()}As(e,t){return _.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new eO(this)}getSize(e){return _.resolve(this.size)}}class eO extends uw{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(i)}),_.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class tO{constructor(e){this.persistence=e,this.Rs=new $n(t=>Si(t),po),this.lastRemoteSnapshotVersion=O.min(),this.highestTargetId=0,this.bs=0,this.Ps=new nf,this.targetCount=0,this.vs=Ui.Pn()}forEachTarget(e,t){return this.Rs.forEach((i,r)=>t(r)),_.resolve()}getLastRemoteSnapshotVersion(e){return _.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.bs&&(this.bs=t),_.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Ui(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,_.resolve()}updateTargetData(e,t){return this.Dn(t),_.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,_.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=t&&null===i.get(a.targetId)&&(this.Rs.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),_.waitFor(s).next(()=>r)}getTargetCount(e){return _.resolve(this.targetCount)}getTargetData(e,t){const i=this.Rs.get(t)||null;return _.resolve(i)}addMatchingKeys(e,t,i){return this.Ps.us(t,i),_.resolve()}removeMatchingKeys(e,t,i){this.Ps.hs(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),_.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),_.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Ps.ds(t);return _.resolve(i)}containsKey(e,t){return _.resolve(this.Ps.containsKey(t))}}class mw{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new Tt(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new tO(this),this.indexManager=new GD,this.remoteDocumentCache=new ZD(i=>this.referenceDelegate.xs(i)),this.yt=new jE(t),this.Ns=new YD(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new XD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Vs[e.toKey()];return i||(i=new JD(t,this.referenceDelegate),this.Vs[e.toKey()]=i),i}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,i){w("MemoryPersistence","Starting transaction:",e);const r=new nO(this.Ss.next());return this.referenceDelegate.ks(),i(r).next(s=>this.referenceDelegate.Os(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ms(e,t){return _.or(Object.values(this.Vs).map(i=>()=>i.containsKey(e,t)))}}class nO extends kT{constructor(e){super(),this.currentSequenceNumber=e}}class ru{constructor(e){this.persistence=e,this.Fs=new nf,this.$s=null}static Bs(e){return new ru(e)}get Ls(){if(this.$s)return this.$s;throw N()}addReference(e,t,i){return this.Fs.addReference(i,t),this.Ls.delete(i.toString()),_.resolve()}removeReference(e,t,i){return this.Fs.removeReference(i,t),this.Ls.add(i.toString()),_.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),_.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(r=>this.Ls.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Ls.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _.forEach(this.Ls,i=>{const r=C.fromPath(i);return this.qs(e,r).next(s=>{s||t.removeEntry(r,O.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(i=>{i?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return _.or([()=>_.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class iO{constructor(e){this.yt=e}$(e,t,i,r){const s=new Lc("createOrUpgrade",t);var a;i<1&&r>=1&&(e.createObjectStore("owner"),(a=e).createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",UE,{unique:!0}),a.createObjectStore("documentMutations"),gw(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=_.resolve();return i<3&&r>=3&&(0!==i&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),gw(e)),o=o.next(()=>function(a){const c=a.store("targetGlobal"),u={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:O.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",u)}(s))),i<4&&r>=4&&(0!==i&&(o=o.next(()=>function(a,c){return c.store("mutations").W().next(u=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",UE,{unique:!0});const d=c.store("mutations"),h=u.map(p=>d.put(p));return _.waitFor(h)})}(e,s))),o=o.next(()=>{!function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),i<5&&r>=5&&(o=o.next(()=>this.Us(s))),i<6&&r>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),i<7&&r>=7&&(o=o.next(()=>this.Gs(s))),i<8&&r>=8&&(o=o.next(()=>this.Qs(e,s))),i<9&&r>=9&&(o=o.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(e)})),i<10&&r>=10&&(o=o.next(()=>this.js(s))),i<11&&r>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&r>=12&&(o=o.next(()=>{!function(a){const c=a.createObjectStore("documentOverlays",{keyPath:kD});c.createIndex("collectionPathOverlayIndex",CD,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",SD,{unique:!1})}(e)})),i<13&&r>=13&&(o=o.next(()=>function(a){const c=a.createObjectStore("remoteDocumentsV14",{keyPath:gD});c.createIndex("documentKeyIndex",_D),c.createIndex("collectionGroupIndex",yD)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(o=o.next(()=>this.zs(e,s))),i<15&&r>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:wD}).createIndex("sequenceNumberIndex",bD,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:AD}).createIndex("documentKeyIndex",xD,{unique:!1})}(e))),o}Ks(e){let t=0;return e.store("remoteDocuments").Z((i,r)=>{t+=tu(r)}).next(()=>{const i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Us(e){const t=e.store("mutationQueues"),i=e.store("mutations");return t.W().next(r=>_.forEach(r,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.W("userMutationsIndex",o).next(a=>_.forEach(a,c=>{P(c.userId===s.userId);const u=Mi(this.yt,c);return rw(e,s.userId,u).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{const s=[];return i.Z((o,a)=>{const c=new X(o),u=[0,ut(c)];s.push(t.get(u).next(d=>d?_.resolve():t.put({targetId:0,path:ut(c),sequenceNumber:r.highestListenSequenceNumber})))}).next(()=>_.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:ED});const i=t.store("collectionParents"),r=new tf,s=o=>{if(r.add(o)){const a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:ut(c)})}};return t.store("remoteDocuments").Z({X:!0},(o,a)=>{const c=new X(o);return s(c.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([o,a,c],u)=>{const d=$t(a);return s(d.popLast())}))}js(e){const t=e.store("targets");return t.Z((i,r)=>{const s=xo(r),o=$E(this.yt,s);return t.put(o)})}Ws(e,t){const i=t.store("remoteDocuments"),r=[];return i.Z((s,o)=>{const a=t.store("remoteDocumentsV14"),c=(u=o,u.document?new C(X.fromString(u.document.name).popFirst(5)):u.noDocument?C.fromSegments(u.noDocument.path):u.unknownDocument?C.fromSegments(u.unknownDocument.path):N()).path.toArray();var u;const d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(d))}).next(()=>_.waitFor(r))}zs(e,t){const i=t.store("mutations"),r=lw(this.yt),s=new mw(ru.Bs,this.yt.ie);return i.W().next(o=>{const a=new Map;return o.forEach(c=>{var u;let d=null!==(u=a.get(c.userId))&&void 0!==u?u:B();Mi(this.yt,c).keys().forEach(h=>d=d.add(h)),a.set(c.userId,d)}),_.forEach(a,(c,u)=>{const d=new We(u),h=Xc.re(this.yt,d),p=s.getIndexManager(d),m=nu.re(d,this.yt,p,s.referenceDelegate);return new pw(r,m,h,p).recalculateAndSaveOverlaysForDocumentKeys(new $h(t,Tt.at),c).next()})})}}function gw(n){n.createObjectStore("targetDocuments",{keyPath:ID}).createIndex("documentTargetsIndex",TD,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",vD,{unique:!0}),n.createObjectStore("targetGlobal")}const rf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class sf{constructor(e,t,i,r,s,o,a,c,u,d,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Hs=s,this.window=o,this.document=a,this.Js=u,this.Ys=d,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=p=>Promise.resolve(),!sf.C())throw new E(v.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new HD(this,r),this.ii=t+"main",this.yt=new jE(c),this.ri=new Dt(this.ii,this.Xs,new iO(this.yt)),this.Cs=new qD(this.referenceDelegate,this.yt),this.remoteDocumentCache=lw(this.yt),this.Ns=new DD,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===d&&ke("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new E(v.FAILED_PRECONDITION,rf);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new Tt(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var i=(0,f.A)(function*(r){if(t.started)return e(r)});return function(r){return i.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,f.A)(function*(i){null===i.newVersion&&(yield e())});return function(i){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,f.A)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>su(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Gn(e))return w("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return w("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Po(e).get("owner").next(t=>_.resolve(this.mi(t)))}gi(e){return su(e).delete(this.clientId)}yi(){var e=this;return(0,f.A)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",i=>{const r=$e(i,"clientMetadata");return r.W().next(s=>{const o=e.Ii(s,18e5),a=s.filter(c=>-1===o.indexOf(c));return _.forEach(a,c=>r.delete(c.clientId)).next(()=>a)})}).catch(()=>[]);if(e.oi)for(const i of t)e.oi.removeItem(e.Ti(i.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?_.resolve(!0):Po(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new E(v.FAILED_PRECONDITION,rf);return!1}}return!(!this.networkEnabled||!this.inForeground)||su(e).W().next(i=>void 0===this.Ii(i,5e3).find(r=>!(this.clientId===r.clientId||!(!this.networkEnabled&&r.networkEnabled||!this.inForeground&&r.inForeground&&this.networkEnabled===r.networkEnabled))))}).next(t=>(this.isPrimary!==t&&w("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,f.A)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const i=new $h(t,Tt.at);return e._i(i).next(()=>e.gi(i))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(i=>this.pi(i.updateTimeMs,t)&&!this.Ei(i.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>su(e).W().next(t=>this.Ii(t,18e5).map(i=>i.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return nu.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new BD(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return Xc.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,i){w("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",s=15===(o=this.Xs)?ND:14===o?qE:13===o?BE:12===o?RD:11===o?GE:void N();var o;let a;return this.ri.runTransaction(e,r,s,c=>(a=new $h(c,this.Ss?this.Ss.next():Tt.at),"readwrite-primary"===t?this.fi(a).next(u=>!!u||this.di(a)).next(u=>{if(!u)throw ke(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new E(v.FAILED_PRECONDITION,xT);return i(a)}).next(u=>this.wi(a).next(()=>u)):this.Vi(a).next(()=>i(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}Vi(e){return Po(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new E(v.FAILED_PRECONDITION,rf)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Po(e).put("owner",t)}static C(){return Dt.C()}_i(e){const t=Po(e);return t.get("owner").next(i=>this.mi(i)?(w("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):_.resolve())}pi(e,t){const i=Date.now();return!(e<i-t||e>i&&(ke(`Detected an update time that is in the future: ${e} > ${i}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),function Ck(){return!function Ak(){var n;const e=null===(n=va())||void 0===n?void 0:n.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const i=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return w("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return ke("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){ke("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch{}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Po(n){return $e(n,"owner")}function su(n){return $e(n,"clientMetadata")}class af{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Si=i,this.Di=r}static Ci(e,t){let i=B(),r=B();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new af(e,t.fromCache,i,r)}}class _w{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,i,r){return this.ki(e,t).next(s=>s||this.Oi(e,t,r,i)).next(s=>s||this.Mi(e,t))}ki(e,t){if(ZT(t))return _.resolve(null);let i=ct(t);return this.indexManager.getIndexType(e,i).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=jc(t,null,"F"),i=ct(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const o=B(...s);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{const u=this.Fi(t,a);return this.$i(t,u,o,c.readTime)?this.ki(e,jc(t,null,"F")):this.Bi(e,u,t,c)}))})))}Oi(e,t,i,r){return ZT(t)||r.isEqual(O.min())?this.Mi(e,t):this.Ni.getDocuments(e,i).next(s=>{const o=this.Fi(t,s);return this.$i(t,o,i,r)?this.Mi(e,t):(wh()<=st.$b.DEBUG&&w("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Vh(t)),this.Bi(e,o,t,function bT(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=O.fromTimestamp(1e9===i?new ye(t+1,0):new ye(t,i));return new It(r,C.empty(),e)}(r,-1)))})}Fi(e,t){let i=new ae(nE(e));return t.forEach((r,s)=>{go(e,s)&&(i=i.add(s))}),i}$i(e,t,i,r){if(null===e.limit)return!1;if(i.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Mi(e,t){return wh()<=st.$b.DEBUG&&w("QueryEngine","Using full collection scan to execute query:",Vh(t)),this.Ni.getDocumentsMatchingQuery(e,t,It.min())}Bi(e,t,i,r){return this.Ni.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class rO{constructor(e,t,i,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new we(F),this.Ui=new $n(s=>Si(s),po),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(i)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new pw(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function yw(n,e,t,i){return new rO(n,e,t,i)}function vw(n,e){return cf.apply(this,arguments)}function cf(){return cf=(0,f.A)(function*(n,e){const t=S(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Qi(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const o=[],a=[];let c=B();for(const u of r){o.push(u.batchId);for(const d of u.mutations)c=c.add(d.key)}for(const u of s){a.push(u.batchId);for(const d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({ji:u,removedBatchIds:o,addedBatchIds:a}))})})}),cf.apply(this,arguments)}function Iw(n){const e=S(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function aO(n,e){const t=S(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function Vr(n,e,t){return uf.apply(this,arguments)}function uf(){return uf=(0,f.A)(function*(n,e,t){const i=S(n),r=i.qi.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!Gn(o))throw o;w("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.qi=i.qi.remove(e),i.Ui.delete(r.target)}),uf.apply(this,arguments)}function ou(n,e,t){const i=S(n);let r=O.min(),s=B();return i.persistence.runTransaction("Execute query","readonly",o=>function(a,c,u){const d=S(a),h=d.Ui.get(u);return void 0!==h?_.resolve(d.qi.get(h)):d.Cs.getTargetData(c,u)}(i,o,ct(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.Li.getDocumentsMatchingQuery(o,e,t?r:O.min(),t?s:B())).next(a=>(function bw(n,e,t){let i=n.Ki.get(e)||O.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Ki.set(e,i)}(i,function tE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}(e),a),{documents:a,Hi:s})))}class pf{constructor(){this.activeTargetIds=Kc()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class kw{constructor(){this.Lr=new pf,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,i){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new pf,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lO{Ur(e){}shutdown(){}}class Cw{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){w("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){w("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const dO={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class hO{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class fO extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,i,r,s){const o=this.ho(e,t);w("RestConnection","Sending: ",o,i);const a={};return this.lo(a,r,s),this.fo(e,o,a,i).then(c=>(w("RestConnection","Received: ",c),c),c=>{throw Er("RestConnection",`${e} failed with error: `,c,"url: ",o,"request:",i),c})}_o(e,t,i,r,s,o){return this.ao(e,t,i,r,s)}lo(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+Tr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}ho(e,t){return`${this.oo}/v1/${t}:${dO[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,i,r){return new Promise((s,o)=>{const a=new mP;a.setWithCredentials(!0),a.listenOnce(hP.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Eh.NO_ERROR:const u=a.getResponseJson();w("Connection","XHR received:",JSON.stringify(u)),s(u);break;case Eh.TIMEOUT:w("Connection",'RPC "'+e+'" timed out'),o(new E(v.DEADLINE_EXCEEDED,"Request time out"));break;case Eh.HTTP_ERROR:const d=a.getStatus();if(w("Connection",'RPC "'+e+'" failed with status:',d,"response text:",a.getResponseText()),d>0){let h=a.getResponseJson();Array.isArray(h)&&(h=h[0]);const p=h?.error;if(p&&p.status&&p.message){const m=function(g){const I=g.toLowerCase().replace(/_/g,"-");return Object.values(v).indexOf(I)>=0?I:v.UNKNOWN}(p.status);o(new E(m,p.message))}else o(new E(v.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new E(v.UNAVAILABLE,"Connection failed."));break;default:N()}}finally{w("Connection",'RPC "'+e+'" completed.')}});const c=JSON.stringify(r);a.send(t,"POST",c,i,15)})}wo(e,t,i){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=lP(),o=dP(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new pP({})),this.lo(a.initMessageHeaders,t,i),a.encodeInitMessageHeaders=!0;const c=r.join("");w("Connection","Creating WebChannel: "+c,a);const u=s.createWebChannel(c,a);let d=!1,h=!1;const p=new hO({Hr:g=>{h?w("Connection","Not sending because WebChannel is closed:",g):(d||(w("Connection","Opening WebChannel transport."),u.open(),d=!0),w("Connection","WebChannel sending:",g),u.send(g))},Jr:()=>u.close()}),m=(g,I,A)=>{g.listen(I,$=>{try{A($)}catch(Z){setTimeout(()=>{throw Z},0)}})};return m(u,Dc.EventType.OPEN,()=>{h||w("Connection","WebChannel transport opened.")}),m(u,Dc.EventType.CLOSE,()=>{h||(h=!0,w("Connection","WebChannel transport closed"),p.io())}),m(u,Dc.EventType.ERROR,g=>{h||(h=!0,Er("Connection","WebChannel transport errored:",g),p.io(new E(v.UNAVAILABLE,"The operation could not be completed")))}),m(u,Dc.EventType.MESSAGE,g=>{var I;if(!h){const A=g.data[0];P(!!A);const Z=A.error||(null===(I=A[0])||void 0===I?void 0:I.error);if(Z){w("Connection","WebChannel received error:",Z);const q=Z.status;let de=function(K){const Ie=Pe[K];if(void 0!==Ie)return _E(Ie)}(q),te=Z.message;void 0===de&&(de=v.INTERNAL,te="Unknown error status: "+q+" with message "+Z.message),h=!0,p.io(new E(de,te)),u.close()}else w("Connection","WebChannel received:",A),p.ro(A)}}),m(o,fP.STAT_EVENT,g=>{g.stat===yT.PROXY?w("Connection","Detected buffering proxy"):g.stat===yT.NOPROXY&&w("Connection","Detected no buffering proxy")}),setTimeout(()=>{p.so()},0),p}}function uu(){return typeof document<"u"?document:null}function Oo(n){return new rD(n,!0)}class gf{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=i,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),i=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-i);r>0&&w("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Rw{constructor(e,t,i,r,s,o,a,c){this.Hs=e,this.vo=i,this.Vo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new gf(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,f.A)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,f.A)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var i=this;return(0,f.A)(function*(){i.Lo(),i.qo(),i.xo.cancel(),i.So++,4!==e?i.xo.reset():t&&t.code===v.RESOURCE_EXHAUSTED?(ke(t.toString()),ke("Using maximum backoff delay to prevent overloading the backend."),i.xo.Ao()):t&&t.code===v.UNAUTHENTICATED&&3!==i.state&&(i.authCredentialsProvider.invalidateToken(),i.appCheckCredentialsProvider.invalidateToken()),null!==i.stream&&(i.Uo(),i.stream.close(),i.stream=null),i.state=e,yield i.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.So===t&&this.Go(i,r)},i=>{e(()=>{const r=new E(v.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Qo(r)})})}Go(e,t){const i=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{i(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(r=>{i(()=>this.Qo(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,f.A)(function*(){e.state=0,e.start()}))}Qo(e){return w("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(w("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pO extends Rw{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function aD(n,e){let t;if("targetChange"in e){const i="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:N(),r=e.targetChange.targetIds||[],s=function(c,u){return c.wt?(P(void 0===u||"string"==typeof u),Ue.fromBase64String(u||"")):(P(void 0===u||u instanceof Uint8Array),Ue.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const u=void 0===c.code?v.UNKNOWN:_E(c.code);return new E(u,c.message||"")}(o);t=new EE(i,r,s,a||null)}else if("documentChange"in e){const i=e.documentChange,r=Wt(n,i.document.name),s=Se(i.document.updateTime),o=i.document.createTime?Se(i.document.createTime):O.min(),a=new Je({mapValue:{fields:i.document.fields}}),c=he.newFoundDocument(r,s,o,a);t=new zc(i.targetIds||[],i.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const i=e.documentDelete,r=Wt(n,i.document),s=i.readTime?Se(i.readTime):O.min(),o=he.newNoDocument(r,s);t=new zc([],i.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const i=e.documentRemove,r=Wt(n,i.document);t=new zc([],i.removedTargetIds||[],r,null)}else{if(!("filter"in e))return N();{const i=e.filter,s=new QP(i.count||0);t=new TE(i.targetId,s)}}var c;return t}(this.yt,e),i=function(r){if(!("targetChange"in r))return O.min();const s=r.targetChange;return s.targetIds&&s.targetIds.length?O.min():s.readTime?Se(s.readTime):O.min()}(e);return this.listener.Wo(t,i)}zo(e){const t={};t.database=bo(this.yt),t.addTarget=function(r,s){let o;const a=s.target;return o=Gc(a)?{documents:PE(r,a)}:{query:Wh(r,a)},o.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?o.resumeToken=xE(r,s.resumeToken):s.snapshotVersion.compareTo(O.min())>0&&(o.readTime=Dr(r,s.snapshotVersion.toTimestamp())),o}(this.yt,e);const i=function uD(n,e){const t=function(i,r){switch(r){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return N()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);i&&(t.labels=i),this.Bo(t)}Ho(e){const t={};t.database=bo(this.yt),t.removeTarget=e,this.Bo(t)}}class mO extends Rw{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(P(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function cD(n,e){return n&&n.length>0?(P(void 0!==e),n.map(t=>function(i,r){let s=Se(i.updateTime?i.updateTime:r);return s.isEqual(O.min())&&(s=Se(r)),new HP(s,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),i=Se(e.commitTime);return this.listener.Zo(i,t)}return P(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=bo(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>Ao(this.yt,i))};this.Bo(t)}}class gO extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.yt=r,this.nu=!1}su(){if(this.nu)throw new E(v.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.ao(e,t,i,r,s)).catch(r=>{throw"FirebaseError"===r.name?(r.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new E(v.UNKNOWN,r.toString())})}_o(e,t,i,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection._o(e,t,i,s,o,r)).catch(s=>{throw"FirebaseError"===s.name?(s.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new E(v.UNKNOWN,s.toString())})}terminate(){this.nu=!0}}class yO{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(ke(t),this.ou=!1):w("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class vO{constructor(e,t,i,r,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(a=>{i.enqueueAndForget((0,f.A)(function*(){var c;un(o)&&(w("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,f.A)(function*(u){const d=S(u);d._u.add(4),yield Gr(d),d.gu.set("Unknown"),d._u.delete(4),yield Mo(d)}),function(u){return c.apply(this,arguments)})(o))}))}),this.gu=new yO(i,r)}}function Mo(n){return yf.apply(this,arguments)}function yf(){return yf=(0,f.A)(function*(n){if(un(n))for(const e of n.wu)yield e(!0)}),yf.apply(this,arguments)}function Gr(n){return vf.apply(this,arguments)}function vf(){return vf=(0,f.A)(function*(n){for(const e of n.wu)yield e(!1)}),vf.apply(this,arguments)}function lu(n,e){const t=S(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Ef(t)?Tf(t):qr(t).ko()&&If(t,e))}function Lo(n,e){const t=S(n),i=qr(t);t.du.delete(e),i.ko()&&Nw(t,e),0===t.du.size&&(i.ko()?i.Fo():un(t)&&t.gu.set("Unknown"))}function If(n,e){n.yu.Ot(e.targetId),qr(n).zo(e)}function Nw(n,e){n.yu.Ot(e),qr(n).Ho(e)}function Tf(n){n.yu=new eD({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),qr(n).start(),n.gu.uu()}function Ef(n){return un(n)&&!qr(n).No()&&n.du.size>0}function un(n){return 0===S(n)._u.size}function Pw(n){n.yu=void 0}function IO(n){return wf.apply(this,arguments)}function wf(){return wf=(0,f.A)(function*(n){n.du.forEach((e,t)=>{If(n,e)})}),wf.apply(this,arguments)}function TO(n,e){return bf.apply(this,arguments)}function bf(){return bf=(0,f.A)(function*(n,e){Pw(n),Ef(n)?(n.gu.hu(e),Tf(n)):n.gu.set("Unknown")}),bf.apply(this,arguments)}function EO(n,e,t){return Af.apply(this,arguments)}function Af(){return Af=(0,f.A)(function*(n,e,t){if(n.gu.set("Online"),e instanceof EE&&2===e.state&&e.cause)try{yield(i=(0,f.A)(function*(r,s){const o=s.cause;for(const a of s.targetIds)r.du.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.du.delete(a),r.yu.removeTarget(a))}),function(r,s){return i.apply(this,arguments)})(n,e)}catch(i){w("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield du(n,i)}else if(e instanceof zc?n.yu.Kt(e):e instanceof TE?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(O.min()))try{const i=yield Iw(n.localStore);t.compareTo(i)>=0&&(yield function(r,s){const o=r.yu.Zt(s);return o.targetChanges.forEach((a,c)=>{if(a.resumeToken.approximateByteSize()>0){const u=r.du.get(c);u&&r.du.set(c,u.withResumeToken(a.resumeToken,s))}}),o.targetMismatches.forEach(a=>{const c=r.du.get(a);if(!c)return;r.du.set(a,c.withResumeToken(Ue.EMPTY_BYTE_STRING,c.snapshotVersion)),Nw(r,a);const u=new Hn(c.target,a,1,c.sequenceNumber);If(r,u)}),r.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(i){w("RemoteStore","Failed to raise snapshot:",i),yield du(n,i)}var i}),Af.apply(this,arguments)}function du(n,e,t){return xf.apply(this,arguments)}function xf(){return xf=(0,f.A)(function*(n,e,t){if(!Gn(e))throw e;n._u.add(1),yield Gr(n),n.gu.set("Offline"),t||(t=()=>Iw(n.localStore)),n.asyncQueue.enqueueRetryable((0,f.A)(function*(){w("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield Mo(n)}))}),xf.apply(this,arguments)}function Dw(n,e){return e().catch(t=>du(n,t,e))}function Br(n){return kf.apply(this,arguments)}function kf(){return kf=(0,f.A)(function*(n){const e=S(n),t=Yn(e);let i=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;wO(e);)try{const r=yield aO(e.localStore,i);if(null===r){0===e.fu.length&&t.Fo();break}i=r.batchId,bO(e,r)}catch(r){yield du(e,r)}Ow(e)&&Mw(e)}),kf.apply(this,arguments)}function wO(n){return un(n)&&n.fu.length<10}function bO(n,e){n.fu.push(e);const t=Yn(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function Ow(n){return un(n)&&!Yn(n).No()&&n.fu.length>0}function Mw(n){Yn(n).start()}function AO(n){return Cf.apply(this,arguments)}function Cf(){return Cf=(0,f.A)(function*(n){Yn(n).eu()}),Cf.apply(this,arguments)}function xO(n){return Sf.apply(this,arguments)}function Sf(){return Sf=(0,f.A)(function*(n){const e=Yn(n);for(const t of n.fu)e.Xo(t.mutations)}),Sf.apply(this,arguments)}function kO(n,e,t){return Rf.apply(this,arguments)}function Rf(){return Rf=(0,f.A)(function*(n,e,t){const i=n.fu.shift(),r=Kh.from(i,e,t);yield Dw(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Br(n)}),Rf.apply(this,arguments)}function CO(n,e){return Nf.apply(this,arguments)}function Nf(){return Nf=(0,f.A)(function*(n,e){var t;e&&Yn(n).Yo&&(yield(t=(0,f.A)(function*(i,r){if(function gE(n){switch(n){default:return N();case v.CANCELLED:case v.UNKNOWN:case v.DEADLINE_EXCEEDED:case v.RESOURCE_EXHAUSTED:case v.INTERNAL:case v.UNAVAILABLE:case v.UNAUTHENTICATED:return!1;case v.INVALID_ARGUMENT:case v.NOT_FOUND:case v.ALREADY_EXISTS:case v.PERMISSION_DENIED:case v.FAILED_PRECONDITION:case v.ABORTED:case v.OUT_OF_RANGE:case v.UNIMPLEMENTED:case v.DATA_LOSS:return!0}}(s=r.code)&&s!==v.ABORTED){const o=i.fu.shift();Yn(i).Mo(),yield Dw(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,r)),yield Br(i)}var s}),function(i,r){return t.apply(this,arguments)})(n,e)),Ow(n)&&Mw(n)}),Nf.apply(this,arguments)}function Lw(n,e){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,f.A)(function*(n,e){const t=S(n);t.asyncQueue.verifyOperationInProgress(),w("RemoteStore","RemoteStore received new credentials");const i=un(t);t._u.add(3),yield Gr(t),i&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield Mo(t)}),Pf.apply(this,arguments)}function Of(){return Of=(0,f.A)(function*(n,e){const t=S(n);e?(t._u.delete(2),yield Mo(t)):e||(t._u.add(2),yield Gr(t),t.gu.set("Unknown"))}),Of.apply(this,arguments)}function qr(n){return n.pu||(n.pu=function(e,t,i){const r=S(e);return r.su(),new pO(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:IO.bind(null,n),Zr:TO.bind(null,n),Wo:EO.bind(null,n)}),n.wu.push(function(){var e=(0,f.A)(function*(t){t?(n.pu.Mo(),Ef(n)?Tf(n):n.gu.set("Unknown")):(yield n.pu.stop(),Pw(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function Yn(n){return n.Iu||(n.Iu=function(e,t,i){const r=S(e);return r.su(),new mO(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:AO.bind(null,n),Zr:CO.bind(null,n),tu:xO.bind(null,n),Zo:kO.bind(null,n)}),n.wu.push(function(){var e=(0,f.A)(function*(t){t?(n.Iu.Mo(),yield Br(n)):(yield n.Iu.stop(),n.fu.length>0&&(w("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class Mf{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new Fe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,i,r,s){const o=Date.now()+i,a=new Mf(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new E(v.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function jr(n,e){if(ke("AsyncQueue",`${e}: ${n}`),Gn(n))return new E(v.UNAVAILABLE,`${e}: ${n}`);throw n}class Wr{constructor(e){this.comparator=e?(t,i)=>e(t,i)||C.comparator(t.key,i.key):(t,i)=>C.comparator(t.key,i.key),this.keyedMap=vo(),this.sortedSet=new we(this.comparator)}static emptySet(e){return new Wr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const i=new Wr;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}class Fw{constructor(){this.Tu=new we(C.comparator)}track(e){const t=e.doc.key,i=this.Tu.get(t);i?0!==e.type&&3===i.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==i.type?this.Tu=this.Tu.insert(t,{type:i.type,doc:e.doc}):2===e.type&&2===i.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===i.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===i.type?this.Tu=this.Tu.remove(t):1===e.type&&2===i.type?this.Tu=this.Tu.insert(t,{type:1,doc:i.doc}):0===e.type&&1===i.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):N():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,i)=>{e.push(i)}),e}}class $r{constructor(e,t,i,r,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,r,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new $r(e,t,Wr.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}class SO{constructor(){this.Au=void 0,this.listeners=[]}}class RO{constructor(){this.queries=new $n(e=>eE(e),mo),this.onlineState="Unknown",this.Ru=new Set}}function Lf(n,e){return Ff.apply(this,arguments)}function Ff(){return Ff=(0,f.A)(function*(n,e){const t=S(n),i=e.query;let r=!1,s=t.queries.get(i);if(s||(r=!0,s=new SO),r)try{s.Au=yield t.onListen(i)}catch(o){const a=jr(o,`Initialization of query '${Vh(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.listeners.push(e),e.bu(t.onlineState),s.Au&&e.Pu(s.Au)&&Gf(t)}),Ff.apply(this,arguments)}function Uf(n,e){return Vf.apply(this,arguments)}function Vf(){return Vf=(0,f.A)(function*(n,e){const t=S(n),i=e.query;let r=!1;const s=t.queries.get(i);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),r=0===s.listeners.length)}if(r)return t.queries.delete(i),t.onUnlisten(i)}),Vf.apply(this,arguments)}function NO(n,e){const t=S(n);let i=!1;for(const r of e){const o=t.queries.get(r.query);if(o){for(const a of o.listeners)a.Pu(r)&&(i=!0);o.Au=r}}i&&Gf(t)}function PO(n,e,t){const i=S(n),r=i.queries.get(e);if(r)for(const s of r.listeners)s.onError(t);i.queries.delete(e)}function Gf(n){n.Ru.forEach(e=>{e.next()})}class Bf{constructor(e,t,i){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=i||{}}Pu(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)3!==r.type&&i.push(r);e=new $r(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=$r.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Gw{constructor(e){this.key=e}}class Bw{constructor(e){this.key=e}}class qw{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=B(),this.mutatedKeys=B(),this.Gu=nE(e),this.Qu=new Wr(this.Gu)}get ju(){return this.qu}Wu(e,t){const i=t?t.zu:new Fw,r=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const c="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,u="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,h)=>{const p=r.get(d),m=go(this.query,h)?h:null,g=!!p&&this.mutatedKeys.has(p.key),I=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let A=!1;p&&m?p.data.isEqual(m.data)?g!==I&&(i.track({type:3,doc:m}),A=!0):this.Hu(p,m)||(i.track({type:2,doc:m}),A=!0,(c&&this.Gu(m,c)>0||u&&this.Gu(m,u)<0)&&(a=!0)):!p&&m?(i.track({type:0,doc:m}),A=!0):p&&!m&&(i.track({type:1,doc:p}),A=!0,(c||u)&&(a=!0)),A&&(m?(o=o.add(m),s=I?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const d="F"===this.query.limitType?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),i.track({type:1,doc:d})}return{Qu:o,zu:i,$i:a,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((u,d)=>function(h,p){const m=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return N()}};return m(h)-m(p)}(u.type,d.type)||this.Gu(u.doc,d.doc)),this.Ju(i);const o=t?this.Yu():[],a=0===this.Ku.size&&this.current?1:0,c=a!==this.Uu;return this.Uu=a,0!==s.length||c?{snapshot:new $r(this.query,e.Qu,r,s,e.mutatedKeys,0===a,c,!1,!!i&&i.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Fw,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=B(),this.Qu.forEach(i=>{this.Zu(i.key)&&(this.Ku=this.Ku.add(i.key))});const t=[];return e.forEach(i=>{this.Ku.has(i)||t.push(new Bw(i))}),this.Ku.forEach(i=>{e.has(i)||t.push(new Gw(i))}),t}tc(e){this.qu=e.Hi,this.Ku=B();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return $r.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class MO{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class LO{constructor(e){this.key=e,this.nc=!1}}class FO{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new $n(a=>eE(a),mo),this.rc=new Map,this.oc=new Set,this.uc=new we(C.comparator),this.cc=new Map,this.ac=new nf,this.hc={},this.lc=new Map,this.fc=Ui.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function UO(n,e){return qf.apply(this,arguments)}function qf(){return qf=(0,f.A)(function*(n,e){const t=function dp(n){const e=S(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=jw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=KO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=BO.bind(null,e),e.sc.Wo=NO.bind(null,e.eventManager),e.sc.wc=PO.bind(null,e.eventManager),e}(n);let i,r;const s=t.ic.get(e);if(s)i=s.targetId,t.sharedClientState.addLocalQueryTarget(i),r=s.view.ec();else{const o=yield function Ur(n,e){const t=S(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Cs.getTargetData(i,e).next(s=>s?(r=s,_.resolve(r)):t.Cs.allocateTargetId(i).next(o=>(r=new Hn(e,o,0,i.currentSequenceNumber),t.Cs.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.qi.get(i.targetId);return(null===r||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.qi=t.qi.insert(i.targetId,i),t.Ui.set(e,i.targetId)),i})}(t.localStore,ct(e));t.isPrimaryClient&&lu(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,r=yield function jf(n,e,t,i,r){return Wf.apply(this,arguments)}(t,e,i,"current"===a,o.resumeToken)}return r}),qf.apply(this,arguments)}function Wf(){return Wf=(0,f.A)(function*(n,e,t,i,r){n._c=(h,p,m)=>{return(g=(0,f.A)(function*(I,A,$,Z){let q=A.view.Wu($);q.$i&&(q=yield ou(I.localStore,A.query,!1).then(({documents:K})=>A.view.Wu(K,q)));const de=Z&&Z.targetChanges.get(A.targetId),te=A.view.applyChanges(q,I.isPrimaryClient,de);return ep(I,A.targetId,te.Xu),te.snapshot}),function(I,A,$,Z){return g.apply(this,arguments)})(n,h,p,m);var g};const s=yield ou(n.localStore,e,!0),o=new qw(e,s.Hi),a=o.Wu(s.documents),c=Eo.createSynthesizedTargetChangeForCurrentChange(t,i&&"Offline"!==n.onlineState,r),u=o.applyChanges(a,n.isPrimaryClient,c);ep(n,t,u.Xu);const d=new MO(e,t,o);return n.ic.set(e,d),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),u.snapshot}),Wf.apply(this,arguments)}function VO(n,e){return $f.apply(this,arguments)}function $f(){return $f=(0,f.A)(function*(n,e){const t=S(n),i=t.ic.get(e),r=t.rc.get(i.targetId);if(r.length>1)return t.rc.set(i.targetId,r.filter(s=>!mo(s,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Vr(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),Lo(t.remoteStore,i.targetId),Hr(t,i.targetId)}).catch(Vn))):(Hr(t,i.targetId),yield Vr(t.localStore,i.targetId,!0))}),$f.apply(this,arguments)}function Hf(){return Hf=(0,f.A)(function*(n,e,t){const i=hp(n);try{const r=yield function(s,o){const a=S(s),c=ye.now(),u=o.reduce((p,m)=>p.add(m.key),B());let d,h;return a.persistence.runTransaction("Locally write mutations","readwrite",p=>{let m=ht(),g=B();return a.Gi.getEntries(p,u).next(I=>{m=I,m.forEach((A,$)=>{$.isValidDocument()||(g=g.add(A))})}).next(()=>a.localDocuments.getOverlayedDocuments(p,m)).next(I=>{d=I;const A=[];for(const $ of o){const Z=zP($,d.get($.key).overlayedDocument);null!=Z&&A.push(new cn($.key,Z,QT(Z.value.mapValue),ge.exists(!0)))}return a.mutationQueue.addMutationBatch(p,c,A,o)}).next(I=>{h=I;const A=I.applyToLocalDocumentSet(d,g);return a.documentOverlayCache.saveOverlays(p,I.batchId,A)})}).then(()=>({batchId:h.batchId,changes:vE(d)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(s,o,a){let c=s.hc[s.currentUser.toKey()];c||(c=new we(F)),c=c.insert(o,a),s.hc[s.currentUser.toKey()]=c}(i,r.batchId,t),yield ln(i,r.changes),yield Br(i.remoteStore)}catch(r){const s=jr(r,"Failed to persist write");t.reject(s)}}),Hf.apply(this,arguments)}function jw(n,e){return Kf.apply(this,arguments)}function Kf(){return Kf=(0,f.A)(function*(n,e){const t=S(n);try{const i=yield function oO(n,e){const t=S(n),i=e.snapshotVersion;let r=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.Gi.newChangeBuffer({trackRemovals:!0});r=t.qi;const a=[];e.targetChanges.forEach((d,h)=>{const p=r.get(h);if(!p)return;a.push(t.Cs.removeMatchingKeys(s,d.removedDocuments,h).next(()=>t.Cs.addMatchingKeys(s,d.addedDocuments,h)));let m=p.withSequenceNumber(s.currentSequenceNumber);var g,I,A;e.targetMismatches.has(h)?m=m.withResumeToken(Ue.EMPTY_BYTE_STRING,O.min()).withLastLimboFreeSnapshotVersion(O.min()):d.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(d.resumeToken,i)),r=r.insert(h,m),I=m,A=d,(0===(g=p).resumeToken.approximateByteSize()||I.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8||A.addedDocuments.size+A.modifiedDocuments.size+A.removedDocuments.size>0)&&a.push(t.Cs.updateTargetData(s,m))});let c=ht(),u=B();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(function Tw(n,e,t){let i=B(),r=B();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=ht();return t.forEach((a,c)=>{const u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(O.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||0===c.version.compareTo(u.version)&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):w("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Wi:o,zi:r}})}(s,o,e.documentUpdates).next(d=>{c=d.Wi,u=d.zi})),!i.isEqual(O.min())){const d=t.Cs.getLastRemoteSnapshotVersion(s).next(h=>t.Cs.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(d)}return _.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.qi=r,s))}(t.localStore,e);e.targetChanges.forEach((r,s)=>{const o=t.cc.get(s);o&&(P(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.nc=!0:r.modifiedDocuments.size>0?P(o.nc):r.removedDocuments.size>0&&(P(o.nc),o.nc=!1))}),yield ln(t,i,e)}catch(i){yield Vn(i)}}),Kf.apply(this,arguments)}function Ww(n,e,t){const i=S(n);if(i.isPrimaryClient&&0===t||!i.isPrimaryClient&&1===t){const r=[];i.ic.forEach((s,o)=>{const a=o.view.bu(e);a.snapshot&&r.push(a.snapshot)}),function(s,o){const a=S(s);a.onlineState=o;let c=!1;a.queries.forEach((u,d)=>{for(const h of d.listeners)h.bu(o)&&(c=!0)}),c&&Gf(a)}(i.eventManager,e),r.length&&i.sc.Wo(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function BO(n,e,t){return zf.apply(this,arguments)}function zf(){return zf=(0,f.A)(function*(n,e,t){const i=S(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.cc.get(e),s=r&&r.key;if(s){let o=new we(C.comparator);o=o.insert(s,he.newNoDocument(s,O.min()));const a=B().add(s),c=new To(O.min(),new Map,new ae(F),o,a);yield jw(i,c),i.uc=i.uc.remove(s),i.cc.delete(e),tp(i)}else yield Vr(i.localStore,e,!1).then(()=>Hr(i,e,t)).catch(Vn)}),zf.apply(this,arguments)}function qO(n,e){return Qf.apply(this,arguments)}function Qf(){return Qf=(0,f.A)(function*(n,e){const t=S(n),i=e.batch.batchId;try{const r=yield function sO(n,e){const t=S(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,c,u){const d=c.batch,h=d.keys();let p=_.resolve();return h.forEach(m=>{p=p.next(()=>u.getEntry(a,m)).next(g=>{const I=c.docVersions.get(m);P(null!==I),g.version.compareTo(I)<0&&(d.applyToRemoteDocument(g,c),g.isValidDocument()&&(g.setReadTime(c.commitVersion),u.addEntry(g)))})}),p.next(()=>o.mutationQueue.removeMutationBatch(a,d))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let a=B();for(let c=0;c<o.mutationResults.length;++c)o.mutationResults[c].transformResults.length>0&&(a=a.add(o.batch.mutations[c].key));return a}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}(t.localStore,e);Zf(t,i,null),Jf(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield ln(t,r)}catch(r){yield Vn(r)}}),Qf.apply(this,arguments)}function jO(n,e,t){return Yf.apply(this,arguments)}function Yf(){return Yf=(0,f.A)(function*(n,e,t){const i=S(n);try{const r=yield function(s,o){const a=S(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return a.mutationQueue.lookupMutationBatch(c,o).next(d=>(P(null!==d),u=d.keys(),a.mutationQueue.removeMutationBatch(c,d))).next(()=>a.mutationQueue.performConsistencyCheck(c)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(c,u,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>a.localDocuments.getDocuments(c,u))})}(i.localStore,e);Zf(i,e,t),Jf(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield ln(i,r)}catch(r){yield Vn(r)}}),Yf.apply(this,arguments)}function Jf(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function Zf(n,e,t){const i=S(n);let r=i.hc[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.hc[i.currentUser.toKey()]=r}}function Hr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.rc.get(e))n.ic.delete(i),t&&n.sc.wc(i,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(i=>{n.ac.containsKey(i)||$w(n,i)})}function $w(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(Lo(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),tp(n))}function ep(n,e,t){for(const i of t)i instanceof Gw?(n.ac.addReference(i.key,e),$O(n,i)):i instanceof Bw?(w("SyncEngine","Document no longer in limbo: "+i.key),n.ac.removeReference(i.key,e),n.ac.containsKey(i.key)||$w(n,i.key)):N()}function $O(n,e){const t=e.key,i=t.path.canonicalString();n.uc.get(t)||n.oc.has(i)||(w("SyncEngine","New document in limbo: "+t),n.oc.add(i),tp(n))}function tp(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new C(X.fromString(e)),i=n.fc.next();n.cc.set(i,new LO(t)),n.uc=n.uc.insert(t,i),lu(n.remoteStore,new Hn(ct(Cr(t.path)),i,2,Tt.at))}}function ln(n,e,t){return np.apply(this,arguments)}function np(){return np=(0,f.A)(function*(n,e,t){const i=S(n),r=[],s=[],o=[];var a;i.ic.isEmpty()||(i.ic.forEach((a,c)=>{o.push(i._c(c,e,t).then(u=>{if((u||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,u?.fromCache?"not-current":"current"),u){r.push(u);const d=af.Ci(c.targetId,u);s.push(d)}}))}),yield Promise.all(o),i.sc.Wo(r),yield(a=(0,f.A)(function*(c,u){const d=S(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>_.forEach(u,p=>_.forEach(p.Si,m=>d.persistence.referenceDelegate.addReference(h,p.targetId,m)).next(()=>_.forEach(p.Di,m=>d.persistence.referenceDelegate.removeReference(h,p.targetId,m)))))}catch(h){if(!Gn(h))throw h;w("LocalStore","Failed to update sequence numbers: "+h)}for(const h of u){const p=h.targetId;if(!h.fromCache){const m=d.qi.get(p),I=m.withLastLimboFreeSnapshotVersion(m.snapshotVersion);d.qi=d.qi.insert(p,I)}}}),function(c,u){return a.apply(this,arguments)})(i.localStore,s))}),np.apply(this,arguments)}function HO(n,e){return ip.apply(this,arguments)}function ip(){return ip=(0,f.A)(function*(n,e){const t=S(n);if(!t.currentUser.isEqual(e)){w("SyncEngine","User change. New user:",e.toKey());const i=yield vw(t.localStore,e);t.currentUser=e,(r=t).lc.forEach(o=>{o.forEach(a=>{a.reject(new E(v.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.lc.clear(),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield ln(t,i.ji)}var r}),ip.apply(this,arguments)}function KO(n,e){const t=S(n),i=t.cc.get(e);if(i&&i.nc)return B().add(i.key);{let r=B();const s=t.rc.get(e);if(!s)return r;for(const o of s){const a=t.ic.get(o);r=r.unionWith(a.view.ju)}return r}}function hp(n){const e=S(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=qO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jO.bind(null,e),e}class zw{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,f.A)(function*(){t.yt=Oo(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return yw(this.persistence,new _w,e.initialUser,this.yt)}yc(e){return new mw(ru.Bs,this.yt)}gc(e){return new kw}terminate(){var e=this;return(0,f.A)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Qw extends zw{constructor(e,t,i){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,i=this;return(0,f.A)(function*(){yield t().call(i,e),yield i.Ac.initialize(i,e),yield hp(i.Ac.syncEngine),yield Br(i.Ac.remoteStore),yield i.persistence.li(()=>(i.gcScheduler&&!i.gcScheduler.started&&i.gcScheduler.start(),i.indexBackfillerScheduler&&!i.indexBackfillerScheduler.started&&i.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return yw(this.persistence,new _w,e.initialUser,this.yt)}Tc(e,t){return new WD(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const i=new SP(t,this.persistence);return new CP(e.asyncQueue,i)}yc(e){const t=function of(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=void 0!==this.cacheSizeBytes?ft.withCacheSize(this.cacheSizeBytes):ft.DEFAULT;return new sf(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,function Sw(){return typeof window<"u"?window:null}(),uu(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new kw}}class fp{initialize(e,t){var i=this;return(0,f.A)(function*(){i.localStore||(i.localStore=e.localStore,i.sharedClientState=e.sharedClientState,i.datastore=i.createDatastore(t),i.remoteStore=i.createRemoteStore(t),i.eventManager=i.createEventManager(t),i.syncEngine=i.createSyncEngine(t,!e.synchronizeTabs),i.sharedClientState.onlineStateHandler=r=>Ww(i.syncEngine,r,1),i.remoteStore.remoteSyncer.handleCredentialChange=HO.bind(null,i.syncEngine),yield function Df(n,e){return Of.apply(this,arguments)}(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(e){return new RO}createDatastore(e){const t=Oo(e.databaseInfo.databaseId),i=new fO(e.databaseInfo);return new gO(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return t=this.localStore,i=this.datastore,r=e.asyncQueue,s=a=>Ww(this.syncEngine,a,0),o=Cw.C()?new Cw:new lO,new vO(t,i,r,s,o);var t,i,r,s,o}createSyncEngine(e,t){return function(i,r,s,o,a,c,u){const d=new FO(i,r,s,o,a,c);return u&&(d.dc=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,f.A)(function*(t){const i=S(t);w("RemoteStore","RemoteStore shutting down."),i._u.add(5),yield Gr(i),i.mu.shutdown(),i.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function pp(n,e,t){if(!t)throw new E(v.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Yw(n){if(!C.isDocumentKey(n))throw new E(v.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Xw(n){if(C.isDocumentKey(n))throw new E(v.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function hu(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":N()}function Y(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new E(v.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=hu(n);throw new E(v.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}const Zw=new Map;class eb{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new E(v.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new E(v.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function iM(n,e,t,i){if(!0===e&&!0===i)throw new E(v.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Fo{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new eb({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new E(v.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new E(v.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new eb(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new gP;switch(t.type){case"gapi":return new IP(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new E(v.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Zw.get(e);t&&(w("ComponentProvider","Removing Datastore"),Zw.delete(e),t.terminate())}(this),Promise.resolve()}}class Re{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ht(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Re(this.firestore,e,this._key)}}class Ze{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Ze(this.firestore,e,this._query)}}class Ht extends Ze{constructor(e,t,i){super(e,t,Cr(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Re(this.firestore,null,new C(e))}withConverter(e){return new Ht(this.firestore,e,this._path)}}function Kr(n,e,...t){if(n=ie(n),1===arguments.length&&(e=ET.R()),pp("doc","path",e),n instanceof Fo){const i=X.fromString(e,...t);return Yw(i),new Re(n,null,new C(i))}{if(!(n instanceof Re||n instanceof Ht))throw new E(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(X.fromString(e,...t));return Yw(i),new Re(n.firestore,n instanceof Ht?n.converter:null,new C(i))}}class fu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):ke("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class dM{constructor(e,t,i,r){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=We.UNAUTHENTICATED,this.clientId=ET.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,function(){var o=(0,f.A)(function*(a){w("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(i,o=>(w("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,f.A)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new E(v.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Fe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,f.A)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(i){const r=jr(i,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}function ib(n,e){return mp.apply(this,arguments)}function mp(){return mp=(0,f.A)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),w("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(function(){var r=(0,f.A)(function*(s){i.isEqual(s)||(yield vw(e.localStore,s),i=s)});return function(s){return r.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),mp.apply(this,arguments)}function rb(n,e){return gp.apply(this,arguments)}function gp(){return gp=(0,f.A)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield _p(n);w("FirestoreClient","Initializing OnlineComponentProvider");const i=yield n.getConfiguration();yield e.initialize(t,i),n.setCredentialChangeListener(r=>Lw(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Lw(e.remoteStore,s)),n.onlineComponents=e}),gp.apply(this,arguments)}function _p(n){return yp.apply(this,arguments)}function yp(){return yp=(0,f.A)(function*(n){return n.offlineComponents||(w("FirestoreClient","Using default OfflineComponentProvider"),yield ib(n,new zw)),n.offlineComponents}),yp.apply(this,arguments)}function pu(n){return vp.apply(this,arguments)}function vp(){return vp=(0,f.A)(function*(n){return n.onlineComponents||(w("FirestoreClient","Using default OnlineComponentProvider"),yield rb(n,new fp)),n.onlineComponents}),vp.apply(this,arguments)}function zr(n){return Ep.apply(this,arguments)}function Ep(){return Ep=(0,f.A)(function*(n){const e=yield pu(n),t=e.eventManager;return t.onListen=UO.bind(null,e.syncEngine),t.onUnlisten=VO.bind(null,e.syncEngine),t}),Ep.apply(this,arguments)}class vM{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new gf(this,"async_queue_retry"),this.Wc=()=>{const t=uu();t&&w("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=uu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=uu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new Fe;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,f.A)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!Gn(t))throw t;w("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(i=>{throw this.Kc=i,this.Gc=!1,ke("INTERNAL UNHANDLED ERROR: ",function(s){let o=s.message||"";return s.stack&&(o=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),o}(i)),i}).then(i=>(this.Gc=!1,i))));return this.Bc=t,t}enqueueAfterDelay(e,t,i){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=Mf.createAndSchedule(this,e,t,i,s=>this.Yc(s));return this.Uc.push(r),r}zc(){this.Kc&&N()}verifyOperationInProgress(){}Xc(){var e=this;return(0,f.A)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function wp(n){return function(e){if("object"!=typeof e||null===e)return!1;const i=e;for(const r of["next","error","complete"])if(r in i&&"function"==typeof i[r])return!0;return!1}(n)}class fe extends Fo{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new vM,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||ub(this),this._firestoreClient.terminate()}}function TM(n,e){const i="string"==typeof n?n:e||"(default)",r=ds("object"==typeof n?n:Tl(),"firestore").getImmediate({identifier:i});if(!r._initialized){const s=(n=>{const e=Uy(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),i]:[e.substring(0,t),i]})("firestore");s&&function rM(n,e,t,i={}){var r;const s=(n=Y(n,Fo))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Er("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),i.mockUserToken){let o,a;if("string"==typeof i.mockUserToken)o=i.mockUserToken,a=We.MOCK_USER;else{o=function By(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[_a(JSON.stringify({alg:"none",type:"JWT"})),_a(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new E(v.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new We(c)}n._authCredentials=new _P(new IT(o,a))}}(r,...s)}return r}function De(n){return n._firestoreClient||ub(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function ub(n){var e;const t=n._freezeSettings(),i=(s=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new RP(n._databaseId,s,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var s,a;n._firestoreClient=new dM(n._authCredentials,n._appCheckCredentials,n._queue,i)}class Gi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Gi(Ue.fromBase64String(e))}catch(t){throw new E(v.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Gi(Ue.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Bi{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new E(v.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ce(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class qi{constructor(e){this._methodName=e}}class bp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new E(v.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new E(v.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return F(this._lat,e._lat)||F(this._long,e._long)}}const wM=/^__.*__$/;class bM{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return null!==this.fieldMask?new cn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Nr(e,this.data,t,this.fieldTransforms)}}class hb{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new cn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fb(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw N()}}class gu{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.yt=i,this.ignoreUndefinedProperties=r,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new gu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.ua(e),r}ca(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return vu(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(fb(this.sa)&&wM.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class AM{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=i||Oo(e)}da(e,t,i,r=!1){return new gu({sa:e,methodName:t,fa:i,path:Ce.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function ji(n){const e=n._freezeSettings(),t=Oo(n._databaseId);return new AM(n._databaseId,!!e.ignoreUndefinedProperties,t)}function _u(n,e,t,i,r,s={}){const o=n.da(s.merge||s.mergeFields?2:0,e,t,r);Cp("Data must be an object, but it was:",o,i);const a=gb(i,o);let c,u;if(s.merge)c=new dt(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const d=[];for(const h of s.mergeFields){const p=Sp(e,h,t);if(!o.contains(p))throw new E(v.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);yb(d,p)||d.push(p)}c=new dt(d),u=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,u=o.fieldTransforms;return new bM(new Je(a),c,u)}class Uo extends qi{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Uo}}class Ap extends qi{_toFieldTransform(e){return new _o(e.path,new Sr)}isEqual(e){return e instanceof Ap}}function mb(n,e,t,i=!1){return Wi(t,n.da(i?4:3,e))}function Wi(n,e){if(_b(n=ie(n)))return Cp("Unsupported field value:",e,n),gb(n,e);if(n instanceof qi)return function(t,i){if(!fb(i.sa))throw i.ha(`${t._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ha(`${t._methodName}() is not currently supported inside arrays`);const r=t._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,i){const r=[];let s=0;for(const o of t){let a=Wi(o,i.aa(s));null==a&&(a={nullValue:"NULL_VALUE"}),r.push(a),s++}return{arrayValue:{values:r}}}(n,e)}return function(t,i){if(null===(t=ie(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return sE(i.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const r=ye.fromDate(t);return{timestampValue:Dr(i.yt,r)}}if(t instanceof ye){const r=new ye(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Dr(i.yt,r)}}if(t instanceof bp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Gi)return{bytesValue:xE(i.yt,t._byteString)};if(t instanceof Re){const r=i.databaseId,s=t.firestore._databaseId;if(!s.isEqual(r))throw i.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Bh(t.firestore._databaseId||i.databaseId,t._key.path)}}throw i.ha(`Unsupported field value: ${hu(t)}`)}(n,e)}function gb(n,e){const t={};return RT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ai(n,(i,r)=>{const s=Wi(r,e.ra(i));null!=s&&(t[i]=s)}),{mapValue:{fields:t}}}function _b(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof ye||n instanceof bp||n instanceof Gi||n instanceof Re||n instanceof qi)}function Cp(n,e,t){if(!_b(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const i=hu(t);throw e.ha("an object"===i?n+" a custom object":n+" "+i)}var i}function Sp(n,e,t){if((e=ie(e))instanceof Bi)return e._internalPath;if("string"==typeof e)return yu(n,e);throw vu("Field path arguments must be of type string or ",n,!1,void 0,t)}const SM=new RegExp("[~\\*/\\[\\]]");function yu(n,e,t){if(e.search(SM)>=0)throw vu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Bi(...e.split("."))._internalPath}catch{throw vu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function vu(n,e,t,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new E(v.INVALID_ARGUMENT,a+n+c)}function yb(n,e){return n.some(t=>t.isEqual(e))}class Vo{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Re(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new RM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Iu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class RM extends Vo{data(){return super.data()}}function Iu(n,e){return"string"==typeof e?yu(n,e):e instanceof Bi?e._internalPath:e._delegate._internalPath}function vb(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new E(v.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Rp{}class Go extends Rp{}function Tu(n,e,...t){let i=[];e instanceof Rp&&i.push(e),i=i.concat(t),function(r){const s=r.filter(a=>a instanceof Qr).length,o=r.filter(a=>a instanceof Bo).length;if(s>1||s>0&&o>0)throw new E(v.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class Bo extends Go{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Bo(e,t,i)}_apply(e){const t=this._parse(e);return wb(e._query,t),new Ze(e.firestore,e.converter,Uh(e._query,t))}_parse(e){const t=ji(e.firestore);return function(r,s,o,a,c,u,d){let h;if(c.isKeyField()){if("array-contains"===u||"array-contains-any"===u)throw new E(v.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if("in"===u||"not-in"===u){Eb(d,u);const p=[];for(const m of d)p.push(Tb(a,r,m));h={arrayValue:{values:p}}}else h=Tb(a,r,d)}else"in"!==u&&"not-in"!==u&&"array-contains-any"!==u||Eb(d,u),h=mb(o,"where",d,"in"===u||"not-in"===u);return z.create(c,u,h)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Qr extends Rp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Qr(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return 1===t.length?t[0]:se.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,r){let s=i;const o=r.getFlattenedFilters();for(const a of o)wb(s,a),s=Uh(s,a)}(e._query,t),new Ze(e.firestore,e.converter,Uh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Np extends Go{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Np(e,t)}_apply(e){const t=function(i,r,s){if(null!==i.startAt)throw new E(v.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new E(v.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new xr(r,s);return function(a,c){if(null===Lh(a)){const u=qc(a);null!==u&&bb(0,u,c.field)}}(i,o),o}(e._query,this._field,this._direction);return new Ze(e.firestore,e.converter,function(i,r){const s=i.explicitOrderBy.concat([r]);return new an(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function Eu(n,e="asc"){const t=e,i=Iu("orderBy",n);return Np._create(i,t)}class wu extends Go{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new wu(e,t,i)}_apply(e){return new Ze(e.firestore,e.converter,jc(e._query,this._limit,this._limitType))}}function bu(n){return function Jw(n,e){if(e<=0)throw new E(v.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}("limit",n),wu._create("limit",n,"F")}class Au extends Go{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new Au(e,t,i)}_apply(e){const t=Ib(e,this.type,this._docOrFields,this._inclusive);return new Ze(e.firestore,e.converter,(r=t,new an((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,r,i.endAt)));var i,r}}function Pp(...n){return Au._create("startAfter",n,!1)}class xu extends Go{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new xu(e,t,i)}_apply(e){const t=Ib(e,this.type,this._docOrFields,this._inclusive);return new Ze(e.firestore,e.converter,(r=t,new an((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,r)));var i,r}}function Ib(n,e,t,i){if(t[0]=ie(t[0]),t[0]instanceof Vo)return function(r,s,o,a,c){if(!a)throw new E(v.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const u=[];for(const d of Ri(r))if(d.field.isKeyField())u.push(Ci(s,a.key));else{const h=a.data.field(d.field);if(Sh(h))throw new E(v.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===h){const p=d.field.canonicalString();throw new E(v.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${p}' (used as the orderBy) does not exist.`)}u.push(h)}return new Wn(u,c)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{const r=ji(n.firestore);return function(s,o,a,c,u,d){const h=s.explicitOrderBy;if(u.length>h.length)throw new E(v.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const p=[];for(let m=0;m<u.length;m++){const g=u[m];if(h[m].field.isKeyField()){if("string"!=typeof g)throw new E(v.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof g}`);if(!Fh(s)&&-1!==g.indexOf("/"))throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${g}' contains a slash.`);const I=s.path.child(X.fromString(g));if(!C.isDocumentKey(I))throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);const A=new C(I);p.push(Ci(o,A))}else{const I=mb(a,c,g);p.push(I)}}return new Wn(p,d)}(n._query,n.firestore._databaseId,r,e,t,i)}}function Tb(n,e,t){if("string"==typeof(t=ie(t))){if(""===t)throw new E(v.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fh(e)&&-1!==t.indexOf("/"))throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(X.fromString(t));if(!C.isDocumentKey(i))throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Ci(n,new C(i))}if(t instanceof Re)return Ci(n,t._key);throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hu(t)}.`)}function Eb(n,e){if(!Array.isArray(n)||0===n.length)throw new E(v.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new E(v.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function wb(n,e){if(e.isInequality()){const i=qc(n),r=e.field;if(null!==i&&!i.isEqual(r))throw new E(v.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${i.toString()}' and '${r.toString()}'`);const s=Lh(n);null!==s&&bb(0,r,s)}const t=function(i,r){for(const s of i)for(const o of s.getFlattenedFilters())if(r.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new E(v.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function bb(n,e,t){if(!t.isEqual(e))throw new E(v.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class xb{convertValue(e,t="none"){switch(ki(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw N()}}convertObject(e,t){const i={};return Ai(e.fields,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertGeoPoint(e){return new bp(Ee(e.latitude),Ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=PT(e);return null==i?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(uo(e));default:return null}}convertTimestamp(e){const t=Bn(e);return new ye(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=X.fromString(e);P(LE(i));const r=new bi(i.get(1),i.get(3)),s=new C(i.popFirst(5));return r.isEqual(t)||ke(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class $i{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Yr extends Vo{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Cu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Iu("DocumentSnapshot.get",e));if(null!==i)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class Cu extends Yr{data(e={}){return super.data(e)}}class Xr{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new $i(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Cu(this._firestore,this._userDataWriter,i.key,i,new $i(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new E(v.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(o=>({type:"added",doc:new Cu(i._firestore,i._userDataWriter,o.doc.key,o.doc,new $i(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:s++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>r||3!==o.type).map(o=>{const a=new Cu(i._firestore,i._userDataWriter,o.doc.key,o.doc,new $i(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,u=-1;return 0!==o.type&&(c=s.indexOf(o.doc.key),s=s.delete(o.doc.key)),1!==o.type&&(s=s.add(o.doc),u=s.indexOf(o.doc.key)),{type:DM(o.type),doc:a,oldIndex:c,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function DM(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return N()}}class Xn extends xb{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Re(this.firestore,null,t)}}function MM(n){n=Y(n,Re);const e=Y(n.firestore,fe),t=De(e),i=new Xn(e);return function pM(n,e){const t=new Fe;return n.asyncQueue.enqueueAndForget((0,f.A)(function*(){return(i=(0,f.A)(function*(r,s,o){try{const a=yield function(c,u){const d=S(c);return d.persistence.runTransaction("read document","readonly",h=>d.localDocuments.getDocument(h,u))}(r,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new E(v.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const c=jr(a,`Failed to get document '${s} from cache`);o.reject(c)}}),function(r,s,o){return i.apply(this,arguments)})(yield function mu(n){return _p(n).then(e=>e.localStore)}(n),e,t);var i})),t.promise}(t,n._key).then(r=>new Yr(e,i,n._key,r,new $i(null!==r&&r.hasLocalMutations,!0),n.converter))}function Su(n){n=Y(n,Ze);const e=Y(n.firestore,fe),t=De(e),i=new Xn(e);return vb(n._query),function cb(n,e,t={}){const i=new Fe;return n.asyncQueue.enqueueAndForget((0,f.A)(function*(){return function(r,s,o,a,c){const u=new fu({next:h=>{s.enqueueAndForget(()=>Uf(r,d)),h.fromCache&&"server"===a.source?c.reject(new E(v.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(h)},error:h=>c.reject(h)}),d=new Bf(o,u,{includeMetadataChanges:!0,Nu:!0});return Lf(r,d)}(yield zr(n),n.asyncQueue,e,t,i)})),i.promise}(t,n._query).then(r=>new Xr(e,i,n,r))}function Dp(n,...e){var t,i,r;n=ie(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||wp(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(wp(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(i=h.error)||void 0===i?void 0:i.bind(h),e[o+2]=null===(r=h.complete)||void 0===r?void 0:r.bind(h)}let c,u,d;if(n instanceof Re)u=Y(n.firestore,fe),d=Cr(n._key.path),c={next:h=>{e[o]&&e[o](Op(u,n,h))},error:e[o+1],complete:e[o+2]};else{const h=Y(n,Ze);u=Y(h.firestore,fe),d=h._query;const p=new Xn(u);c={next:m=>{e[o]&&e[o](new Xr(u,p,h,m))},error:e[o+1],complete:e[o+2]},vb(n._query)}return function(h,p,m,g){const I=new fu(g),A=new Bf(p,I,m);return h.asyncQueue.enqueueAndForget((0,f.A)(function*(){return Lf(yield zr(h),A)})),()=>{I.bc(),h.asyncQueue.enqueueAndForget((0,f.A)(function*(){return Uf(yield zr(h),A)}))}}(De(u),d,a,c)}function qo(n,e){return function(t,i){const r=new Fe;return t.asyncQueue.enqueueAndForget((0,f.A)(function*(){return function GO(n,e,t){return Hf.apply(this,arguments)}(yield function Tp(n){return pu(n).then(e=>e.syncEngine)}(t),i,r)})),r.promise}(De(n),e)}function Op(n,e,t){const i=t.docs.get(e._key),r=new Xn(n);return new Yr(n,r,e._key,i,new $i(t.hasPendingWrites,t.fromCache),e.converter)}function Mp(){return new Ap("serverTimestamp")}!function(n,e=!0){Tr=ir,oi(new wn("firestore",(t,{instanceIdentifier:i,options:r})=>{const s=t.getProvider("app").getImmediate(),o=new fe(new yP(t.getProvider("auth-internal")),new TP(t.getProvider("app-check-internal")),function(a,c){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new E(v.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new bi(a.options.projectId,c)}(s,i),s);return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),Mt(vT,"3.8.3",n),Mt(vT,"3.8.3","esm2017")}();var Jr=R(1635);const qM=function Cb(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Sb=new as("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Rb=new st.Vy("@firebase/auth");function Ru(n,...e){Rb.logLevel<=st.$b.ERROR&&Rb.error(`Auth (${ir}): ${n}`,...e)}function pt(n,...e){throw Lp(n,...e)}function Kt(n,...e){return Lp(n,...e)}function Lp(n,...e){if("string"!=typeof n){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Sb.create(n,...e)}function k(n,e,...t){if(!n)throw Lp(e,...t)}function zt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ru(e),new Error(e)}function Zn(n,e){n||zt(e)}const Pb=new Map;function dn(n){Zn(n instanceof Function,"Expected a class definition");let e=Pb.get(n);return e?(Zn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Pb.set(n,e),e)}function jo(){var n;return typeof self<"u"&&(null===(n=self.location)||void 0===n?void 0:n.href)||""}function Db(){var n;return typeof self<"u"&&(null===(n=self.location)||void 0===n?void 0:n.protocol)||null}function $M(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(function Fp(){return"http:"===Db()||"https:"===Db()}()||function xk(){const n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof n&&void 0!==n.id}()||"connection"in navigator))||navigator.onLine}class Wo{constructor(e,t){this.shortDelay=e,this.longDelay=t,Zn(t>e,"Short delay should be less than long delay!"),this.isMobile=hl()||qy()}get(){return $M()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Up(n,e){Zn(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Ob{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void zt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void zt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void zt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const KM={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},zM=new Wo(3e4,6e4);function Ve(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Ke(n,e,t,i){return Vp.apply(this,arguments)}function Vp(){return Vp=(0,f.A)(function*(n,e,t,i,r={}){return Mb(n,r,(0,f.A)(function*(){let s={},o={};i&&("GET"===e?o=i:s={body:JSON.stringify(i)});const a=nr(Object.assign({key:n.config.apiKey},o)).slice(1),c=yield n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),Ob.fetch()(Lb(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},s))}))}),Vp.apply(this,arguments)}function Mb(n,e,t){return Gp.apply(this,arguments)}function Gp(){return Gp=(0,f.A)(function*(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},KM),e);try{const r=new QM(n),s=yield Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=yield s.json();if("needConfirmation"in o)throw $o(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===c)throw $o(n,"credential-already-in-use",o);if("EMAIL_EXISTS"===c)throw $o(n,"email-already-in-use",o);if("USER_DISABLED"===c)throw $o(n,"user-disabled",o);const d=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw function Nb(n,e,t){const i=Object.assign(Object.assign({},qM()),{[e]:t});return new as("auth","Firebase",i).create(e,{appName:n.name})}(n,d,u);pt(n,d)}}catch(r){if(r instanceof Jt)throw r;pt(n,"network-request-failed")}}),Gp.apply(this,arguments)}function hn(n,e,t,i){return Bp.apply(this,arguments)}function Bp(){return Bp=(0,f.A)(function*(n,e,t,i,r={}){const s=yield Ke(n,e,t,i,r);return"mfaPendingCredential"in s&&pt(n,"multi-factor-auth-required",{_serverResponse:s}),s}),Bp.apply(this,arguments)}function Lb(n,e,t,i){const r=`${e}${t}?${i}`;return n.config.emulator?Up(n.config,r):`${n.config.apiScheme}://${r}`}class QM{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Kt(this.auth,"network-request-failed")),zM.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function $o(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=Kt(n,e,i);return r.customData._tokenResponse=t,r}function qp(){return qp=(0,f.A)(function*(n,e){return Ke(n,"POST","/v1/accounts:delete",e)}),qp.apply(this,arguments)}function Wp(){return Wp=(0,f.A)(function*(n,e){return Ke(n,"POST","/v1/accounts:lookup",e)}),Wp.apply(this,arguments)}function Ho(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function $p(){return $p=(0,f.A)(function*(n,e=!1){const t=ie(n),i=yield t.getIdToken(e),r=Nu(i);k(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:Ho(Hp(r.auth_time)),issuedAtTime:Ho(Hp(r.iat)),expirationTime:Ho(Hp(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}),$p.apply(this,arguments)}function Hp(n){return 1e3*Number(n)}function Nu(n){const[e,t,i]=n.split(".");if(void 0===e||void 0===t||void 0===i)return Ru("JWT malformed, contained fewer than 3 sections"),null;try{const r=ya(t);return r?JSON.parse(r):(Ru("Failed to decode base64 JWT payload"),null)}catch(r){return Ru("Caught error parsing JWT payload as JSON",r?.toString()),null}}function fn(n,e){return Kp.apply(this,arguments)}function Kp(){return Kp=(0,f.A)(function*(n,e,t=!1){if(t)return e;try{return yield e}catch(i){throw i instanceof Jt&&function tL({code:n}){return"auth/user-disabled"===n||"auth/user-token-expired"===n}(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}}),Kp.apply(this,arguments)}class nL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),i}{this.errorBackoff=3e4;const r=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout((0,f.A)(function*(){yield t.iteration()}),i)}iteration(){var e=this;return(0,f.A)(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t?.code&&e.schedule(!0))}e.schedule()})()}}class Fb{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ho(this.lastLoginAt),this.creationTime=Ho(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Ko(n){return zp.apply(this,arguments)}function zp(){return zp=(0,f.A)(function*(n){var e;const t=n.auth,i=yield n.getIdToken(),r=yield fn(n,function JM(n,e){return Wp.apply(this,arguments)}(t,{idToken:i}));k(r?.users.length,t,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=null!==(e=s.providerUserInfo)&&void 0!==e&&e.length?function sL(n){return n.map(e=>{var{providerId:t}=e,i=(0,Jr.Tt)(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}(s.providerUserInfo):[],a=function rL(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}(n.providerData,o),d=!!n.isAnonymous&&!(n.email&&s.passwordHash||a?.length),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Fb(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,h)}),zp.apply(this,arguments)}function Qp(){return Qp=(0,f.A)(function*(n){const e=ie(n);yield Ko(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}),Qp.apply(this,arguments)}function Yp(){return Yp=(0,f.A)(function*(n,e){const t=yield Mb(n,{},(0,f.A)(function*(){const i=nr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=Lb(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Ob.fetch()(o,{method:"POST",headers:a,body:i})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}),Yp.apply(this,arguments)}class zo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){k(e.idToken,"internal-error"),k(typeof e.idToken<"u","internal-error"),k(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):function eL(n){const e=Nu(n);return k(e,"internal-error"),k(typeof e.exp<"u","internal-error"),k(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var i=this;return(0,f.A)(function*(){return k(!i.accessToken||i.refreshToken,e,"user-token-expired"),t||!i.accessToken||i.isExpired?i.refreshToken?(yield i.refresh(e,i.refreshToken),i.accessToken):null:i.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var i=this;return(0,f.A)(function*(){const{accessToken:r,refreshToken:s,expiresIn:o}=yield function oL(n,e){return Yp.apply(this,arguments)}(e,t);i.updateTokensAndExpiration(r,s,Number(o))})()}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*i}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new zo;return i&&(k("string"==typeof i,"internal-error",{appName:e}),o.refreshToken=i),r&&(k("string"==typeof r,"internal-error",{appName:e}),o.accessToken=r),s&&(k("number"==typeof s,"internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new zo,this.toJSON())}_performRefresh(){return zt("not implemented")}}function ei(n,e){k("string"==typeof n||typeof n>"u","internal-error",{appName:e})}class Hi{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=(0,Jr.Tt)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new nL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Fb(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){var t=this;return(0,f.A)(function*(){const i=yield fn(t,t.stsTokenManager.getToken(t.auth,e));return k(i,t.auth,"internal-error"),t.accessToken!==i&&(t.accessToken=i,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),i})()}getIdTokenResult(e){return function ZM(n){return $p.apply(this,arguments)}(this,e)}reload(){return function iL(n){return Qp.apply(this,arguments)}(this)}_assign(e){this!==e&&(k(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Hi(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){k(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var i=this;return(0,f.A)(function*(){let r=!1;e.idToken&&e.idToken!==i.stsTokenManager.accessToken&&(i.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Ko(i)),yield i.auth._persistUserIfCurrent(i),r&&i.auth._notifyListenersIfCurrent(i)})()}delete(){var e=this;return(0,f.A)(function*(){const t=yield e.getIdToken();return yield fn(e,function YM(n,e){return qp.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,c,u,d;const h=null!==(i=t.displayName)&&void 0!==i?i:void 0,p=null!==(r=t.email)&&void 0!==r?r:void 0,m=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,g=null!==(o=t.photoURL)&&void 0!==o?o:void 0,I=null!==(a=t.tenantId)&&void 0!==a?a:void 0,A=null!==(c=t._redirectEventId)&&void 0!==c?c:void 0,$=null!==(u=t.createdAt)&&void 0!==u?u:void 0,Z=null!==(d=t.lastLoginAt)&&void 0!==d?d:void 0,{uid:q,emailVerified:de,isAnonymous:te,providerData:K,stsTokenManager:Ie}=t;k(q&&Ie,e,"internal-error");const En=zo.fromJSON(this.name,Ie);k("string"==typeof q,e,"internal-error"),ei(h,e.name),ei(p,e.name),k("boolean"==typeof de,e,"internal-error"),k("boolean"==typeof te,e,"internal-error"),ei(m,e.name),ei(g,e.name),ei(I,e.name),ei(A,e.name),ei($,e.name),ei(Z,e.name);const Ji=new Hi({uid:q,auth:e,email:p,emailVerified:de,displayName:h,isAnonymous:te,photoURL:g,phoneNumber:m,tenantId:I,stsTokenManager:En,createdAt:$,lastLoginAt:Z});return K&&Array.isArray(K)&&(Ji.providerData=K.map(Dy=>Object.assign({},Dy))),A&&(Ji._redirectEventId=A),Ji}static _fromIdTokenResponse(e,t,i=!1){return(0,f.A)(function*(){const r=new zo;r.updateFromServerResponse(t);const s=new Hi({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return yield Ko(s),s})()}}const Ub=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,f.A)(function*(){return!0})()}_set(t,i){var r=this;return(0,f.A)(function*(){r.storage[t]=i})()}_get(t){var i=this;return(0,f.A)(function*(){const r=i.storage[t];return void 0===r?null:r})()}_remove(t){var i=this;return(0,f.A)(function*(){delete i.storage[t]})()}_addListener(t,i){}_removeListener(t,i){}}return n.type="NONE",n})();function Pu(n,e,t){return`firebase:${n}:${e}:${t}`}class es{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=Pu(this.userKey,r.apiKey,s),this.fullPersistenceKey=Pu("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return(0,f.A)(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?Hi._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return(0,f.A)(function*(){if(t.persistence===e)return;const i=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,i?t.setCurrentUser(i):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,i="authUser"){return(0,f.A)(function*(){if(!t.length)return new es(dn(Ub),e,i);const r=(yield Promise.all(t.map(function(){var u=(0,f.A)(function*(d){if(yield d._isAvailable())return d});return function(d){return u.apply(this,arguments)}}()))).filter(u=>u);let s=r[0]||dn(Ub);const o=Pu(i,e.config.apiKey,e.name);let a=null;for(const u of t)try{const d=yield u._get(o);if(d){const h=Hi._fromJSON(e,d);u!==s&&(a=h),s=u;break}}catch{}const c=r.filter(u=>u._shouldAllowMigration);return s._shouldAllowMigration&&c.length?(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(function(){var u=(0,f.A)(function*(d){if(d!==s)try{yield d._remove(o)}catch{}});return function(d){return u.apply(this,arguments)}}())),new es(s,e,i)):new es(s,e,i)})()}}function Vb(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(qb(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Gb(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Wb(e))return"Blackberry";if($b(e))return"Webos";if(Xp(e))return"Safari";if((e.includes("chrome/")||Bb(e))&&!e.includes("edge/"))return"Chrome";if(jb(e))return"Android";{const i=n.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===i?.length)return i[1]}return"Other"}function Gb(n=xe()){return/firefox\//i.test(n)}function Xp(n=xe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Bb(n=xe()){return/crios\//i.test(n)}function qb(n=xe()){return/iemobile/i.test(n)}function jb(n=xe()){return/android/i.test(n)}function Wb(n=xe()){return/blackberry/i.test(n)}function $b(n=xe()){return/webos/i.test(n)}function Du(n=xe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Hb(n=xe()){return Du(n)||jb(n)||$b(n)||Wb(n)||/windows phone/i.test(n)||qb(n)}function Kb(n,e=[]){let t;switch(n){case"Browser":t=Vb(xe());break;case"Worker":t=`${Vb(xe())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ir}/${i}`}class lL{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((o,a)=>{try{o(e(s))}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){var t=this;return(0,f.A)(function*(){if(t.auth.currentUser===e)return;const i=[];try{for(const r of t.queue)yield r(e),r.onAbort&&i.push(r.onAbort)}catch(r){i.reverse();for(const s of i)try{s()}catch{}throw t.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})()}}class dL{constructor(e,t,i){this.app=e,this.heartbeatServiceProvider=t,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new zb(this),this.idTokenSubscription=new zb(this),this.beforeStateQueue=new lL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Sb,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){var i=this;return t&&(this._popupRedirectResolver=dn(t)),this._initializationPromise=this.queue((0,f.A)(function*(){var r,s;if(!i._deleted&&(i.persistenceManager=yield es.create(i,e),!i._deleted)){if(null!==(r=i._popupRedirectResolver)&&void 0!==r&&r._shouldInitProactively)try{yield i._popupRedirectResolver._initialize(i)}catch{}yield i.initializeCurrentUser(t),i.lastNotifiedUid=(null===(s=i.currentUser)||void 0===s?void 0:s.uid)||null,!i._deleted&&(i._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return(0,f.A)(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t,!0)}})()}initializeCurrentUser(e){var t=this;return(0,f.A)(function*(){var i;const r=yield t.assertedPersistence.getCurrentUser();let s=r,o=!1;if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const a=null===(i=t.redirectUser)||void 0===i?void 0:i._redirectEventId,c=s?._redirectEventId,u=yield t.tryRedirectSignIn(e);(!a||a===c)&&u?.user&&(s=u.user,o=!0)}if(!s)return t.directlySetCurrentUser(null);if(!s._redirectEventId){if(o)try{yield t.beforeStateQueue.runMiddleware(s)}catch(a){s=r,t._popupRedirectResolver._overrideRedirectResult(t,()=>Promise.reject(a))}return s?t.reloadAndSetCurrentUserOrClear(s):t.directlySetCurrentUser(null)}return k(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===s._redirectEventId?t.directlySetCurrentUser(s):t.reloadAndSetCurrentUserOrClear(s)})()}tryRedirectSignIn(e){var t=this;return(0,f.A)(function*(){let i=null;try{i=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return i})()}reloadAndSetCurrentUserOrClear(e){var t=this;return(0,f.A)(function*(){try{yield Ko(e)}catch(i){if("auth/network-request-failed"!==i?.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function HM(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}()}_delete(){var e=this;return(0,f.A)(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return(0,f.A)(function*(){const i=e?ie(e):null;return i&&k(i.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(i&&i._clone(t))})()}_updateCurrentUser(e,t=!1){var i=this;return(0,f.A)(function*(){if(!i._deleted)return e&&k(i.tenantId===e.tenantId,i,"tenant-id-mismatch"),t||(yield i.beforeStateQueue.runMiddleware(e)),i.queue((0,f.A)(function*(){yield i.directlySetCurrentUser(e),i.notifyAuthListeners()}))})()}signOut(){var e=this;return(0,f.A)(function*(){return yield e.beforeStateQueue.runMiddleware(null),(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null,!0)})()}setPersistence(e){var t=this;return this.queue((0,f.A)(function*(){yield t.assertedPersistence.setPersistence(dn(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new as("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var i=this;return(0,f.A)(function*(){const r=yield i.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return(0,f.A)(function*(){if(!t.redirectPersistenceManager){const i=e&&dn(e)||t._popupRedirectResolver;k(i,t,"argument-error"),t.redirectPersistenceManager=yield es.create(t,[dn(i._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return(0,f.A)(function*(){var i,r;return t._isInitialized&&(yield t.queue((0,f.A)(function*(){}))),(null===(i=t._currentUser)||void 0===i?void 0:i._redirectEventId)===e?t._currentUser:(null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return(0,f.A)(function*(){if(e===t.currentUser)return t.queue((0,f.A)(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return k(o,this,"internal-error"),o.then(()=>s(this.currentUser)),"function"==typeof t?e.addObserver(t,i,r):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return(0,f.A)(function*(){t.currentUser&&t.currentUser!==e&&t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh(),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return k(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Kb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return(0,f.A)(function*(){var t;const i={"X-Client-Version":e.clientVersion};e.app.options.appId&&(i["X-Firebase-gmpid"]=e.app.options.appId);const r=yield null===(t=e.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();return r&&(i["X-Firebase-Client"]=r),i})()}}function mt(n){return ie(n)}class zb{constructor(e){this.auth=e,this.observer=null,this.addObserver=function Lk(n,e){const t=new Fk(n,e);return t.subscribe.bind(t)}(t=>this.observer=t)}get next(){return k(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Qb(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Yb(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}class Qo{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return zt("not implemented")}_getIdTokenResponse(e){return zt("not implemented")}_linkToIdToken(e,t){return zt("not implemented")}_getReauthenticationResolver(e){return zt("not implemented")}}function Zp(){return Zp=(0,f.A)(function*(n,e){return Ke(n,"POST","/v1/accounts:update",e)}),Zp.apply(this,arguments)}function tm(){return tm=(0,f.A)(function*(n,e){return hn(n,"POST","/v1/accounts:signInWithPassword",Ve(n,e))}),tm.apply(this,arguments)}function am(){return am=(0,f.A)(function*(n,e){return hn(n,"POST","/v1/accounts:signInWithEmailLink",Ve(n,e))}),am.apply(this,arguments)}function cm(){return cm=(0,f.A)(function*(n,e){return hn(n,"POST","/v1/accounts:signInWithEmailLink",Ve(n,e))}),cm.apply(this,arguments)}class Yo extends Qo{constructor(e,t,i,r=null){super("password",i),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Yo(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new Yo(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){var t=this;return(0,f.A)(function*(){switch(t.signInMethod){case"password":return function gL(n,e){return tm.apply(this,arguments)}(e,{returnSecureToken:!0,email:t._email,password:t._password});case"emailLink":return function TL(n,e){return am.apply(this,arguments)}(e,{email:t._email,oobCode:t._password});default:pt(e,"internal-error")}})()}_linkToIdToken(e,t){var i=this;return(0,f.A)(function*(){switch(i.signInMethod){case"password":return function Jb(n,e){return Zp.apply(this,arguments)}(e,{idToken:t,returnSecureToken:!0,email:i._email,password:i._password});case"emailLink":return function EL(n,e){return cm.apply(this,arguments)}(e,{idToken:t,email:i._email,oobCode:i._password});default:pt(e,"internal-error")}})()}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function pn(n,e){return um.apply(this,arguments)}function um(){return um=(0,f.A)(function*(n,e){return hn(n,"POST","/v1/accounts:signInWithIdp",Ve(n,e))}),um.apply(this,arguments)}class Zo{constructor(e){var t,i,r,s,o,a;const c=us(ls(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,d=null!==(i=c.oobCode)&&void 0!==i?i:null,h=function SL(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);k(u&&d&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=d,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function RL(n){const e=us(ls(n)).link,t=e?us(ls(e)).deep_link_id:null,i=us(ls(n)).deep_link_id;return(i?us(ls(i)).link:null)||i||t||e||n}(e);try{return new Zo(t)}catch{return null}}}let Zb=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,i){return Yo._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){const r=Zo.parseLink(i);return k(r,"argument-error"),Yo._fromEmailAndCode(t,r.code,r.tenantId)}}return n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink",n})();class mn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class NL extends mn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}function mm(){return mm=(0,f.A)(function*(n,e){return hn(n,"POST","/v1/accounts:signUp",Ve(n,e))}),mm.apply(this,arguments)}class bt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,i,r=!1){return(0,f.A)(function*(){const s=yield Hi._fromIdTokenResponse(e,i,r),o=tA(i);return new bt({user:s,providerId:o,_tokenResponse:i,operationType:t})})()}static _forOperation(e,t,i){return(0,f.A)(function*(){yield e._updateTokensIfNecessary(i,!0);const r=tA(i);return new bt({user:e,providerId:r,_tokenResponse:i,operationType:t})})()}}function tA(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Lu extends Jt{constructor(e,t,i,r){var s;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,Lu.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new Lu(e,t,i,r)}}function nA(n,e,t,i){return("reauthenticate"===e?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw"auth/multi-factor-auth-required"===s.code?Lu._fromErrorAndOperation(n,s,e,i):s})}function vm(){return vm=(0,f.A)(function*(n,e,t=!1){const i=yield fn(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return bt._forOperation(n,"link",i)}),vm.apply(this,arguments)}function Tm(){return Tm=(0,f.A)(function*(n,e,t=!1){const{auth:i}=n,r="reauthenticate";try{const s=yield fn(n,nA(i,r,e,n),t);k(s.idToken,i,"internal-error");const o=Nu(s.idToken);k(o,i,"internal-error");const{sub:a}=o;return k(n.uid===a,i,"user-mismatch"),bt._forOperation(n,r,s)}catch(s){throw"auth/user-not-found"===s?.code&&pt(i,"user-mismatch"),s}}),Tm.apply(this,arguments)}function sA(n,e){return Em.apply(this,arguments)}function Em(){return Em=(0,f.A)(function*(n,e,t=!1){const i="signIn",r=yield nA(n,i,e),s=yield bt._fromIdTokenResponse(n,i,r);return t||(yield n._updateCurrentUser(s.user)),s}),Em.apply(this,arguments)}function bm(){return bm=(0,f.A)(function*(n,e){return sA(mt(n),e)}),bm.apply(this,arguments)}function Mm(){return Mm=(0,f.A)(function*(n,e,t){const i=mt(n),r=yield function eA(n,e){return mm.apply(this,arguments)}(i,{returnSecureToken:!0,email:e,password:t}),s=yield bt._fromIdTokenResponse(i,"signIn",r);return yield i._updateCurrentUser(s.user),s}),Mm.apply(this,arguments)}const Gu="__sak";class cA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Gu,"1"),this.storage.removeItem(Gu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const iF=(()=>{class n extends cA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function eF(){const n=xe();return Xp(n)||Du(n)}()&&function uL(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Hb(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const i of Object.keys(this.listeners)){const r=this.storage.getItem(i),s=this.localCache[i];r!==s&&t(i,s,r)}}onStorageEvent(t,i=!1){if(!t.key)return void this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});const r=t.key;if(i?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const a=this.storage.getItem(r);if(t.newValue!==a)null!==t.newValue?this.storage.setItem(r,t.newValue):this.storage.removeItem(r);else if(this.localCache[r]===t.newValue&&!i)return}const s=()=>{const a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);!function cL(){return function kk(){const n=xe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}()&&10===document.documentMode}()||o===t.newValue||t.newValue===t.oldValue?s():setTimeout(s,10)}notifyListeners(t,i){this.localCache[t]=i;const r=this.listeners[t];if(r)for(const s of Array.from(r))s(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(t,i){var r=()=>super._set,s=this;return(0,f.A)(function*(){yield r().call(s,t,i),s.localCache[t]=JSON.stringify(i)})()}_get(t){var i=()=>super._get,r=this;return(0,f.A)(function*(){const s=yield i().call(r,t);return r.localCache[t]=JSON.stringify(s),s})()}_remove(t){var i=()=>super._remove,r=this;return(0,f.A)(function*(){yield i().call(r,t),delete r.localCache[t]})()}}return n.type="LOCAL",n})(),uA=(()=>{class n extends cA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}return n.type="SESSION",n})();let sF=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const i=this.receivers.find(s=>s.isListeningto(t));if(i)return i;const r=new n(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}handleEvent(t){var i=this;return(0,f.A)(function*(){const r=t,{eventId:s,eventType:o,data:a}=r.data,c=i.handlersMap[o];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:s,eventType:o});const u=Array.from(c).map(function(){var h=(0,f.A)(function*(p){return p(r.origin,a)});return function(p){return h.apply(this,arguments)}}()),d=yield function rF(n){return Promise.all(n.map(function(){var e=(0,f.A)(function*(t){try{return{fulfilled:!0,value:yield t}}catch(i){return{fulfilled:!1,reason:i}}});return function(t){return e.apply(this,arguments)}}()))}(u);r.ports[0].postMessage({status:"done",eventId:s,eventType:o,response:d})})()}_subscribe(t,i){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||0===this.handlersMap[t].size)&&delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return n.receivers=[],n})();function Qm(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(10*Math.random());return n+t}class oF{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,i=50){var r=this;return(0,f.A)(function*(){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((c,u)=>{const d=Qm("",20);s.port1.start();const h=setTimeout(()=>{u(new Error("unsupported_event"))},i);a={messageChannel:s,onMessage(p){const m=p;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(h),o=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),c(m.data.response);break;default:clearTimeout(h),clearTimeout(o),u(new Error("invalid_response"))}}},r.handlers.add(a),s.port1.addEventListener("message",a.onMessage),r.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&r.removeMessageHandler(a)})})()}}function Ge(){return window}function Ym(){return typeof Ge().WorkerGlobalScope<"u"&&"function"==typeof Ge().importScripts}function Xm(){return(Xm=(0,f.A)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const lA="firebaseLocalStorageDb",Bu="firebaseLocalStorage",dA="fbase_key";class ta{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function qu(n,e){return n.transaction([Bu],e?"readwrite":"readonly").objectStore(Bu)}function Jm(){const n=indexedDB.open(lA,1);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Bu,{keyPath:dA})}catch(r){t(r)}}),n.addEventListener("success",(0,f.A)(function*(){const i=n.result;i.objectStoreNames.contains(Bu)?e(i):(i.close(),yield function hF(){const n=indexedDB.deleteDatabase(lA);return new ta(n).toPromise()}(),e(yield Jm()))}))})}function hA(n,e,t){return Zm.apply(this,arguments)}function Zm(){return Zm=(0,f.A)(function*(n,e,t){const i=qu(n,!0).put({[dA]:e,value:t});return new ta(i).toPromise()}),Zm.apply(this,arguments)}function eg(){return eg=(0,f.A)(function*(n,e){const t=qu(n,!1).get(e),i=yield new ta(t).toPromise();return void 0===i?null:i.value}),eg.apply(this,arguments)}function fA(n,e){const t=qu(n,!0).delete(e);return new ta(t).toPromise()}const gF=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var t=this;return(0,f.A)(function*(){return t.db||(t.db=yield Jm()),t.db})()}_withRetries(t){var i=this;return(0,f.A)(function*(){let r=0;for(;;)try{const s=yield i._openDb();return yield t(s)}catch(s){if(r++>3)throw s;i.db&&(i.db.close(),i.db=void 0)}})()}initializeServiceWorkerMessaging(){var t=this;return(0,f.A)(function*(){return Ym()?t.initializeReceiver():t.initializeSender()})()}initializeReceiver(){var t=this;return(0,f.A)(function*(){t.receiver=sF._getInstance(function lF(){return Ym()?self:null}()),t.receiver._subscribe("keyChanged",function(){var i=(0,f.A)(function*(r,s){return{keyProcessed:(yield t._poll()).includes(s.key)}});return function(r,s){return i.apply(this,arguments)}}()),t.receiver._subscribe("ping",function(){var i=(0,f.A)(function*(r,s){return["keyChanged"]});return function(r,s){return i.apply(this,arguments)}}())})()}initializeSender(){var t=this;return(0,f.A)(function*(){var i,r;if(t.activeServiceWorker=yield function cF(){return Xm.apply(this,arguments)}(),!t.activeServiceWorker)return;t.sender=new oF(t.activeServiceWorker);const s=yield t.sender._send("ping",{},800);s&&null!==(i=s[0])&&void 0!==i&&i.fulfilled&&null!==(r=s[0])&&void 0!==r&&r.value.includes("keyChanged")&&(t.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(t){var i=this;return(0,f.A)(function*(){if(i.sender&&i.activeServiceWorker&&function uF(){var n;return(null===(n=navigator?.serviceWorker)||void 0===n?void 0:n.controller)||null}()===i.activeServiceWorker)try{yield i.sender._send("keyChanged",{key:t},i.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,f.A)(function*(){try{if(!indexedDB)return!1;const t=yield Jm();return yield hA(t,Gu,"1"),yield fA(t,Gu),!0}catch{}return!1})()}_withPendingWrite(t){var i=this;return(0,f.A)(function*(){i.pendingWrites++;try{yield t()}finally{i.pendingWrites--}})()}_set(t,i){var r=this;return(0,f.A)(function*(){return r._withPendingWrite((0,f.A)(function*(){return yield r._withRetries(s=>hA(s,t,i)),r.localCache[t]=i,r.notifyServiceWorker(t)}))})()}_get(t){var i=this;return(0,f.A)(function*(){const r=yield i._withRetries(s=>function fF(n,e){return eg.apply(this,arguments)}(s,t));return i.localCache[t]=r,r})()}_remove(t){var i=this;return(0,f.A)(function*(){return i._withPendingWrite((0,f.A)(function*(){return yield i._withRetries(r=>fA(r,t)),delete i.localCache[t],i.notifyServiceWorker(t)}))})()}_poll(){var t=this;return(0,f.A)(function*(){const i=yield t._withRetries(o=>{const a=qu(o,!1).getAll();return new ta(a).toPromise()});if(!i)return[];if(0!==t.pendingWrites)return[];const r=[],s=new Set;for(const{fbase_key:o,value:a}of i)s.add(o),JSON.stringify(t.localCache[o])!==JSON.stringify(a)&&(t.notifyListeners(o,a),r.push(o));for(const o of Object.keys(t.localCache))t.localCache[o]&&!s.has(o)&&(t.notifyListeners(o,null),r.push(o));return r})()}notifyListeners(t,i){this.localCache[t]=i;const r=this.listeners[t];if(r)for(const s of Array.from(r))s(i)}startPolling(){var t=this;this.stopPolling(),this.pollTimer=setInterval((0,f.A)(function*(){return t._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return n.type="LOCAL",n})();function mA(n){return`__${n}${Math.floor(1e6*Math.random())}`}mA("rcb"),new Wo(3e4,6e4);class lg extends Qo{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return pn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return pn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return pn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function DF(n){return sA(n.auth,new lg(n),n.bypassAuthState)}function OF(n){const{auth:e,user:t}=n;return k(t,e,"internal-error"),function rA(n,e){return Tm.apply(this,arguments)}(t,new lg(n),n.bypassAuthState)}function MF(n){return dg.apply(this,arguments)}function dg(){return dg=(0,f.A)(function*(n){const{auth:e,user:t}=n;return k(t,e,"internal-error"),function ym(n,e){return vm.apply(this,arguments)}(t,new lg(n),n.bypassAuthState)}),dg.apply(this,arguments)}class LF{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=(0,f.A)(function*(i,r){e.pendingPromise={resolve:i,reject:r};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(s){e.reject(s)}});return function(i,r){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return(0,f.A)(function*(){const{urlResponse:i,sessionId:r,postBody:s,tenantId:o,error:a,type:c}=e;if(a)return void t.reject(a);const u={auth:t.auth,requestUri:i,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(c)(u))}catch(d){t.reject(d)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return DF;case"linkViaPopup":case"linkViaRedirect":return MF;case"reauthViaPopup":case"reauthViaRedirect":return OF;default:pt(this.auth,"internal-error")}}resolve(e){Zn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Zn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}new Wo(2e3,1e4);const na=new Map;class UF extends LF{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}execute(){var e=()=>super.execute,t=this;return(0,f.A)(function*(){let i=na.get(t.auth._key());if(!i){try{const s=(yield function VF(n,e){return gg.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;i=()=>Promise.resolve(s)}catch(r){i=()=>Promise.reject(r)}na.set(t.auth._key(),i)}return t.bypassAuthState||na.set(t.auth._key(),()=>Promise.resolve(null)),i()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,i=this;return(0,f.A)(function*(){if("signInViaRedirect"===e.type)return t().call(i,e);if("unknown"!==e.type){if(e.eventId){const r=yield i.auth._redirectUserForId(e.eventId);if(r)return i.user=r,t().call(i,e);i.resolve(null)}}else i.resolve(null)})()}onExecution(){return(0,f.A)(function*(){})()}cleanUp(){}}function gg(){return gg=(0,f.A)(function*(n,e){const t=function yA(n){return Pu("pendingRedirect",n.config.apiKey,n.name)}(e),i=function _A(n){return dn(n._redirectPersistence)}(n);if(!(yield i._isAvailable()))return!1;const r="true"===(yield i._get(t));return yield i._remove(t),r}),gg.apply(this,arguments)}function GF(n,e){na.set(n._key(),e)}function vA(n,e){return wg.apply(this,arguments)}function wg(){return wg=(0,f.A)(function*(n,e,t=!1){const i=mt(n),r=function zi(n,e){return e?dn(e):(k(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}(i,e),o=yield new UF(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,e)),o}),wg.apply(this,arguments)}class $F{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function HF(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return EA(n);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!EA(e)){const r=(null===(i=e.error.code)||void 0===i?void 0:i.split("auth/")[1])||"internal-error";t.onError(Kt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(TA(e))}saveEventToCache(e){this.cachedEventUids.add(TA(e)),this.lastProcessedEventTime=Date.now()}}function TA(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function EA({type:n,error:e}){return"unknown"===n&&"auth/no-auth-event"===e?.code}function Ag(){return Ag=(0,f.A)(function*(n,e={}){return Ke(n,"GET","/v1/projects",e)}),Ag.apply(this,arguments)}const zF=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,QF=/^https?/;function xg(){return xg=(0,f.A)(function*(n){if(n.config.emulator)return;const{authorizedDomains:e}=yield function KF(n){return Ag.apply(this,arguments)}(n);for(const t of e)try{if(XF(t))return}catch{}pt(n,"unauthorized-domain")}),xg.apply(this,arguments)}function XF(n){const e=jo(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return""===o.hostname&&""===i?"chrome-extension:"===t&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===t&&o.hostname===i}if(!QF.test(t))return!1;if(zF.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const JF=new Wo(3e4,6e4);function wA(){const n=Ge().___jsl;if(n?.H)for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}let Wu=null;function e3(n){return Wu=Wu||function ZF(n){return new Promise((e,t)=>{var i,r,s;function o(){wA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{wA(),t(Kt(n,"network-request-failed"))},timeout:JF.get()})}if(null!==(r=null===(i=Ge().gapi)||void 0===i?void 0:i.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(s=Ge().gapi)||void 0===s||!s.load){const a=mA("iframefcb");return Ge()[a]=()=>{gapi.load?o():t(Kt(n,"network-request-failed"))},function pA(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=Kt("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",function IF(){var n,e;return null!==(e=null===(n=document.getElementsByTagName("head"))||void 0===n?void 0:n[0])&&void 0!==e?e:document}().appendChild(i)})}(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}o()}}).catch(e=>{throw Wu=null,e})}(n),Wu}const t3=new Wo(5e3,15e3),r3={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},s3=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function o3(n){const e=n.config;k(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Up(e,"emulator/auth/iframe"):`https://${n.config.authDomain}/__/auth/iframe`,i={apiKey:e.apiKey,appName:n.name,v:ir},r=s3.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${nr(i).slice(1)}`}function kg(){return kg=(0,f.A)(function*(n){const e=yield e3(n),t=Ge().gapi;return k(t,n,"internal-error"),e.open({where:document.body,url:o3(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:r3,dontclear:!0},i=>new Promise(function(){var r=(0,f.A)(function*(s,o){yield i.restyle({setHideOnLeave:!1});const a=Kt(n,"network-request-failed"),c=Ge().setTimeout(()=>{o(a)},t3.get());function u(){Ge().clearTimeout(c),s(i)}i.ping(u).then(u,()=>{o(a)})});return function(s,o){return r.apply(this,arguments)}}()))}),kg.apply(this,arguments)}const c3={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class bA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function AA(n,e,t,i,r,s){k(n.config.authDomain,n,"auth-domain-config-required"),k(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:ir,eventId:r};if(e instanceof mn){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Ta(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,u]of Object.entries(s||{}))o[c]=u}if(e instanceof NL){const c=e.getScopes().filter(u=>""!==u);c.length>0&&(o.scopes=c.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const c of Object.keys(a))void 0===a[c]&&delete a[c];return`${function _3({config:n}){return n.emulator?Up(n,"emulator/auth/handler"):`https://${n.authDomain}/__/auth/handler`}(n)}?${nr(a).slice(1)}`}const Cg="webStorageSupport",v3=class y3{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=uA,this._completeRedirectFn=vA,this._overrideRedirectResult=GF}_openPopup(e,t,i,r){var s=this;return(0,f.A)(function*(){var o;Zn(null===(o=s.eventManagers[e._key()])||void 0===o?void 0:o.manager,"_initialize() not called before _openPopup()");const a=AA(e,t,i,jo(),r);return function f3(n,e,t,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},c3),{width:i.toString(),height:r.toString(),top:s,left:o}),u=xe().toLowerCase();t&&(a=Bb(u)?"_blank":t),Gb(u)&&(e=e||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce((p,[m,g])=>`${p}${m}=${g},`,"");if(function aL(n=xe()){var e;return Du(n)&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(u)&&"_self"!==a)return function p3(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}(e||"",a),new bA(null);const h=window.open(e||"",a,d);k(h,n,"popup-blocked");try{h.focus()}catch{}return new bA(h)}(e,a,Qm())})()}_openRedirect(e,t,i,r){var s=this;return(0,f.A)(function*(){return yield s._originValidation(e),function aF(n){Ge().location.href=n}(AA(e,t,i,jo(),r)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Zn(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}initAndGetManager(e){var t=this;return(0,f.A)(function*(){const i=yield function a3(n){return kg.apply(this,arguments)}(e),r=new $F(e);return i.register("authEvent",s=>(k(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:r},t.iframes[e._key()]=i,r})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Cg,{type:Cg},r=>{var s;const o=null===(s=r?.[0])||void 0===s?void 0:s[Cg];void 0!==o&&t(!!o),pt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function YF(n){return xg.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Hb()||Xp()||Du()}};var kA="@firebase/auth";class T3{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return(0,f.A)(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){k(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const A3=Gy("authIdTokenMaxAge")||300;let SA=null;const x3=n=>function(){var e=(0,f.A)(function*(t){const i=t&&(yield t.getIdTokenResult()),r=i&&((new Date).getTime()-Date.parse(i.issuedAtTime))/1e3;if(r&&r>A3)return;const s=i?.token;SA!==s&&(SA=s,yield fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});return function(t){return e.apply(this,arguments)}}();function k3(n=Tl()){const e=ds(n,"auth");if(e.isInitialized())return e.getImmediate();const t=function jM(n,e){const t=ds(n,"auth");if(t.isInitialized()){const r=t.getImmediate();if(wa(t.getOptions(),e??{}))return r;pt(r,"already-initialized")}return t.initialize({options:e})}(n,{popupRedirectResolver:v3,persistence:[gF,iF,uA]}),i=Gy("authTokenSyncURL");if(i){const s=x3(i);(function zL(n,e,t){ie(n).beforeAuthStateChanged(e,t)})(t,s,()=>s(t.currentUser)),function KL(n,e,t,i){ie(n).onIdTokenChanged(e,t,i)}(t,o=>s(o))}const r=Uy("auth");return r&&function hL(n,e,t){const i=mt(n);k(i._canInitEmulator,i,"emulator-config-failed"),k(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!!t?.disableWarnings,s=Qb(e),{host:o,port:a}=function fL(n){const e=Qb(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:Yb(i.substr(s.length+1))}}{const[s,o]=i.split(":");return{host:s,port:Yb(o)}}}(e);i.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function pL(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",n):n())}()}(t,`http://${r}`),t}!function w3(n){oi(new wn("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:s,authDomain:o}=i.options;return((a,c)=>{k(s&&!s.includes(":"),"invalid-api-key",{appName:a.name}),k(!o?.includes(":"),"argument-error",{appName:a.name});const u={apiKey:s,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Kb(n)},d=new dL(a,c,u);return function WM(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(dn);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}(d,t),d})(i,r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),oi(new wn("auth-internal",e=>{const t=mt(e.getProvider("auth").getImmediate());return new T3(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Mt(kA,"0.21.3",function E3(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(n)),Mt(kA,"0.21.3","esm2017")}("Browser"),new l.nKC(null);const NA="https://rktect-rest-default-rtdb.firebaseio.com/users.json",PA="kpPiWBeAJJ3KlXNQ1tULjJcYLWZoLMwdEpDRzKSc";let q3=(()=>{class n{constructor(t){this.http=t}getUsers(){return this.http.get(NA,{params:{auth:PA}})}createUser(t){return this.http.post(NA,t,{params:{auth:PA}})}}return n.\u0275fac=function(t){return new(t||n)(l.KVO(n0.Qq))},n.\u0275prov=l.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class j3{constructor(){this.db=TM(),this.auth=k3(),function EM(n,e){!function db(n){if(n._initialized||n._terminated)throw new E(v.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}(n=Y(n,fe));const t=De(n),i=n._freezeSettings(),r=new fp;return function lb(n,e,t){const i=new Fe;return n.asyncQueue.enqueue((0,f.A)(function*(){try{yield ib(n,t),yield rb(n,e),i.resolve()}catch(r){const s=r;if(!("FirebaseError"===(o=s).name?o.code===v.FAILED_PRECONDITION||o.code===v.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw s;Er("Error enabling offline persistence. Falling back to persistence disabled: "+s),i.reject(s)}var o})).then(()=>i.promise)}(t,r,new Qw(r,i.cacheSizeBytes,e?.forceOwnership))}(this.db).catch(e=>{"failed-precondition"==e.code?console.log("persistance failed"):"unimplemented"==e.code&&console.log("persistance not available")})}get colRef(){return function sM(n,e,...t){if(n=ie(n),pp("collection","path",e),n instanceof Fo){const i=X.fromString(e,...t);return Xw(i),new Ht(n,null,i)}{if(!(n instanceof Re||n instanceof Ht))throw new E(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(X.fromString(e,...t));return Xw(i),new Ht(n.firestore,null,i)}}(this.db,this.collectionPath)}getCollectionData(){return new Promise((e,t)=>{Su(this.colRef).then(i=>{let r=this.setData2(i);e(r)}).catch(i=>{t(i.message)})})}getSingleDoc(e){const t=Kr(this.db,this.collectionPath,e);return new Promise((i,r)=>function OM(n){n=Y(n,Re);const e=Y(n.firestore,fe);return function ab(n,e,t={}){const i=new Fe;return n.asyncQueue.enqueueAndForget((0,f.A)(function*(){return function(r,s,o,a,c){const u=new fu({next:h=>{s.enqueueAndForget(()=>Uf(r,d));const p=h.docs.has(o);!p&&h.fromCache?c.reject(new E(v.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&h.fromCache&&a&&"server"===a.source?c.reject(new E(v.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(h)},error:h=>c.reject(h)}),d=new Bf(Cr(o.path),u,{includeMetadataChanges:!0,Nu:!0});return Lf(r,d)}(yield zr(n),n.asyncQueue,e,t,i)})),i.promise}(De(e),n._key).then(t=>Op(e,n,t))}(t).then(s=>{let o=this.transformSingleDoc(s);i(o)}).catch(s=>{r(s.message)}))}getSingleDocFromCache(e){var t=this;return(0,f.A)(function*(){const i=Kr(t.db,t.collectionPath,e);try{const r=yield MM(i);console.log("Cached document data:",r.data())}catch(r){console.log("Error getting cached document:",r)}})()}getCollectionRealTime(e){return this.unsubscribe=Dp(this.colRef,t=>{e(this.setData2(t))})}getDocRealTime(e,t){return Dp(Kr(this.db,this.collectionPath,e),r=>{t(this.transformSingleDoc(r))})}g(){Dp(void 0,t=>{t.docChanges().forEach(i=>{"added"===i.type&&console.log("New city: ",i.doc.data()),"modified"===i.type&&console.log("Modified city: ",i.doc.data()),"removed"===i.type&&console.log("Removed city: ",i.doc.data())})})}addingDoc(e={}){return function UM(n,e){const t=Y(n.firestore,fe),i=Kr(n),r=function ku(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}(n.converter,e);return qo(t,[_u(ji(n.firestore),"addDoc",i._key,r,null!==n.converter,{}).toMutation(i._key,ge.exists(!1))]).then(()=>i)}(this.colRef,{createdAt:Mp(),updatedAt:Mp(),...e})}deletingDoc(e){return function FM(n){return qo(Y(n.firestore,fe),[new Pr(n._key,ge.none())])}(Kr(this.db,this.collectionPath,e))}updatingDoc(e,t){return function LM(n,e,t,...i){n=Y(n,Re);const r=Y(n.firestore,fe),s=ji(r);let o;return o="string"==typeof(e=ie(e))||e instanceof Bi?function kp(n,e,t,i,r,s){const o=n.da(1,e,t),a=[Sp(e,i,t)],c=[r];if(s.length%2!=0)throw new E(v.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)a.push(Sp(e,s[p])),c.push(s[p+1]);const u=[],d=Je.empty();for(let p=a.length-1;p>=0;--p)if(!yb(u,a[p])){const m=a[p];let g=c[p];g=ie(g);const I=o.ca(m);if(g instanceof Uo)u.push(m);else{const A=Wi(g,I);null!=A&&(u.push(m),d.set(m,A))}}const h=new dt(u);return new hb(d,h,o.fieldTransforms)}(s,"updateDoc",n._key,e,t,i):function xp(n,e,t,i){const r=n.da(1,e,t);Cp("Data must be an object, but it was:",r,i);const s=[],o=Je.empty();Ai(i,(c,u)=>{const d=yu(e,c,t);u=ie(u);const h=r.ca(d);if(u instanceof Uo)s.push(d);else{const p=Wi(u,h);null!=p&&(s.push(d),o.set(d,p))}});const a=new dt(s);return new hb(o,a,r.fieldTransforms)}(s,"updateDoc",n._key,e),qo(r,[o.toMutation(n._key,ge.exists(!0))])}(Kr(this.db,this.collectionPath,e),{updatedAt:Mp(),...t})}signUpWithEmailPass({email:e,password:t}){return function UL(n,e,t){return Mm.apply(this,arguments)}(this.auth,e,t).then(i=>Promise.resolve(i.user)).catch(i=>Promise.reject(i.message))}signInWithEmailPass({email:e,password:t}){return function VL(n,e,t){return function wm(n,e){return bm.apply(this,arguments)}(ie(n),Zb.credential(e,t))}(this.auth,e,t).then(i=>Promise.resolve(i.user)).catch(i=>Promise.reject(i.message))}onSignOut(){return function YL(n){return ie(n).signOut()}(this.auth).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e.message))}subscribingAuthChangedRealTime(e){return function QL(n,e,t,i){return ie(n).onAuthStateChanged(e,t,i)}(this.auth,t=>{e(t)})}getPaginationData1(e={latestDoc:null,empty:!1,data:[]},t=5){return new Promise((i,r)=>{Su(Tu(this.colRef,Eu("createdAt"),Pp(e.latestDoc||0),bu(t))).then(o=>{let a=this.setData2(o);e.latestDoc=o.docs[o.docs.length-1],e.data=[...e.data,...a],e.empty=o.empty,i(e)}).catch(o=>{r(o.message)})})}getPaginationData(e={latestDoc:null,empty:!1,data:[],size:0},t=5){var i=this;return(0,f.A)(function*(){if(!e.empty)try{const r=Tu(i.colRef,Eu("createdAt"),Pp(e.latestDoc||0),bu(t)),s=yield Su(r);let o=i.setData2(s);return e.latestDoc=s.docs[s.docs.length-1],e.data=[...e.data,...o],e.empty=s.empty,e.size=s.size,e}catch(r){return r}})()}unsubscribeRealTime(){this.unsubscribe()}nextPage(e={latestDoc:null,empty:!1,data:[],size:0},t=5){var i=this;return(0,f.A)(function*(){const r=Tu(i.colRef,Eu("createdAt"),Pp(e.latestDoc||0),bu(t));return yield i.handlePagination(r)})()}prePage(e={latestDoc:null,empty:!1,data:[],size:0},t=5){var i=this;return(0,f.A)(function*(){const r=Tu(i.colRef,Eu("createdAt"),function NM(...n){return xu._create("endBefore",n,!1)}(e.latestDoc||0),bu(t));return yield i.handlePagination(r,!1)})()}setData(e){return e.docs.map(t=>({id:t.id,...t.data()}))}setData2(e){let t=[];return e.docs.forEach(i=>{t.push({...i.data(),id:i.id})}),t}transformSingleDoc(e){return{...e.data(),id:e.id}}handlePagination(e,t=!0){var i=this;return(0,f.A)(function*(){try{const r=yield Su(e);let s=i.setData2(r);return{latestDoc:t?r.docs[r.docs.length-1]:r.docs[0],data:s,empty:r.empty,size:r.size}}catch(r){return r}})()}}var $u=R(5704),DA=R(8232),ia=R(3810);const W3=()=>["Books","auth","pagination load more","pagination pre and next"],OA=()=>["name","author"];function $3(n,e){if(1&n){const t=l.RV6();l.j41(0,"button",6),l.bIt("click",function(){l.eBV(t),l.XpG();const r=l.sdS(2),s=l.XpG();return l.Njj(s.createBook(r))}),l.EFF(1,"Create Book"),l.k0s()}}function H3(n,e){if(1&n){const t=l.RV6();l.j41(0,"button",6),l.bIt("click",function(){l.eBV(t),l.XpG();const r=l.sdS(2),s=l.XpG();return l.Njj(s.updateBook(r))}),l.EFF(1,"Update Book"),l.k0s()}}function K3(n,e){if(1&n){const t=l.RV6();l.qex(0),l.j41(1,"ang-modal",3,0),l.nrm(3,"ang-pretty-json-input",4),l.DNE(4,$3,2,0,"button",5)(5,H3,2,0,"button",5),l.k0s(),l.nrm(6,"hr"),l.j41(7,"button",6),l.bIt("click",function(){l.eBV(t);const r=l.sdS(2),s=l.XpG();return l.Njj(s.addBook(r))}),l.EFF(8,"Add"),l.k0s(),l.nrm(9,"hr")(10,"ng-table-view",7),l.j41(11,"ng-table-actions",8),l.bIt("onDelete",function(r){l.eBV(t);const s=l.XpG();return l.Njj(s.onDelete(r))})("onEdit",function(r){l.eBV(t);const s=l.sdS(2),o=l.XpG();return l.Njj(o.onEdit(r,s))})("onView",function(r){l.eBV(t);const s=l.sdS(2),o=l.XpG();return l.Njj(o.onView(r,s))}),l.k0s(),l.j41(12,"ng-table-inline-editing-one",9),l.bIt("onDelete",function(r){l.eBV(t);const s=l.XpG();return l.Njj(s.onDelete(r))})("onUpdate",function(r){l.eBV(t);const s=l.sdS(2),o=l.XpG();return l.Njj(o.onEdit(r,s))}),l.k0s(),l.j41(13,"ng-table-inline-editing-two",10),l.bIt("onUpdate",function(r){l.eBV(t);const s=l.sdS(2),o=l.XpG();return l.Njj(o.onEdit(r,s))}),l.k0s(),l.bVm()}if(2&n){const t=l.XpG();l.R7$(3),l.Y8G("data",t.bookForm),l.R7$(),l.Y8G("ngIf","add"===t.action),l.R7$(),l.Y8G("ngIf","edit"===t.action),l.R7$(5),l.Y8G("columns",t.cols1)("customHeads",t.customHeads1)("rows",t.books),l.R7$(),l.Y8G("columns",t.cols)("customHeads",t.customHeads)("rows",t.books),l.R7$(),l.Y8G("columns",t.cols)("customHeads",t.customHeads)("rows",t.books),l.R7$(),l.Y8G("columns",t.cols1)("customHeads",t.customHeads1)("rows",t.books)}}function z3(n,e){if(1&n){const t=l.RV6();l.j41(0,"form",12)(1,"label"),l.EFF(2,"Email "),l.j41(3,"em"),l.EFF(4,"(Required)"),l.k0s(),l.nrm(5,"input",13),l.k0s(),l.j41(6,"label"),l.EFF(7,"Password "),l.nrm(8,"input",14),l.k0s(),l.j41(9,"span")(10,"button",6),l.bIt("click",function(){l.eBV(t);const r=l.XpG(2);return l.Njj(r.signUp())}),l.EFF(11,"SignUp"),l.k0s(),l.j41(12,"button",6),l.bIt("click",function(){l.eBV(t);const r=l.XpG(2);return l.Njj(r.signIn())}),l.EFF(13,"SignIn"),l.k0s()()()}if(2&n){const t=l.XpG(2);l.Y8G("formGroup",t.singUpForm)}}function Q3(n,e){if(1&n){const t=l.RV6();l.qex(0),l.j41(1,"span"),l.EFF(2,"Login as : "),l.j41(3,"em"),l.EFF(4),l.k0s()(),l.j41(5,"button",6),l.bIt("click",function(){l.eBV(t);const r=l.XpG(2);return l.Njj(r.signOut())}),l.EFF(6,"SignOut"),l.k0s(),l.bVm()}if(2&n){const t=l.XpG(2);l.R7$(4),l.JRh(null==t.user?null:t.user.email)}}function Y3(n,e){if(1&n&&(l.qex(0),l.DNE(1,z3,14,1,"form",11)(2,Q3,7,1,"ng-container",2),l.bVm()),2&n){const t=l.XpG();l.R7$(),l.Y8G("ngIf",!t.user),l.R7$(),l.Y8G("ngIf",t.user)}}function X3(n,e){if(1&n){const t=l.RV6();l.j41(0,"button",6),l.bIt("click",function(){l.eBV(t);const r=l.XpG(2);return l.Njj(r.loadMore())}),l.EFF(1,"load More"),l.k0s()}}function J3(n,e){if(1&n&&(l.qex(0),l.nrm(1,"ng-table-view",15),l.DNE(2,X3,2,0,"button",5),l.bVm()),2&n){const t=l.XpG();l.R7$(),l.Y8G("columns",l.lJ4(3,OA))("rows",t.loadMoreData.data),l.R7$(),l.Y8G("ngIf",!t.loadMoreData.empty)}}function Z3(n,e){if(1&n){const t=l.RV6();l.j41(0,"button",6),l.bIt("click",function(){l.eBV(t);const r=l.XpG(2);return l.Njj(r.pre())}),l.EFF(1,"pre"),l.k0s()}}function eU(n,e){if(1&n){const t=l.RV6();l.j41(0,"button",6),l.bIt("click",function(){l.eBV(t);const r=l.XpG(2);return l.Njj(r.next())}),l.EFF(1,"Next"),l.k0s()}}function tU(n,e){if(1&n&&(l.qex(0),l.nrm(1,"ng-table-view",15),l.DNE(2,Z3,2,0,"button",5)(3,eU,2,0,"button",5),l.bVm()),2&n){const t=l.XpG();l.R7$(),l.Y8G("columns",l.lJ4(4,OA))("rows",t.paginationData.data),l.R7$(),l.Y8G("ngIf",!t.paginationData.empty),l.R7$(),l.Y8G("ngIf",!t.paginationData.empty)}}let nU=(()=>{class n extends j3{constructor(t){super(),this.fb=t,this.bookForm={name:"",author:""},this.selectTab=1,this.books=[],this.cols=["","name","author"],this.customHeads=["Action","Book name","Book author"],this.cols1=["name","author"],this.customHeads1=["Book name","Book author"],this.action="add",this.paginationData={data:[],latestDoc:null,empty:!1,size:0},this.loadMoreData={data:[],latestDoc:null,empty:!1,size:0},this.collectionPath="books",this.singUpForm=this.fb.group({email:["",[U.k0.required,U.k0.email]],password:["",[U.k0.required]]})}ngOnInit(){this.getCollectionRealTime(t=>{this.books=t}),this.subscribingAuthChangedRealTime(t=>{this.user=t}),this.loadMore()}createBook(t){this.addingDoc(this.bookForm).then(()=>{t.close()})}updateBook(t){this.updatingDoc(this.docId,this.bookForm).then(()=>{this.docId=null,t.close()})}onView(t,i){this.action="view",this.getSingleDoc(t.id).then(r=>{this.bookForm=r,i.open()})}onDelete(t){this.action="delete",confirm("Are you sure to delete doc ?")&&this.deletingDoc(t.id).then()}onEdit(t,i){this.action="edit",this.getSingleDoc(t.id).then(r=>{let{name:s,author:o,id:a}=r;this.bookForm={name:s,author:o},this.docId=a,i.open()})}onSelectTab(t){this.selectTab=t}addBook(t){this.bookForm={name:"",author:""},this.action="add",t.open()}signUp(){this.singUpForm.valid&&this.signUpWithEmailPass(this.singUpForm.value).then(()=>{this.singUpForm.reset()})}signIn(){this.singUpForm.valid&&this.signInWithEmailPass(this.singUpForm.value).then(()=>{this.singUpForm.reset()})}signOut(){this.onSignOut().then()}loadMore(){this.getPaginationData(this.loadMoreData).then(t=>{this.loadMoreData=t})}next(){this.nextPage(this.paginationData).then(t=>{this.paginationData=t})}pre(){this.prePage(this.paginationData).then(t=>{this.paginationData=t})}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(U.ok))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-firestore"]],standalone:!1,features:[l.Vt3],decls:5,vars:6,consts:[["pop",""],["color","red",3,"onClick","tabs"],[4,"ngIf"],["id","custom-modal-1","width","50vw"],["useCase","VALID_FORM",3,"data"],[3,"click",4,"ngIf"],[3,"click"],["table","striped",3,"columns","customHeads","rows"],["table","bordered",3,"onDelete","onEdit","onView","columns","customHeads","rows"],["table","bordered",3,"onDelete","onUpdate","columns","customHeads","rows"],["table","bordered",3,"onUpdate","columns","customHeads","rows"],["class","contact-form",3,"formGroup",4,"ngIf"],[1,"contact-form",3,"formGroup"],["formControlName","email","type","email"],["formControlName","password"],[3,"columns","rows"]],template:function(i,r){1&i&&(l.j41(0,"tg-tabs",1),l.bIt("onClick",function(o){return r.onSelectTab(o)}),l.k0s(),l.DNE(1,K3,14,15,"ng-container",2)(2,Y3,3,2,"ng-container",2)(3,J3,3,4,"ng-container",2)(4,tU,4,5,"ng-container",2)),2&i&&(l.Y8G("tabs",l.lJ4(5,W3)),l.R7$(),l.Y8G("ngIf",1===r.selectTab),l.R7$(),l.Y8G("ngIf",2===r.selectTab),l.R7$(),l.Y8G("ngIf",3===r.selectTab),l.R7$(),l.Y8G("ngIf",4===r.selectTab))},dependencies:[T.NgIf,U.qT,U.me,U.BC,U.cb,U.j4,U.JD,$u.gX,$u.zf,DA.OW,ia.NU,ia.jN,ia.Pn,ia.Lw],encapsulation:2})}}return n})();var G=R(1076),At=R(7852),MA=R(1362);const iU=function LA(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},FA=new G.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Hu=new st.Vy("@firebase/auth");function Ku(n,...e){Hu.logLevel<=st.$b.ERROR&&Hu.error(`Auth (${At.MF}): ${n}`,...e)}function gt(n,...e){throw Rg(n,...e)}function Et(n,...e){return Rg(n,...e)}function UA(n,e,t){const i=Object.assign(Object.assign({},iU()),{[e]:t});return new G.FA("auth","Firebase",i).create(e,{appName:n.name})}function Rg(n,...e){if("string"!=typeof n){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return FA.create(n,...e)}function x(n,e,...t){if(!n)throw Rg(e,...t)}function Qt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ku(e),new Error(e)}function gn(n,e){n||Qt(e)}function ra(){var n;return typeof self<"u"&&(null===(n=self.location)||void 0===n?void 0:n.href)||""}function VA(){var n;return typeof self<"u"&&(null===(n=self.location)||void 0===n?void 0:n.protocol)||null}class sa{constructor(e,t){this.shortDelay=e,this.longDelay=t,gn(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,G.jZ)()||(0,G.lV)()}get(){return function sU(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(function Ng(){return"http:"===VA()||"https:"===VA()}()||(0,G.sr)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Pg(n,e){gn(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class GA{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void Qt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void Qt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void Qt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const aU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},cU=new sa(3e4,6e4);function ve(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function be(n,e,t,i){return Dg.apply(this,arguments)}function Dg(){return Dg=(0,f.A)(function*(n,e,t,i,r={}){return BA(n,r,(0,f.A)(function*(){let s={},o={};i&&("GET"===e?o=i:s={body:JSON.stringify(i)});const a=(0,G.Am)(Object.assign({key:n.config.apiKey},o)).slice(1),c=yield n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),GA.fetch()(qA(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},s))}))}),Dg.apply(this,arguments)}function BA(n,e,t){return Og.apply(this,arguments)}function Og(){return Og=(0,f.A)(function*(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},aU),e);try{const r=new uU(n),s=yield Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=yield s.json();if("needConfirmation"in o)throw oa(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===c)throw oa(n,"credential-already-in-use",o);if("EMAIL_EXISTS"===c)throw oa(n,"email-already-in-use",o);if("USER_DISABLED"===c)throw oa(n,"user-disabled",o);const d=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw UA(n,d,u);gt(n,d)}}catch(r){if(r instanceof G.g)throw r;gt(n,"network-request-failed",{message:String(r)})}}),Og.apply(this,arguments)}function Mg(){return Mg=(0,f.A)(function*(n,e,t,i,r={}){const s=yield be(n,e,t,i,r);return"mfaPendingCredential"in s&&gt(n,"multi-factor-auth-required",{_serverResponse:s}),s}),Mg.apply(this,arguments)}function qA(n,e,t,i){const r=`${e}${t}?${i}`;return n.config.emulator?Pg(n.config,r):`${n.config.apiScheme}://${r}`}class uU{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Et(this.auth,"network-request-failed")),cU.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function oa(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=Et(n,e,i);return r.customData._tokenResponse=t,r}function Lg(){return Lg=(0,f.A)(function*(n,e){return be(n,"POST","/v1/accounts:delete",e)}),Lg.apply(this,arguments)}function Ug(){return Ug=(0,f.A)(function*(n,e){return be(n,"POST","/v1/accounts:lookup",e)}),Ug.apply(this,arguments)}function aa(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Vg(){return Vg=(0,f.A)(function*(n,e=!1){const t=(0,G.Ku)(n),i=yield t.getIdToken(e),r=zu(i);x(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:aa(Gg(r.auth_time)),issuedAtTime:aa(Gg(r.iat)),expirationTime:aa(Gg(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}),Vg.apply(this,arguments)}function Gg(n){return 1e3*Number(n)}function zu(n){const[e,t,i]=n.split(".");if(void 0===e||void 0===t||void 0===i)return Ku("JWT malformed, contained fewer than 3 sections"),null;try{const r=(0,G.u)(t);return r?JSON.parse(r):(Ku("Failed to decode base64 JWT payload"),null)}catch(r){return Ku("Caught error parsing JWT payload as JSON",r?.toString()),null}}function yn(n,e){return Bg.apply(this,arguments)}function Bg(){return Bg=(0,f.A)(function*(n,e,t=!1){if(t)return e;try{return yield e}catch(i){throw i instanceof G.g&&function mU({code:n}){return"auth/user-disabled"===n||"auth/user-token-expired"===n}(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}}),Bg.apply(this,arguments)}class gU{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),i}{this.errorBackoff=3e4;const r=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout((0,f.A)(function*(){yield t.iteration()}),i)}iteration(){var e=this;return(0,f.A)(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t?.code&&e.schedule(!0))}e.schedule()})()}}class jA{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=aa(this.lastLoginAt),this.creationTime=aa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function ca(n){return qg.apply(this,arguments)}function qg(){return qg=(0,f.A)(function*(n){var e;const t=n.auth,i=yield n.getIdToken(),r=yield yn(n,function hU(n,e){return Ug.apply(this,arguments)}(t,{idToken:i}));x(r?.users.length,t,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=null!==(e=s.providerUserInfo)&&void 0!==e&&e.length?function vU(n){return n.map(e=>{var{providerId:t}=e,i=(0,Jr.Tt)(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}(s.providerUserInfo):[],a=function yU(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}(n.providerData,o),d=!!n.isAnonymous&&!(n.email&&s.passwordHash||a?.length),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new jA(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,h)}),qg.apply(this,arguments)}function jg(){return jg=(0,f.A)(function*(n){const e=(0,G.Ku)(n);yield ca(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}),jg.apply(this,arguments)}function Wg(){return Wg=(0,f.A)(function*(n,e){const t=yield BA(n,{},(0,f.A)(function*(){const i=(0,G.Am)({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=qA(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",GA.fetch()(o,{method:"POST",headers:a,body:i})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}),Wg.apply(this,arguments)}class ua{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){x(e.idToken,"internal-error"),x(typeof e.idToken<"u","internal-error"),x(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):function pU(n){const e=zu(n);return x(e,"internal-error"),x(typeof e.exp<"u","internal-error"),x(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var i=this;return(0,f.A)(function*(){return x(!i.accessToken||i.refreshToken,e,"user-token-expired"),t||!i.accessToken||i.isExpired?i.refreshToken?(yield i.refresh(e,i.refreshToken),i.accessToken):null:i.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var i=this;return(0,f.A)(function*(){const{accessToken:r,refreshToken:s,expiresIn:o}=yield function IU(n,e){return Wg.apply(this,arguments)}(e,t);i.updateTokensAndExpiration(r,s,Number(o))})()}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*i}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new ua;return i&&(x("string"==typeof i,"internal-error",{appName:e}),o.refreshToken=i),r&&(x("string"==typeof r,"internal-error",{appName:e}),o.accessToken=r),s&&(x("number"==typeof s,"internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ua,this.toJSON())}_performRefresh(){return Qt("not implemented")}}function ti(n,e){x("string"==typeof n||typeof n>"u","internal-error",{appName:e})}class Qi{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=(0,Jr.Tt)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new gU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new jA(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){var t=this;return(0,f.A)(function*(){const i=yield yn(t,t.stsTokenManager.getToken(t.auth,e));return x(i,t.auth,"internal-error"),t.accessToken!==i&&(t.accessToken=i,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),i})()}getIdTokenResult(e){return function fU(n){return Vg.apply(this,arguments)}(this,e)}reload(){return function _U(n){return jg.apply(this,arguments)}(this)}_assign(e){this!==e&&(x(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Qi(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){x(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var i=this;return(0,f.A)(function*(){let r=!1;e.idToken&&e.idToken!==i.stsTokenManager.accessToken&&(i.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield ca(i)),yield i.auth._persistUserIfCurrent(i),r&&i.auth._notifyListenersIfCurrent(i)})()}delete(){var e=this;return(0,f.A)(function*(){const t=yield e.getIdToken();return yield yn(e,function lU(n,e){return Lg.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,c,u,d;const h=null!==(i=t.displayName)&&void 0!==i?i:void 0,p=null!==(r=t.email)&&void 0!==r?r:void 0,m=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,g=null!==(o=t.photoURL)&&void 0!==o?o:void 0,I=null!==(a=t.tenantId)&&void 0!==a?a:void 0,A=null!==(c=t._redirectEventId)&&void 0!==c?c:void 0,$=null!==(u=t.createdAt)&&void 0!==u?u:void 0,Z=null!==(d=t.lastLoginAt)&&void 0!==d?d:void 0,{uid:q,emailVerified:de,isAnonymous:te,providerData:K,stsTokenManager:Ie}=t;x(q&&Ie,e,"internal-error");const En=ua.fromJSON(this.name,Ie);x("string"==typeof q,e,"internal-error"),ti(h,e.name),ti(p,e.name),x("boolean"==typeof de,e,"internal-error"),x("boolean"==typeof te,e,"internal-error"),ti(m,e.name),ti(g,e.name),ti(I,e.name),ti(A,e.name),ti($,e.name),ti(Z,e.name);const Ji=new Qi({uid:q,auth:e,email:p,emailVerified:de,displayName:h,isAnonymous:te,photoURL:g,phoneNumber:m,tenantId:I,stsTokenManager:En,createdAt:$,lastLoginAt:Z});return K&&Array.isArray(K)&&(Ji.providerData=K.map(Dy=>Object.assign({},Dy))),A&&(Ji._redirectEventId=A),Ji}static _fromIdTokenResponse(e,t,i=!1){return(0,f.A)(function*(){const r=new ua;r.updateFromServerResponse(t);const s=new Qi({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return yield ca(s),s})()}}const WA=new Map;function vn(n){gn(n instanceof Function,"Expected a class definition");let e=WA.get(n);return e?(gn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,WA.set(n,e),e)}const $A=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,f.A)(function*(){return!0})()}_set(t,i){var r=this;return(0,f.A)(function*(){r.storage[t]=i})()}_get(t){var i=this;return(0,f.A)(function*(){const r=i.storage[t];return void 0===r?null:r})()}_remove(t){var i=this;return(0,f.A)(function*(){delete i.storage[t]})()}_addListener(t,i){}_removeListener(t,i){}}return n.type="NONE",n})();function Qu(n,e,t){return`firebase:${n}:${e}:${t}`}class is{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=Qu(this.userKey,r.apiKey,s),this.fullPersistenceKey=Qu("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return(0,f.A)(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?Qi._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return(0,f.A)(function*(){if(t.persistence===e)return;const i=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,i?t.setCurrentUser(i):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,i="authUser"){return(0,f.A)(function*(){if(!t.length)return new is(vn($A),e,i);const r=(yield Promise.all(t.map(function(){var u=(0,f.A)(function*(d){if(yield d._isAvailable())return d});return function(d){return u.apply(this,arguments)}}()))).filter(u=>u);let s=r[0]||vn($A);const o=Qu(i,e.config.apiKey,e.name);let a=null;for(const u of t)try{const d=yield u._get(o);if(d){const h=Qi._fromJSON(e,d);u!==s&&(a=h),s=u;break}}catch{}const c=r.filter(u=>u._shouldAllowMigration);return s._shouldAllowMigration&&c.length?(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(function(){var u=(0,f.A)(function*(d){if(d!==s)try{yield d._remove(o)}catch{}});return function(d){return u.apply(this,arguments)}}())),new is(s,e,i)):new is(s,e,i)})()}}function HA(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(QA(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(KA(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(XA(e))return"Blackberry";if(JA(e))return"Webos";if($g(e))return"Safari";if((e.includes("chrome/")||zA(e))&&!e.includes("edge/"))return"Chrome";if(YA(e))return"Android";{const i=n.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===i?.length)return i[1]}return"Other"}function KA(n=(0,G.ZQ)()){return/firefox\//i.test(n)}function $g(n=(0,G.ZQ)()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function zA(n=(0,G.ZQ)()){return/crios\//i.test(n)}function QA(n=(0,G.ZQ)()){return/iemobile/i.test(n)}function YA(n=(0,G.ZQ)()){return/android/i.test(n)}function XA(n=(0,G.ZQ)()){return/blackberry/i.test(n)}function JA(n=(0,G.ZQ)()){return/webos/i.test(n)}function Yu(n=(0,G.ZQ)()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function ZA(n=(0,G.ZQ)()){return Yu(n)||YA(n)||JA(n)||XA(n)||/windows phone/i.test(n)||QA(n)}function ex(n,e=[]){let t;switch(n){case"Browser":t=HA((0,G.ZQ)());break;case"Worker":t=`${HA((0,G.ZQ)())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${At.MF}/${i}`}function tx(n,e){return Kg.apply(this,arguments)}function Kg(){return Kg=(0,f.A)(function*(n,e){return be(n,"GET","/v2/recaptchaConfig",ve(n,e))}),Kg.apply(this,arguments)}function ix(n){return void 0!==n&&void 0!==n.enterprise}class rx{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(t=>"EMAIL_PASSWORD_PROVIDER"===t.provider&&"OFF"!==t.enforcementState)}}function zg(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=Et("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",function AU(){var n,e;return null!==(e=null===(n=document.getElementsByTagName("head"))||void 0===n?void 0:n[0])&&void 0!==e?e:document}().appendChild(i)})}function sx(n){return`__${n}${Math.floor(1e6*Math.random())}`}class ox{constructor(e){this.type="recaptcha-enterprise",this.auth=ze(e)}verify(e="verify",t=!1){var i=this;return(0,f.A)(function*(){function s(){return s=(0,f.A)(function*(a){if(!t){if(null==a.tenantId&&null!=a._agentRecaptchaConfig)return a._agentRecaptchaConfig.siteKey;if(null!=a.tenantId&&void 0!==a._tenantRecaptchaConfigs[a.tenantId])return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(function(){var c=(0,f.A)(function*(u,d){tx(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(void 0!==h.recaptchaKey){const p=new rx(h);return null==a.tenantId?a._agentRecaptchaConfig=p:a._tenantRecaptchaConfigs[a.tenantId]=p,u(p.siteKey)}d(new Error("recaptcha Enterprise site key undefined"))}).catch(h=>{d(h)})});return function(u,d){return c.apply(this,arguments)}}())}),s.apply(this,arguments)}function o(a,c,u){const d=window.grecaptcha;ix(d)?d.enterprise.ready(()=>{d.enterprise.execute(a,{action:e}).then(h=>{c(h)}).catch(()=>{c("NO_RECAPTCHA")})}):u(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,c)=>{(function r(a){return s.apply(this,arguments)})(i.auth).then(u=>{if(!t&&ix(window.grecaptcha))o(u,a,c);else{if(typeof window>"u")return void c(new Error("RecaptchaVerifier is only supported in browser"));zg("https://www.google.com/recaptcha/enterprise.js?render="+u).then(()=>{o(u,a,c)}).catch(d=>{c(d)})}}).catch(u=>{c(u)})})})()}}class SU{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((o,a)=>{try{o(e(s))}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){var t=this;return(0,f.A)(function*(){if(t.auth.currentUser===e)return;const i=[];try{for(const r of t.queue)yield r(e),r.onAbort&&i.push(r.onAbort)}catch(r){i.reverse();for(const s of i)try{s()}catch{}throw t.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})()}}class RU{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ax(this),this.idTokenSubscription=new ax(this),this.beforeStateQueue=new SU(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=FA,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){var i=this;return t&&(this._popupRedirectResolver=vn(t)),this._initializationPromise=this.queue((0,f.A)(function*(){var r,s;if(!i._deleted&&(i.persistenceManager=yield is.create(i,e),!i._deleted)){if(null!==(r=i._popupRedirectResolver)&&void 0!==r&&r._shouldInitProactively)try{yield i._popupRedirectResolver._initialize(i)}catch{}yield i.initializeCurrentUser(t),i.lastNotifiedUid=(null===(s=i.currentUser)||void 0===s?void 0:s.uid)||null,!i._deleted&&(i._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return(0,f.A)(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t,!0)}})()}initializeCurrentUser(e){var t=this;return(0,f.A)(function*(){var i;const r=yield t.assertedPersistence.getCurrentUser();let s=r,o=!1;if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const a=null===(i=t.redirectUser)||void 0===i?void 0:i._redirectEventId,c=s?._redirectEventId,u=yield t.tryRedirectSignIn(e);(!a||a===c)&&u?.user&&(s=u.user,o=!0)}if(!s)return t.directlySetCurrentUser(null);if(!s._redirectEventId){if(o)try{yield t.beforeStateQueue.runMiddleware(s)}catch(a){s=r,t._popupRedirectResolver._overrideRedirectResult(t,()=>Promise.reject(a))}return s?t.reloadAndSetCurrentUserOrClear(s):t.directlySetCurrentUser(null)}return x(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===s._redirectEventId?t.directlySetCurrentUser(s):t.reloadAndSetCurrentUserOrClear(s)})()}tryRedirectSignIn(e){var t=this;return(0,f.A)(function*(){let i=null;try{i=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return i})()}reloadAndSetCurrentUserOrClear(e){var t=this;return(0,f.A)(function*(){try{yield ca(e)}catch(i){if("auth/network-request-failed"!==i?.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function oU(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}()}_delete(){var e=this;return(0,f.A)(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return(0,f.A)(function*(){const i=e?(0,G.Ku)(e):null;return i&&x(i.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(i&&i._clone(t))})()}_updateCurrentUser(e,t=!1){var i=this;return(0,f.A)(function*(){if(!i._deleted)return e&&x(i.tenantId===e.tenantId,i,"tenant-id-mismatch"),t||(yield i.beforeStateQueue.runMiddleware(e)),i.queue((0,f.A)(function*(){yield i.directlySetCurrentUser(e),i.notifyAuthListeners()}))})()}signOut(){var e=this;return(0,f.A)(function*(){return yield e.beforeStateQueue.runMiddleware(null),(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null,!0)})()}setPersistence(e){var t=this;return this.queue((0,f.A)(function*(){yield t.assertedPersistence.setPersistence(vn(e))}))}initializeRecaptchaConfig(){var e=this;return(0,f.A)(function*(){const t=yield tx(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),i=new rx(t);null==e.tenantId?e._agentRecaptchaConfig=i:e._tenantRecaptchaConfigs[e.tenantId]=i,i.emailPasswordEnabled&&new ox(e).verify()})()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new G.FA("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var i=this;return(0,f.A)(function*(){const r=yield i.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return(0,f.A)(function*(){if(!t.redirectPersistenceManager){const i=e&&vn(e)||t._popupRedirectResolver;x(i,t,"argument-error"),t.redirectPersistenceManager=yield is.create(t,[vn(i._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return(0,f.A)(function*(){var i,r;return t._isInitialized&&(yield t.queue((0,f.A)(function*(){}))),(null===(i=t._currentUser)||void 0===i?void 0:i._redirectEventId)===e?t._currentUser:(null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return(0,f.A)(function*(){if(e===t.currentUser)return t.queue((0,f.A)(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return x(o,this,"internal-error"),o.then(()=>s(this.currentUser)),"function"==typeof t?e.addObserver(t,i,r):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return(0,f.A)(function*(){t.currentUser&&t.currentUser!==e&&t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh(),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return x(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ex(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return(0,f.A)(function*(){var t;const i={"X-Client-Version":e.clientVersion};e.app.options.appId&&(i["X-Firebase-gmpid"]=e.app.options.appId);const r=yield null===(t=e.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();r&&(i["X-Firebase-Client"]=r);const s=yield e._getAppCheckToken();return s&&(i["X-Firebase-AppCheck"]=s),i})()}_getAppCheckToken(){var e=this;return(0,f.A)(function*(){var t;const i=yield null===(t=e.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken();return i?.error&&function rU(n,...e){Hu.logLevel<=st.$b.WARN&&Hu.warn(`Auth (${At.MF}): ${n}`,...e)}(`Error while retrieving App Check token: ${i.error}`),i?.token})()}}function ze(n){return(0,G.Ku)(n)}class ax{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,G.tD)(t=>this.observer=t)}get next(){return x(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function cx(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ux(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}class la{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Qt("not implemented")}_getIdTokenResponse(e){return Qt("not implemented")}_linkToIdToken(e,t){return Qt("not implemented")}_getReauthenticationResolver(e){return Qt("not implemented")}}function In(n,e){return d_.apply(this,arguments)}function d_(){return d_=(0,f.A)(function*(n,e){return function _n(n,e,t,i){return Mg.apply(this,arguments)}(n,"POST","/v1/accounts:signInWithIdp",ve(n,e))}),d_.apply(this,arguments)}class rs extends la{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new rs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):gt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:i,signInMethod:r}=t,s=(0,Jr.Tt)(t,["providerId","signInMethod"]);if(!i||!r)return null;const o=new rs(i,r);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){return In(e,this.buildRequest())}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,In(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,In(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,G.Am)(t)}return e}}class Tn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class fx extends Tn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}let ha=(()=>{class n extends fx{constructor(){super("google.com"),this.addScope("profile")}static credential(t,i){return rs._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:i})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:i,oauthAccessToken:r}=t;if(!i&&!r)return null;try{return n.credential(i,r)}catch{return null}}}return n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com",n})();class xt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,i,r=!1){return(0,f.A)(function*(){const s=yield Qi._fromIdTokenResponse(e,i,r),o=px(i);return new xt({user:s,providerId:o,_tokenResponse:i,operationType:t})})()}static _forOperation(e,t,i){return(0,f.A)(function*(){yield e._updateTokensIfNecessary(i,!0);const r=px(i);return new xt({user:e,providerId:r,_tokenResponse:i,operationType:t})})()}}function px(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class tl extends G.g{constructor(e,t,i,r){var s;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,tl.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new tl(e,t,i,r)}}function mx(n,e,t,i){return("reauthenticate"===e?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw"auth/multi-factor-auth-required"===s.code?tl._fromErrorAndOperation(n,s,e,i):s})}function T_(){return T_=(0,f.A)(function*(n,e,t=!1){const i=yield yn(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return xt._forOperation(n,"link",i)}),T_.apply(this,arguments)}function w_(){return w_=(0,f.A)(function*(n,e,t=!1){const{auth:i}=n,r="reauthenticate";try{const s=yield yn(n,mx(i,r,e,n),t);x(s.idToken,i,"internal-error");const o=zu(s.idToken);x(o,i,"internal-error");const{sub:a}=o;return x(n.uid===a,i,"user-mismatch"),xt._forOperation(n,r,s)}catch(s){throw"auth/user-not-found"===s?.code&&gt(i,"user-mismatch"),s}}),w_.apply(this,arguments)}function b_(){return b_=(0,f.A)(function*(n,e,t=!1){const i="signIn",r=yield mx(n,i,e),s=yield xt._fromIdTokenResponse(n,i,r);return t||(yield n._updateCurrentUser(s.user)),s}),b_.apply(this,arguments)}class os{constructor(e,t,i={}){this.isNewUser=e,this.providerId=t,this.profile=i}}class Ix extends os{constructor(e,t,i,r){super(e,t,i),this.username=r}}class s2 extends os{constructor(e,t){super(e,"facebook.com",t)}}class o2 extends Ix{constructor(e,t){super(e,"github.com",t,"string"==typeof t?.login?t?.login:null)}}class a2 extends os{constructor(e,t){super(e,"google.com",t)}}class c2 extends Ix{constructor(e,t,i){super(e,"twitter.com",t,i)}}function Tx(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:function r2(n){var e,t;if(!n)return null;const{providerId:i}=n,r=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||"identitytoolkit#SignupNewUserResponse"===n.kind;if(!i&&n?.idToken){const o=null===(t=null===(e=zu(n.idToken))||void 0===e?void 0:e.firebase)||void 0===t?void 0:t.sign_in_provider;if(o)return new os(s,"anonymous"!==o&&"custom"!==o?o:null)}if(!i)return null;switch(i){case"facebook.com":return new s2(s,r);case"github.com":return new o2(s,r);case"google.com":return new a2(s,r);case"twitter.com":return new c2(s,r,n.screenName||null);case"custom":case"anonymous":return new os(s,null);default:return new os(s,i,r)}}(t)}const il="__sak";class Ex{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(il,"1"),this.storage.removeItem(il),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const v2=(()=>{class n extends Ex{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function g2(){const n=(0,G.ZQ)();return $g(n)||Yu(n)}()&&function wU(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=ZA(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const i of Object.keys(this.listeners)){const r=this.storage.getItem(i),s=this.localCache[i];r!==s&&t(i,s,r)}}onStorageEvent(t,i=!1){if(!t.key)return void this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});const r=t.key;if(i?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const a=this.storage.getItem(r);if(t.newValue!==a)null!==t.newValue?this.storage.setItem(r,t.newValue):this.storage.removeItem(r);else if(this.localCache[r]===t.newValue&&!i)return}const s=()=>{const a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);!function EU(){return(0,G.lT)()&&10===document.documentMode}()||o===t.newValue||t.newValue===t.oldValue?s():setTimeout(s,10)}notifyListeners(t,i){this.localCache[t]=i;const r=this.listeners[t];if(r)for(const s of Array.from(r))s(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(t,i){var r=()=>super._set,s=this;return(0,f.A)(function*(){yield r().call(s,t,i),s.localCache[t]=JSON.stringify(i)})()}_get(t){var i=()=>super._get,r=this;return(0,f.A)(function*(){const s=yield i().call(r,t);return r.localCache[t]=JSON.stringify(s),s})()}_remove(t){var i=()=>super._remove,r=this;return(0,f.A)(function*(){yield i().call(r,t),delete r.localCache[t]})()}}return n.type="LOCAL",n})(),wx=(()=>{class n extends Ex{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}return n.type="SESSION",n})();let T2=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const i=this.receivers.find(s=>s.isListeningto(t));if(i)return i;const r=new n(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}handleEvent(t){var i=this;return(0,f.A)(function*(){const r=t,{eventId:s,eventType:o,data:a}=r.data,c=i.handlersMap[o];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:s,eventType:o});const u=Array.from(c).map(function(){var h=(0,f.A)(function*(p){return p(r.origin,a)});return function(p){return h.apply(this,arguments)}}()),d=yield function I2(n){return Promise.all(n.map(function(){var e=(0,f.A)(function*(t){try{return{fulfilled:!0,value:yield t}}catch(i){return{fulfilled:!1,reason:i}}});return function(t){return e.apply(this,arguments)}}()))}(u);r.ports[0].postMessage({status:"done",eventId:s,eventType:o,response:d})})()}_subscribe(t,i){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||0===this.handlersMap[t].size)&&delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return n.receivers=[],n})();function rl(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(10*Math.random());return n+t}class E2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,i=50){var r=this;return(0,f.A)(function*(){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((c,u)=>{const d=rl("",20);s.port1.start();const h=setTimeout(()=>{u(new Error("unsupported_event"))},i);a={messageChannel:s,onMessage(p){const m=p;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(h),o=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),c(m.data.response);break;default:clearTimeout(h),clearTimeout(o),u(new Error("invalid_response"))}}},r.handlers.add(a),s.port1.addEventListener("message",a.onMessage),r.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&r.removeMessageHandler(a)})})()}}function Oe(){return window}function J_(){return typeof Oe().WorkerGlobalScope<"u"&&"function"==typeof Oe().importScripts}function Z_(){return(Z_=(0,f.A)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const bx="firebaseLocalStorageDb",sl="firebaseLocalStorage",Ax="fbase_key";class ma{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ol(n,e){return n.transaction([sl],e?"readwrite":"readonly").objectStore(sl)}function ey(){const n=indexedDB.open(bx,1);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(sl,{keyPath:Ax})}catch(r){t(r)}}),n.addEventListener("success",(0,f.A)(function*(){const i=n.result;i.objectStoreNames.contains(sl)?e(i):(i.close(),yield function C2(){const n=indexedDB.deleteDatabase(bx);return new ma(n).toPromise()}(),e(yield ey()))}))})}function xx(n,e,t){return ty.apply(this,arguments)}function ty(){return ty=(0,f.A)(function*(n,e,t){const i=ol(n,!0).put({[Ax]:e,value:t});return new ma(i).toPromise()}),ty.apply(this,arguments)}function ny(){return ny=(0,f.A)(function*(n,e){const t=ol(n,!1).get(e),i=yield new ma(t).toPromise();return void 0===i?null:i.value}),ny.apply(this,arguments)}function kx(n,e){const t=ol(n,!0).delete(e);return new ma(t).toPromise()}const P2=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var t=this;return(0,f.A)(function*(){return t.db||(t.db=yield ey()),t.db})()}_withRetries(t){var i=this;return(0,f.A)(function*(){let r=0;for(;;)try{const s=yield i._openDb();return yield t(s)}catch(s){if(r++>3)throw s;i.db&&(i.db.close(),i.db=void 0)}})()}initializeServiceWorkerMessaging(){var t=this;return(0,f.A)(function*(){return J_()?t.initializeReceiver():t.initializeSender()})()}initializeReceiver(){var t=this;return(0,f.A)(function*(){t.receiver=T2._getInstance(function x2(){return J_()?self:null}()),t.receiver._subscribe("keyChanged",function(){var i=(0,f.A)(function*(r,s){return{keyProcessed:(yield t._poll()).includes(s.key)}});return function(r,s){return i.apply(this,arguments)}}()),t.receiver._subscribe("ping",function(){var i=(0,f.A)(function*(r,s){return["keyChanged"]});return function(r,s){return i.apply(this,arguments)}}())})()}initializeSender(){var t=this;return(0,f.A)(function*(){var i,r;if(t.activeServiceWorker=yield function b2(){return Z_.apply(this,arguments)}(),!t.activeServiceWorker)return;t.sender=new E2(t.activeServiceWorker);const s=yield t.sender._send("ping",{},800);s&&null!==(i=s[0])&&void 0!==i&&i.fulfilled&&null!==(r=s[0])&&void 0!==r&&r.value.includes("keyChanged")&&(t.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(t){var i=this;return(0,f.A)(function*(){if(i.sender&&i.activeServiceWorker&&function A2(){var n;return(null===(n=navigator?.serviceWorker)||void 0===n?void 0:n.controller)||null}()===i.activeServiceWorker)try{yield i.sender._send("keyChanged",{key:t},i.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,f.A)(function*(){try{if(!indexedDB)return!1;const t=yield ey();return yield xx(t,il,"1"),yield kx(t,il),!0}catch{}return!1})()}_withPendingWrite(t){var i=this;return(0,f.A)(function*(){i.pendingWrites++;try{yield t()}finally{i.pendingWrites--}})()}_set(t,i){var r=this;return(0,f.A)(function*(){return r._withPendingWrite((0,f.A)(function*(){return yield r._withRetries(s=>xx(s,t,i)),r.localCache[t]=i,r.notifyServiceWorker(t)}))})()}_get(t){var i=this;return(0,f.A)(function*(){const r=yield i._withRetries(s=>function S2(n,e){return ny.apply(this,arguments)}(s,t));return i.localCache[t]=r,r})()}_remove(t){var i=this;return(0,f.A)(function*(){return i._withPendingWrite((0,f.A)(function*(){return yield i._withRetries(r=>kx(r,t)),delete i.localCache[t],i.notifyServiceWorker(t)}))})()}_poll(){var t=this;return(0,f.A)(function*(){const i=yield t._withRetries(o=>{const a=ol(o,!1).getAll();return new ma(a).toPromise()});if(!i)return[];if(0!==t.pendingWrites)return[];const r=[],s=new Set;for(const{fbase_key:o,value:a}of i)s.add(o),JSON.stringify(t.localCache[o])!==JSON.stringify(a)&&(t.notifyListeners(o,a),r.push(o));for(const o of Object.keys(t.localCache))t.localCache[o]&&!s.has(o)&&(t.notifyListeners(o,null),r.push(o));return r})()}notifyListeners(t,i){this.localCache[t]=i;const r=this.listeners[t];if(r)for(const s of Array.from(r))s(i)}startPolling(){var t=this;this.stopPolling(),this.pollTimer=setInterval((0,f.A)(function*(){return t._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return n.type="LOCAL",n})();function Xi(n,e){return e?vn(e):(x(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}sx("rcb"),new sa(3e4,6e4);class dy extends la{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return In(e,this._buildIdpRequest())}_linkToIdToken(e,t){return In(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return In(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function z2(n){return function yx(n,e){return b_.apply(this,arguments)}(n.auth,new dy(n),n.bypassAuthState)}function Q2(n){const{auth:e,user:t}=n;return x(t,e,"internal-error"),function _x(n,e){return w_.apply(this,arguments)}(t,new dy(n),n.bypassAuthState)}function Y2(n){return hy.apply(this,arguments)}function hy(){return hy=(0,f.A)(function*(n){const{auth:e,user:t}=n;return x(t,e,"internal-error"),function I_(n,e){return T_.apply(this,arguments)}(t,new dy(n),n.bypassAuthState)}),hy.apply(this,arguments)}class Sx{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=(0,f.A)(function*(i,r){e.pendingPromise={resolve:i,reject:r};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(s){e.reject(s)}});return function(i,r){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return(0,f.A)(function*(){const{urlResponse:i,sessionId:r,postBody:s,tenantId:o,error:a,type:c}=e;if(a)return void t.reject(a);const u={auth:t.auth,requestUri:i,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(c)(u))}catch(d){t.reject(d)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return z2;case"linkViaPopup":case"linkViaRedirect":return Y2;case"reauthViaPopup":case"reauthViaRedirect":return Q2;default:gt(this.auth,"internal-error")}}resolve(e){gn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const X2=new sa(2e3,1e4);function fy(){return fy=(0,f.A)(function*(n,e,t){const i=ze(n);!function ns(n,e,t){if(!(e instanceof t))throw t.name!==e.constructor.name&&gt(n,"argument-error"),UA(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(n,e,Tn);const r=Xi(i,t);return new gy(i,"signInViaPopup",e,r).executeNotNull()}),fy.apply(this,arguments)}let gy=(()=>{class n extends Sx{constructor(t,i,r,s,o){super(t,i,s,o),this.provider=r,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){var t=this;return(0,f.A)(function*(){const i=yield t.execute();return x(i,t.auth,"internal-error"),i})()}onExecution(){var t=this;return(0,f.A)(function*(){gn(1===t.filter.length,"Popup operations only handle one event");const i=rl();t.authWindow=yield t.resolver._openPopup(t.auth,t.provider,t.filter[0],i),t.authWindow.associatedEvent=i,t.resolver._originValidation(t.auth).catch(r=>{t.reject(r)}),t.resolver._isIframeWebStorageSupported(t.auth,r=>{r||t.reject(Et(t.auth,"web-storage-unsupported"))}),t.pollUserCancellation()})()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(Et(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){const t=()=>{var i,r;this.pollId=null!==(r=null===(i=this.authWindow)||void 0===i?void 0:i.window)&&void 0!==r&&r.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Et(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(t,X2.get())};t()}}return n.currentPopupAction=null,n})();const ga=new Map;class eV extends Sx{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}execute(){var e=()=>super.execute,t=this;return(0,f.A)(function*(){let i=ga.get(t.auth._key());if(!i){try{const s=(yield function tV(n,e){return _y.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;i=()=>Promise.resolve(s)}catch(r){i=()=>Promise.reject(r)}ga.set(t.auth._key(),i)}return t.bypassAuthState||ga.set(t.auth._key(),()=>Promise.resolve(null)),i()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,i=this;return(0,f.A)(function*(){if("signInViaRedirect"===e.type)return t().call(i,e);if("unknown"!==e.type){if(e.eventId){const r=yield i.auth._redirectUserForId(e.eventId);if(r)return i.user=r,t().call(i,e);i.resolve(null)}}else i.resolve(null)})()}onExecution(){return(0,f.A)(function*(){})()}cleanUp(){}}function _y(){return _y=(0,f.A)(function*(n,e){const t=function Nx(n){return Qu("pendingRedirect",n.config.apiKey,n.name)}(e),i=function Rx(n){return vn(n._redirectPersistence)}(n);if(!(yield i._isAvailable()))return!1;const r="true"===(yield i._get(t));return yield i._remove(t),r}),_y.apply(this,arguments)}function nV(n,e){ga.set(n._key(),e)}function wy(){return wy=(0,f.A)(function*(n,e){return yield ze(n)._initializationPromise,Px(n,e,!1)}),wy.apply(this,arguments)}function Px(n,e){return by.apply(this,arguments)}function by(){return by=(0,f.A)(function*(n,e,t=!1){const i=ze(n),r=Xi(i,e),o=yield new eV(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,e)),o}),by.apply(this,arguments)}class cV{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function uV(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Mx(n);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!Mx(e)){const r=(null===(i=e.error.code)||void 0===i?void 0:i.split("auth/")[1])||"internal-error";t.onError(Et(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ox(e))}saveEventToCache(e){this.cachedEventUids.add(Ox(e)),this.lastProcessedEventTime=Date.now()}}function Ox(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Mx({type:n,error:e}){return"unknown"===n&&"auth/no-auth-event"===e?.code}function xy(){return xy=(0,f.A)(function*(n,e={}){return be(n,"GET","/v1/projects",e)}),xy.apply(this,arguments)}const dV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hV=/^https?/;function ky(){return ky=(0,f.A)(function*(n){if(n.config.emulator)return;const{authorizedDomains:e}=yield function lV(n){return xy.apply(this,arguments)}(n);for(const t of e)try{if(pV(t))return}catch{}gt(n,"unauthorized-domain")}),ky.apply(this,arguments)}function pV(n){const e=ra(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return""===o.hostname&&""===i?"chrome-extension:"===t&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===t&&o.hostname===i}if(!hV.test(t))return!1;if(dV.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const mV=new sa(3e4,6e4);function Lx(){const n=Oe().___jsl;if(n?.H)for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}let cl=null;const yV=new sa(5e3,15e3),TV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function wV(n){const e=n.config;x(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Pg(e,"emulator/auth/iframe"):`https://${n.config.authDomain}/__/auth/iframe`,i={apiKey:e.apiKey,appName:n.name,v:At.MF},r=EV.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${(0,G.Am)(i).slice(1)}`}function Cy(){return Cy=(0,f.A)(function*(n){const e=yield function _V(n){return cl=cl||function gV(n){return new Promise((e,t)=>{var i,r,s;function o(){Lx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Lx(),t(Et(n,"network-request-failed"))},timeout:mV.get()})}if(null!==(r=null===(i=Oe().gapi)||void 0===i?void 0:i.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(s=Oe().gapi)||void 0===s||!s.load){const a=sx("iframefcb");return Oe()[a]=()=>{gapi.load?o():t(Et(n,"network-request-failed"))},zg(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}o()}}).catch(e=>{throw cl=null,e})}(n),cl}(n),t=Oe().gapi;return x(t,n,"internal-error"),e.open({where:document.body,url:wV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:TV,dontclear:!0},i=>new Promise(function(){var r=(0,f.A)(function*(s,o){yield i.restyle({setHideOnLeave:!1});const a=Et(n,"network-request-failed"),c=Oe().setTimeout(()=>{o(a)},yV.get());function u(){Oe().clearTimeout(c),s(i)}i.ping(u).then(u,()=>{o(a)})});return function(s,o){return r.apply(this,arguments)}}()))}),Cy.apply(this,arguments)}const AV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Fx{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const OV=encodeURIComponent("fac");function Ux(n,e,t,i,r,s){return Sy.apply(this,arguments)}function Sy(){return Sy=(0,f.A)(function*(n,e,t,i,r,s){x(n.config.authDomain,n,"auth-domain-config-required"),x(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:At.MF,eventId:r};if(e instanceof Tn){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",(0,G.Im)(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries(s||{}))o[d]=h}if(e instanceof fx){const d=e.getScopes().filter(h=>""!==h);d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))void 0===a[d]&&delete a[d];const c=yield n._getAppCheckToken(),u=c?`#${OV}=${encodeURIComponent(c)}`:"";return`${function MV({config:n}){return n.emulator?Pg(n,"emulator/auth/handler"):`https://${n.authDomain}/__/auth/handler`}(n)}?${(0,G.Am)(a).slice(1)}${u}`}),Sy.apply(this,arguments)}const Ry="webStorageSupport",FV=class LV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wx,this._completeRedirectFn=Px,this._overrideRedirectResult=nV}_openPopup(e,t,i,r){var s=this;return(0,f.A)(function*(){var o;gn(null===(o=s.eventManagers[e._key()])||void 0===o?void 0:o.manager,"_initialize() not called before _openPopup()");const a=yield Ux(e,t,i,ra(),r);return function RV(n,e,t,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},AV),{width:i.toString(),height:r.toString(),top:s,left:o}),u=(0,G.ZQ)().toLowerCase();t&&(a=zA(u)?"_blank":t),KA(u)&&(e=e||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce((p,[m,g])=>`${p}${m}=${g},`,"");if(function TU(n=(0,G.ZQ)()){var e;return Yu(n)&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(u)&&"_self"!==a)return function NV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}(e||"",a),new Fx(null);const h=window.open(e||"",a,d);x(h,n,"popup-blocked");try{h.focus()}catch{}return new Fx(h)}(e,a,rl())})()}_openRedirect(e,t,i,r){var s=this;return(0,f.A)(function*(){return yield s._originValidation(e),function w2(n){Oe().location.href=n}(yield Ux(e,t,i,ra(),r)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(gn(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}initAndGetManager(e){var t=this;return(0,f.A)(function*(){const i=yield function bV(n){return Cy.apply(this,arguments)}(e),r=new cV(e);return i.register("authEvent",s=>(x(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:r},t.iframes[e._key()]=i,r})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ry,{type:Ry},r=>{var s;const o=null===(s=r?.[0])||void 0===s?void 0:s[Ry];void 0!==o&&t(!!o),gt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function fV(n){return ky.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ZA()||$g()||Yu()}};var qx="@firebase/auth";class UV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return(0,f.A)(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){x(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const qV=(0,G.XA)("authIdTokenMaxAge")||300;let Wx=null;const jV=n=>function(){var e=(0,f.A)(function*(t){const i=t&&(yield t.getIdTokenResult()),r=i&&((new Date).getTime()-Date.parse(i.issuedAtTime))/1e3;if(r&&r>qV)return;const s=i?.token;Wx!==s&&(Wx=s,yield fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});return function(t){return e.apply(this,arguments)}}();function WV(n=(0,At.Sx)()){const e=(0,At.j6)(n,"auth");if(e.isInitialized())return e.getImmediate();const t=function NU(n,e){const t=(0,At.j6)(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if((0,G.bD)(s,e??{}))return r;gt(r,"already-initialized")}return t.initialize({options:e})}(n,{popupRedirectResolver:FV,persistence:[P2,v2,wx]}),i=(0,G.XA)("authTokenSyncURL");if(i){const s=jV(i);(function l2(n,e,t){(0,G.Ku)(n).beforeAuthStateChanged(e,t)})(t,s,()=>s(t.currentUser)),function u2(n,e,t,i){(0,G.Ku)(n).onIdTokenChanged(e,t,i)}(t,o=>s(o))}const r=(0,G.Tj)("auth");return r&&function DU(n,e,t){const i=ze(n);x(i._canInitEmulator,i,"emulator-config-failed"),x(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!!t?.disableWarnings,s=cx(e),{host:o,port:a}=function OU(n){const e=cx(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:ux(i.substr(s.length+1))}}{const[s,o]=i.split(":");return{host:s,port:ux(o)}}}(e);i.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function MU(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",n):n())}()}(t,`http://${r}`),t}!function GV(n){(0,At.om)(new MA.uA("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;x(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ex(n)},u=new RU(i,r,s,c);return function PU(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(vn);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),(0,At.om)(new MA.uA("auth-internal",e=>{const t=ze(e.getProvider("auth").getImmediate());return new UV(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,At.KO)(qx,"0.23.2",function VV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(n)),(0,At.KO)(qx,"0.23.2","esm2017")}("Browser");let $V=(()=>{class n{constructor(){this.auth=WV()}ngOnInit(){}signInAsEmail(){const t=new ha;(function J2(n,e,t){return fy.apply(this,arguments)})(this.auth,t).then(i=>{const s=ha.credentialFromResult(i).accessToken,o=i.user;let a=Tx(i);this.result={user:o,token:s,additionalInfo:a}}).catch(i=>{console.log(i),ha.credentialFromError(i)})}getRedirectResult1(){(function oV(n,e){return wy.apply(this,arguments)})(this.auth).then(t=>{const r=ha.credentialFromResult(t).accessToken,s=t.user;let o=Tx(t);this.result={user:s,token:r,additionalInfo:o},console.log(t)}).catch(t=>{ha.credentialFromError(t)})}signout(){(function d2(n){return(0,G.Ku)(n).signOut()})(this.auth).then(()=>{}).catch(t=>{})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-firebase-auth"]],standalone:!1,decls:8,vars:3,consts:[[3,"click"]],template:function(i,r){1&i&&(l.j41(0,"button",0),l.bIt("click",function(){return r.signInAsEmail()}),l.EFF(1,"signInAsEmail"),l.k0s(),l.j41(2,"button",0),l.bIt("click",function(){return r.getRedirectResult1()}),l.EFF(3,"getRedirectResult"),l.k0s(),l.j41(4,"button",0),l.bIt("click",function(){return r.signout()}),l.EFF(5,"signout"),l.k0s(),l.EFF(6),l.nI1(7,"json")),2&i&&(l.R7$(6),l.SpI(" ",l.bMT(7,1,r.result),"\n"))},dependencies:[T.JsonPipe],encapsulation:2})}}return n})(),HV=(()=>{class n{constructor(t){this.fdb=t}ngOnInit(){this.fdb.getUsers().subscribe(console.log)}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(q3))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-firebase-db"]],standalone:!1,decls:2,vars:0,template:function(i,r){1&i&&(l.j41(0,"p"),l.EFF(1,"firebase-db works!"),l.k0s())},encapsulation:2})}}return n})();function KV(n,e){if(1&n){const t=l.RV6();l.j41(0,"li"),l.EFF(1),l.j41(2,"a",5),l.bIt("click",function(){const r=l.eBV(t).$implicit,s=l.XpG(2);return l.Njj(s.deleteMessage(r))}),l.EFF(3,"Delete"),l.k0s()()}if(2&n){const t=e.$implicit;l.R7$(),l.SpI(" ",t.name," \u2014 ")}}function zV(n,e){if(1&n&&(l.j41(0,"ul"),l.DNE(1,KV,4,1,"li",4),l.k0s()),2&n){const t=l.XpG();l.R7$(),l.Y8G("ngForOf",t.posts)}}let QV=(()=>{class n{constructor(t){this.firebaseRealtimeDatabaseService=t,this.posts=[],this.form={name:""}}ngOnInit(){this.firebaseRealtimeDatabaseService.readRealtime$("posts").subscribe(t=>{this.posts=t})}addPost(){this.firebaseRealtimeDatabaseService.create("posts",this.form)}deleteMessage(t){}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(Q.h))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-realtime-db"]],standalone:!1,decls:6,vars:3,consts:[[4,"ngIf"],[3,"submit"],["type","text","name","message","autofocus","",3,"ngModelChange","ngModel"],["type","submit","value","Add Message"],[4,"ngFor","ngForOf"],[3,"click"]],template:function(i,r){1&i&&(l.j41(0,"h2"),l.EFF(1),l.k0s(),l.DNE(2,zV,2,1,"ul",0),l.j41(3,"form",1),l.bIt("submit",function(){return r.addPost()}),l.j41(4,"input",2),l.mxI("ngModelChange",function(o){return l.DH7(r.form.name,o)||(r.form.name=o),o}),l.k0s(),l.nrm(5,"input",3),l.k0s()),2&i&&(l.R7$(),l.SpI(" You Have ",null==r.posts?null:r.posts.length," Message(s)!\n"),l.R7$(),l.Y8G("ngIf",r.posts.length),l.R7$(2),l.R50("ngModel",r.form.name))},dependencies:[T.NgForOf,T.NgIf,U.qT,U.me,U.BC,U.cb,U.vS,U.cV],encapsulation:2})}}return n})();var YV=R(9781),XV=R(4917),JV=R(9991),Py=R(3853),ZV=R(4567);const e4=[{path:"",component:(()=>{class n{constructor(){}ngOnInit(){}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["app-firebase"]],standalone:!1,decls:23,vars:1,consts:[["theme","magenta",3,"defaultTheme"],["routerLink","realtime-presence"],["routerLink","realtime-presence","label","realtime presence"],["routerLink","counter","label","counter"],["routerLink","db-http","label","db http"],["routerLink","follow-system","label","follow system"],["routerLink","db","label","db"],["routerLink","db-http-2","label","db http 2"],["routerLink","task","label","task"],["routerLink","toast-notifications","label","toast-notifications"],["routerLink","voting","label","voting"],["routerLink","activities","label","activities"],["routerLink","employees","label","employees"],["routerLink","firestore","label","firestore"],["routerLink","auth","label","auth"]],template:function(i,r){1&i&&(l.j41(0,"ng-presentation",0)(1,"ng-header")(2,"h3"),l.EFF(3,"Bookmark"),l.k0s(),l.j41(4,"ng-nav-list")(5,"ng-nav-link",1),l.EFF(6,"realtime-presence"),l.k0s()()(),l.j41(7,"ng-sidenav"),l.nrm(8,"ng-sidenav-link",2)(9,"ng-sidenav-link",3)(10,"ng-sidenav-link",4)(11,"ng-sidenav-link",5)(12,"ng-sidenav-link",6)(13,"ng-sidenav-link",7)(14,"ng-sidenav-link",8)(15,"ng-sidenav-link",9)(16,"ng-sidenav-link",10)(17,"ng-sidenav-link",11)(18,"ng-sidenav-link",12)(19,"ng-sidenav-link",13)(20,"ng-sidenav-link",14),l.k0s(),l.j41(21,"ng-main"),l.nrm(22,"router-outlet"),l.k0s()()),2&i&&l.Y8G("defaultTheme",!1)},dependencies:[oe.n3,oe.Wk,YV.I,XV.e,JV.D,Py.K9,Py.lD,Py.xN,ZV.x],encapsulation:2})}}return n})(),children:[{path:"",redirectTo:"realtime-presence",pathMatch:"full"},{path:"realtime-presence",component:y},{path:"counter",component:hk},{path:"db-http",component:HV},{path:"follow-system",component:dk},{path:"db",component:QV},{path:"db-http-2",component:gk},{path:"task",component:Jx},{path:"toast-notifications",component:ik},{path:"voting",component:et},{path:"employees",loadChildren:()=>R.e(6451).then(R.bind(R,6451)).then(n=>n.EmployeesModule)},{path:"firestore",component:nU},{path:"auth",component:$V}]}];let t4=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=l.$C({type:n})}static{this.\u0275inj=l.G2t({imports:[oe.iI.forChild(e4),oe.iI]})}}return n})();var n4=R(1240),i4=R(4873);let r4=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=l.$C({type:n})}static{this.\u0275inj=l.G2t({imports:[T.CommonModule,U.YN,U.X1,t4,$u.pA,$u.Q_,DA.jr,ia.oJ,n4.d,i4.O]})}}return n})()},1240:(Yt,Ne,R)=>{R.d(Ne,{d:()=>kt});var T=R(177),y=(R(9781),R(4917),R(9991),R(4567),R(3853),R(1764),R(4438));let kt=(()=>{class et{static{this.\u0275fac=function(Zi){return new(Zi||et)}}static{this.\u0275mod=y.$C({type:et})}static{this.\u0275inj=y.G2t({imports:[T.CommonModule]})}}return et})()},1764:(Yt,Ne,R)=>{R.d(Ne,{m:()=>oe});var T=R(4438);let oe=(()=>{class l{constructor(Q){this.viewContainerRef=Q}static{this.\u0275fac=function(M){return new(M||l)(T.rXU(T.c1b))}}static{this.\u0275dir=T.FsC({type:l,selectors:[["","sidenavContentArea",""]],standalone:!1})}}return l})()},3853:(Yt,Ne,R)=>{R.d(Ne,{K9:()=>Ae,hM:()=>Q,lD:()=>l,xN:()=>oe});var T=R(4438);let oe=(()=>{class M{static{this.\u0275fac=function(ee){return new(ee||M)}}static{this.\u0275dir=T.FsC({type:M,selectors:[["ng-header"]],standalone:!1})}}return M})(),l=(()=>{class M{static{this.\u0275fac=function(ee){return new(ee||M)}}static{this.\u0275dir=T.FsC({type:M,selectors:[["ng-main"]],standalone:!1})}}return M})(),Ae=(()=>{class M{constructor(){this.shape="pilled"}static{this.\u0275fac=function(ee){return new(ee||M)}}static{this.\u0275dir=T.FsC({type:M,selectors:[["ng-sidenav"]],standalone:!1})}}return M})(),Q=(()=>{class M{static{this.\u0275fac=function(ee){return new(ee||M)}}static{this.\u0275dir=T.FsC({type:M,selectors:[["ng-footer"]],standalone:!1})}}return M})()},4567:(Yt,Ne,R)=>{R.d(Ne,{x:()=>Ae});var T=R(4438),oe=R(884);const l=["*"];let Ae=(()=>{class Q{constructor(){this.routerLinkActiveOptions={exact:!1}}static{this.\u0275fac=function(y){return new(y||Q)}}static{this.\u0275cmp=T.VBU({type:Q,selectors:[["ng-nav-link"]],inputs:{routerLink:"routerLink",label:"label",routerLinkActiveOptions:"routerLinkActiveOptions"},standalone:!1,ngContentSelectors:l,decls:3,vars:3,consts:[["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"]],template:function(y,ee){1&y&&(T.NAR(),T.j41(0,"a",0),T.SdG(1),T.EFF(2),T.k0s()),2&y&&(T.Y8G("routerLink",ee.routerLink)("routerLinkActiveOptions",ee.routerLinkActiveOptions),T.R7$(2),T.SpI(" ",ee.label,"\n"))},dependencies:[oe.Wk,oe.wQ],styles:["@media screen and (max-width: 700px){a[_ngcontent-%COMP%]{padding-left:2.5em}}"]})}}return Q})()},4917:(Yt,Ne,R)=>{R.d(Ne,{e:()=>Ae});var T=R(4438),oe=R(884);const l=["*"];let Ae=(()=>{class Q{constructor(){this.routerLinkActiveOptions={exact:!1}}static{this.\u0275fac=function(y){return new(y||Q)}}static{this.\u0275cmp=T.VBU({type:Q,selectors:[["ng-sidenav-link"]],inputs:{routerLink:"routerLink",label:"label",routerLinkActiveOptions:"routerLinkActiveOptions"},standalone:!1,ngContentSelectors:l,decls:3,vars:3,consts:[["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"]],template:function(y,ee){1&y&&(T.NAR(),T.j41(0,"a",0),T.SdG(1),T.EFF(2),T.k0s()),2&y&&(T.Y8G("routerLink",ee.routerLink)("routerLinkActiveOptions",ee.routerLinkActiveOptions),T.R7$(2),T.SpI(" ",ee.label,"\n"))},dependencies:[oe.Wk,oe.wQ],encapsulation:2})}}return Q})()},7428:(Yt,Ne,R)=>{R.d(Ne,{B2:()=>T,NY:()=>oe,x8:()=>M});var T=function(y){return y.black="#000000",y.white="#ffffff",y.darkGreen="darkgreen",y.indigo="indigo",y.purple="purple",y.brown="brown",y.lime="lime",y.teal="teal",y.custom1="rgb(172 72 0)",y.rose="#C51162",y.violet="#7B1FA2",y.azure="#0091EA",y.spring="#00C853",y.chartreuse="#AFB42B",y.orange="#F57C00",y.magenta="#C2185B",y.cyan="#0097A7",y.yellow="#FBC02D",y.blue="#1976D2",y.green="#388E3C",y.red="#D32F2F",y.danger="#a6192e",y.warning="#ff9900",y.success="#04b34f",y.info="#0057b8",y.dark="#000000",y.light="#ffffff",y.grey="#4b4f55",y.default="var(--primary-color-light)",y}(T||{}),oe=function(y){return y.black="#f6f6f6",y.white="#000000",y.darkGreen="#ffffff",y.indigo="#ffffff",y.purple="#ffffff",y.brown="#ffffff",y.lime="#000000",y.teal="#ffffff",y.custom1="#ffffff",y.rose="#ffffff",y.violet="#ffffff",y.azure="#000000",y.spring="#000000",y.chartreuse="#000000",y.orange="#000000",y.magenta="#ffffff",y.cyan="#000000",y.yellow="#000000",y.blue="#ffffff",y.green="#ffffff",y.red="#ffffff",y.danger="#ffffff",y.warning="#000000",y.success="#000000",y.info="#ffffff",y.dark="#f6f6f6",y.light="#333333",y.grey="#f6f6f6",y.default="var(--secondary-color)",y}(oe||{});const M=Object.keys(T)},7987:(Yt,Ne,R)=>{R.d(Ne,{G:()=>l});var T=R(467),oe=R(4438);let l=(()=>{class Ae{#e=[];#t;push(M){var Me=this;return(0,T.A)(function*(){Me.#e.push(M),Me.setContent(M)})()}pop(){var M=this;return(0,T.A)(function*(){1!==M.#e.length&&(M.#e.pop(),M.setContent(M.#e[M.#e.length-1]))})()}setDynamicContentArea(M){this.#t=M}setContent(M){this.#t?.viewContainerRef.clear(),this.#t?.viewContainerRef.createComponent(M)}clear(){this.#t?.viewContainerRef.clear()}get isEmpty(){return!this.#e.length}static{this.\u0275fac=function(Me){return new(Me||Ae)}}static{this.\u0275prov=oe.jDH({token:Ae,factory:Ae.\u0275fac,providedIn:"root"})}}return Ae})()},9781:(Yt,Ne,R)=>{R.d(Ne,{I:()=>y});var T=R(4438),oe=R(7428),l=R(1764),Ae=R(7987);const Q=[[["ng-header"]],[["ng-sidenav"]],[["ng-main"]]],M=["ng-header","ng-sidenav","ng-main"];function Me(ee,kt){}let y=(()=>{class ee{constructor(et){this.ele=et,this.theme="blue",this.defaultTheme=!0,this.sidenavService=(0,T.WQX)(Ae.G)}get ThemeColor(){return oe.B2[this.theme]}ngAfterViewInit(){if(this.defaultTheme&&this.setLayoutColor(),this.layoutColor&&!this.defaultTheme){let{headerColor:et,mainColor:U,sidebarColor:Ct}=this.layoutColor;this.setLayoutColor(et,Ct,U)}if(!this.sidenavContentArea)throw new Error("sidenavContentArea is undefined");this.sidenavService.setDynamicContentArea(this.sidenavContentArea)}setLayoutColor(et="#fff",U="#f8f8f8",Ct="#efefef"){this.ele.nativeElement.style.setProperty("--header-color",et),this.ele.nativeElement.style.setProperty("--sidebar-color",U),this.ele.nativeElement.style.setProperty("--main-color",Ct)}static{this.\u0275fac=function(U){return new(U||ee)(T.rXU(T.aKT))}}static{this.\u0275cmp=T.VBU({type:ee,selectors:[["ng-presentation"]],viewQuery:function(U,Ct){if(1&U&&T.GBs(l.m,7),2&U){let Zi;T.mGM(Zi=T.lsd())&&(Ct.sidenavContentArea=Zi.first)}},hostVars:2,hostBindings:function(U,Ct){2&U&&T.xc7("--theme-color",Ct.ThemeColor)},inputs:{theme:"theme",defaultTheme:"defaultTheme",layoutColor:"layoutColor"},standalone:!1,ngContentSelectors:M,decls:7,vars:0,consts:[["sidenavContentArea",""]],template:function(U,Ct){1&U&&(T.NAR(Q),T.j41(0,"header"),T.SdG(1),T.k0s(),T.j41(2,"aside"),T.SdG(3,1),T.DNE(4,Me,0,0,"ng-template",0),T.k0s(),T.j41(5,"main"),T.SdG(6,2),T.k0s())},dependencies:[l.m],styles:["*{padding:0;margin:0;box-sizing:border-box}:host{--top-bar-height: 70px;--sidebar-width: 220px;--theme-color: #2ebc4f;--theme-light-color: color-mix(in srgb, var(--theme-color) 20%, transparent);--theme-dark-color: color-mix(in srgb, var(--theme-color) 20%, black);--dark-color: #333;--dark-light-color: color-mix(in srgb, var(--dark-color) 20%, transparent);--header-color: #fff;--sidebar-color: #f8f8f8;--main-color: #efefef;--text-color: #1f1f1f;--shadow: 0 2px 1px rgba(0, 0, 0, .06);font-family:Arial,sans-serif;color:var(--text-color);font-size:14px;line-height:1.42857143;accent-color:var(--theme-color);display:grid;grid-template-columns:var(--sidebar-width) 1fr;min-height:100vh}:host header{grid-column:span 2;box-shadow:0 0 10px #00000026;width:100%;background-color:var(--header-color);padding:1rem;position:sticky;top:0;z-index:100}:host ng-header{display:flex;justify-content:space-between;align-items:center}:host aside{height:calc(100vh - var(--top-bar-height));overflow-y:auto;background-color:var(--sidebar-color);padding:1rem}@media (min-width: 701px){:host aside{position:sticky;left:0;top:var(--top-bar-height);z-index:100}}:host main{padding:1rem;overflow-x:hidden;background-color:var(--main-color)}@media (max-width: 700px){:host{grid-auto-flow:column;grid-template-columns:1fr;grid-template-rows:auto auto 1fr}:host aside{position:unset;height:auto}:host ng-sidenav{display:flex;gap:1rem;white-space:nowrap}}a{display:block;padding:8px 0;color:#666;text-decoration:none;cursor:pointer;font-size:12px}a:hover,a.active{color:var(--theme-color);text-decoration:underline}input,textarea,select{outline:none;height:32px;padding:0 80px 0 12px;border:solid 1px #e4e5ea;border-radius:4px;width:100%;background:#fff}input:focus,textarea:focus,select:focus{background-color:#eff3ff;border:solid 1px var(--theme-color, rgba(46, 188, 79, .6))}textarea{min-height:200px}.container{margin-right:auto;margin-left:auto;padding-left:20px;padding-right:20px;max-width:1140px}.card{display:flex;flex-direction:column;gap:.6rem;background:#fff;padding:1rem;box-shadow:var(--shadow);border-radius:8px}pre{color:#fff;background:#455e7b;padding:1em;border-radius:5px;white-space:pre-wrap;word-wrap:break-word;text-align:justify;overflow-x:auto;width:100%}pre>code{display:block;width:75vw}.nav-design a{text-decoration:none;display:inline-block;width:100%;padding:.6rem 1rem;color:var(--dark-color);white-space:nowrap;margin-bottom:.2rem}.nav-design a:hover{background:var(--dark-light-color)}.nav-design a.active{color:var(--theme-color);background:var(--theme-light-color)}.nav-design.squared a{border-radius:0}.nav-design.rounded a{border-radius:1rem}.nav-design.pilled a{border-radius:3rem}h1{margin-bottom:.75rem}\n"],encapsulation:3})}}return ee})()},9991:(Yt,Ne,R)=>{R.d(Ne,{D:()=>Ae});var T=R(4438);const oe=["openSidebarButton"],l=["*"];let Ae=(()=>{class Q{constructor(){this.show=!1}openSidebar(){this.show=!0}closeSidebar(){this.show=!1}static{this.\u0275fac=function(y){return new(y||Q)}}static{this.\u0275cmp=T.VBU({type:Q,selectors:[["ng-nav-list"]],viewQuery:function(y,ee){if(1&y&&T.GBs(oe,5),2&y){let kt;T.mGM(kt=T.lsd())&&(ee.openButtonEle=kt.first)}},standalone:!1,ngContentSelectors:l,decls:9,vars:2,consts:[["id","open-sidebar-button","aria-label","open sidebar","aria-expanded","false","aria-controls","navbar",3,"click"],["xmlns","http://www.w3.org/2000/svg","height","40px","viewBox","0 -960 960 960","width","40px","fill","#c9c9c9"],["d","M165.13-254.62q-10.68 0-17.9-7.26-7.23-7.26-7.23-18t7.23-17.86q7.22-7.13 17.9-7.13h629.74q10.68 0 17.9 7.26 7.23 7.26 7.23 18t-7.23 17.87q-7.22 7.12-17.9 7.12H165.13Zm0-200.25q-10.68 0-17.9-7.27-7.23-7.26-7.23-17.99 0-10.74 7.23-17.87 7.22-7.13 17.9-7.13h629.74q10.68 0 17.9 7.27 7.23 7.26 7.23 17.99 0 10.74-7.23 17.87-7.22 7.13-17.9 7.13H165.13Zm0-200.26q-10.68 0-17.9-7.26-7.23-7.26-7.23-18t7.23-17.87q7.22-7.12 17.9-7.12h629.74q10.68 0 17.9 7.26 7.23 7.26 7.23 18t-7.23 17.86q-7.22 7.13-17.9 7.13H165.13Z"],["id","close-sidebar-button","aria-label","close sidebar",3,"click"],["d","m480-444.62-209.69 209.7q-7.23 7.23-17.5 7.42-10.27.19-17.89-7.42-7.61-7.62-7.61-17.7 0-10.07 7.61-17.69L444.62-480l-209.7-209.69q-7.23-7.23-7.42-17.5-.19-10.27 7.42-17.89 7.62-7.61 17.7-7.61 10.07 0 17.69 7.61L480-515.38l209.69-209.7q7.23-7.23 17.5-7.42 10.27-.19 17.89 7.42 7.61 7.62 7.61 17.7 0 10.07-7.61 17.69L515.38-480l209.7 209.69q7.23 7.23 7.42 17.5.19 10.27-7.42 17.89-7.62 7.61-17.7 7.61-10.07 0-17.69-7.61L480-444.62Z"],["id","overlay","aria-hidden","true",3,"click"]],template:function(y,ee){1&y&&(T.NAR(),T.j41(0,"button",0),T.bIt("click",function(){return ee.openSidebar()}),T.qSk(),T.j41(1,"svg",1),T.nrm(2,"path",2),T.k0s()(),T.joV(),T.j41(3,"nav")(4,"button",3),T.bIt("click",function(){return ee.closeSidebar()}),T.qSk(),T.j41(5,"svg",1),T.nrm(6,"path",4),T.k0s()(),T.SdG(7),T.k0s(),T.joV(),T.j41(8,"div",5),T.bIt("click",function(){return ee.closeSidebar()}),T.k0s()),2&y&&(T.R7$(3),T.AVh("show",ee.show))},styles:["nav[_ngcontent-%COMP%]{display:flex;gap:1rem}@media screen and (max-width: 700px){nav[_ngcontent-%COMP%]{flex-direction:column;position:fixed;top:0;right:-100%;height:100vh;width:min(15em,100%);z-index:10;border-left:1px solid var(--theme-color);transition:right .3s ease-in-out;background-color:var(--header-color)}nav.show[_ngcontent-%COMP%]{right:0}nav.show[_ngcontent-%COMP%] ~ #overlay[_ngcontent-%COMP%]{display:block}}#open-sidebar-button[_ngcontent-%COMP%]{display:none;background:none;border:none;padding:1em;margin-left:auto;cursor:pointer}#close-sidebar-button[_ngcontent-%COMP%]{display:none;background:none;border:none;padding:1em;cursor:pointer}#overlay[_ngcontent-%COMP%]{background:#00000080;position:fixed;inset:0;z-index:9;display:none}@media screen and (max-width: 700px){#open-sidebar-button[_ngcontent-%COMP%], #close-sidebar-button[_ngcontent-%COMP%]{display:flex}}"]})}}return Q})()}}]);